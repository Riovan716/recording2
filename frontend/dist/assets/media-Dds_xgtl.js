var Sr={},Ot={exports:{}},br,Jr;function tn(){if(Jr)return br;Jr=1;var S=1e3,D=S*60,R=D*60,u=R*24,T=u*7,v=u*365.25;br=function(h,c){c=c||{};var f=typeof h;if(f==="string"&&h.length>0)return _(h);if(f==="number"&&isFinite(h))return c.long?y(h):g(h);throw new Error("val is not a non-empty string or a valid number. val="+JSON.stringify(h))};function _(h){if(h=String(h),!(h.length>100)){var c=/^(-?(?:\d+)?\.?\d+) *(milliseconds?|msecs?|ms|seconds?|secs?|s|minutes?|mins?|m|hours?|hrs?|h|days?|d|weeks?|w|years?|yrs?|y)?$/i.exec(h);if(c){var f=parseFloat(c[1]),m=(c[2]||"ms").toLowerCase();switch(m){case"years":case"year":case"yrs":case"yr":case"y":return f*v;case"weeks":case"week":case"w":return f*T;case"days":case"day":case"d":return f*u;case"hours":case"hour":case"hrs":case"hr":case"h":return f*R;case"minutes":case"minute":case"mins":case"min":case"m":return f*D;case"seconds":case"second":case"secs":case"sec":case"s":return f*S;case"milliseconds":case"millisecond":case"msecs":case"msec":case"ms":return f;default:return}}}}function g(h){var c=Math.abs(h);return c>=u?Math.round(h/u)+"d":c>=R?Math.round(h/R)+"h":c>=D?Math.round(h/D)+"m":c>=S?Math.round(h/S)+"s":h+"ms"}function y(h){var c=Math.abs(h);return c>=u?b(h,c,u,"day"):c>=R?b(h,c,R,"hour"):c>=D?b(h,c,D,"minute"):c>=S?b(h,c,S,"second"):h+" ms"}function b(h,c,f,m){var a=c>=f*1.5;return Math.round(h/f)+" "+m+(a?"s":"")}return br}var yr,Zr;function rn(){if(Zr)return yr;Zr=1;function S(D){u.debug=u,u.default=u,u.coerce=b,u.disable=g,u.enable=v,u.enabled=y,u.humanize=tn(),u.destroy=h,Object.keys(D).forEach(c=>{u[c]=D[c]}),u.names=[],u.skips=[],u.formatters={};function R(c){let f=0;for(let m=0;m<c.length;m++)f=(f<<5)-f+c.charCodeAt(m),f|=0;return u.colors[Math.abs(f)%u.colors.length]}u.selectColor=R;function u(c){let f,m=null,a,s;function e(...t){if(!e.enabled)return;const i=e,r=Number(new Date),n=r-(f||r);i.diff=n,i.prev=f,i.curr=r,f=r,t[0]=u.coerce(t[0]),typeof t[0]!="string"&&t.unshift("%O");let o=0;t[0]=t[0].replace(/%([a-zA-Z%])/g,(l,w)=>{if(l==="%%")return"%";o++;const d=u.formatters[w];if(typeof d=="function"){const P=t[o];l=d.call(i,P),t.splice(o,1),o--}return l}),u.formatArgs.call(i,t),(i.log||u.log).apply(i,t)}return e.namespace=c,e.useColors=u.useColors(),e.color=u.selectColor(c),e.extend=T,e.destroy=u.destroy,Object.defineProperty(e,"enabled",{enumerable:!0,configurable:!1,get:()=>m!==null?m:(a!==u.namespaces&&(a=u.namespaces,s=u.enabled(c)),s),set:t=>{m=t}}),typeof u.init=="function"&&u.init(e),e}function T(c,f){const m=u(this.namespace+(typeof f>"u"?":":f)+c);return m.log=this.log,m}function v(c){u.save(c),u.namespaces=c,u.names=[],u.skips=[];const f=(typeof c=="string"?c:"").trim().replace(/\s+/g,",").split(",").filter(Boolean);for(const m of f)m[0]==="-"?u.skips.push(m.slice(1)):u.names.push(m)}function _(c,f){let m=0,a=0,s=-1,e=0;for(;m<c.length;)if(a<f.length&&(f[a]===c[m]||f[a]==="*"))f[a]==="*"?(s=a,e=m,a++):(m++,a++);else if(s!==-1)a=s+1,e++,m=e;else return!1;for(;a<f.length&&f[a]==="*";)a++;return a===f.length}function g(){const c=[...u.names,...u.skips.map(f=>"-"+f)].join(",");return u.enable(""),c}function y(c){for(const f of u.skips)if(_(c,f))return!1;for(const f of u.names)if(_(c,f))return!0;return!1}function b(c){return c instanceof Error?c.stack||c.message:c}function h(){console.warn("Instance method `debug.destroy()` is deprecated and no longer does anything. It will be removed in the next major version of `debug`.")}return u.enable(u.load()),u}return yr=S,yr}var es;function er(){return es||(es=1,function(S,D){var R={};D.formatArgs=T,D.save=v,D.load=_,D.useColors=u,D.storage=g(),D.destroy=(()=>{let b=!1;return()=>{b||(b=!0,console.warn("Instance method `debug.destroy()` is deprecated and no longer does anything. It will be removed in the next major version of `debug`."))}})(),D.colors=["#0000CC","#0000FF","#0033CC","#0033FF","#0066CC","#0066FF","#0099CC","#0099FF","#00CC00","#00CC33","#00CC66","#00CC99","#00CCCC","#00CCFF","#3300CC","#3300FF","#3333CC","#3333FF","#3366CC","#3366FF","#3399CC","#3399FF","#33CC00","#33CC33","#33CC66","#33CC99","#33CCCC","#33CCFF","#6600CC","#6600FF","#6633CC","#6633FF","#66CC00","#66CC33","#9900CC","#9900FF","#9933CC","#9933FF","#99CC00","#99CC33","#CC0000","#CC0033","#CC0066","#CC0099","#CC00CC","#CC00FF","#CC3300","#CC3333","#CC3366","#CC3399","#CC33CC","#CC33FF","#CC6600","#CC6633","#CC9900","#CC9933","#CCCC00","#CCCC33","#FF0000","#FF0033","#FF0066","#FF0099","#FF00CC","#FF00FF","#FF3300","#FF3333","#FF3366","#FF3399","#FF33CC","#FF33FF","#FF6600","#FF6633","#FF9900","#FF9933","#FFCC00","#FFCC33"];function u(){if(typeof window<"u"&&window.process&&(window.process.type==="renderer"||window.process.__nwjs))return!0;if(typeof navigator<"u"&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/(edge|trident)\/(\d+)/))return!1;let b;return typeof document<"u"&&document.documentElement&&document.documentElement.style&&document.documentElement.style.WebkitAppearance||typeof window<"u"&&window.console&&(window.console.firebug||window.console.exception&&window.console.table)||typeof navigator<"u"&&navigator.userAgent&&(b=navigator.userAgent.toLowerCase().match(/firefox\/(\d+)/))&&parseInt(b[1],10)>=31||typeof navigator<"u"&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/applewebkit\/(\d+)/)}function T(b){if(b[0]=(this.useColors?"%c":"")+this.namespace+(this.useColors?" %c":" ")+b[0]+(this.useColors?"%c ":" ")+"+"+S.exports.humanize(this.diff),!this.useColors)return;const h="color: "+this.color;b.splice(1,0,h,"color: inherit");let c=0,f=0;b[0].replace(/%[a-zA-Z%]/g,m=>{m!=="%%"&&(c++,m==="%c"&&(f=c))}),b.splice(f,0,h)}D.log=console.debug||console.log||(()=>{});function v(b){try{b?D.storage.setItem("debug",b):D.storage.removeItem("debug")}catch{}}function _(){let b;try{b=D.storage.getItem("debug")||D.storage.getItem("DEBUG")}catch{}return!b&&typeof process<"u"&&"env"in process&&(b=R.DEBUG),b}function g(){try{return localStorage}catch{}}S.exports=rn()(D);const{formatters:y}=S.exports;y.j=function(b){try{return JSON.stringify(b)}catch(h){return"[UnexpectedJSONParseError]: "+h.message}}}(Ot,Ot.exports)),Ot.exports}var Ce={},Te={},Ct={exports:{}},sn=Ct.exports,ts;function nn(){return ts||(ts=1,function(S,D){(function(R,u){var T="2.0.4",v=500,_="user-agent",g="",y="?",b="function",h="undefined",c="object",f="string",m="browser",a="cpu",s="device",e="engine",t="os",i="result",r="name",n="type",o="vendor",p="version",l="architecture",w="major",d="model",P="console",k="mobile",x="tablet",C="smarttv",E="wearable",I="xr",L="embedded",O="inapp",F="brands",$="formFactors",H="fullVersionList",J="platform",ye="platformVersion",me="bitness",ie="sec-ch-ua",Le=ie+"-full-version-list",Hi=ie+"-arch",Vi=ie+"-"+me,Ki=ie+"-form-factors",Gi=ie+"-"+k,Qi=ie+"-"+d,Or=ie+"-"+J,Wi=Or+"-version",jr=[F,H,k,d,J,ye,l,$,me],Tt="Amazon",Ie="Apple",Ar="ASUS",Nr="BlackBerry",Re="Google",Fr="Huawei",nr="Lenovo",Ur="Honor",Dt="LG",ar="Microsoft",or="Motorola",cr="Nvidia",qr="OnePlus",dr="OPPO",$e="Samsung",$r="Sharp",Be="Sony",pr="Xiaomi",lr="Zebra",Br="Chrome",zr="Chromium",ge="Chromecast",Pt="Edge",ze="Firefox",He="Opera",ur="Facebook",Hr="Sogou",Me="Mobile ",Ve=" Browser",hr="Windows",Vr=typeof R!==h,ee=Vr&&R.navigator?R.navigator:u,_e=ee&&ee.userAgentData?ee.userAgentData:u,Yi=function(M,A){var N={},z=A;if(!Et(A)){z={};for(var U in A)for(var V in A[U])z[V]=A[U][V].concat(z[V]?z[V]:[])}for(var j in M)N[j]=z[j]&&z[j].length%2===0?z[j].concat(M[j]):M[j];return N},kt=function(M){for(var A={},N=0;N<M.length;N++)A[M[N].toUpperCase()]=M[N];return A},fr=function(M,A){if(typeof M===c&&M.length>0){for(var N in M)if(le(A)==le(M[N]))return!0;return!1}return Oe(M)?le(A)==le(M):!1},Et=function(M,A){for(var N in M)return/^(browser|cpu|device|engine|os)$/.test(N)||(A?Et(M[N]):!1)},Oe=function(M){return typeof M===f},mr=function(M){if(!M)return u;for(var A=[],N=je(/\\?\"/g,M).split(","),z=0;z<N.length;z++)if(N[z].indexOf(";")>-1){var U=xt(N[z]).split(";v=");A[z]={brand:U[0],version:U[1]}}else A[z]=xt(N[z]);return A},le=function(M){return Oe(M)?M.toLowerCase():M},gr=function(M){return Oe(M)?je(/[^\d\.]/g,M).split(".")[0]:u},ue=function(M){for(var A in M){var N=M[A];typeof N==c&&N.length==2?this[N[0]]=N[1]:this[N]=u}return this},je=function(M,A){return Oe(A)?A.replace(M,g):A},Ke=function(M){return je(/\\?\"/g,M)},xt=function(M,A){if(Oe(M))return M=je(/^\s\s*/,M),typeof A===h?M:M.substring(0,v)},_r=function(M,A){if(!(!M||!A))for(var N=0,z,U,V,j,B,q;N<A.length&&!B;){var K=A[N],he=A[N+1];for(z=U=0;z<K.length&&!B&&K[z];)if(B=K[z++].exec(M),B)for(V=0;V<he.length;V++)q=B[++U],j=he[V],typeof j===c&&j.length>0?j.length===2?typeof j[1]==b?this[j[0]]=j[1].call(this,q):this[j[0]]=j[1]:j.length>=3&&(typeof j[1]===b&&!(j[1].exec&&j[1].test)?j.length>3?this[j[0]]=q?j[1].apply(this,j.slice(2)):u:this[j[0]]=q?j[1].call(this,q,j[2]):u:j.length==3?this[j[0]]=q?q.replace(j[1],j[2]):u:j.length==4?this[j[0]]=q?j[3].call(this,q.replace(j[1],j[2])):u:j.length>4&&(this[j[0]]=q?j[3].apply(this,[q.replace(j[1],j[2])].concat(j.slice(4))):u)):this[j]=q||u;N+=2}},de=function(M,A){for(var N in A)if(typeof A[N]===c&&A[N].length>0){for(var z=0;z<A[N].length;z++)if(fr(A[N][z],M))return N===y?u:N}else if(fr(A[N],M))return N===y?u:N;return A.hasOwnProperty("*")?A["*"]:M},Kr={ME:"4.90","NT 3.51":"3.51","NT 4.0":"4.0",2e3:["5.0","5.01"],XP:["5.1","5.2"],Vista:"6.0",7:"6.1",8:"6.2","8.1":"6.3",10:["6.4","10.0"],NT:""},Gr={embedded:"Automotive",mobile:"Mobile",tablet:["Tablet","EInk"],smarttv:"TV",wearable:"Watch",xr:["VR","XR"],"?":["Desktop","Unknown"],"*":u},Xi={Chrome:"Google Chrome",Edge:"Microsoft Edge","Edge WebView2":"Microsoft Edge WebView2","Chrome WebView":"Android WebView","Chrome Headless":"HeadlessChrome","Huawei Browser":"HuaweiBrowser","MIUI Browser":"Miui Browser","Opera Mobi":"OperaMobile",Yandex:"YaBrowser"},Qr={browser:[[/\b(?:crmo|crios)\/([\w\.]+)/i],[p,[r,Me+"Chrome"]],[/webview.+edge\/([\w\.]+)/i],[p,[r,Pt+" WebView"]],[/edg(?:e|ios|a)?\/([\w\.]+)/i],[p,[r,"Edge"]],[/(opera mini)\/([-\w\.]+)/i,/(opera [mobiletab]{3,6})\b.+version\/([-\w\.]+)/i,/(opera)(?:.+version\/|[\/ ]+)([\w\.]+)/i],[r,p],[/opios[\/ ]+([\w\.]+)/i],[p,[r,He+" Mini"]],[/\bop(?:rg)?x\/([\w\.]+)/i],[p,[r,He+" GX"]],[/\bopr\/([\w\.]+)/i],[p,[r,He]],[/\bb[ai]*d(?:uhd|[ub]*[aekoprswx]{5,6})[\/ ]?([\w\.]+)/i],[p,[r,"Baidu"]],[/\b(?:mxbrowser|mxios|myie2)\/?([-\w\.]*)\b/i],[p,[r,"Maxthon"]],[/(kindle)\/([\w\.]+)/i,/(lunascape|maxthon|netfront|jasmine|blazer|sleipnir)[\/ ]?([\w\.]*)/i,/(avant|iemobile|slim(?:browser|boat|jet))[\/ ]?([\d\.]*)/i,/(?:ms|\()(ie) ([\w\.]+)/i,/(flock|rockmelt|midori|epiphany|silk|skyfire|ovibrowser|bolt|iron|vivaldi|iridium|phantomjs|bowser|qupzilla|falkon|rekonq|puffin|brave|whale(?!.+naver)|qqbrowserlite|duckduckgo|klar|helio|(?=comodo_)?dragon|otter|dooble|(?:lg |qute)browser)\/([-\w\.]+)/i,/(heytap|ovi|115|surf)browser\/([\d\.]+)/i,/(ecosia|weibo)(?:__| \w+@)([\d\.]+)/i],[r,p],[/quark(?:pc)?\/([-\w\.]+)/i],[p,[r,"Quark"]],[/\bddg\/([\w\.]+)/i],[p,[r,"DuckDuckGo"]],[/(?:\buc? ?browser|(?:juc.+)ucweb)[\/ ]?([\w\.]+)/i],[p,[r,"UCBrowser"]],[/microm.+\bqbcore\/([\w\.]+)/i,/\bqbcore\/([\w\.]+).+microm/i,/micromessenger\/([\w\.]+)/i],[p,[r,"WeChat"]],[/konqueror\/([\w\.]+)/i],[p,[r,"Konqueror"]],[/trident.+rv[: ]([\w\.]{1,9})\b.+like gecko/i],[p,[r,"IE"]],[/ya(?:search)?browser\/([\w\.]+)/i],[p,[r,"Yandex"]],[/slbrowser\/([\w\.]+)/i],[p,[r,"Smart "+nr+Ve]],[/(avast|avg)\/([\w\.]+)/i],[[r,/(.+)/,"$1 Secure"+Ve],p],[/\bfocus\/([\w\.]+)/i],[p,[r,ze+" Focus"]],[/\bopt\/([\w\.]+)/i],[p,[r,He+" Touch"]],[/coc_coc\w+\/([\w\.]+)/i],[p,[r,"Coc Coc"]],[/dolfin\/([\w\.]+)/i],[p,[r,"Dolphin"]],[/coast\/([\w\.]+)/i],[p,[r,He+" Coast"]],[/miuibrowser\/([\w\.]+)/i],[p,[r,"MIUI"+Ve]],[/fxios\/([\w\.-]+)/i],[p,[r,Me+ze]],[/\bqihoobrowser\/?([\w\.]*)/i],[p,[r,"360"]],[/\b(qq)\/([\w\.]+)/i],[[r,/(.+)/,"$1Browser"],p],[/(oculus|sailfish|huawei|vivo|pico)browser\/([\w\.]+)/i],[[r,/(.+)/,"$1"+Ve],p],[/samsungbrowser\/([\w\.]+)/i],[p,[r,$e+" Internet"]],[/metasr[\/ ]?([\d\.]+)/i],[p,[r,Hr+" Explorer"]],[/(sogou)mo\w+\/([\d\.]+)/i],[[r,Hr+" Mobile"],p],[/(electron)\/([\w\.]+) safari/i,/(tesla)(?: qtcarbrowser|\/(20\d\d\.[-\w\.]+))/i,/m?(qqbrowser|2345(?=browser|chrome|explorer))\w*[\/ ]?v?([\w\.]+)/i],[r,p],[/(lbbrowser|rekonq)/i],[r],[/ome\/([\w\.]+) \w* ?(iron) saf/i,/ome\/([\w\.]+).+qihu (360)[es]e/i],[p,r],[/((?:fban\/fbios|fb_iab\/fb4a)(?!.+fbav)|;fbav\/([\w\.]+);)/i],[[r,ur],p,[n,O]],[/(kakao(?:talk|story))[\/ ]([\w\.]+)/i,/(naver)\(.*?(\d+\.[\w\.]+).*\)/i,/(daum)apps[\/ ]([\w\.]+)/i,/safari (line)\/([\w\.]+)/i,/\b(line)\/([\w\.]+)\/iab/i,/(alipay)client\/([\w\.]+)/i,/(twitter)(?:and| f.+e\/([\w\.]+))/i,/(instagram|snapchat|klarna)[\/ ]([-\w\.]+)/i],[r,p,[n,O]],[/\bgsa\/([\w\.]+) .*safari\//i],[p,[r,"GSA"],[n,O]],[/musical_ly(?:.+app_?version\/|_)([\w\.]+)/i],[p,[r,"TikTok"],[n,O]],[/\[(linkedin)app\]/i],[r,[n,O]],[/(chromium)[\/ ]([-\w\.]+)/i],[r,p],[/headlesschrome(?:\/([\w\.]+)| )/i],[p,[r,Br+" Headless"]],[/wv\).+chrome\/([\w\.]+).+edgw\//i],[p,[r,Pt+" WebView2"]],[/ wv\).+(chrome)\/([\w\.]+)/i],[[r,Br+" WebView"],p],[/droid.+ version\/([\w\.]+)\b.+(?:mobile safari|safari)/i],[p,[r,"Android"+Ve]],[/chrome\/([\w\.]+) mobile/i],[p,[r,Me+"Chrome"]],[/(chrome|omniweb|arora|[tizenoka]{5} ?browser)\/v?([\w\.]+)/i],[r,p],[/version\/([\w\.\,]+) .*mobile(?:\/\w+ | ?)safari/i],[p,[r,Me+"Safari"]],[/iphone .*mobile(?:\/\w+ | ?)safari/i],[[r,Me+"Safari"]],[/version\/([\w\.\,]+) .*(safari)/i],[p,r],[/webkit.+?(mobile ?safari|safari)(\/[\w\.]+)/i],[r,[p,"1"]],[/(webkit|khtml)\/([\w\.]+)/i],[r,p],[/(?:mobile|tablet);.*(firefox)\/([\w\.-]+)/i],[[r,Me+ze],p],[/(navigator|netscape\d?)\/([-\w\.]+)/i],[[r,"Netscape"],p],[/(wolvic|librewolf)\/([\w\.]+)/i],[r,p],[/mobile vr; rv:([\w\.]+)\).+firefox/i],[p,[r,ze+" Reality"]],[/ekiohf.+(flow)\/([\w\.]+)/i,/(swiftfox)/i,/(icedragon|iceweasel|camino|chimera|fennec|maemo browser|minimo|conkeror)[\/ ]?([\w\.\+]+)/i,/(seamonkey|k-meleon|icecat|iceape|firebird|phoenix|palemoon|basilisk|waterfox)\/([-\w\.]+)$/i,/(firefox)\/([\w\.]+)/i,/(mozilla)\/([\w\.]+) .+rv\:.+gecko\/\d+/i,/(amaya|dillo|doris|icab|ladybird|lynx|mosaic|netsurf|obigo|polaris|w3m|(?:go|ice|up)[\. ]?browser)[-\/ ]?v?([\w\.]+)/i,/\b(links) \(([\w\.]+)/i],[r,[p,/_/g,"."]],[/(cobalt)\/([\w\.]+)/i],[r,[p,/[^\d\.]+./,g]]],cpu:[[/\b((amd|x|x86[-_]?|wow|win)64)\b/i],[[l,"amd64"]],[/(ia32(?=;))/i,/\b((i[346]|x)86)(pc)?\b/i],[[l,"ia32"]],[/\b(aarch64|arm(v?[89]e?l?|_?64))\b/i],[[l,"arm64"]],[/\b(arm(v[67])?ht?n?[fl]p?)\b/i],[[l,"armhf"]],[/( (ce|mobile); ppc;|\/[\w\.]+arm\b)/i],[[l,"arm"]],[/((ppc|powerpc)(64)?)( mac|;|\))/i],[[l,/ower/,g,le]],[/ sun4\w[;\)]/i],[[l,"sparc"]],[/\b(avr32|ia64(?=;)|68k(?=\))|\barm(?=v([1-7]|[5-7]1)l?|;|eabi)|(irix|mips|sparc)(64)?\b|pa-risc)/i],[[l,le]]],device:[[/\b(sch-i[89]0\d|shw-m380s|sm-[ptx]\w{2,4}|gt-[pn]\d{2,4}|sgh-t8[56]9|nexus 10)/i],[d,[o,$e],[n,x]],[/\b((?:s[cgp]h|gt|sm)-(?![lr])\w+|sc[g-]?[\d]+a?|galaxy nexus)/i,/samsung[- ]((?!sm-[lr]|browser)[-\w]+)/i,/sec-(sgh\w+)/i],[d,[o,$e],[n,k]],[/(?:\/|\()(ip(?:hone|od)[\w, ]*)(?:\/|;)/i],[d,[o,Ie],[n,k]],[/\((ipad);[-\w\),; ]+apple/i,/applecoremedia\/[\w\.]+ \((ipad)/i,/\b(ipad)\d\d?,\d\d?[;\]].+ios/i],[d,[o,Ie],[n,x]],[/(macintosh);/i],[d,[o,Ie]],[/\b(sh-?[altvz]?\d\d[a-ekm]?)/i],[d,[o,$r],[n,k]],[/\b((?:brt|eln|hey2?|gdi|jdn)-a?[lnw]09|(?:ag[rm]3?|jdn2|kob2)-a?[lw]0[09]hn)(?: bui|\)|;)/i],[d,[o,Ur],[n,x]],[/honor([-\w ]+)[;\)]/i],[d,[o,Ur],[n,k]],[/\b((?:ag[rs][2356]?k?|bah[234]?|bg[2o]|bt[kv]|cmr|cpn|db[ry]2?|jdn2|got|kob2?k?|mon|pce|scm|sht?|[tw]gr|vrd)-[ad]?[lw][0125][09]b?|605hw|bg2-u03|(?:gem|fdr|m2|ple|t1)-[7a]0[1-4][lu]|t1-a2[13][lw]|mediapad[\w\. ]*(?= bui|\)))\b(?!.+d\/s)/i],[d,[o,Fr],[n,x]],[/(?:huawei)([-\w ]+)[;\)]/i,/\b(nexus 6p|\w{2,4}e?-[atu]?[ln][\dx][012359c][adn]?)\b(?!.+d\/s)/i],[d,[o,Fr],[n,k]],[/oid[^\)]+; (2[\dbc]{4}(182|283|rp\w{2})[cgl]|m2105k81a?c)(?: bui|\))/i,/\b((?:red)?mi[-_ ]?pad[\w- ]*)(?: bui|\))/i],[[d,/_/g," "],[o,pr],[n,x]],[/\b(poco[\w ]+|m2\d{3}j\d\d[a-z]{2})(?: bui|\))/i,/\b; (\w+) build\/hm\1/i,/\b(hm[-_ ]?note?[_ ]?(?:\d\w)?) bui/i,/\b(redmi[\-_ ]?(?:note|k)?[\w_ ]+)(?: bui|\))/i,/oid[^\)]+; (m?[12][0-389][01]\w{3,6}[c-y])( bui|; wv|\))/i,/\b(mi[-_ ]?(?:a\d|one|one[_ ]plus|note lte|max|cc)?[_ ]?(?:\d?\w?)[_ ]?(?:plus|se|lite|pro)?)(?: bui|\))/i,/ ([\w ]+) miui\/v?\d/i],[[d,/_/g," "],[o,pr],[n,k]],[/droid.+; (cph2[3-6]\d[13579]|((gm|hd)19|(ac|be|in|kb)20|(d[en]|eb|le|mt)21|ne22)[0-2]\d|p[g-k]\w[1m]10)\b/i,/(?:one)?(?:plus)? (a\d0\d\d)(?: b|\))/i],[d,[o,qr],[n,k]],[/; (\w+) bui.+ oppo/i,/\b(cph[12]\d{3}|p(?:af|c[al]|d\w|e[ar])[mt]\d0|x9007|a101op)\b/i],[d,[o,dr],[n,k]],[/\b(opd2(\d{3}a?))(?: bui|\))/i],[d,[o,de,{OnePlus:["203","304","403","404","413","415"],"*":dr}],[n,x]],[/(vivo (5r?|6|8l?|go|one|s|x[il]?[2-4]?)[\w\+ ]*)(?: bui|\))/i],[d,[o,"BLU"],[n,k]],[/; vivo (\w+)(?: bui|\))/i,/\b(v[12]\d{3}\w?[at])(?: bui|;)/i],[d,[o,"Vivo"],[n,k]],[/\b(rmx[1-3]\d{3})(?: bui|;|\))/i],[d,[o,"Realme"],[n,k]],[/(ideatab[-\w ]+|602lv|d-42a|a101lv|a2109a|a3500-hv|s[56]000|pb-6505[my]|tb-?x?\d{3,4}(?:f[cu]|xu|[av])|yt\d?-[jx]?\d+[lfmx])( bui|;|\)|\/)/i,/lenovo ?(b[68]0[08]0-?[hf]?|tab(?:[\w- ]+?)|tb[\w-]{6,7})( bui|;|\)|\/)/i],[d,[o,nr],[n,x]],[/lenovo[-_ ]?([-\w ]+?)(?: bui|\)|\/)/i],[d,[o,nr],[n,k]],[/\b(milestone|droid(?:[2-4x]| (?:bionic|x2|pro|razr))?:?( 4g)?)\b[\w ]+build\//i,/\bmot(?:orola)?[- ]([\w\s]+)(\)| bui)/i,/((?:moto(?! 360)[-\w\(\) ]+|xt\d{3,4}[cgkosw\+]?[-\d]*|nexus 6)(?= bui|\)))/i],[d,[o,or],[n,k]],[/\b(mz60\d|xoom[2 ]{0,2}) build\//i],[d,[o,or],[n,x]],[/((?=lg)?[vl]k\-?\d{3}) bui| 3\.[-\w; ]{10}lg?-([06cv9]{3,4})/i],[d,[o,Dt],[n,x]],[/(lm(?:-?f100[nv]?|-[\w\.]+)(?= bui|\))|nexus [45])/i,/\blg[-e;\/ ]+(?!.*(?:browser|netcast|android tv|watch|webos))(\w+)/i,/\blg-?([\d\w]+) bui/i],[d,[o,Dt],[n,k]],[/(nokia) (t[12][01])/i],[o,d,[n,x]],[/(?:maemo|nokia).*(n900|lumia \d+|rm-\d+)/i,/nokia[-_ ]?(([-\w\. ]*))/i],[[d,/_/g," "],[n,k],[o,"Nokia"]],[/(pixel (c|tablet))\b/i],[d,[o,Re],[n,x]],[/droid.+;(?: google)? (g(01[13]a|020[aem]|025[jn]|1b60|1f8f|2ybb|4s1m|576d|5nz6|8hhn|8vou|a02099|c15s|d1yq|e2ae|ec77|gh2x|kv4x|p4bc|pj41|r83y|tt9q|ur25|wvk6)|pixel[\d ]*a?( pro)?( xl)?( fold)?( \(5g\))?)( bui|\))/i],[d,[o,Re],[n,k]],[/(google) (pixelbook( go)?)/i],[o,d],[/droid.+; (a?\d[0-2]{2}so|[c-g]\d{4}|so[-gl]\w+|xq-\w\w\d\d)(?= bui|\).+chrome\/(?![1-6]{0,1}\d\.))/i],[d,[o,Be],[n,k]],[/sony tablet [ps]/i,/\b(?:sony)?sgp\w+(?: bui|\))/i],[[d,"Xperia Tablet"],[o,Be],[n,x]],[/(alexa)webm/i,/(kf[a-z]{2}wi|aeo(?!bc)\w\w)( bui|\))/i,/(kf[a-z]+)( bui|\)).+silk\//i],[d,[o,Tt],[n,x]],[/((?:sd|kf)[0349hijorstuw]+)( bui|\)).+silk\//i],[[d,/(.+)/g,"Fire Phone $1"],[o,Tt],[n,k]],[/(playbook);[-\w\),; ]+(rim)/i],[d,o,[n,x]],[/\b((?:bb[a-f]|st[hv])100-\d)/i,/\(bb10; (\w+)/i],[d,[o,Nr],[n,k]],[/(?:\b|asus_)(transfo[prime ]{4,10} \w+|eeepc|slider \w+|nexus 7|padfone|p00[cj])/i],[d,[o,Ar],[n,x]],[/ (z[bes]6[027][012][km][ls]|zenfone \d\w?)\b/i],[d,[o,Ar],[n,k]],[/(nexus 9)/i],[d,[o,"HTC"],[n,x]],[/(htc)[-;_ ]{1,2}([\w ]+(?=\)| bui)|\w+)/i,/(zte)[- ]([\w ]+?)(?: bui|\/|\))/i,/(alcatel|geeksphone|nexian|panasonic(?!(?:;|\.))|sony(?!-bra))[-_ ]?([-\w]*)/i],[o,[d,/_/g," "],[n,k]],[/tcl (xess p17aa)/i,/droid [\w\.]+; ((?:8[14]9[16]|9(?:0(?:48|60|8[01])|1(?:3[27]|66)|2(?:6[69]|9[56])|466))[gqswx])(_\w(\w|\w\w))?(\)| bui)/i],[d,[o,"TCL"],[n,x]],[/droid [\w\.]+; (418(?:7d|8v)|5087z|5102l|61(?:02[dh]|25[adfh]|27[ai]|56[dh]|59k|65[ah])|a509dl|t(?:43(?:0w|1[adepqu])|50(?:6d|7[adju])|6(?:09dl|10k|12b|71[efho]|76[hjk])|7(?:66[ahju]|67[hw]|7[045][bh]|71[hk]|73o|76[ho]|79w|81[hks]?|82h|90[bhsy]|99b)|810[hs]))(_\w(\w|\w\w))?(\)| bui)/i],[d,[o,"TCL"],[n,k]],[/(itel) ((\w+))/i],[[o,le],d,[n,de,{tablet:["p10001l","w7001"],"*":"mobile"}]],[/droid.+; ([ab][1-7]-?[0178a]\d\d?)/i],[d,[o,"Acer"],[n,x]],[/droid.+; (m[1-5] note) bui/i,/\bmz-([-\w]{2,})/i],[d,[o,"Meizu"],[n,k]],[/; ((?:power )?armor(?:[\w ]{0,8}))(?: bui|\))/i],[d,[o,"Ulefone"],[n,k]],[/; (energy ?\w+)(?: bui|\))/i,/; energizer ([\w ]+)(?: bui|\))/i],[d,[o,"Energizer"],[n,k]],[/; cat (b35);/i,/; (b15q?|s22 flip|s48c|s62 pro)(?: bui|\))/i],[d,[o,"Cat"],[n,k]],[/((?:new )?andromax[\w- ]+)(?: bui|\))/i],[d,[o,"Smartfren"],[n,k]],[/droid.+; (a(in)?(0(15|59|6[35])|142)p?)/i],[d,[o,"Nothing"],[n,k]],[/; (x67 5g|tikeasy \w+|ac[1789]\d\w+)( b|\))/i,/archos ?(5|gamepad2?|([\w ]*[t1789]|hello) ?\d+[\w ]*)( b|\))/i],[d,[o,"Archos"],[n,x]],[/archos ([\w ]+)( b|\))/i,/; (ac[3-6]\d\w{2,8})( b|\))/i],[d,[o,"Archos"],[n,k]],[/; (n159v)/i],[d,[o,"HMD"],[n,k]],[/(imo) (tab \w+)/i,/(infinix|tecno) (x1101b?|p904|dp(7c|8d|10a)( pro)?|p70[1-3]a?|p904|t1101)/i],[o,d,[n,x]],[/(blackberry|benq|palm(?=\-)|sonyericsson|acer|asus(?! zenw)|dell|jolla|meizu|motorola|polytron|tecno|micromax|advan)[-_ ]?([-\w]*)/i,/; (blu|hmd|imo|infinix|lava|oneplus|tcl)[_ ]([\w\+ ]+?)(?: bui|\)|; r)/i,/(hp) ([\w ]+\w)/i,/(microsoft); (lumia[\w ]+)/i,/(oppo) ?([\w ]+) bui/i],[o,d,[n,k]],[/(kobo)\s(ereader|touch)/i,/(hp).+(touchpad(?!.+tablet)|tablet)/i,/(kindle)\/([\w\.]+)/i],[o,d,[n,x]],[/(surface duo)/i],[d,[o,ar],[n,x]],[/droid [\d\.]+; (fp\du?)(?: b|\))/i],[d,[o,"Fairphone"],[n,k]],[/((?:tegranote|shield t(?!.+d tv))[\w- ]*?)(?: b|\))/i],[d,[o,cr],[n,x]],[/(sprint) (\w+)/i],[o,d,[n,k]],[/(kin\.[onetw]{3})/i],[[d,/\./g," "],[o,ar],[n,k]],[/droid.+; ([c6]+|et5[16]|mc[239][23]x?|vc8[03]x?)\)/i],[d,[o,lr],[n,x]],[/droid.+; (ec30|ps20|tc[2-8]\d[kx])\)/i],[d,[o,lr],[n,k]],[/smart-tv.+(samsung)/i],[o,[n,C]],[/hbbtv.+maple;(\d+)/i],[[d,/^/,"SmartTV"],[o,$e],[n,C]],[/(vizio)(?: |.+model\/)(\w+-\w+)/i,/tcast.+(lg)e?. ([-\w]+)/i],[o,d,[n,C]],[/(nux; netcast.+smarttv|lg (netcast\.tv-201\d|android tv))/i],[[o,Dt],[n,C]],[/(apple) ?tv/i],[o,[d,Ie+" TV"],[n,C]],[/crkey.*devicetype\/chromecast/i],[[d,ge+" Third Generation"],[o,Re],[n,C]],[/crkey.*devicetype\/([^/]*)/i],[[d,/^/,"Chromecast "],[o,Re],[n,C]],[/fuchsia.*crkey/i],[[d,ge+" Nest Hub"],[o,Re],[n,C]],[/crkey/i],[[d,ge],[o,Re],[n,C]],[/(portaltv)/i],[d,[o,ur],[n,C]],[/droid.+aft(\w+)( bui|\))/i],[d,[o,Tt],[n,C]],[/(shield \w+ tv)/i],[d,[o,cr],[n,C]],[/\(dtv[\);].+(aquos)/i,/(aquos-tv[\w ]+)\)/i],[d,[o,$r],[n,C]],[/(bravia[\w ]+)( bui|\))/i],[d,[o,Be],[n,C]],[/(mi(tv|box)-?\w+) bui/i],[d,[o,pr],[n,C]],[/Hbbtv.*(technisat) (.*);/i],[o,d,[n,C]],[/\b(roku)[\dx]*[\)\/]((?:dvp-)?[\d\.]*)/i,/hbbtv\/\d+\.\d+\.\d+ +\([\w\+ ]*; *([\w\d][^;]*);([^;]*)/i],[[o,/.+\/(\w+)/,"$1",de,{LG:"lge"}],[d,xt],[n,C]],[/droid.+; ([\w- ]+) (?:android tv|smart[- ]?tv)/i],[d,[n,C]],[/\b(android tv|smart[- ]?tv|opera tv|tv; rv:|large screen[\w ]+safari)\b/i],[[n,C]],[/(playstation \w+)/i],[d,[o,Be],[n,P]],[/\b(xbox(?: one)?(?!; xbox))[\); ]/i],[d,[o,ar],[n,P]],[/(ouya)/i,/(nintendo) (\w+)/i,/(retroid) (pocket ([^\)]+))/i],[o,d,[n,P]],[/droid.+; (shield)( bui|\))/i],[d,[o,cr],[n,P]],[/\b(sm-[lr]\d\d[0156][fnuw]?s?|gear live)\b/i],[d,[o,$e],[n,E]],[/((pebble))app/i,/(asus|google|lg|oppo) ((pixel |zen)?watch[\w ]*)( bui|\))/i],[o,d,[n,E]],[/(ow(?:19|20)?we?[1-3]{1,3})/i],[d,[o,dr],[n,E]],[/(watch)(?: ?os[,\/]|\d,\d\/)[\d\.]+/i],[d,[o,Ie],[n,E]],[/(opwwe\d{3})/i],[d,[o,qr],[n,E]],[/(moto 360)/i],[d,[o,or],[n,E]],[/(smartwatch 3)/i],[d,[o,Be],[n,E]],[/(g watch r)/i],[d,[o,Dt],[n,E]],[/droid.+; (wt63?0{2,3})\)/i],[d,[o,lr],[n,E]],[/droid.+; (glass) \d/i],[d,[o,Re],[n,I]],[/(pico) (4|neo3(?: link|pro)?)/i],[o,d,[n,I]],[/(quest( \d| pro)?s?).+vr/i],[d,[o,ur],[n,I]],[/mobile vr; rv.+firefox/i],[[n,I]],[/(tesla)(?: qtcarbrowser|\/[-\w\.]+)/i],[o,[n,L]],[/(aeobc)\b/i],[d,[o,Tt],[n,L]],[/(homepod).+mac os/i],[d,[o,Ie],[n,L]],[/windows iot/i],[[n,L]],[/droid .+?; ([^;]+?)(?: bui|; wv\)|\) applew).+?(mobile|vr|\d) safari/i],[d,[n,de,{mobile:"Mobile",xr:"VR","*":x}]],[/\b((tablet|tab)[;\/]|focus\/\d(?!.+mobile))/i],[[n,x]],[/(phone|mobile(?:[;\/]| [ \w\/\.]*safari)|pda(?=.+windows ce))/i],[[n,k]],[/droid .+?; ([\w\. -]+)( bui|\))/i],[d,[o,"Generic"]]],engine:[[/windows.+ edge\/([\w\.]+)/i],[p,[r,Pt+"HTML"]],[/(arkweb)\/([\w\.]+)/i],[r,p],[/webkit\/537\.36.+chrome\/(?!27)([\w\.]+)/i],[p,[r,"Blink"]],[/(presto)\/([\w\.]+)/i,/(webkit|trident|netfront|netsurf|amaya|lynx|w3m|goanna|servo)\/([\w\.]+)/i,/ekioh(flow)\/([\w\.]+)/i,/(khtml|tasman|links)[\/ ]\(?([\w\.]+)/i,/(icab)[\/ ]([23]\.[\d\.]+)/i,/\b(libweb)/i],[r,p],[/ladybird\//i],[[r,"LibWeb"]],[/rv\:([\w\.]{1,9})\b.+(gecko)/i],[p,r]],os:[[/(windows nt) (6\.[23]); arm/i],[[r,/N/,"R"],[p,de,Kr]],[/(windows (?:phone|mobile|iot))(?: os)?[\/ ]?([\d\.]*( se)?)/i,/(windows)[\/ ](1[01]|2000|3\.1|7|8(\.1)?|9[58]|me|server 20\d\d( r2)?|vista|xp)/i],[r,p],[/windows nt ?([\d\.\)]*)(?!.+xbox)/i,/\bwin(?=3| ?9|n)(?:nt| 9x )?([\d\.;]*)/i],[[p,/(;|\))/g,"",de,Kr],[r,hr]],[/(windows ce)\/?([\d\.]*)/i],[r,p],[/[adehimnop]{4,7}\b(?:.*os ([\w]+) like mac|; opera)/i,/(?:ios;fbsv\/|iphone.+ios[\/ ])([\d\.]+)/i,/cfnetwork\/.+darwin/i],[[p,/_/g,"."],[r,"iOS"]],[/(mac os x) ?([\w\. ]*)/i,/(macintosh|mac_powerpc\b)(?!.+(haiku|morphos))/i],[[r,"macOS"],[p,/_/g,"."]],[/android ([\d\.]+).*crkey/i],[p,[r,ge+" Android"]],[/fuchsia.*crkey\/([\d\.]+)/i],[p,[r,ge+" Fuchsia"]],[/crkey\/([\d\.]+).*devicetype\/smartspeaker/i],[p,[r,ge+" SmartSpeaker"]],[/linux.*crkey\/([\d\.]+)/i],[p,[r,ge+" Linux"]],[/crkey\/([\d\.]+)/i],[p,[r,ge]],[/droid ([\w\.]+)\b.+(android[- ]x86)/i],[p,r],[/(ubuntu) ([\w\.]+) like android/i],[[r,/(.+)/,"$1 Touch"],p],[/(harmonyos)[\/ ]?([\d\.]*)/i,/(android|bada|blackberry|kaios|maemo|meego|openharmony|qnx|rim tablet os|sailfish|series40|symbian|tizen)\w*[-\/\.; ]?([\d\.]*)/i],[r,p],[/\(bb(10);/i],[p,[r,Nr]],[/(?:symbian ?os|symbos|s60(?=;)|series ?60)[-\/ ]?([\w\.]*)/i],[p,[r,"Symbian"]],[/mozilla\/[\d\.]+ \((?:mobile|tablet|tv|mobile; [\w ]+); rv:.+ gecko\/([\w\.]+)/i],[p,[r,ze+" OS"]],[/\b(?:hp)?wos(?:browser)?\/([\w\.]+)/i,/webos(?:[ \/]?|\.tv-20(?=2[2-9]))(\d[\d\.]*)/i],[p,[r,"webOS"]],[/web0s;.+?(?:chr[o0]me|safari)\/(\d+)/i],[[p,de,{25:"120",24:"108",23:"94",22:"87",6:"79",5:"68",4:"53",3:"38",2:"538",1:"537","*":"TV"}],[r,"webOS"]],[/watch(?: ?os[,\/]|\d,\d\/)([\d\.]+)/i],[p,[r,"watchOS"]],[/(cros) [\w]+(?:\)| ([\w\.]+)\b)/i],[[r,"Chrome OS"],p],[/panasonic;(viera)/i,/(netrange)mmh/i,/(nettv)\/(\d+\.[\w\.]+)/i,/(nintendo|playstation) (\w+)/i,/(xbox); +xbox ([^\);]+)/i,/(pico) .+os([\w\.]+)/i,/\b(joli|palm)\b ?(?:os)?\/?([\w\.]*)/i,/linux.+(mint)[\/\(\) ]?([\w\.]*)/i,/(mageia|vectorlinux|fuchsia|arcaos|arch(?= ?linux))[;l ]([\d\.]*)/i,/([kxln]?ubuntu|debian|suse|opensuse|gentoo|slackware|fedora|mandriva|centos|pclinuxos|red ?hat|zenwalk|linpus|raspbian|plan 9|minix|risc os|contiki|deepin|manjaro|elementary os|sabayon|linspire|knoppix)(?: gnu[\/ ]linux)?(?: enterprise)?(?:[- ]linux)?(?:-gnu)?[-\/ ]?(?!chrom|package)([-\w\.]*)/i,/((?:open)?solaris)[-\/ ]?([\w\.]*)/i,/\b(aix)[; ]([1-9\.]{0,4})/i,/(hurd|linux|morphos)(?: (?:arm|x86|ppc)\w*| ?)([\w\.]*)/i,/(gnu) ?([\w\.]*)/i,/\b([-frentopcghs]{0,5}bsd|dragonfly)[\/ ]?(?!amd|[ix346]{1,2}86)([\w\.]*)/i,/(haiku) ?(r\d)?/i],[r,p],[/(sunos) ?([\d\.]*)/i],[[r,"Solaris"],p],[/\b(beos|os\/2|amigaos|openvms|hp-ux|serenityos)/i,/(unix) ?([\w\.]*)/i],[r,p]]},Lt=function(){var M={init:{},isIgnore:{},isIgnoreRgx:{},toString:{}};return ue.call(M.init,[[m,[r,p,w,n]],[a,[l]],[s,[n,d,o]],[e,[r,p]],[t,[r,p]]]),ue.call(M.isIgnore,[[m,[p,w]],[e,[p]],[t,[p]]]),ue.call(M.isIgnoreRgx,[[m,/ ?browser$/i],[t,/ ?os$/i]]),ue.call(M.toString,[[m,[r,p]],[a,[l]],[s,[o,d]],[e,[r,p]],[t,[r,p]]]),M}(),Ji=function(M,A){var N=Lt.init[A],z=Lt.isIgnore[A]||0,U=Lt.isIgnoreRgx[A]||0,V=Lt.toString[A]||0;function j(){ue.call(this,N)}return j.prototype.getItem=function(){return M},j.prototype.withClientHints=function(){return _e?_e.getHighEntropyValues(jr).then(function(B){return M.setCH(new Wr(B,!1)).parseCH().get()}):M.parseCH().get()},j.prototype.withFeatureCheck=function(){return M.detectFeature().get()},A!=i&&(j.prototype.is=function(B){var q=!1;for(var K in this)if(this.hasOwnProperty(K)&&!fr(z,K)&&le(U?je(U,this[K]):this[K])==le(U?je(U,B):B)){if(q=!0,B!=h)break}else if(B==h&&q){q=!q;break}return q},j.prototype.toString=function(){var B=g;for(var q in V)typeof this[V[q]]!==h&&(B+=(B?" ":g)+this[V[q]]);return B||h}),_e||(j.prototype.then=function(B){var q=this,K=function(){for(var we in q)q.hasOwnProperty(we)&&(this[we]=q[we])};K.prototype={is:j.prototype.is,toString:j.prototype.toString};var he=new K;return B(he),he}),new j};function Wr(M,A){if(M=M||{},ue.call(this,jr),A)ue.call(this,[[F,mr(M[ie])],[H,mr(M[Le])],[k,/\?1/.test(M[Gi])],[d,Ke(M[Qi])],[J,Ke(M[Or])],[ye,Ke(M[Wi])],[l,Ke(M[Hi])],[$,mr(M[Ki])],[me,Ke(M[Vi])]]);else for(var N in M)this.hasOwnProperty(N)&&typeof M[N]!==h&&(this[N]=M[N])}function Yr(M,A,N,z){return this.get=function(U){return U?this.data.hasOwnProperty(U)?this.data[U]:u:this.data},this.set=function(U,V){return this.data[U]=V,this},this.setCH=function(U){return this.uaCH=U,this},this.detectFeature=function(){if(ee&&ee.userAgent==this.ua)switch(this.itemType){case m:ee.brave&&typeof ee.brave.isBrave==b&&this.set(r,"Brave");break;case s:!this.get(n)&&_e&&_e[k]&&this.set(n,k),this.get(d)=="Macintosh"&&ee&&typeof ee.standalone!==h&&ee.maxTouchPoints&&ee.maxTouchPoints>2&&this.set(d,"iPad").set(n,x);break;case t:!this.get(r)&&_e&&_e[J]&&this.set(r,_e[J]);break;case i:var U=this.data,V=function(j){return U[j].getItem().detectFeature().get()};this.set(m,V(m)).set(a,V(a)).set(s,V(s)).set(e,V(e)).set(t,V(t))}return this},this.parseUA=function(){return this.itemType!=i&&_r.call(this.data,this.ua,this.rgxMap),this.itemType==m&&this.set(w,gr(this.get(p))),this},this.parseCH=function(){var U=this.uaCH,V=this.rgxMap;switch(this.itemType){case m:case e:var j=U[H]||U[F],B;if(j)for(var q in j){var K=j[q].brand||j[q],he=j[q].version;this.itemType==m&&!/not.a.brand/i.test(K)&&(!B||/Chrom/.test(B)&&K!=zr||B==Pt&&/WebView2/.test(K))&&(K=de(K,Xi),B=this.get(r),B&&!/Chrom/.test(B)&&/Chrom/.test(K)||this.set(r,K).set(p,he).set(w,gr(he)),B=K),this.itemType==e&&K==zr&&this.set(p,he)}break;case a:var we=U[l];we&&(we&&U[me]=="64"&&(we+="64"),_r.call(this.data,we+";",V));break;case s:if(U[k]&&this.set(n,k),U[d]&&(this.set(d,U[d]),!this.get(n)||!this.get(o))){var Ge={};_r.call(Ge,"droid 9; "+U[d]+")",V),!this.get(n)&&Ge.type&&this.set(n,Ge.type),!this.get(o)&&Ge.vendor&&this.set(o,Ge.vendor)}if(U[$]){var Mt;if(typeof U[$]!="string")for(var Xr=0;!Mt&&Xr<U[$].length;)Mt=de(U[$][Xr++],Gr);else Mt=de(U[$],Gr);this.set(n,Mt)}break;case t:var wr=U[J];if(wr){var vr=U[ye];wr==hr&&(vr=parseInt(gr(vr),10)>=13?"11":"10"),this.set(r,wr).set(p,vr)}this.get(r)==hr&&U[d]=="Xbox"&&this.set(r,"Xbox").set(p,u);break;case i:var Zi=this.data,Qe=function(en){return Zi[en].getItem().setCH(U).parseCH().get()};this.set(m,Qe(m)).set(a,Qe(a)).set(s,Qe(s)).set(e,Qe(e)).set(t,Qe(t))}return this},ue.call(this,[["itemType",M],["ua",A],["uaCH",z],["rgxMap",N],["data",Ji(this,M)]]),this}function ne(M,A,N){if(typeof M===c?(Et(M,!0)?(typeof A===c&&(N=A),A=M):(N=M,A=u),M=u):typeof M===f&&!Et(A,!0)&&(N=A,A=u),N&&typeof N.append===b){var z={};N.forEach(function(q,K){z[K]=q}),N=z}if(!(this instanceof ne))return new ne(M,A,N).getResult();var U=typeof M===f?M:N&&N[_]?N[_]:ee&&ee.userAgent?ee.userAgent:g,V=new Wr(N,!0),j=A?Yi(Qr,A):Qr,B=function(q){return q==i?function(){return new Yr(q,U,j,V).set("ua",U).set(m,this.getBrowser()).set(a,this.getCPU()).set(s,this.getDevice()).set(e,this.getEngine()).set(t,this.getOS()).get()}:function(){return new Yr(q,U,j[q],V).parseUA().get()}};return ue.call(this,[["getBrowser",B(m)],["getCPU",B(a)],["getDevice",B(s)],["getEngine",B(e)],["getOS",B(t)],["getResult",B(i)],["getUA",function(){return U}],["setUA",function(q){return Oe(q)&&(U=q.length>v?xt(q,v):q),this}]]).setUA(U),this}ne.VERSION=T,ne.BROWSER=kt([r,p,w,n]),ne.CPU=kt([l]),ne.DEVICE=kt([d,o,n,P,k,C,x,E,L]),ne.ENGINE=ne.OS=kt([r,p]),S.exports&&(D=S.exports=ne),D.UAParser=ne;var Ae=Vr&&(R.jQuery||R.Zepto);if(Ae&&!Ae.ua){var It=new ne;Ae.ua=It.getResult(),Ae.ua.get=function(){return It.getUA()},Ae.ua.set=function(M){It.setUA(M);var A=It.getResult();for(var N in A)Ae.ua[N]=A[N]}}})(typeof window=="object"?window:sn)}(Ct,Ct.exports)),Ct.exports}var We={},rs;function G(){if(rs)return We;rs=1,Object.defineProperty(We,"__esModule",{value:!0}),We.Logger=void 0;const S=er(),D="mediasoup-client";class R{_debug;_warn;_error;constructor(T){T?(this._debug=(0,S.default)(`${D}:${T}`),this._warn=(0,S.default)(`${D}:WARN:${T}`),this._error=(0,S.default)(`${D}:ERROR:${T}`)):(this._debug=(0,S.default)(D),this._warn=(0,S.default)(`${D}:WARN`),this._error=(0,S.default)(`${D}:ERROR`)),this._debug.log=console.info.bind(console),this._warn.log=console.warn.bind(console),this._error.log=console.error.bind(console)}get debug(){return this._debug}get warn(){return this._warn}get error(){return this._error}}return We.Logger=R,We}var Ye={},jt={exports:{}},ss;function an(){if(ss)return jt.exports;ss=1;var S=typeof Reflect=="object"?Reflect:null,D=S&&typeof S.apply=="function"?S.apply:function(o,p,l){return Function.prototype.apply.call(o,p,l)},R;S&&typeof S.ownKeys=="function"?R=S.ownKeys:Object.getOwnPropertySymbols?R=function(o){return Object.getOwnPropertyNames(o).concat(Object.getOwnPropertySymbols(o))}:R=function(o){return Object.getOwnPropertyNames(o)};function u(n){console&&console.warn&&console.warn(n)}var T=Number.isNaN||function(o){return o!==o};function v(){v.init.call(this)}jt.exports=v,jt.exports.once=t,v.EventEmitter=v,v.prototype._events=void 0,v.prototype._eventsCount=0,v.prototype._maxListeners=void 0;var _=10;function g(n){if(typeof n!="function")throw new TypeError('The "listener" argument must be of type Function. Received type '+typeof n)}Object.defineProperty(v,"defaultMaxListeners",{enumerable:!0,get:function(){return _},set:function(n){if(typeof n!="number"||n<0||T(n))throw new RangeError('The value of "defaultMaxListeners" is out of range. It must be a non-negative number. Received '+n+".");_=n}}),v.init=function(){(this._events===void 0||this._events===Object.getPrototypeOf(this)._events)&&(this._events=Object.create(null),this._eventsCount=0),this._maxListeners=this._maxListeners||void 0},v.prototype.setMaxListeners=function(o){if(typeof o!="number"||o<0||T(o))throw new RangeError('The value of "n" is out of range. It must be a non-negative number. Received '+o+".");return this._maxListeners=o,this};function y(n){return n._maxListeners===void 0?v.defaultMaxListeners:n._maxListeners}v.prototype.getMaxListeners=function(){return y(this)},v.prototype.emit=function(o){for(var p=[],l=1;l<arguments.length;l++)p.push(arguments[l]);var w=o==="error",d=this._events;if(d!==void 0)w=w&&d.error===void 0;else if(!w)return!1;if(w){var P;if(p.length>0&&(P=p[0]),P instanceof Error)throw P;var k=new Error("Unhandled error."+(P?" ("+P.message+")":""));throw k.context=P,k}var x=d[o];if(x===void 0)return!1;if(typeof x=="function")D(x,this,p);else for(var C=x.length,E=a(x,C),l=0;l<C;++l)D(E[l],this,p);return!0};function b(n,o,p,l){var w,d,P;if(g(p),d=n._events,d===void 0?(d=n._events=Object.create(null),n._eventsCount=0):(d.newListener!==void 0&&(n.emit("newListener",o,p.listener?p.listener:p),d=n._events),P=d[o]),P===void 0)P=d[o]=p,++n._eventsCount;else if(typeof P=="function"?P=d[o]=l?[p,P]:[P,p]:l?P.unshift(p):P.push(p),w=y(n),w>0&&P.length>w&&!P.warned){P.warned=!0;var k=new Error("Possible EventEmitter memory leak detected. "+P.length+" "+String(o)+" listeners added. Use emitter.setMaxListeners() to increase limit");k.name="MaxListenersExceededWarning",k.emitter=n,k.type=o,k.count=P.length,u(k)}return n}v.prototype.addListener=function(o,p){return b(this,o,p,!1)},v.prototype.on=v.prototype.addListener,v.prototype.prependListener=function(o,p){return b(this,o,p,!0)};function h(){if(!this.fired)return this.target.removeListener(this.type,this.wrapFn),this.fired=!0,arguments.length===0?this.listener.call(this.target):this.listener.apply(this.target,arguments)}function c(n,o,p){var l={fired:!1,wrapFn:void 0,target:n,type:o,listener:p},w=h.bind(l);return w.listener=p,l.wrapFn=w,w}v.prototype.once=function(o,p){return g(p),this.on(o,c(this,o,p)),this},v.prototype.prependOnceListener=function(o,p){return g(p),this.prependListener(o,c(this,o,p)),this},v.prototype.removeListener=function(o,p){var l,w,d,P,k;if(g(p),w=this._events,w===void 0)return this;if(l=w[o],l===void 0)return this;if(l===p||l.listener===p)--this._eventsCount===0?this._events=Object.create(null):(delete w[o],w.removeListener&&this.emit("removeListener",o,l.listener||p));else if(typeof l!="function"){for(d=-1,P=l.length-1;P>=0;P--)if(l[P]===p||l[P].listener===p){k=l[P].listener,d=P;break}if(d<0)return this;d===0?l.shift():s(l,d),l.length===1&&(w[o]=l[0]),w.removeListener!==void 0&&this.emit("removeListener",o,k||p)}return this},v.prototype.off=v.prototype.removeListener,v.prototype.removeAllListeners=function(o){var p,l,w;if(l=this._events,l===void 0)return this;if(l.removeListener===void 0)return arguments.length===0?(this._events=Object.create(null),this._eventsCount=0):l[o]!==void 0&&(--this._eventsCount===0?this._events=Object.create(null):delete l[o]),this;if(arguments.length===0){var d=Object.keys(l),P;for(w=0;w<d.length;++w)P=d[w],P!=="removeListener"&&this.removeAllListeners(P);return this.removeAllListeners("removeListener"),this._events=Object.create(null),this._eventsCount=0,this}if(p=l[o],typeof p=="function")this.removeListener(o,p);else if(p!==void 0)for(w=p.length-1;w>=0;w--)this.removeListener(o,p[w]);return this};function f(n,o,p){var l=n._events;if(l===void 0)return[];var w=l[o];return w===void 0?[]:typeof w=="function"?p?[w.listener||w]:[w]:p?e(w):a(w,w.length)}v.prototype.listeners=function(o){return f(this,o,!0)},v.prototype.rawListeners=function(o){return f(this,o,!1)},v.listenerCount=function(n,o){return typeof n.listenerCount=="function"?n.listenerCount(o):m.call(n,o)},v.prototype.listenerCount=m;function m(n){var o=this._events;if(o!==void 0){var p=o[n];if(typeof p=="function")return 1;if(p!==void 0)return p.length}return 0}v.prototype.eventNames=function(){return this._eventsCount>0?R(this._events):[]};function a(n,o){for(var p=new Array(o),l=0;l<o;++l)p[l]=n[l];return p}function s(n,o){for(;o+1<n.length;o++)n[o]=n[o+1];n.pop()}function e(n){for(var o=new Array(n.length),p=0;p<o.length;++p)o[p]=n[p].listener||n[p];return o}function t(n,o){return new Promise(function(p,l){function w(P){n.removeListener(o,d),l(P)}function d(){typeof n.removeListener=="function"&&n.removeListener("error",w),p([].slice.call(arguments))}r(n,o,d,{once:!0}),o!=="error"&&i(n,w,{once:!0})})}function i(n,o,p){typeof n.on=="function"&&r(n,"error",o,p)}function r(n,o,p,l){if(typeof n.on=="function")l.once?n.once(o,p):n.on(o,p);else if(typeof n.addEventListener=="function")n.addEventListener(o,function w(d){l.once&&n.removeEventListener(o,w),p(d)});else throw new TypeError('The "emitter" argument must be of type EventEmitter. Received type '+typeof n)}return jt.exports}var is;function ve(){if(is)return Ye;is=1,Object.defineProperty(Ye,"__esModule",{value:!0}),Ye.EnhancedEventEmitter=void 0;const S=an(),D=G(),R=new D.Logger("EnhancedEventEmitter");class u extends S.EventEmitter{constructor(){super(),this.setMaxListeners(1/0)}emit(v,..._){return super.emit(v,..._)}safeEmit(v,..._){try{return super.emit(v,..._)}catch(g){R.error("safeEmit() | event listener threw an error [eventName:%s]:%o",v,g);try{super.emit("listenererror",v,g)}catch{}return!!super.listenerCount(v)}}on(v,_){return super.on(v,_),this}off(v,_){return super.off(v,_),this}addListener(v,_){return super.on(v,_),this}prependListener(v,_){return super.prependListener(v,_),this}once(v,_){return super.once(v,_),this}prependOnceListener(v,_){return super.prependOnceListener(v,_),this}removeListener(v,_){return super.off(v,_),this}removeAllListeners(v){return super.removeAllListeners(v),this}listenerCount(v){return super.listenerCount(v)}listeners(v){return super.listeners(v)}rawListeners(v){return super.rawListeners(v)}}return Ye.EnhancedEventEmitter=u,Ye}var De={},ns;function Y(){if(ns)return De;ns=1,Object.defineProperty(De,"__esModule",{value:!0}),De.InvalidStateError=De.UnsupportedError=void 0;class S extends Error{constructor(u){super(u),this.name="UnsupportedError",Error.hasOwnProperty("captureStackTrace")?Error.captureStackTrace(this,S):this.stack=new Error(u).stack}}De.UnsupportedError=S;class D extends Error{constructor(u){super(u),this.name="InvalidStateError",Error.hasOwnProperty("captureStackTrace")?Error.captureStackTrace(this,D):this.stack=new Error(u).stack}}return De.InvalidStateError=D,De}var Ne={},as;function Q(){if(as)return Ne;as=1,Object.defineProperty(Ne,"__esModule",{value:!0}),Ne.clone=S,Ne.generateRandomNumber=D,Ne.deepFreeze=R;function S(u){if(u!==void 0)return Number.isNaN(u)?NaN:typeof structuredClone=="function"?structuredClone(u):JSON.parse(JSON.stringify(u))}function D(){return Math.round(Math.random()*1e7)}function R(u){const T=Reflect.ownKeys(u);for(const v of T){const _=u[v];(_&&typeof _=="object"||typeof _=="function")&&R(_)}return Object.freeze(u)}return Ne}var Z={},W={},Pe={},os;function on(){if(os)return Pe;os=1;var S=Pe&&Pe.__importDefault||function(T){return T&&T.__esModule?T:{default:T}};Object.defineProperty(Pe,"__esModule",{value:!0}),Pe.Logger=void 0;const D=S(er()),R="h264-profile-level-id";class u{constructor(v){v?(this._debug=(0,D.default)(`${R}:${v}`),this._warn=(0,D.default)(`${R}:WARN:${v}`),this._error=(0,D.default)(`${R}:ERROR:${v}`)):(this._debug=(0,D.default)(R),this._warn=(0,D.default)(`${R}:WARN`),this._error=(0,D.default)(`${R}:ERROR`)),this._debug.log=console.info.bind(console),this._warn.log=console.warn.bind(console),this._error.log=console.error.bind(console)}get debug(){return this._debug}get warn(){return this._warn}get error(){return this._error}}return Pe.Logger=u,Pe}var cs;function cn(){if(cs)return W;cs=1,Object.defineProperty(W,"__esModule",{value:!0}),W.ProfileLevelId=W.Level=W.Profile=void 0,W.parseProfileLevelId=h,W.profileLevelIdToString=c,W.profileToString=f,W.levelToString=m,W.parseSdpProfileLevelId=a,W.isSameProfile=s,W.isSameProfileAndLevel=e,W.generateProfileLevelIdStringForAnswer=t,W.supportedLevel=i;const S=on(),D=new S.Logger;var R;(function(l){l[l.ConstrainedBaseline=1]="ConstrainedBaseline",l[l.Baseline=2]="Baseline",l[l.Main=3]="Main",l[l.ConstrainedHigh=4]="ConstrainedHigh",l[l.High=5]="High",l[l.PredictiveHigh444=6]="PredictiveHigh444"})(R||(W.Profile=R={}));var u;(function(l){l[l.L1_b=0]="L1_b",l[l.L1=10]="L1",l[l.L1_1=11]="L1_1",l[l.L1_2=12]="L1_2",l[l.L1_3=13]="L1_3",l[l.L2=20]="L2",l[l.L2_1=21]="L2_1",l[l.L2_2=22]="L2_2",l[l.L3=30]="L3",l[l.L3_1=31]="L3_1",l[l.L3_2=32]="L3_2",l[l.L4=40]="L4",l[l.L4_1=41]="L4_1",l[l.L4_2=42]="L4_2",l[l.L5=50]="L5",l[l.L5_1=51]="L5_1",l[l.L5_2=52]="L5_2"})(u||(W.Level=u={}));class T{constructor(w,d){this.profile=w,this.level=d}}W.ProfileLevelId=T;const v=new T(R.ConstrainedBaseline,u.L3_1);class _{constructor(w){this.mask=~r("x",w),this.masked_value=r("1",w)}isMatch(w){return this.masked_value===(w&this.mask)}}class g{constructor(w,d,P){this.profile_idc=w,this.profile_iop=d,this.profile=P}}const y=[new g(66,new _("x1xx0000"),R.ConstrainedBaseline),new g(77,new _("1xxx0000"),R.ConstrainedBaseline),new g(88,new _("11xx0000"),R.ConstrainedBaseline),new g(66,new _("x0xx0000"),R.Baseline),new g(88,new _("10xx0000"),R.Baseline),new g(77,new _("0x0x0000"),R.Main),new g(100,new _("00000000"),R.High),new g(100,new _("00001100"),R.ConstrainedHigh),new g(244,new _("00000000"),R.PredictiveHigh444)],b=[{max_macroblocks_per_second:1485,max_macroblock_frame_size:99,level:u.L1},{max_macroblocks_per_second:1485,max_macroblock_frame_size:99,level:u.L1_b},{max_macroblocks_per_second:3e3,max_macroblock_frame_size:396,level:u.L1_1},{max_macroblocks_per_second:6e3,max_macroblock_frame_size:396,level:u.L1_2},{max_macroblocks_per_second:11880,max_macroblock_frame_size:396,level:u.L1_3},{max_macroblocks_per_second:11880,max_macroblock_frame_size:396,level:u.L2},{max_macroblocks_per_second:19800,max_macroblock_frame_size:792,level:u.L2_1},{max_macroblocks_per_second:20250,max_macroblock_frame_size:1620,level:u.L2_2},{max_macroblocks_per_second:40500,max_macroblock_frame_size:1620,level:u.L3},{max_macroblocks_per_second:108e3,max_macroblock_frame_size:3600,level:u.L3_1},{max_macroblocks_per_second:216e3,max_macroblock_frame_size:5120,level:u.L3_2},{max_macroblocks_per_second:245760,max_macroblock_frame_size:8192,level:u.L4},{max_macroblocks_per_second:245760,max_macroblock_frame_size:8192,level:u.L4_1},{max_macroblocks_per_second:522240,max_macroblock_frame_size:8704,level:u.L4_2},{max_macroblocks_per_second:589824,max_macroblock_frame_size:22080,level:u.L5},{max_macroblocks_per_second:983040,max_macroblock_frame_size:36864,level:u.L5_1},{max_macroblocks_per_second:2073600,max_macroblock_frame_size:36864,level:u.L5_2}];function h(l){if(typeof l!="string"||l.length!==6)return;const d=parseInt(l,16);if(d===0)return;const P=d&255,k=d>>8&255,x=d>>16&255;let C;switch(P){case u.L1_1:{C=(k&16)!==0?u.L1_b:u.L1_1;break}case u.L1:case u.L1_2:case u.L1_3:case u.L2:case u.L2_1:case u.L2_2:case u.L3:case u.L3_1:case u.L3_2:case u.L4:case u.L4_1:case u.L4_2:case u.L5:case u.L5_1:case u.L5_2:{C=P;break}default:{D.warn(`parseProfileLevelId() | unrecognized level_idc [str:${l}, level_idc:${P}]`);return}}for(const E of y)if(x===E.profile_idc&&E.profile_iop.isMatch(k))return D.debug(`parseProfileLevelId() | result [str:${l}, profile:${E.profile}, level:${C}]`),new T(E.profile,C);D.warn(`parseProfileLevelId() | unrecognized profile_idc/profile_iop combination [str:${l}, profile_idc:${x}, profile_iop:${k}]`)}function c(l){if(l.level==u.L1_b)switch(l.profile){case R.ConstrainedBaseline:return"42f00b";case R.Baseline:return"42100b";case R.Main:return"4d100b";default:{D.warn(`profileLevelIdToString() | Level 1_b not is allowed for profile ${l.profile}`);return}}let w;switch(l.profile){case R.ConstrainedBaseline:{w="42e0";break}case R.Baseline:{w="4200";break}case R.Main:{w="4d00";break}case R.ConstrainedHigh:{w="640c";break}case R.High:{w="6400";break}case R.PredictiveHigh444:{w="f400";break}default:{D.warn(`profileLevelIdToString() | unrecognized profile ${l.profile}`);return}}let d=l.level.toString(16);return d.length===1&&(d=`0${d}`),`${w}${d}`}function f(l){switch(l){case R.ConstrainedBaseline:return"ConstrainedBaseline";case R.Baseline:return"Baseline";case R.Main:return"Main";case R.ConstrainedHigh:return"ConstrainedHigh";case R.High:return"High";case R.PredictiveHigh444:return"PredictiveHigh444";default:{D.warn(`profileToString() | unrecognized profile ${l}`);return}}}function m(l){switch(l){case u.L1_b:return"1b";case u.L1:return"1";case u.L1_1:return"1.1";case u.L1_2:return"1.2";case u.L1_3:return"1.3";case u.L2:return"2";case u.L2_1:return"2.1";case u.L2_2:return"2.2";case u.L3:return"3";case u.L3_1:return"3.1";case u.L3_2:return"3.2";case u.L4:return"4";case u.L4_1:return"4.1";case u.L4_2:return"4.2";case u.L5:return"5";case u.L5_1:return"5.1";case u.L5_2:return"5.2";default:{D.warn(`levelToString() | unrecognized level ${l}`);return}}}function a(l={}){const w=l["profile-level-id"];return w?h(w):v}function s(l={},w={}){const d=a(l),P=a(w);return!!(d&&P&&d.profile===P.profile)}function e(l={},w={}){const d=a(l),P=a(w);return!!(d&&P&&d.profile===P.profile&&d.level==P.level)}function t(l={},w={}){if(!l["profile-level-id"]&&!w["profile-level-id"]){D.warn("generateProfileLevelIdStringForAnswer() | profile-level-id missing in local and remote params");return}const d=a(l),P=a(w);if(!d)throw new TypeError("invalid local_profile_level_id");if(!P)throw new TypeError("invalid remote_profile_level_id");if(d.profile!==P.profile)throw new TypeError("H264 Profile mismatch");const k=p(l)&&p(w),x=d.level,C=P.level,E=o(x,C),I=k?x:E;return D.debug(`generateProfileLevelIdStringForAnswer() | result [profile:${d.profile}, level:${I}]`),c(new T(d.profile,I))}function i(l,w){for(let P=b.length-1;P>=0;--P){const k=b[P];if(k.max_macroblock_frame_size*256<=l&&k.max_macroblocks_per_second<=w*k.max_macroblock_frame_size)return D.debug(`supportedLevel() | result [max_frame_pixel_count:${l}, max_fps:${w}, level:${k.level}]`),k.level}D.warn(`supportedLevel() | no level supported [max_frame_pixel_count:${l}, max_fps:${w}]`)}function r(l,w){return+(w[0]===l)<<7|+(w[1]===l)<<6|+(w[2]===l)<<5|+(w[3]===l)<<4|+(w[4]===l)<<3|+(w[5]===l)<<2|+(w[6]===l)<<1|+(w[7]===l)<<0}function n(l,w){return l===u.L1_b?w!==u.L1&&w!==u.L1_b:w===u.L1_b?l!==u.L1:l<w}function o(l,w){return n(l,w)?l:w}function p(l={}){const w=l["level-asymmetry-allowed"];return w===!0||w===1||w==="1"}return W}var ds;function X(){if(ds)return Z;ds=1,Object.defineProperty(Z,"__esModule",{value:!0}),Z.validateRtpCapabilities=v,Z.validateRtpParameters=_,Z.validateSctpStreamParameters=g,Z.validateSctpCapabilities=y,Z.getExtendedRtpCapabilities=b,Z.getRecvRtpCapabilities=h,Z.getSendingRtpParameters=c,Z.getSendingRemoteRtpParameters=f,Z.reduceCodecs=m,Z.generateProbatorRtpParameters=a,Z.canSend=s,Z.canReceive=e;const S=cn(),D=Q(),R="probator",u=1234,T=127;function v(C){if(typeof C!="object")throw new TypeError("caps is not an object");if(C.codecs&&!Array.isArray(C.codecs))throw new TypeError("caps.codecs is not an array");C.codecs||(C.codecs=[]);for(const E of C.codecs)t(E);if(C.headerExtensions&&!Array.isArray(C.headerExtensions))throw new TypeError("caps.headerExtensions is not an array");C.headerExtensions||(C.headerExtensions=[]);for(const E of C.headerExtensions)r(E)}function _(C){if(typeof C!="object")throw new TypeError("params is not an object");if(C.mid&&typeof C.mid!="string")throw new TypeError("params.mid is not a string");if(!Array.isArray(C.codecs))throw new TypeError("missing params.codecs");for(const E of C.codecs)n(E);if(C.headerExtensions&&!Array.isArray(C.headerExtensions))throw new TypeError("params.headerExtensions is not an array");C.headerExtensions||(C.headerExtensions=[]);for(const E of C.headerExtensions)o(E);if(C.encodings&&!Array.isArray(C.encodings))throw new TypeError("params.encodings is not an array");C.encodings||(C.encodings=[]);for(const E of C.encodings)p(E);if(C.rtcp&&typeof C.rtcp!="object")throw new TypeError("params.rtcp is not an object");C.rtcp||(C.rtcp={}),l(C.rtcp)}function g(C){if(typeof C!="object")throw new TypeError("params is not an object");if(typeof C.streamId!="number")throw new TypeError("missing params.streamId");let E=!1;if(typeof C.ordered=="boolean"?E=!0:C.ordered=!0,C.maxPacketLifeTime&&typeof C.maxPacketLifeTime!="number")throw new TypeError("invalid params.maxPacketLifeTime");if(C.maxRetransmits&&typeof C.maxRetransmits!="number")throw new TypeError("invalid params.maxRetransmits");if(C.maxPacketLifeTime&&C.maxRetransmits)throw new TypeError("cannot provide both maxPacketLifeTime and maxRetransmits");if(E&&C.ordered&&(C.maxPacketLifeTime||C.maxRetransmits))throw new TypeError("cannot be ordered with maxPacketLifeTime or maxRetransmits");if(!E&&(C.maxPacketLifeTime||C.maxRetransmits)&&(C.ordered=!1),C.label&&typeof C.label!="string")throw new TypeError("invalid params.label");if(C.protocol&&typeof C.protocol!="string")throw new TypeError("invalid params.protocol")}function y(C){if(typeof C!="object")throw new TypeError("caps is not an object");if(!C.numStreams||typeof C.numStreams!="object")throw new TypeError("missing caps.numStreams");w(C.numStreams)}function b(C,E,I){const L={codecs:[],headerExtensions:[]};if(I)for(const O of C.codecs??[]){if(d(O))continue;const F=(E.codecs??[]).find(H=>P(H,O,{strict:!0,modify:!0}));if(!F)continue;const $={mimeType:O.mimeType,kind:O.kind,clockRate:O.clockRate,channels:O.channels,localPayloadType:O.preferredPayloadType,localRtxPayloadType:void 0,remotePayloadType:F.preferredPayloadType,remoteRtxPayloadType:void 0,localParameters:O.parameters,remoteParameters:F.parameters,rtcpFeedback:x(O,F)};L.codecs.push($)}else for(const O of E.codecs??[]){if(d(O))continue;const F=(C.codecs??[]).find(H=>P(H,O,{strict:!0,modify:!0}));if(!F)continue;const $={mimeType:F.mimeType,kind:F.kind,clockRate:F.clockRate,channels:F.channels,localPayloadType:F.preferredPayloadType,localRtxPayloadType:void 0,remotePayloadType:O.preferredPayloadType,remoteRtxPayloadType:void 0,localParameters:F.parameters,remoteParameters:O.parameters,rtcpFeedback:x(F,O)};L.codecs.push($)}for(const O of L.codecs){const F=C.codecs.find(H=>d(H)&&H.parameters.apt===O.localPayloadType),$=E.codecs.find(H=>d(H)&&H.parameters.apt===O.remotePayloadType);F&&$&&(O.localRtxPayloadType=F.preferredPayloadType,O.remoteRtxPayloadType=$.preferredPayloadType)}for(const O of E.headerExtensions){const F=C.headerExtensions.find(H=>k(H,O));if(!F)continue;const $={kind:O.kind,uri:O.uri,sendId:F.preferredId,recvId:O.preferredId,encrypt:F.preferredEncrypt,direction:"sendrecv"};switch(O.direction){case"sendrecv":{$.direction="sendrecv";break}case"recvonly":{$.direction="sendonly";break}case"sendonly":{$.direction="recvonly";break}case"inactive":{$.direction="inactive";break}}L.headerExtensions.push($)}return L}function h(C){const E={codecs:[],headerExtensions:[]};for(const I of C.codecs){const L={mimeType:I.mimeType,kind:I.kind,preferredPayloadType:I.remotePayloadType,clockRate:I.clockRate,channels:I.channels,parameters:I.localParameters,rtcpFeedback:I.rtcpFeedback};if(E.codecs.push(L),!I.remoteRtxPayloadType)continue;const O={mimeType:`${I.kind}/rtx`,kind:I.kind,preferredPayloadType:I.remoteRtxPayloadType,clockRate:I.clockRate,parameters:{apt:I.remotePayloadType},rtcpFeedback:[]};E.codecs.push(O)}for(const I of C.headerExtensions){if(I.direction!=="sendrecv"&&I.direction!=="recvonly")continue;const L={kind:I.kind,uri:I.uri,preferredId:I.recvId,preferredEncrypt:I.encrypt,direction:I.direction};E.headerExtensions.push(L)}return E}function c(C,E){const I={mid:void 0,codecs:[],headerExtensions:[],encodings:[],rtcp:{}};for(const L of E.codecs){if(L.kind!==C)continue;const O={mimeType:L.mimeType,payloadType:L.localPayloadType,clockRate:L.clockRate,channels:L.channels,parameters:L.localParameters,rtcpFeedback:L.rtcpFeedback};if(I.codecs.push(O),L.localRtxPayloadType){const F={mimeType:`${L.kind}/rtx`,payloadType:L.localRtxPayloadType,clockRate:L.clockRate,parameters:{apt:L.localPayloadType},rtcpFeedback:[]};I.codecs.push(F)}}for(const L of E.headerExtensions){if(L.kind&&L.kind!==C||L.direction!=="sendrecv"&&L.direction!=="sendonly")continue;const O={uri:L.uri,id:L.sendId,encrypt:L.encrypt,parameters:{}};I.headerExtensions.push(O)}return I}function f(C,E){const I={mid:void 0,codecs:[],headerExtensions:[],encodings:[],rtcp:{}};for(const L of E.codecs){if(L.kind!==C)continue;const O={mimeType:L.mimeType,payloadType:L.localPayloadType,clockRate:L.clockRate,channels:L.channels,parameters:L.remoteParameters,rtcpFeedback:L.rtcpFeedback};if(I.codecs.push(O),L.localRtxPayloadType){const F={mimeType:`${L.kind}/rtx`,payloadType:L.localRtxPayloadType,clockRate:L.clockRate,parameters:{apt:L.localPayloadType},rtcpFeedback:[]};I.codecs.push(F)}}for(const L of E.headerExtensions){if(L.kind&&L.kind!==C||L.direction!=="sendrecv"&&L.direction!=="sendonly")continue;const O={uri:L.uri,id:L.sendId,encrypt:L.encrypt,parameters:{}};I.headerExtensions.push(O)}if(I.headerExtensions.some(L=>L.uri==="http://www.ietf.org/id/draft-holmer-rmcat-transport-wide-cc-extensions-01"))for(const L of I.codecs)L.rtcpFeedback=(L.rtcpFeedback??[]).filter(O=>O.type!=="goog-remb");else if(I.headerExtensions.some(L=>L.uri==="http://www.webrtc.org/experiments/rtp-hdrext/abs-send-time"))for(const L of I.codecs)L.rtcpFeedback=(L.rtcpFeedback??[]).filter(O=>O.type!=="transport-cc");else for(const L of I.codecs)L.rtcpFeedback=(L.rtcpFeedback??[]).filter(O=>O.type!=="transport-cc"&&O.type!=="goog-remb");return I}function m(C,E){const I=[];if(!E)I.push(C[0]),d(C[1])&&I.push(C[1]);else{for(let L=0;L<C.length;++L)if(P(C[L],E,{strict:!0})){I.push(C[L]),d(C[L+1])&&I.push(C[L+1]);break}if(I.length===0)throw new TypeError("no matching codec found")}return I}function a(C){C=D.clone(C),_(C);const E={mid:R,codecs:[],headerExtensions:[],encodings:[{ssrc:u}],rtcp:{cname:"probator"}};return E.codecs.push(C.codecs[0]),E.codecs[0].payloadType=T,E.headerExtensions=C.headerExtensions,E}function s(C,E){return E.codecs.some(I=>I.kind===C)}function e(C,E){if(_(C),C.codecs.length===0)return!1;const I=C.codecs[0];return E.codecs.some(L=>L.remotePayloadType===I.payloadType)}function t(C){const E=new RegExp("^(audio|video)/(.+)","i");if(typeof C!="object")throw new TypeError("codec is not an object");if(!C.mimeType||typeof C.mimeType!="string")throw new TypeError("missing codec.mimeType");const I=E.exec(C.mimeType);if(!I)throw new TypeError("invalid codec.mimeType");if(C.kind=I[1].toLowerCase(),C.preferredPayloadType&&typeof C.preferredPayloadType!="number")throw new TypeError("invalid codec.preferredPayloadType");if(typeof C.clockRate!="number")throw new TypeError("missing codec.clockRate");C.kind==="audio"?typeof C.channels!="number"&&(C.channels=1):delete C.channels,(!C.parameters||typeof C.parameters!="object")&&(C.parameters={});for(const L of Object.keys(C.parameters)){let O=C.parameters[L];if(O===void 0&&(C.parameters[L]="",O=""),typeof O!="string"&&typeof O!="number")throw new TypeError(`invalid codec parameter [key:${L}s, value:${O}]`);if(L==="apt"&&typeof O!="number")throw new TypeError("invalid codec apt parameter")}(!C.rtcpFeedback||!Array.isArray(C.rtcpFeedback))&&(C.rtcpFeedback=[]);for(const L of C.rtcpFeedback)i(L)}function i(C){if(typeof C!="object")throw new TypeError("fb is not an object");if(!C.type||typeof C.type!="string")throw new TypeError("missing fb.type");(!C.parameter||typeof C.parameter!="string")&&(C.parameter="")}function r(C){if(typeof C!="object")throw new TypeError("ext is not an object");if(C.kind!=="audio"&&C.kind!=="video")throw new TypeError("invalid ext.kind");if(!C.uri||typeof C.uri!="string")throw new TypeError("missing ext.uri");if(typeof C.preferredId!="number")throw new TypeError("missing ext.preferredId");if(C.preferredEncrypt&&typeof C.preferredEncrypt!="boolean")throw new TypeError("invalid ext.preferredEncrypt");if(C.preferredEncrypt||(C.preferredEncrypt=!1),C.direction&&typeof C.direction!="string")throw new TypeError("invalid ext.direction");C.direction||(C.direction="sendrecv")}function n(C){const E=new RegExp("^(audio|video)/(.+)","i");if(typeof C!="object")throw new TypeError("codec is not an object");if(!C.mimeType||typeof C.mimeType!="string")throw new TypeError("missing codec.mimeType");const I=E.exec(C.mimeType);if(!I)throw new TypeError("invalid codec.mimeType");if(typeof C.payloadType!="number")throw new TypeError("missing codec.payloadType");if(typeof C.clockRate!="number")throw new TypeError("missing codec.clockRate");I[1].toLowerCase()==="audio"?typeof C.channels!="number"&&(C.channels=1):delete C.channels,(!C.parameters||typeof C.parameters!="object")&&(C.parameters={});for(const O of Object.keys(C.parameters)){let F=C.parameters[O];if(F===void 0&&(C.parameters[O]="",F=""),typeof F!="string"&&typeof F!="number")throw new TypeError(`invalid codec parameter [key:${O}s, value:${F}]`);if(O==="apt"&&typeof F!="number")throw new TypeError("invalid codec apt parameter")}(!C.rtcpFeedback||!Array.isArray(C.rtcpFeedback))&&(C.rtcpFeedback=[]);for(const O of C.rtcpFeedback)i(O)}function o(C){if(typeof C!="object")throw new TypeError("ext is not an object");if(!C.uri||typeof C.uri!="string")throw new TypeError("missing ext.uri");if(typeof C.id!="number")throw new TypeError("missing ext.id");if(C.encrypt&&typeof C.encrypt!="boolean")throw new TypeError("invalid ext.encrypt");C.encrypt||(C.encrypt=!1),(!C.parameters||typeof C.parameters!="object")&&(C.parameters={});for(const E of Object.keys(C.parameters)){let I=C.parameters[E];if(I===void 0&&(C.parameters[E]="",I=""),typeof I!="string"&&typeof I!="number")throw new TypeError("invalid header extension parameter")}}function p(C){if(typeof C!="object")throw new TypeError("encoding is not an object");if(C.ssrc&&typeof C.ssrc!="number")throw new TypeError("invalid encoding.ssrc");if(C.rid&&typeof C.rid!="string")throw new TypeError("invalid encoding.rid");if(C.rtx&&typeof C.rtx!="object")throw new TypeError("invalid encoding.rtx");if(C.rtx&&typeof C.rtx.ssrc!="number")throw new TypeError("missing encoding.rtx.ssrc");if((!C.dtx||typeof C.dtx!="boolean")&&(C.dtx=!1),C.scalabilityMode&&typeof C.scalabilityMode!="string")throw new TypeError("invalid encoding.scalabilityMode")}function l(C){if(typeof C!="object")throw new TypeError("rtcp is not an object");if(C.cname&&typeof C.cname!="string")throw new TypeError("invalid rtcp.cname");(!C.reducedSize||typeof C.reducedSize!="boolean")&&(C.reducedSize=!0)}function w(C){if(typeof C!="object")throw new TypeError("numStreams is not an object");if(typeof C.OS!="number")throw new TypeError("missing numStreams.OS");if(typeof C.MIS!="number")throw new TypeError("missing numStreams.MIS")}function d(C){return C?/.+\/rtx$/i.test(C.mimeType):!1}function P(C,E,{strict:I=!1,modify:L=!1}={}){const O=C.mimeType.toLowerCase(),F=E.mimeType.toLowerCase();if(O!==F||C.clockRate!==E.clockRate||C.channels!==E.channels)return!1;switch(O){case"video/h264":{if(I){const $=C.parameters["packetization-mode"]??0,H=E.parameters["packetization-mode"]??0;if($!==H||!S.isSameProfile(C.parameters,E.parameters))return!1;let J;try{J=S.generateProfileLevelIdStringForAnswer(C.parameters,E.parameters)}catch{return!1}L&&(J?(C.parameters["profile-level-id"]=J,E.parameters["profile-level-id"]=J):(delete C.parameters["profile-level-id"],delete E.parameters["profile-level-id"]))}break}case"video/vp9":{if(I){const $=C.parameters["profile-id"]??0,H=E.parameters["profile-id"]??0;if($!==H)return!1}break}}return!0}function k(C,E){return!(C.kind&&E.kind&&C.kind!==E.kind||C.uri!==E.uri)}function x(C,E){const I=[];for(const L of C.rtcpFeedback??[]){const O=(E.rtcpFeedback??[]).find(F=>F.type===L.type&&(F.parameter===L.parameter||!F.parameter&&!L.parameter));O&&I.push(O)}return I}return Z}var Xe={},Rr={},Je={},Ze={},ps;function dn(){if(ps)return Ze;ps=1,Object.defineProperty(Ze,"__esModule",{value:!0}),Ze.Logger=void 0;const S=er(),D="awaitqueue";let R=class{_debug;_warn;_error;constructor(T){T?(this._debug=S(`${D}:${T}`),this._warn=S(`${D}:WARN:${T}`),this._error=S(`${D}:ERROR:${T}`)):(this._debug=S(D),this._warn=S(`${D}:WARN`),this._error=S(`${D}:ERROR`)),this._debug.log=console.info.bind(console),this._warn.log=console.warn.bind(console),this._error.log=console.error.bind(console)}get debug(){return this._debug}get warn(){return this._warn}get error(){return this._error}};return Ze.Logger=R,Ze}var ke={},ls;function bi(){if(ls)return ke;ls=1,Object.defineProperty(ke,"__esModule",{value:!0}),ke.AwaitQueueRemovedTaskError=ke.AwaitQueueStoppedError=void 0;class S extends Error{constructor(u){super(u??"queue stopped"),this.name="AwaitQueueStoppedError",typeof Error.captureStackTrace=="function"&&Error.captureStackTrace(this,S)}}ke.AwaitQueueStoppedError=S;class D extends Error{constructor(u){super(u??"queue task removed"),this.name="AwaitQueueRemovedTaskError",typeof Error.captureStackTrace=="function"&&Error.captureStackTrace(this,D)}}return ke.AwaitQueueRemovedTaskError=D,ke}var us;function pn(){if(us)return Je;us=1,Object.defineProperty(Je,"__esModule",{value:!0}),Je.AwaitQueue=void 0;const S=dn(),D=bi(),R=new S.Logger("AwaitQueue");let u=class{pendingTasks=new Map;nextTaskId=0;stopping=!1;constructor(){R.debug("constructor()")}get size(){return this.pendingTasks.size}async push(v,_){if(_=_??v.name,R.debug(`push() [name:${_}]`),typeof v!="function")throw new TypeError("given task is not a function");if(_)try{Object.defineProperty(v,"name",{value:_})}catch{}return new Promise((g,y)=>{const b={id:this.nextTaskId++,task:v,name:_,enqueuedAt:Date.now(),executedAt:void 0,completed:!1,resolve:h=>{if(b.completed)return;b.completed=!0,this.pendingTasks.delete(b.id),R.debug(`resolving task [name:${b.name}]`),g(h);const[c]=this.pendingTasks.values();c&&!c.executedAt&&this.execute(c)},reject:h=>{if(!b.completed&&(b.completed=!0,this.pendingTasks.delete(b.id),R.debug(`rejecting task [name:${b.name}]: %s`,String(h)),y(h),!this.stopping)){const[c]=this.pendingTasks.values();c&&!c.executedAt&&this.execute(c)}}};this.pendingTasks.set(b.id,b),this.pendingTasks.size===1&&this.execute(b)})}stop(){R.debug("stop()"),this.stopping=!0;for(const v of this.pendingTasks.values())R.debug(`stop() | stopping task [name:${v.name}]`),v.reject(new D.AwaitQueueStoppedError);this.stopping=!1}remove(v){R.debug(`remove() [taskIdx:${v}]`);const _=Array.from(this.pendingTasks.values())[v];if(!_){R.debug(`stop() | no task with given idx [taskIdx:${v}]`);return}_.reject(new D.AwaitQueueRemovedTaskError)}dump(){const v=Date.now();let _=0;return Array.from(this.pendingTasks.values()).map(g=>({idx:_++,task:g.task,name:g.name,enqueuedTime:g.executedAt?g.executedAt-g.enqueuedAt:v-g.enqueuedAt,executionTime:g.executedAt?v-g.executedAt:0}))}async execute(v){if(R.debug(`execute() [name:${v.name}]`),v.executedAt)throw new Error("task already being executed");v.executedAt=Date.now();try{const _=await v.task();v.resolve(_)}catch(_){v.reject(_)}}};return Je.AwaitQueue=u,Je}var hs;function ln(){return hs||(hs=1,function(S){Object.defineProperty(S,"__esModule",{value:!0}),S.AwaitQueueRemovedTaskError=S.AwaitQueueStoppedError=S.AwaitQueue=void 0;var D=pn();Object.defineProperty(S,"AwaitQueue",{enumerable:!0,get:function(){return D.AwaitQueue}});var R=bi();Object.defineProperty(S,"AwaitQueueStoppedError",{enumerable:!0,get:function(){return R.AwaitQueueStoppedError}}),Object.defineProperty(S,"AwaitQueueRemovedTaskError",{enumerable:!0,get:function(){return R.AwaitQueueRemovedTaskError}})}(Rr)),Rr}var et={},fs;function yi(){if(fs)return et;fs=1,Object.defineProperty(et,"__esModule",{value:!0}),et.Producer=void 0;const S=G(),D=ve(),R=Y(),u=new S.Logger("Producer");let T=class extends D.EnhancedEventEmitter{_id;_localId;_closed=!1;_rtpSender;_track;_kind;_rtpParameters;_paused;_maxSpatialLayer;_stopTracks;_disableTrackOnPause;_zeroRtpOnPause;_appData;_observer=new D.EnhancedEventEmitter;constructor({id:_,localId:g,rtpSender:y,track:b,rtpParameters:h,stopTracks:c,disableTrackOnPause:f,zeroRtpOnPause:m,appData:a}){super(),u.debug("constructor()"),this._id=_,this._localId=g,this._rtpSender=y,this._track=b,this._kind=b.kind,this._rtpParameters=h,this._paused=f?!b.enabled:!1,this._maxSpatialLayer=void 0,this._stopTracks=c,this._disableTrackOnPause=f,this._zeroRtpOnPause=m,this._appData=a??{},this.onTrackEnded=this.onTrackEnded.bind(this),this.handleTrack()}get id(){return this._id}get localId(){return this._localId}get closed(){return this._closed}get kind(){return this._kind}get rtpSender(){return this._rtpSender}get track(){return this._track}get rtpParameters(){return this._rtpParameters}get paused(){return this._paused}get maxSpatialLayer(){return this._maxSpatialLayer}get appData(){return this._appData}set appData(_){this._appData=_}get observer(){return this._observer}close(){this._closed||(u.debug("close()"),this._closed=!0,this.destroyTrack(),this.emit("@close"),this._observer.safeEmit("close"))}transportClosed(){this._closed||(u.debug("transportClosed()"),this._closed=!0,this.destroyTrack(),this.safeEmit("transportclose"),this._observer.safeEmit("close"))}async getStats(){if(this._closed)throw new R.InvalidStateError("closed");return new Promise((_,g)=>{this.safeEmit("@getstats",_,g)})}pause(){if(u.debug("pause()"),this._closed){u.error("pause() | Producer closed");return}this._paused=!0,this._track&&this._disableTrackOnPause&&(this._track.enabled=!1),this._zeroRtpOnPause&&new Promise((_,g)=>{this.safeEmit("@pause",_,g)}).catch(()=>{}),this._observer.safeEmit("pause")}resume(){if(u.debug("resume()"),this._closed){u.error("resume() | Producer closed");return}this._paused=!1,this._track&&this._disableTrackOnPause&&(this._track.enabled=!0),this._zeroRtpOnPause&&new Promise((_,g)=>{this.safeEmit("@resume",_,g)}).catch(()=>{}),this._observer.safeEmit("resume")}async replaceTrack({track:_}){if(u.debug("replaceTrack() [track:%o]",_),this._closed){if(_&&this._stopTracks)try{_.stop()}catch{}throw new R.InvalidStateError("closed")}else if(_&&_.readyState==="ended")throw new R.InvalidStateError("track ended");if(_===this._track){u.debug("replaceTrack() | same track, ignored");return}await new Promise((g,y)=>{this.safeEmit("@replacetrack",_,g,y)}),this.destroyTrack(),this._track=_,this._track&&this._disableTrackOnPause&&(this._paused?this._paused&&(this._track.enabled=!1):this._track.enabled=!0),this.handleTrack()}async setMaxSpatialLayer(_){if(this._closed)throw new R.InvalidStateError("closed");if(this._kind!=="video")throw new R.UnsupportedError("not a video Producer");if(typeof _!="number")throw new TypeError("invalid spatialLayer");_!==this._maxSpatialLayer&&(await new Promise((g,y)=>{this.safeEmit("@setmaxspatiallayer",_,g,y)}).catch(()=>{}),this._maxSpatialLayer=_)}async setRtpEncodingParameters(_){if(this._closed)throw new R.InvalidStateError("closed");if(typeof _!="object")throw new TypeError("invalid params");await new Promise((g,y)=>{this.safeEmit("@setrtpencodingparameters",_,g,y)})}onTrackEnded(){u.debug('track "ended" event'),this.safeEmit("trackended"),this._observer.safeEmit("trackended")}handleTrack(){this._track&&this._track.addEventListener("ended",this.onTrackEnded)}destroyTrack(){if(this._track)try{this._track.removeEventListener("ended",this.onTrackEnded),this._stopTracks&&this._track.stop()}catch{}}};return et.Producer=T,et}var tt={},ms;function Ri(){if(ms)return tt;ms=1,Object.defineProperty(tt,"__esModule",{value:!0}),tt.Consumer=void 0;const S=G(),D=ve(),R=Y(),u=new S.Logger("Consumer");let T=class extends D.EnhancedEventEmitter{_id;_localId;_producerId;_closed=!1;_rtpReceiver;_track;_rtpParameters;_paused;_appData;_observer=new D.EnhancedEventEmitter;constructor({id:_,localId:g,producerId:y,rtpReceiver:b,track:h,rtpParameters:c,appData:f}){super(),u.debug("constructor()"),this._id=_,this._localId=g,this._producerId=y,this._rtpReceiver=b,this._track=h,this._rtpParameters=c,this._paused=!h.enabled,this._appData=f??{},this.onTrackEnded=this.onTrackEnded.bind(this),this.handleTrack()}get id(){return this._id}get localId(){return this._localId}get producerId(){return this._producerId}get closed(){return this._closed}get kind(){return this._track.kind}get rtpReceiver(){return this._rtpReceiver}get track(){return this._track}get rtpParameters(){return this._rtpParameters}get paused(){return this._paused}get appData(){return this._appData}set appData(_){this._appData=_}get observer(){return this._observer}close(){this._closed||(u.debug("close()"),this._closed=!0,this.destroyTrack(),this.emit("@close"),this._observer.safeEmit("close"))}transportClosed(){this._closed||(u.debug("transportClosed()"),this._closed=!0,this.destroyTrack(),this.safeEmit("transportclose"),this._observer.safeEmit("close"))}async getStats(){if(this._closed)throw new R.InvalidStateError("closed");return new Promise((_,g)=>{this.safeEmit("@getstats",_,g)})}pause(){if(u.debug("pause()"),this._closed){u.error("pause() | Consumer closed");return}if(this._paused){u.debug("pause() | Consumer is already paused");return}this._paused=!0,this._track.enabled=!1,this.emit("@pause"),this._observer.safeEmit("pause")}resume(){if(u.debug("resume()"),this._closed){u.error("resume() | Consumer closed");return}if(!this._paused){u.debug("resume() | Consumer is already resumed");return}this._paused=!1,this._track.enabled=!0,this.emit("@resume"),this._observer.safeEmit("resume")}onTrackEnded(){u.debug('track "ended" event'),this.safeEmit("trackended"),this._observer.safeEmit("trackended")}handleTrack(){this._track.addEventListener("ended",this.onTrackEnded)}destroyTrack(){try{this._track.removeEventListener("ended",this.onTrackEnded),this._track.stop()}catch{}}};return tt.Consumer=T,tt}var rt={},gs;function Ci(){if(gs)return rt;gs=1,Object.defineProperty(rt,"__esModule",{value:!0}),rt.DataProducer=void 0;const S=G(),D=ve(),R=Y(),u=new S.Logger("DataProducer");let T=class extends D.EnhancedEventEmitter{_id;_dataChannel;_closed=!1;_sctpStreamParameters;_appData;_observer=new D.EnhancedEventEmitter;constructor({id:_,dataChannel:g,sctpStreamParameters:y,appData:b}){super(),u.debug("constructor()"),this._id=_,this._dataChannel=g,this._sctpStreamParameters=y,this._appData=b??{},this.handleDataChannel()}get id(){return this._id}get closed(){return this._closed}get sctpStreamParameters(){return this._sctpStreamParameters}get readyState(){return this._dataChannel.readyState}get label(){return this._dataChannel.label}get protocol(){return this._dataChannel.protocol}get bufferedAmount(){return this._dataChannel.bufferedAmount}get bufferedAmountLowThreshold(){return this._dataChannel.bufferedAmountLowThreshold}set bufferedAmountLowThreshold(_){this._dataChannel.bufferedAmountLowThreshold=_}get appData(){return this._appData}set appData(_){this._appData=_}get observer(){return this._observer}close(){this._closed||(u.debug("close()"),this._closed=!0,this._dataChannel.close(),this.emit("@close"),this._observer.safeEmit("close"))}transportClosed(){this._closed||(u.debug("transportClosed()"),this._closed=!0,this._dataChannel.close(),this.safeEmit("transportclose"),this._observer.safeEmit("close"))}send(_){if(u.debug("send()"),this._closed)throw new R.InvalidStateError("closed");this._dataChannel.send(_)}handleDataChannel(){this._dataChannel.addEventListener("open",()=>{this._closed||(u.debug('DataChannel "open" event'),this.safeEmit("open"))}),this._dataChannel.addEventListener("error",_=>{if(this._closed)return;let{error:g}=_;g||(g=new Error("unknown DataChannel error")),g.errorDetail==="sctp-failure"?u.error("DataChannel SCTP error [sctpCauseCode:%s]: %s",g.sctpCauseCode,g.message):u.error('DataChannel "error" event: %o',g),this.safeEmit("error",g)}),this._dataChannel.addEventListener("close",()=>{this._closed||(u.warn('DataChannel "close" event'),this._closed=!0,this.emit("@close"),this.safeEmit("close"),this._observer.safeEmit("close"))}),this._dataChannel.addEventListener("message",()=>{this._closed||u.warn('DataChannel "message" event in a DataProducer, message discarded')}),this._dataChannel.addEventListener("bufferedamountlow",()=>{this._closed||this.safeEmit("bufferedamountlow")})}};return rt.DataProducer=T,rt}var st={},_s;function Ti(){if(_s)return st;_s=1,Object.defineProperty(st,"__esModule",{value:!0}),st.DataConsumer=void 0;const S=G(),D=ve(),R=new S.Logger("DataConsumer");let u=class extends D.EnhancedEventEmitter{_id;_dataProducerId;_dataChannel;_closed=!1;_sctpStreamParameters;_appData;_observer=new D.EnhancedEventEmitter;constructor({id:v,dataProducerId:_,dataChannel:g,sctpStreamParameters:y,appData:b}){super(),R.debug("constructor()"),this._id=v,this._dataProducerId=_,this._dataChannel=g,this._sctpStreamParameters=y,this._appData=b??{},this.handleDataChannel()}get id(){return this._id}get dataProducerId(){return this._dataProducerId}get closed(){return this._closed}get sctpStreamParameters(){return this._sctpStreamParameters}get readyState(){return this._dataChannel.readyState}get label(){return this._dataChannel.label}get protocol(){return this._dataChannel.protocol}get binaryType(){return this._dataChannel.binaryType}set binaryType(v){this._dataChannel.binaryType=v}get appData(){return this._appData}set appData(v){this._appData=v}get observer(){return this._observer}close(){this._closed||(R.debug("close()"),this._closed=!0,this._dataChannel.close(),this.emit("@close"),this._observer.safeEmit("close"))}transportClosed(){this._closed||(R.debug("transportClosed()"),this._closed=!0,this._dataChannel.close(),this.safeEmit("transportclose"),this._observer.safeEmit("close"))}handleDataChannel(){this._dataChannel.addEventListener("open",()=>{this._closed||(R.debug('DataChannel "open" event'),this.safeEmit("open"))}),this._dataChannel.addEventListener("error",v=>{if(this._closed)return;let{error:_}=v;_||(_=new Error("unknown DataChannel error")),_.errorDetail==="sctp-failure"?R.error("DataChannel SCTP error [sctpCauseCode:%s]: %s",_.sctpCauseCode,_.message):R.error('DataChannel "error" event: %o',_),this.safeEmit("error",_)}),this._dataChannel.addEventListener("close",()=>{this._closed||(R.warn('DataChannel "close" event'),this._closed=!0,this.emit("@close"),this.safeEmit("close"),this._observer.safeEmit("close"))}),this._dataChannel.addEventListener("message",v=>{this._closed||this.safeEmit("message",v.data)})}};return st.DataConsumer=u,st}var ws;function Di(){if(ws)return Xe;ws=1,Object.defineProperty(Xe,"__esModule",{value:!0}),Xe.Transport=void 0;const S=ln(),D=G(),R=ve(),u=Y(),T=Q(),v=X(),_=yi(),g=Ri(),y=Ci(),b=Ti(),h=new D.Logger("Transport");class c{consumerOptions;promise;resolve;reject;constructor(a){this.consumerOptions=a,this.promise=new Promise((s,e)=>{this.resolve=s,this.reject=e})}}let f=class extends R.EnhancedEventEmitter{_id;_closed=!1;_direction;_extendedRtpCapabilities;_canProduceByKind;_maxSctpMessageSize;_handler;_iceGatheringState="new";_connectionState="new";_appData;_producers=new Map;_consumers=new Map;_dataProducers=new Map;_dataConsumers=new Map;_probatorConsumerCreated=!1;_awaitQueue=new S.AwaitQueue;_pendingConsumerTasks=[];_consumerCreationInProgress=!1;_pendingPauseConsumers=new Map;_consumerPauseInProgress=!1;_pendingResumeConsumers=new Map;_consumerResumeInProgress=!1;_pendingCloseConsumers=new Map;_consumerCloseInProgress=!1;_observer=new R.EnhancedEventEmitter;constructor({direction:a,id:s,iceParameters:e,iceCandidates:t,dtlsParameters:i,sctpParameters:r,iceServers:n,iceTransportPolicy:o,additionalSettings:p,proprietaryConstraints:l,appData:w,handlerFactory:d,extendedRtpCapabilities:P,canProduceByKind:k}){super(),h.debug("constructor() [id:%s, direction:%s]",s,a),this._id=s,this._direction=a,this._extendedRtpCapabilities=P,this._canProduceByKind=k,this._maxSctpMessageSize=r?r.maxMessageSize:null;const x=T.clone(p)??{};delete x.iceServers,delete x.iceTransportPolicy,delete x.bundlePolicy,delete x.rtcpMuxPolicy,delete x.sdpSemantics,this._handler=d(),this._handler.run({direction:a,iceParameters:e,iceCandidates:t,dtlsParameters:i,sctpParameters:r,iceServers:n,iceTransportPolicy:o,additionalSettings:x,proprietaryConstraints:l,extendedRtpCapabilities:P}),this._appData=w??{},this.handleHandler()}get id(){return this._id}get closed(){return this._closed}get direction(){return this._direction}get handler(){return this._handler}get iceGatheringState(){return this._iceGatheringState}get connectionState(){return this._connectionState}get appData(){return this._appData}set appData(a){this._appData=a}get observer(){return this._observer}close(){if(!this._closed){h.debug("close()"),this._closed=!0,this._awaitQueue.stop(),this._handler.close(),this._connectionState="closed";for(const a of this._producers.values())a.transportClosed();this._producers.clear();for(const a of this._consumers.values())a.transportClosed();this._consumers.clear();for(const a of this._dataProducers.values())a.transportClosed();this._dataProducers.clear();for(const a of this._dataConsumers.values())a.transportClosed();this._dataConsumers.clear(),this._observer.safeEmit("close")}}async getStats(){if(this._closed)throw new u.InvalidStateError("closed");return this._handler.getTransportStats()}async restartIce({iceParameters:a}){if(h.debug("restartIce()"),this._closed)throw new u.InvalidStateError("closed");if(!a)throw new TypeError("missing iceParameters");return this._awaitQueue.push(async()=>await this._handler.restartIce(a),"transport.restartIce()")}async updateIceServers({iceServers:a}={}){if(h.debug("updateIceServers()"),this._closed)throw new u.InvalidStateError("closed");if(!Array.isArray(a))throw new TypeError("missing iceServers");return this._awaitQueue.push(async()=>this._handler.updateIceServers(a),"transport.updateIceServers()")}async produce({track:a,encodings:s,codecOptions:e,codec:t,stopTracks:i=!0,disableTrackOnPause:r=!0,zeroRtpOnPause:n=!1,onRtpSender:o,appData:p={}}={}){if(h.debug("produce() [track:%o]",a),this._closed)throw new u.InvalidStateError("closed");if(a){if(this._direction!=="send")throw new u.UnsupportedError("not a sending Transport");if(this._canProduceByKind[a.kind]){if(a.readyState==="ended")throw new u.InvalidStateError("track ended");if(this.listenerCount("connect")===0&&this._connectionState==="new")throw new TypeError('no "connect" listener set into this transport');if(this.listenerCount("produce")===0)throw new TypeError('no "produce" listener set into this transport');if(p&&typeof p!="object")throw new TypeError("if given, appData must be an object")}else throw new u.UnsupportedError(`cannot produce ${a.kind}`)}else throw new TypeError("missing track");return this._awaitQueue.push(async()=>{let l;if(s&&!Array.isArray(s))throw TypeError("encodings must be an array");s&&s.length===0?l=void 0:s&&(l=s.map(k=>{const x={active:!0};return k.active===!1&&(x.active=!1),typeof k.dtx=="boolean"&&(x.dtx=k.dtx),typeof k.scalabilityMode=="string"&&(x.scalabilityMode=k.scalabilityMode),typeof k.scaleResolutionDownBy=="number"&&(x.scaleResolutionDownBy=k.scaleResolutionDownBy),typeof k.maxBitrate=="number"&&(x.maxBitrate=k.maxBitrate),typeof k.maxFramerate=="number"&&(x.maxFramerate=k.maxFramerate),typeof k.adaptivePtime=="boolean"&&(x.adaptivePtime=k.adaptivePtime),typeof k.priority=="string"&&(x.priority=k.priority),typeof k.networkPriority=="string"&&(x.networkPriority=k.networkPriority),x}));const{localId:w,rtpParameters:d,rtpSender:P}=await this._handler.send({track:a,encodings:l,codecOptions:e,codec:t,onRtpSender:o});try{v.validateRtpParameters(d);const{id:k}=await new Promise((C,E)=>{this.safeEmit("produce",{kind:a.kind,rtpParameters:d,appData:p},C,E)}),x=new _.Producer({id:k,localId:w,rtpSender:P,track:a,rtpParameters:d,stopTracks:i,disableTrackOnPause:r,zeroRtpOnPause:n,appData:p});return this._producers.set(x.id,x),this.handleProducer(x),this._observer.safeEmit("newproducer",x),x}catch(k){throw this._handler.stopSending(w).catch(()=>{}),k}},"transport.produce()").catch(l=>{if(i)try{a.stop()}catch{}throw l})}async consume({id:a,producerId:s,kind:e,rtpParameters:t,streamId:i,onRtpReceiver:r,appData:n={}}){if(h.debug("consume()"),this._closed)throw new u.InvalidStateError("closed");if(this._direction!=="recv")throw new u.UnsupportedError("not a receiving Transport");if(typeof a!="string")throw new TypeError("missing id");if(typeof s!="string")throw new TypeError("missing producerId");if(e!=="audio"&&e!=="video")throw new TypeError(`invalid kind '${e}'`);if(this.listenerCount("connect")===0&&this._connectionState==="new")throw new TypeError('no "connect" listener set into this transport');if(n&&typeof n!="object")throw new TypeError("if given, appData must be an object");const o=T.clone(t);if(!v.canReceive(o,this._extendedRtpCapabilities))throw new u.UnsupportedError("cannot consume this Producer");const l=new c({id:a,producerId:s,kind:e,rtpParameters:o,streamId:i,onRtpReceiver:r,appData:n});return this._pendingConsumerTasks.push(l),queueMicrotask(()=>{this._closed||this._consumerCreationInProgress===!1&&this.createPendingConsumers()}),l.promise}async produceData({ordered:a=!0,maxPacketLifeTime:s,maxRetransmits:e,label:t="",protocol:i="",appData:r={}}={}){if(h.debug("produceData()"),this._closed)throw new u.InvalidStateError("closed");if(this._direction!=="send")throw new u.UnsupportedError("not a sending Transport");if(this._maxSctpMessageSize){if(this.listenerCount("connect")===0&&this._connectionState==="new")throw new TypeError('no "connect" listener set into this transport');if(this.listenerCount("producedata")===0)throw new TypeError('no "producedata" listener set into this transport');if(r&&typeof r!="object")throw new TypeError("if given, appData must be an object")}else throw new u.UnsupportedError("SCTP not enabled by remote Transport");return(s||e)&&(a=!1),this._awaitQueue.push(async()=>{const{dataChannel:n,sctpStreamParameters:o}=await this._handler.sendDataChannel({ordered:a,maxPacketLifeTime:s,maxRetransmits:e,label:t,protocol:i});v.validateSctpStreamParameters(o);const{id:p}=await new Promise((w,d)=>{this.safeEmit("producedata",{sctpStreamParameters:o,label:t,protocol:i,appData:r},w,d)}),l=new y.DataProducer({id:p,dataChannel:n,sctpStreamParameters:o,appData:r});return this._dataProducers.set(l.id,l),this.handleDataProducer(l),this._observer.safeEmit("newdataproducer",l),l},"transport.produceData()")}async consumeData({id:a,dataProducerId:s,sctpStreamParameters:e,label:t="",protocol:i="",appData:r={}}){if(h.debug("consumeData()"),this._closed)throw new u.InvalidStateError("closed");if(this._direction!=="recv")throw new u.UnsupportedError("not a receiving Transport");if(this._maxSctpMessageSize){if(typeof a!="string")throw new TypeError("missing id");if(typeof s!="string")throw new TypeError("missing dataProducerId");if(this.listenerCount("connect")===0&&this._connectionState==="new")throw new TypeError('no "connect" listener set into this transport');if(r&&typeof r!="object")throw new TypeError("if given, appData must be an object")}else throw new u.UnsupportedError("SCTP not enabled by remote Transport");const n=T.clone(e);return v.validateSctpStreamParameters(n),this._awaitQueue.push(async()=>{const{dataChannel:o}=await this._handler.receiveDataChannel({sctpStreamParameters:n,label:t,protocol:i}),p=new b.DataConsumer({id:a,dataProducerId:s,dataChannel:o,sctpStreamParameters:n,appData:r});return this._dataConsumers.set(p.id,p),this.handleDataConsumer(p),this._observer.safeEmit("newdataconsumer",p),p},"transport.consumeData()")}createPendingConsumers(){this._consumerCreationInProgress=!0,this._awaitQueue.push(async()=>{if(this._pendingConsumerTasks.length===0){h.debug("createPendingConsumers() | there is no Consumer to be created");return}const a=[...this._pendingConsumerTasks];this._pendingConsumerTasks=[];let s;const e=[];for(const t of a){const{id:i,kind:r,rtpParameters:n,streamId:o,onRtpReceiver:p}=t.consumerOptions;e.push({trackId:i,kind:r,rtpParameters:n,streamId:o,onRtpReceiver:p})}try{const t=await this._handler.receive(e);for(let i=0;i<t.length;++i){const r=a[i],n=t[i],{id:o,producerId:p,kind:l,rtpParameters:w,appData:d}=r.consumerOptions,{localId:P,rtpReceiver:k,track:x}=n,C=new g.Consumer({id:o,localId:P,producerId:p,rtpReceiver:k,track:x,rtpParameters:w,appData:d});this._consumers.set(C.id,C),this.handleConsumer(C),!this._probatorConsumerCreated&&!s&&l==="video"&&(s=C),this._observer.safeEmit("newconsumer",C),r.resolve(C)}}catch(t){for(const i of a)i.reject(t)}if(s)try{const t=v.generateProbatorRtpParameters(s.rtpParameters);await this._handler.receive([{trackId:"probator",kind:"video",rtpParameters:t}]),h.debug("createPendingConsumers() | Consumer for RTP probation created"),this._probatorConsumerCreated=!0}catch(t){h.error("createPendingConsumers() | failed to create Consumer for RTP probation:%o",t)}},"transport.createPendingConsumers()").then(()=>{this._consumerCreationInProgress=!1,this._pendingConsumerTasks.length>0&&this.createPendingConsumers()}).catch(()=>{})}pausePendingConsumers(){this._consumerPauseInProgress=!0,this._awaitQueue.push(async()=>{if(this._pendingPauseConsumers.size===0){h.debug("pausePendingConsumers() | there is no Consumer to be paused");return}const a=Array.from(this._pendingPauseConsumers.values());this._pendingPauseConsumers.clear();try{const s=a.map(e=>e.localId);await this._handler.pauseReceiving(s)}catch(s){h.error("pausePendingConsumers() | failed to pause Consumers:",s)}},"transport.pausePendingConsumers").then(()=>{this._consumerPauseInProgress=!1,this._pendingPauseConsumers.size>0&&this.pausePendingConsumers()}).catch(()=>{})}resumePendingConsumers(){this._consumerResumeInProgress=!0,this._awaitQueue.push(async()=>{if(this._pendingResumeConsumers.size===0){h.debug("resumePendingConsumers() | there is no Consumer to be resumed");return}const a=Array.from(this._pendingResumeConsumers.values());this._pendingResumeConsumers.clear();try{const s=a.map(e=>e.localId);await this._handler.resumeReceiving(s)}catch(s){h.error("resumePendingConsumers() | failed to resume Consumers:",s)}},"transport.resumePendingConsumers").then(()=>{this._consumerResumeInProgress=!1,this._pendingResumeConsumers.size>0&&this.resumePendingConsumers()}).catch(()=>{})}closePendingConsumers(){this._consumerCloseInProgress=!0,this._awaitQueue.push(async()=>{if(this._pendingCloseConsumers.size===0){h.debug("closePendingConsumers() | there is no Consumer to be closed");return}const a=Array.from(this._pendingCloseConsumers.values());this._pendingCloseConsumers.clear();try{await this._handler.stopReceiving(a.map(s=>s.localId))}catch(s){h.error("closePendingConsumers() | failed to close Consumers:",s)}},"transport.closePendingConsumers").then(()=>{this._consumerCloseInProgress=!1,this._pendingCloseConsumers.size>0&&this.closePendingConsumers()}).catch(()=>{})}handleHandler(){const a=this._handler;a.on("@connect",({dtlsParameters:s},e,t)=>{if(this._closed){t(new u.InvalidStateError("closed"));return}this.safeEmit("connect",{dtlsParameters:s},e,t)}),a.on("@icegatheringstatechange",s=>{s!==this._iceGatheringState&&(h.debug("ICE gathering state changed to %s",s),this._iceGatheringState=s,this._closed||this.safeEmit("icegatheringstatechange",s))}),a.on("@icecandidateerror",s=>{h.warn(`ICE candidate error [url:${s.url}, localAddress:${s.address}, localPort:${s.port}]: ${s.errorCode} "${s.errorText}"`),this.safeEmit("icecandidateerror",s)}),a.on("@connectionstatechange",s=>{s!==this._connectionState&&(h.debug("connection state changed to %s",s),this._connectionState=s,this._closed||this.safeEmit("connectionstatechange",s))})}handleProducer(a){a.on("@close",()=>{this._producers.delete(a.id),!this._closed&&this._awaitQueue.push(async()=>await this._handler.stopSending(a.localId),"producer @close event").catch(s=>h.warn("producer.close() failed:%o",s))}),a.on("@pause",(s,e)=>{this._awaitQueue.push(async()=>await this._handler.pauseSending(a.localId),"producer @pause event").then(s).catch(e)}),a.on("@resume",(s,e)=>{this._awaitQueue.push(async()=>await this._handler.resumeSending(a.localId),"producer @resume event").then(s).catch(e)}),a.on("@replacetrack",(s,e,t)=>{this._awaitQueue.push(async()=>await this._handler.replaceTrack(a.localId,s),"producer @replacetrack event").then(e).catch(t)}),a.on("@setmaxspatiallayer",(s,e,t)=>{this._awaitQueue.push(async()=>await this._handler.setMaxSpatialLayer(a.localId,s),"producer @setmaxspatiallayer event").then(e).catch(t)}),a.on("@setrtpencodingparameters",(s,e,t)=>{this._awaitQueue.push(async()=>await this._handler.setRtpEncodingParameters(a.localId,s),"producer @setrtpencodingparameters event").then(e).catch(t)}),a.on("@getstats",(s,e)=>{if(this._closed)return e(new u.InvalidStateError("closed"));this._handler.getSenderStats(a.localId).then(s).catch(e)})}handleConsumer(a){a.on("@close",()=>{this._consumers.delete(a.id),this._pendingPauseConsumers.delete(a.id),this._pendingResumeConsumers.delete(a.id),!this._closed&&(this._pendingCloseConsumers.set(a.id,a),this._consumerCloseInProgress===!1&&this.closePendingConsumers())}),a.on("@pause",()=>{this._pendingResumeConsumers.has(a.id)&&this._pendingResumeConsumers.delete(a.id),this._pendingPauseConsumers.set(a.id,a),queueMicrotask(()=>{this._closed||this._consumerPauseInProgress===!1&&this.pausePendingConsumers()})}),a.on("@resume",()=>{this._pendingPauseConsumers.has(a.id)&&this._pendingPauseConsumers.delete(a.id),this._pendingResumeConsumers.set(a.id,a),queueMicrotask(()=>{this._closed||this._consumerResumeInProgress===!1&&this.resumePendingConsumers()})}),a.on("@getstats",(s,e)=>{if(this._closed)return e(new u.InvalidStateError("closed"));this._handler.getReceiverStats(a.localId).then(s).catch(e)})}handleDataProducer(a){a.on("@close",()=>{this._dataProducers.delete(a.id)})}handleDataConsumer(a){a.on("@close",()=>{this._dataConsumers.delete(a.id)})}};return Xe.Transport=f,Xe}var it={},ae={},Cr={},Tr={exports:{}},vs;function Ir(){if(vs)return Tr.exports;vs=1;var S=Tr.exports={v:[{name:"version",reg:/^(\d*)$/}],o:[{name:"origin",reg:/^(\S*) (\d*) (\d*) (\S*) IP(\d) (\S*)/,names:["username","sessionId","sessionVersion","netType","ipVer","address"],format:"%s %s %d %s IP%d %s"}],s:[{name:"name"}],i:[{name:"description"}],u:[{name:"uri"}],e:[{name:"email"}],p:[{name:"phone"}],z:[{name:"timezones"}],r:[{name:"repeats"}],t:[{name:"timing",reg:/^(\d*) (\d*)/,names:["start","stop"],format:"%d %d"}],c:[{name:"connection",reg:/^IN IP(\d) (\S*)/,names:["version","ip"],format:"IN IP%d %s"}],b:[{push:"bandwidth",reg:/^(TIAS|AS|CT|RR|RS):(\d*)/,names:["type","limit"],format:"%s:%s"}],m:[{reg:/^(\w*) (\d*) ([\w/]*)(?: (.*))?/,names:["type","port","protocol","payloads"],format:"%s %d %s %s"}],a:[{push:"rtp",reg:/^rtpmap:(\d*) ([\w\-.]*)(?:\s*\/(\d*)(?:\s*\/(\S*))?)?/,names:["payload","codec","rate","encoding"],format:function(D){return D.encoding?"rtpmap:%d %s/%s/%s":D.rate?"rtpmap:%d %s/%s":"rtpmap:%d %s"}},{push:"fmtp",reg:/^fmtp:(\d*) ([\S| ]*)/,names:["payload","config"],format:"fmtp:%d %s"},{name:"control",reg:/^control:(.*)/,format:"control:%s"},{name:"rtcp",reg:/^rtcp:(\d*)(?: (\S*) IP(\d) (\S*))?/,names:["port","netType","ipVer","address"],format:function(D){return D.address!=null?"rtcp:%d %s IP%d %s":"rtcp:%d"}},{push:"rtcpFbTrrInt",reg:/^rtcp-fb:(\*|\d*) trr-int (\d*)/,names:["payload","value"],format:"rtcp-fb:%s trr-int %d"},{push:"rtcpFb",reg:/^rtcp-fb:(\*|\d*) ([\w-_]*)(?: ([\w-_]*))?/,names:["payload","type","subtype"],format:function(D){return D.subtype!=null?"rtcp-fb:%s %s %s":"rtcp-fb:%s %s"}},{push:"ext",reg:/^extmap:(\d+)(?:\/(\w+))?(?: (urn:ietf:params:rtp-hdrext:encrypt))? (\S*)(?: (\S*))?/,names:["value","direction","encrypt-uri","uri","config"],format:function(D){return"extmap:%d"+(D.direction?"/%s":"%v")+(D["encrypt-uri"]?" %s":"%v")+" %s"+(D.config?" %s":"")}},{name:"extmapAllowMixed",reg:/^(extmap-allow-mixed)/},{push:"crypto",reg:/^crypto:(\d*) ([\w_]*) (\S*)(?: (\S*))?/,names:["id","suite","config","sessionConfig"],format:function(D){return D.sessionConfig!=null?"crypto:%d %s %s %s":"crypto:%d %s %s"}},{name:"setup",reg:/^setup:(\w*)/,format:"setup:%s"},{name:"connectionType",reg:/^connection:(new|existing)/,format:"connection:%s"},{name:"mid",reg:/^mid:([^\s]*)/,format:"mid:%s"},{name:"msid",reg:/^msid:(.*)/,format:"msid:%s"},{name:"ptime",reg:/^ptime:(\d*(?:\.\d*)*)/,format:"ptime:%d"},{name:"maxptime",reg:/^maxptime:(\d*(?:\.\d*)*)/,format:"maxptime:%d"},{name:"direction",reg:/^(sendrecv|recvonly|sendonly|inactive)/},{name:"icelite",reg:/^(ice-lite)/},{name:"iceUfrag",reg:/^ice-ufrag:(\S*)/,format:"ice-ufrag:%s"},{name:"icePwd",reg:/^ice-pwd:(\S*)/,format:"ice-pwd:%s"},{name:"fingerprint",reg:/^fingerprint:(\S*) (\S*)/,names:["type","hash"],format:"fingerprint:%s %s"},{push:"candidates",reg:/^candidate:(\S*) (\d*) (\S*) (\d*) (\S*) (\d*) typ (\S*)(?: raddr (\S*) rport (\d*))?(?: tcptype (\S*))?(?: generation (\d*))?(?: network-id (\d*))?(?: network-cost (\d*))?/,names:["foundation","component","transport","priority","ip","port","type","raddr","rport","tcptype","generation","network-id","network-cost"],format:function(D){var R="candidate:%s %d %s %d %s %d typ %s";return R+=D.raddr!=null?" raddr %s rport %d":"%v%v",R+=D.tcptype!=null?" tcptype %s":"%v",D.generation!=null&&(R+=" generation %d"),R+=D["network-id"]!=null?" network-id %d":"%v",R+=D["network-cost"]!=null?" network-cost %d":"%v",R}},{name:"endOfCandidates",reg:/^(end-of-candidates)/},{name:"remoteCandidates",reg:/^remote-candidates:(.*)/,format:"remote-candidates:%s"},{name:"iceOptions",reg:/^ice-options:(\S*)/,format:"ice-options:%s"},{push:"ssrcs",reg:/^ssrc:(\d*) ([\w_-]*)(?::(.*))?/,names:["id","attribute","value"],format:function(D){var R="ssrc:%d";return D.attribute!=null&&(R+=" %s",D.value!=null&&(R+=":%s")),R}},{push:"ssrcGroups",reg:/^ssrc-group:([\x21\x23\x24\x25\x26\x27\x2A\x2B\x2D\x2E\w]*) (.*)/,names:["semantics","ssrcs"],format:"ssrc-group:%s %s"},{name:"msidSemantic",reg:/^msid-semantic:\s?(\w*) (\S*)/,names:["semantic","token"],format:"msid-semantic: %s %s"},{push:"groups",reg:/^group:(\w*) (.*)/,names:["type","mids"],format:"group:%s %s"},{name:"rtcpMux",reg:/^(rtcp-mux)/},{name:"rtcpRsize",reg:/^(rtcp-rsize)/},{name:"sctpmap",reg:/^sctpmap:([\w_/]*) (\S*)(?: (\S*))?/,names:["sctpmapNumber","app","maxMessageSize"],format:function(D){return D.maxMessageSize!=null?"sctpmap:%s %s %s":"sctpmap:%s %s"}},{name:"xGoogleFlag",reg:/^x-google-flag:([^\s]*)/,format:"x-google-flag:%s"},{push:"rids",reg:/^rid:([\d\w]+) (\w+)(?: ([\S| ]*))?/,names:["id","direction","params"],format:function(D){return D.params?"rid:%s %s %s":"rid:%s %s"}},{push:"imageattrs",reg:new RegExp("^imageattr:(\\d+|\\*)[\\s\\t]+(send|recv)[\\s\\t]+(\\*|\\[\\S+\\](?:[\\s\\t]+\\[\\S+\\])*)(?:[\\s\\t]+(recv|send)[\\s\\t]+(\\*|\\[\\S+\\](?:[\\s\\t]+\\[\\S+\\])*))?"),names:["pt","dir1","attrs1","dir2","attrs2"],format:function(D){return"imageattr:%s %s %s"+(D.dir2?" %s %s":"")}},{name:"simulcast",reg:new RegExp("^simulcast:(send|recv) ([a-zA-Z0-9\\-_~;,]+)(?:\\s?(send|recv) ([a-zA-Z0-9\\-_~;,]+))?$"),names:["dir1","list1","dir2","list2"],format:function(D){return"simulcast:%s %s"+(D.dir2?" %s %s":"")}},{name:"simulcast_03",reg:/^simulcast:[\s\t]+([\S+\s\t]+)$/,names:["value"],format:"simulcast: %s"},{name:"framerate",reg:/^framerate:(\d+(?:$|\.\d+))/,format:"framerate:%s"},{name:"sourceFilter",reg:/^source-filter: *(excl|incl) (\S*) (IP4|IP6|\*) (\S*) (.*)/,names:["filterMode","netType","addressTypes","destAddress","srcList"],format:"source-filter: %s %s %s %s %s"},{name:"bundleOnly",reg:/^(bundle-only)/},{name:"label",reg:/^label:(.+)/,format:"label:%s"},{name:"sctpPort",reg:/^sctp-port:(\d+)$/,format:"sctp-port:%s"},{name:"maxMessageSize",reg:/^max-message-size:(\d+)$/,format:"max-message-size:%s"},{push:"tsRefClocks",reg:/^ts-refclk:([^\s=]*)(?:=(\S*))?/,names:["clksrc","clksrcExt"],format:function(D){return"ts-refclk:%s"+(D.clksrcExt!=null?"=%s":"")}},{name:"mediaClk",reg:/^mediaclk:(?:id=(\S*))? *([^\s=]*)(?:=(\S*))?(?: *rate=(\d+)\/(\d+))?/,names:["id","mediaClockName","mediaClockValue","rateNumerator","rateDenominator"],format:function(D){var R="mediaclk:";return R+=D.id!=null?"id=%s %s":"%v%s",R+=D.mediaClockValue!=null?"=%s":"",R+=D.rateNumerator!=null?" rate=%s":"",R+=D.rateDenominator!=null?"/%s":"",R}},{name:"keywords",reg:/^keywds:(.+)$/,format:"keywds:%s"},{name:"content",reg:/^content:(.+)/,format:"content:%s"},{name:"bfcpFloorCtrl",reg:/^floorctrl:(c-only|s-only|c-s)/,format:"floorctrl:%s"},{name:"bfcpConfId",reg:/^confid:(\d+)/,format:"confid:%s"},{name:"bfcpUserId",reg:/^userid:(\d+)/,format:"userid:%s"},{name:"bfcpFloorId",reg:/^floorid:(.+) (?:m-stream|mstrm):(.+)/,names:["id","mStream"],format:"floorid:%s mstrm:%s"},{push:"invalid",names:["value"]}]};return Object.keys(S).forEach(function(D){var R=S[D];R.forEach(function(u){u.reg||(u.reg=/(.*)/),u.format||(u.format="%s")})}),Tr.exports}var Ss;function un(){return Ss||(Ss=1,function(S){var D=function(g){return String(Number(g))===g?Number(g):g},R=function(g,y,b,h){if(h&&!b)y[h]=D(g[1]);else for(var c=0;c<b.length;c+=1)g[c+1]!=null&&(y[b[c]]=D(g[c+1]))},u=function(g,y,b){var h=g.name&&g.names;g.push&&!y[g.push]?y[g.push]=[]:h&&!y[g.name]&&(y[g.name]={});var c=g.push?{}:h?y[g.name]:y;R(b.match(g.reg),c,g.names,g.name),g.push&&y[g.push].push(c)},T=Ir(),v=RegExp.prototype.test.bind(/^([a-z])=(.*)/);S.parse=function(g){var y={},b=[],h=y;return g.split(/(\r\n|\r|\n)/).filter(v).forEach(function(c){var f=c[0],m=c.slice(2);f==="m"&&(b.push({rtp:[],fmtp:[]}),h=b[b.length-1]);for(var a=0;a<(T[f]||[]).length;a+=1){var s=T[f][a];if(s.reg.test(m))return u(s,h,m)}}),y.media=b,y};var _=function(g,y){var b=y.split(/=(.+)/,2);return b.length===2?g[b[0]]=D(b[1]):b.length===1&&y.length>1&&(g[b[0]]=void 0),g};S.parseParams=function(g){return g.split(/;\s?/).reduce(_,{})},S.parseFmtpConfig=S.parseParams,S.parsePayloads=function(g){return g.toString().split(" ").map(Number)},S.parseRemoteCandidates=function(g){for(var y=[],b=g.split(" ").map(D),h=0;h<b.length;h+=3)y.push({component:b[h],ip:b[h+1],port:b[h+2]});return y},S.parseImageAttributes=function(g){return g.split(" ").map(function(y){return y.substring(1,y.length-1).split(",").reduce(_,{})})},S.parseSimulcastStreamList=function(g){return g.split(";").map(function(y){return y.split(",").map(function(b){var h,c=!1;return b[0]!=="~"?h=D(b):(h=D(b.substring(1,b.length)),c=!0),{scid:h,paused:c}})})}}(Cr)),Cr}var Dr,bs;function hn(){if(bs)return Dr;bs=1;var S=Ir(),D=/%[sdv%]/g,R=function(_){var g=1,y=arguments,b=y.length;return _.replace(D,function(h){if(g>=b)return h;var c=y[g];switch(g+=1,h){case"%%":return"%";case"%s":return String(c);case"%d":return Number(c);case"%v":return""}})},u=function(_,g,y){var b=g.format instanceof Function?g.format(g.push?y:y[g.name]):g.format,h=[_+"="+b];if(g.names)for(var c=0;c<g.names.length;c+=1){var f=g.names[c];g.name?h.push(y[g.name][f]):h.push(y[g.names[c]])}else h.push(y[g.name]);return R.apply(null,h)},T=["v","o","s","i","u","e","p","c","b","t","r","z","a"],v=["i","c","b","a"];return Dr=function(_,g){g=g||{},_.version==null&&(_.version=0),_.name==null&&(_.name=" "),_.media.forEach(function(c){c.payloads==null&&(c.payloads="")});var y=g.outerOrder||T,b=g.innerOrder||v,h=[];return y.forEach(function(c){S[c].forEach(function(f){f.name in _&&_[f.name]!=null?h.push(u(c,f,_)):f.push in _&&_[f.push]!=null&&_[f.push].forEach(function(m){h.push(u(c,f,m))})})}),_.media.forEach(function(c){h.push(u("m",S.m[0],c)),b.forEach(function(f){S[f].forEach(function(m){m.name in c&&c[m.name]!=null?h.push(u(f,m,c)):m.push in c&&c[m.push]!=null&&c[m.push].forEach(function(a){h.push(u(f,m,a))})})})}),h.join(`\r
`)+`\r
`},Dr}var ys;function te(){if(ys)return ae;ys=1;var S=un(),D=hn(),R=Ir();return ae.grammar=R,ae.write=D,ae.parse=S.parse,ae.parseParams=S.parseParams,ae.parseFmtpConfig=S.parseFmtpConfig,ae.parsePayloads=S.parsePayloads,ae.parseRemoteCandidates=S.parseRemoteCandidates,ae.parseImageAttributes=S.parseImageAttributes,ae.parseSimulcastStreamList=S.parseSimulcastStreamList,ae}var Ee={},Rs;function oe(){if(Rs)return Ee;Rs=1,Object.defineProperty(Ee,"__esModule",{value:!0}),Ee.extractRtpCapabilities=D,Ee.extractDtlsParameters=R,Ee.getCname=u,Ee.applyCodecParameters=T;const S=te();function D({sdpObject:v}){const _=new Map,g=[];let y=!1,b=!1;for(const c of v.media){const f=c.type;switch(f){case"audio":{if(y)continue;y=!0;break}case"video":{if(b)continue;b=!0;break}default:continue}for(const m of c.rtp){const a={kind:f,mimeType:`${f}/${m.codec}`,preferredPayloadType:m.payload,clockRate:m.rate,channels:m.encoding,parameters:{},rtcpFeedback:[]};_.set(a.preferredPayloadType,a)}for(const m of c.fmtp??[]){const a=S.parseParams(m.config),s=_.get(m.payload);s&&(a?.hasOwnProperty("profile-level-id")&&(a["profile-level-id"]=String(a["profile-level-id"])),s.parameters=a)}for(const m of c.rtcpFb??[]){const a={type:m.type,parameter:m.subtype};if(a.parameter||delete a.parameter,m.payload!=="*"){const s=_.get(m.payload);if(!s)continue;s.rtcpFeedback.push(a)}else for(const s of _.values())s.kind===f&&!/.+\/rtx$/i.test(s.mimeType)&&s.rtcpFeedback.push(a)}for(const m of c.ext??[]){if(m["encrypt-uri"])continue;const a={kind:f,uri:m.uri,preferredId:m.value};g.push(a)}}return{codecs:Array.from(_.values()),headerExtensions:g}}function R({sdpObject:v}){let _=v.setup,g=v.fingerprint;if(!_||!g){const h=(v.media??[]).find(c=>c.port!==0);h&&(_??=h.setup,g??=h.fingerprint)}if(_){if(!g)throw new Error("no a=fingerprint found at SDP session or media level")}else throw new Error("no a=setup found at SDP session or media level");let y;switch(_){case"active":{y="client";break}case"passive":{y="server";break}case"actpass":{y="auto";break}}return{role:y,fingerprints:[{algorithm:g.type,value:g.hash}]}}function u({offerMediaObject:v}){const _=(v.ssrcs??[]).find(g=>g.attribute==="cname");return _?_.value:""}function T({offerRtpParameters:v,answerMediaObject:_}){for(const g of v.codecs){const y=g.mimeType.toLowerCase();if(y!=="audio/opus"||!(_.rtp??[]).find(f=>f.payload===g.payloadType))continue;_.fmtp=_.fmtp??[];let h=_.fmtp.find(f=>f.payload===g.payloadType);h||(h={payload:g.payloadType,config:""},_.fmtp.push(h));const c=S.parseParams(h.config);switch(y){case"audio/opus":{const f=g.parameters["sprop-stereo"];f!==void 0&&(c.stereo=Number(f)?1:0);break}}h.config="";for(const f of Object.keys(c))h.config&&(h.config+=";"),h.config+=`${f}=${c[f]}`}}return Ee}var nt={},Cs;function xe(){if(Cs)return nt;Cs=1,Object.defineProperty(nt,"__esModule",{value:!0}),nt.getRtpEncodings=S,nt.addLegacySimulcast=D;function S({offerMediaObject:R}){const u=new Set;for(const _ of R.ssrcs??[]){const g=_.id;u.add(g)}if(u.size===0)throw new Error("no a=ssrc lines found");const T=new Map;for(const _ of R.ssrcGroups??[]){if(_.semantics!=="FID")continue;let[g,y]=_.ssrcs.split(/\s+/);g=Number(g),y=Number(y),u.has(g)&&(u.delete(g),u.delete(y),T.set(g,y))}for(const _ of u)T.set(_,null);const v=[];for(const[_,g]of T){const y={ssrc:_};g&&(y.rtx={ssrc:g}),v.push(y)}return v}function D({offerMediaObject:R,numStreams:u}){if(u<=1)throw new TypeError("numStreams must be greater than 1");const T=(R.ssrcs??[]).find(m=>m.attribute==="msid");if(!T)throw new Error("a=ssrc line with msid information not found");const[v,_]=T.value.split(" "),g=Number(T.id);let y;(R.ssrcGroups??[]).some(m=>{if(m.semantics!=="FID")return!1;const a=m.ssrcs.split(/\s+/);return Number(a[0])===g?(y=Number(a[1]),!0):!1});const b=R.ssrcs.find(m=>m.attribute==="cname");if(!b)throw new Error("a=ssrc line with cname information not found");const h=b.value,c=[],f=[];for(let m=0;m<u;++m)c.push(g+m),y&&f.push(y+m);R.ssrcGroups=[],R.ssrcs=[],R.ssrcGroups.push({semantics:"SIM",ssrcs:c.join(" ")});for(const m of c)R.ssrcs.push({id:m,attribute:"cname",value:h}),R.ssrcs.push({id:m,attribute:"msid",value:`${v} ${_}`});for(let m=0;m<f.length;++m){const a=c[m],s=f[m];R.ssrcs.push({id:s,attribute:"cname",value:h}),R.ssrcs.push({id:s,attribute:"msid",value:`${v} ${_}`}),R.ssrcGroups.push({semantics:"FID",ssrcs:`${a} ${s}`})}}return nt}var At={},Ts;function tr(){if(Ts)return At;Ts=1,Object.defineProperty(At,"__esModule",{value:!0}),At.addNackSupportForOpus=S;function S(D){for(const R of D.codecs??[])(R.mimeType.toLowerCase()==="audio/opus"||R.mimeType.toLowerCase()==="audio/multiopus")&&!R.rtcpFeedback?.some(u=>u.type==="nack"&&!u.parameter)&&(R.rtcpFeedback||(R.rtcpFeedback=[]),R.rtcpFeedback.push({type:"nack"}))}return At}var at={},Ds;function re(){if(Ds)return at;Ds=1,Object.defineProperty(at,"__esModule",{value:!0}),at.HandlerInterface=void 0;const S=ve();let D=class extends S.EnhancedEventEmitter{constructor(){super()}};return at.HandlerInterface=D,at}var ot={},fe={},Ps;function fn(){if(Ps)return fe;Ps=1,Object.defineProperty(fe,"__esModule",{value:!0}),fe.OfferMediaSection=fe.AnswerMediaSection=fe.MediaSection=void 0;const S=te(),D=Q();let R=class{_mediaObject;_planB;constructor({iceParameters:g,iceCandidates:y,dtlsParameters:b,planB:h=!1}){if(this._mediaObject={},this._planB=h,g&&this.setIceParameters(g),y){this._mediaObject.candidates=[];for(const c of y){const f={};f.component=1,f.foundation=c.foundation,f.ip=c.address??c.ip,f.port=c.port,f.priority=c.priority,f.transport=c.protocol,f.type=c.type,c.tcpType&&(f.tcptype=c.tcpType),this._mediaObject.candidates.push(f)}this._mediaObject.endOfCandidates="end-of-candidates",this._mediaObject.iceOptions="renomination"}b&&this.setDtlsRole(b.role)}get mid(){return String(this._mediaObject.mid)}get closed(){return this._mediaObject.port===0}getObject(){return this._mediaObject}setIceParameters(g){this._mediaObject.iceUfrag=g.usernameFragment,this._mediaObject.icePwd=g.password}pause(){this._mediaObject.direction="inactive"}disable(){this.pause(),delete this._mediaObject.ext,delete this._mediaObject.ssrcs,delete this._mediaObject.ssrcGroups,delete this._mediaObject.simulcast,delete this._mediaObject.simulcast_03,delete this._mediaObject.rids,delete this._mediaObject.extmapAllowMixed}close(){this.disable(),this._mediaObject.port=0}};fe.MediaSection=R;class u extends R{constructor({iceParameters:g,iceCandidates:y,dtlsParameters:b,sctpParameters:h,plainRtpParameters:c,planB:f=!1,offerMediaObject:m,offerRtpParameters:a,answerRtpParameters:s,codecOptions:e}){switch(super({iceParameters:g,iceCandidates:y,dtlsParameters:b,planB:f}),this._mediaObject.mid=String(m.mid),this._mediaObject.type=m.type,this._mediaObject.protocol=m.protocol,c?(this._mediaObject.connection={ip:c.ip,version:c.ipVersion},this._mediaObject.port=c.port):(this._mediaObject.connection={ip:"127.0.0.1",version:4},this._mediaObject.port=7),m.type){case"audio":case"video":{this._mediaObject.direction="recvonly",this._mediaObject.rtp=[],this._mediaObject.rtcpFb=[],this._mediaObject.fmtp=[];for(const t of s.codecs){const i={payload:t.payloadType,codec:v(t),rate:t.clockRate};t.channels>1&&(i.encoding=t.channels),this._mediaObject.rtp.push(i);const r=D.clone(t.parameters)??{};let n=D.clone(t.rtcpFeedback)??[];if(e){const{opusStereo:p,opusFec:l,opusDtx:w,opusMaxPlaybackRate:d,opusMaxAverageBitrate:P,opusPtime:k,opusNack:x,videoGoogleStartBitrate:C,videoGoogleMaxBitrate:E,videoGoogleMinBitrate:I}=e,L=a.codecs.find(O=>O.payloadType===t.payloadType);switch(t.mimeType.toLowerCase()){case"audio/opus":case"audio/multiopus":{p!==void 0&&(L.parameters["sprop-stereo"]=p?1:0,r.stereo=p?1:0),l!==void 0&&(L.parameters.useinbandfec=l?1:0,r.useinbandfec=l?1:0),w!==void 0&&(L.parameters.usedtx=w?1:0,r.usedtx=w?1:0),d!==void 0&&(r.maxplaybackrate=d),P!==void 0&&(r.maxaveragebitrate=P),k!==void 0&&(L.parameters.ptime=k,r.ptime=k),x||(L.rtcpFeedback=L.rtcpFeedback.filter(O=>O.type!=="nack"||O.parameter),n=n.filter(O=>O.type!=="nack"||O.parameter));break}case"video/vp8":case"video/vp9":case"video/h264":case"video/h265":case"video/av1":{C!==void 0&&(r["x-google-start-bitrate"]=C),E!==void 0&&(r["x-google-max-bitrate"]=E),I!==void 0&&(r["x-google-min-bitrate"]=I);break}}}const o={payload:t.payloadType,config:""};for(const p of Object.keys(r))o.config&&(o.config+=";"),o.config+=`${p}=${r[p]}`;o.config&&this._mediaObject.fmtp.push(o);for(const p of n)this._mediaObject.rtcpFb.push({payload:t.payloadType,type:p.type,subtype:p.parameter})}this._mediaObject.payloads=s.codecs.map(t=>t.payloadType).join(" "),this._mediaObject.ext=[];for(const t of s.headerExtensions)(m.ext??[]).some(r=>r.uri===t.uri)&&this._mediaObject.ext.push({uri:t.uri,value:t.id});if(m.extmapAllowMixed==="extmap-allow-mixed"&&(this._mediaObject.extmapAllowMixed="extmap-allow-mixed"),m.simulcast){this._mediaObject.simulcast={dir1:"recv",list1:m.simulcast.list1},this._mediaObject.rids=[];for(const t of m.rids??[])t.direction==="send"&&this._mediaObject.rids.push({id:t.id,direction:"recv"})}else if(m.simulcast_03){this._mediaObject.simulcast_03={value:m.simulcast_03.value.replace(/send/g,"recv")},this._mediaObject.rids=[];for(const t of m.rids??[])t.direction==="send"&&this._mediaObject.rids.push({id:t.id,direction:"recv"})}this._mediaObject.rtcpMux="rtcp-mux",this._mediaObject.rtcpRsize="rtcp-rsize",this._planB&&this._mediaObject.type==="video"&&(this._mediaObject.xGoogleFlag="conference");break}case"application":{typeof m.sctpPort=="number"?(this._mediaObject.payloads="webrtc-datachannel",this._mediaObject.sctpPort=h.port,this._mediaObject.maxMessageSize=h.maxMessageSize):m.sctpmap&&(this._mediaObject.payloads=h.port,this._mediaObject.sctpmap={app:"webrtc-datachannel",sctpmapNumber:h.port,maxMessageSize:h.maxMessageSize});break}}}setDtlsRole(g){switch(g){case"client":{this._mediaObject.setup="active";break}case"server":{this._mediaObject.setup="passive";break}case"auto":{this._mediaObject.setup="actpass";break}}}resume(){this._mediaObject.direction="recvonly"}muxSimulcastStreams(g){if(!this._mediaObject.simulcast?.list1)return;const y={};for(const c of g)c.rid&&(y[c.rid]=c);const b=this._mediaObject.simulcast.list1,h=S.parseSimulcastStreamList(b);for(const c of h)for(const f of c)f.paused=!y[f.scid]?.active;this._mediaObject.simulcast.list1=h.map(c=>c.map(f=>`${f.paused?"~":""}${f.scid}`).join(",")).join(";")}}fe.AnswerMediaSection=u;class T extends R{constructor({iceParameters:g,iceCandidates:y,dtlsParameters:b,sctpParameters:h,plainRtpParameters:c,planB:f=!1,mid:m,kind:a,offerRtpParameters:s,streamId:e,trackId:t,oldDataChannelSpec:i=!1}){switch(super({iceParameters:g,iceCandidates:y,dtlsParameters:b,planB:f}),this._mediaObject.mid=String(m),this._mediaObject.type=a,c?(this._mediaObject.connection={ip:c.ip,version:c.ipVersion},this._mediaObject.protocol="RTP/AVP",this._mediaObject.port=c.port):(this._mediaObject.connection={ip:"127.0.0.1",version:4},h?this._mediaObject.protocol="UDP/DTLS/SCTP":this._mediaObject.protocol="UDP/TLS/RTP/SAVPF",this._mediaObject.port=7),this._mediaObject.extmapAllowMixed="extmap-allow-mixed",a){case"audio":case"video":{this._mediaObject.direction="sendonly",this._mediaObject.rtp=[],this._mediaObject.rtcpFb=[],this._mediaObject.fmtp=[],this._planB||(this._mediaObject.msid=`${e??"-"} ${t}`);for(const p of s.codecs){const l={payload:p.payloadType,codec:v(p),rate:p.clockRate};p.channels>1&&(l.encoding=p.channels),this._mediaObject.rtp.push(l);const w={payload:p.payloadType,config:""};for(const d of Object.keys(p.parameters))w.config&&(w.config+=";"),w.config+=`${d}=${p.parameters[d]}`;w.config&&this._mediaObject.fmtp.push(w);for(const d of p.rtcpFeedback)this._mediaObject.rtcpFb.push({payload:p.payloadType,type:d.type,subtype:d.parameter})}this._mediaObject.payloads=s.codecs.map(p=>p.payloadType).join(" "),this._mediaObject.ext=[];for(const p of s.headerExtensions)this._mediaObject.ext.push({uri:p.uri,value:p.id});this._mediaObject.rtcpMux="rtcp-mux",this._mediaObject.rtcpRsize="rtcp-rsize";const r=s.encodings[0],n=r.ssrc,o=r.rtx?.ssrc;this._mediaObject.ssrcs=[],this._mediaObject.ssrcGroups=[],s.rtcp.cname&&this._mediaObject.ssrcs.push({id:n,attribute:"cname",value:s.rtcp.cname}),this._planB&&this._mediaObject.ssrcs.push({id:n,attribute:"msid",value:`${e??"-"} ${t}`}),o&&(s.rtcp.cname&&this._mediaObject.ssrcs.push({id:o,attribute:"cname",value:s.rtcp.cname}),this._planB&&this._mediaObject.ssrcs.push({id:o,attribute:"msid",value:`${e??"-"} ${t}`}),this._mediaObject.ssrcGroups.push({semantics:"FID",ssrcs:`${n} ${o}`}));break}case"application":{i?(this._mediaObject.payloads=h.port,this._mediaObject.sctpmap={app:"webrtc-datachannel",sctpmapNumber:h.port,maxMessageSize:h.maxMessageSize}):(this._mediaObject.payloads="webrtc-datachannel",this._mediaObject.sctpPort=h.port,this._mediaObject.maxMessageSize=h.maxMessageSize);break}}}setDtlsRole(g){this._mediaObject.setup="actpass"}resume(){this._mediaObject.direction="sendonly"}planBReceive({offerRtpParameters:g,streamId:y,trackId:b}){const h=g.encodings[0],c=h.ssrc,f=h.rtx?.ssrc,m=this._mediaObject.payloads.split(" ");for(const a of g.codecs){if(m.includes(String(a.payloadType)))continue;const s={payload:a.payloadType,codec:v(a),rate:a.clockRate};a.channels>1&&(s.encoding=a.channels),this._mediaObject.rtp.push(s);const e={payload:a.payloadType,config:""};for(const t of Object.keys(a.parameters))e.config&&(e.config+=";"),e.config+=`${t}=${a.parameters[t]}`;e.config&&this._mediaObject.fmtp.push(e);for(const t of a.rtcpFeedback)this._mediaObject.rtcpFb.push({payload:a.payloadType,type:t.type,subtype:t.parameter})}this._mediaObject.payloads+=` ${g.codecs.filter(a=>!this._mediaObject.payloads.includes(a.payloadType)).map(a=>a.payloadType).join(" ")}`,this._mediaObject.payloads=this._mediaObject.payloads.trim(),g.rtcp.cname&&this._mediaObject.ssrcs.push({id:c,attribute:"cname",value:g.rtcp.cname}),this._mediaObject.ssrcs.push({id:c,attribute:"msid",value:`${y??"-"} ${b}`}),f&&(g.rtcp.cname&&this._mediaObject.ssrcs.push({id:f,attribute:"cname",value:g.rtcp.cname}),this._mediaObject.ssrcs.push({id:f,attribute:"msid",value:`${y??"-"} ${b}`}),this._mediaObject.ssrcGroups.push({semantics:"FID",ssrcs:`${c} ${f}`}))}planBStopReceiving({offerRtpParameters:g}){const y=g.encodings[0],b=y.ssrc,h=y.rtx?.ssrc;this._mediaObject.ssrcs=this._mediaObject.ssrcs.filter(c=>c.id!==b&&c.id!==h),h&&(this._mediaObject.ssrcGroups=this._mediaObject.ssrcGroups.filter(c=>c.ssrcs!==`${b} ${h}`))}}fe.OfferMediaSection=T;function v(_){const y=new RegExp("^(audio|video)/(.+)","i").exec(_.mimeType);if(!y)throw new TypeError("invalid codec.mimeType");return y[2]}return fe}var ks;function ce(){if(ks)return ot;ks=1,Object.defineProperty(ot,"__esModule",{value:!0}),ot.RemoteSdp=void 0;const S=te(),D=G(),R=fn(),u=["av1","h264"],T=new D.Logger("RemoteSdp");let v=class{_iceParameters;_iceCandidates;_dtlsParameters;_sctpParameters;_plainRtpParameters;_planB;_mediaSections=[];_midToIndex=new Map;_firstMid;_sdpObject;constructor({iceParameters:g,iceCandidates:y,dtlsParameters:b,sctpParameters:h,plainRtpParameters:c,planB:f=!1}){if(this._iceParameters=g,this._iceCandidates=y,this._dtlsParameters=b,this._sctpParameters=h,this._plainRtpParameters=c,this._planB=f,this._sdpObject={version:0,origin:{address:"0.0.0.0",ipVer:4,netType:"IN",sessionId:1e4,sessionVersion:0,username:"mediasoup-client"},name:"-",timing:{start:0,stop:0},media:[]},g?.iceLite&&(this._sdpObject.icelite="ice-lite"),b){this._sdpObject.msidSemantic={semantic:"WMS",token:"*"};const m=this._dtlsParameters.fingerprints.length;this._sdpObject.fingerprint={type:b.fingerprints[m-1].algorithm,hash:b.fingerprints[m-1].value},this._sdpObject.groups=[{type:"BUNDLE",mids:""}]}c&&(this._sdpObject.origin.address=c.ip,this._sdpObject.origin.ipVer=c.ipVersion)}updateIceParameters(g){T.debug("updateIceParameters() [iceParameters:%o]",g),this._iceParameters=g,this._sdpObject.icelite=g.iceLite?"ice-lite":void 0;for(const y of this._mediaSections)y.setIceParameters(g)}updateDtlsRole(g){T.debug("updateDtlsRole() [role:%s]",g),this._dtlsParameters.role=g;for(const y of this._mediaSections)y.setDtlsRole(g)}setSessionExtmapAllowMixed(){T.debug("setSessionExtmapAllowMixed()"),this._sdpObject.extmapAllowMixed="extmap-allow-mixed"}getNextMediaSectionIdx(){for(let g=0;g<this._mediaSections.length;++g){const y=this._mediaSections[g];if(y.closed)return{idx:g,reuseMid:y.mid}}return{idx:this._mediaSections.length}}send({offerMediaObject:g,reuseMid:y,offerRtpParameters:b,answerRtpParameters:h,codecOptions:c}){const f=new R.AnswerMediaSection({iceParameters:this._iceParameters,iceCandidates:this._iceCandidates,dtlsParameters:this._dtlsParameters,plainRtpParameters:this._plainRtpParameters,planB:this._planB,offerMediaObject:g,offerRtpParameters:b,answerRtpParameters:h,codecOptions:c}),m=f.getObject();m.rtp.find(s=>u.includes(s.codec.toLowerCase()))||(m.ext=m.ext.filter(s=>s.uri!=="https://aomediacodec.github.io/av1-rtp-spec/#dependency-descriptor-rtp-header-extension")),y?this._replaceMediaSection(f,y):this._midToIndex.has(f.mid)?this._replaceMediaSection(f):this._addMediaSection(f)}receive({mid:g,kind:y,offerRtpParameters:b,streamId:h,trackId:c}){const f=this._midToIndex.get(g);let m;if(f!==void 0&&(m=this._mediaSections[f]),this.setSessionExtmapAllowMixed(),m)m.planBReceive({offerRtpParameters:b,streamId:h,trackId:c}),this._replaceMediaSection(m);else{m=new R.OfferMediaSection({iceParameters:this._iceParameters,iceCandidates:this._iceCandidates,dtlsParameters:this._dtlsParameters,plainRtpParameters:this._plainRtpParameters,planB:this._planB,mid:g,kind:y,offerRtpParameters:b,streamId:h,trackId:c});const a=this._mediaSections.find(s=>s.closed);a?this._replaceMediaSection(m,a.mid):this._addMediaSection(m)}}pauseMediaSection(g){this._findMediaSection(g).pause()}resumeSendingMediaSection(g){this._findMediaSection(g).resume()}resumeReceivingMediaSection(g){this._findMediaSection(g).resume()}disableMediaSection(g){this._findMediaSection(g).disable()}closeMediaSection(g){const y=this._findMediaSection(g);return g===this._firstMid?(T.debug("closeMediaSection() | cannot close first media section, disabling it instead [mid:%s]",g),this.disableMediaSection(g),!1):(y.close(),this._regenerateBundleMids(),!0)}muxMediaSectionSimulcast(g,y){const b=this._findMediaSection(g);b.muxSimulcastStreams(y),this._replaceMediaSection(b)}planBStopReceiving({mid:g,offerRtpParameters:y}){const b=this._findMediaSection(g);b.planBStopReceiving({offerRtpParameters:y}),this._replaceMediaSection(b)}sendSctpAssociation({offerMediaObject:g}){const y=new R.AnswerMediaSection({iceParameters:this._iceParameters,iceCandidates:this._iceCandidates,dtlsParameters:this._dtlsParameters,sctpParameters:this._sctpParameters,plainRtpParameters:this._plainRtpParameters,offerMediaObject:g});this._addMediaSection(y)}receiveSctpAssociation({oldDataChannelSpec:g=!1}={}){const y=new R.OfferMediaSection({iceParameters:this._iceParameters,iceCandidates:this._iceCandidates,dtlsParameters:this._dtlsParameters,sctpParameters:this._sctpParameters,plainRtpParameters:this._plainRtpParameters,mid:"datachannel",kind:"application",oldDataChannelSpec:g});this._addMediaSection(y)}getSdp(){return this._sdpObject.origin.sessionVersion++,S.write(this._sdpObject)}_addMediaSection(g){this._firstMid||(this._firstMid=g.mid),this._mediaSections.push(g),this._midToIndex.set(g.mid,this._mediaSections.length-1),this._sdpObject.media.push(g.getObject()),this._regenerateBundleMids()}_replaceMediaSection(g,y){if(typeof y=="string"){const b=this._midToIndex.get(y);if(b===void 0)throw new Error(`no media section found for reuseMid '${y}'`);const h=this._mediaSections[b];this._mediaSections[b]=g,this._midToIndex.delete(h.mid),this._midToIndex.set(g.mid,b),this._sdpObject.media[b]=g.getObject(),this._regenerateBundleMids()}else{const b=this._midToIndex.get(g.mid);if(b===void 0)throw new Error(`no media section found with mid '${g.mid}'`);this._mediaSections[b]=g,this._sdpObject.media[b]=g.getObject()}}_findMediaSection(g){const y=this._midToIndex.get(g);if(y===void 0)throw new Error(`no media section found with mid '${g}'`);return this._mediaSections[y]}_regenerateBundleMids(){this._dtlsParameters&&(this._sdpObject.groups[0].mids=this._mediaSections.filter(g=>!g.closed).map(g=>g.mid).join(" "))}};return ot.RemoteSdp=v,ot}var Nt={},Es;function Se(){if(Es)return Nt;Es=1,Object.defineProperty(Nt,"__esModule",{value:!0}),Nt.parse=D;const S=new RegExp("^[LS]([1-9]\\d{0,1})T([1-9]\\d{0,1})");function D(R){const u=S.exec(R??"");return u?{spatialLayers:Number(u[1]),temporalLayers:Number(u[2])}:{spatialLayers:1,temporalLayers:1}}return Nt}var xs;function mn(){if(xs)return it;xs=1,Object.defineProperty(it,"__esModule",{value:!0}),it.Chrome111=void 0;const S=te(),D=G(),R=Q(),u=X(),T=oe(),v=xe(),_=tr(),g=Y(),y=re(),b=ce(),h=Se(),c=new D.Logger("Chrome111"),f="Chrome111",m={OS:1024,MIS:1024};let a=class Pi extends y.HandlerInterface{_closed=!1;_direction;_remoteSdp;_sendingRtpParametersByKind;_sendingRemoteRtpParametersByKind;_forcedLocalDtlsRole;_pc;_mapMidTransceiver=new Map;_sendStream=new MediaStream;_hasDataChannelMediaSection=!1;_nextSendSctpStreamId=0;_transportReady=!1;static createFactory(){return()=>new Pi}constructor(){super()}get name(){return f}close(){if(c.debug("close()"),!this._closed){if(this._closed=!0,this._pc)try{this._pc.close()}catch{}this.emit("@close")}}async getNativeRtpCapabilities(){c.debug("getNativeRtpCapabilities()");const e=new RTCPeerConnection({iceServers:[],iceTransportPolicy:"all",bundlePolicy:"max-bundle",rtcpMuxPolicy:"require",sdpSemantics:"unified-plan"});try{e.addTransceiver("audio"),e.addTransceiver("video",{sendEncodings:[{scalabilityMode:"L3T3"}]});const t=await e.createOffer();try{e.close()}catch{}const i=S.parse(t.sdp),r=T.extractRtpCapabilities({sdpObject:i});return _.addNackSupportForOpus(r),r}catch(t){try{e.close()}catch{}throw t}}async getNativeSctpCapabilities(){return c.debug("getNativeSctpCapabilities()"),{numStreams:m}}run({direction:e,iceParameters:t,iceCandidates:i,dtlsParameters:r,sctpParameters:n,iceServers:o,iceTransportPolicy:p,additionalSettings:l,proprietaryConstraints:w,extendedRtpCapabilities:d}){this.assertNotClosed(),c.debug("run()"),this._direction=e,this._remoteSdp=new b.RemoteSdp({iceParameters:t,iceCandidates:i,dtlsParameters:r,sctpParameters:n}),this._sendingRtpParametersByKind={audio:u.getSendingRtpParameters("audio",d),video:u.getSendingRtpParameters("video",d)},this._sendingRemoteRtpParametersByKind={audio:u.getSendingRemoteRtpParameters("audio",d),video:u.getSendingRemoteRtpParameters("video",d)},r.role&&r.role!=="auto"&&(this._forcedLocalDtlsRole=r.role==="server"?"client":"server"),this._pc=new RTCPeerConnection({iceServers:o??[],iceTransportPolicy:p??"all",bundlePolicy:"max-bundle",rtcpMuxPolicy:"require",sdpSemantics:"unified-plan",...l},w),this._pc.addEventListener("icegatheringstatechange",()=>{this.emit("@icegatheringstatechange",this._pc.iceGatheringState)}),this._pc.addEventListener("icecandidateerror",P=>{this.emit("@icecandidateerror",P)}),this._pc.connectionState?this._pc.addEventListener("connectionstatechange",()=>{this.emit("@connectionstatechange",this._pc.connectionState)}):(c.warn("run() | pc.connectionState not supported, using pc.iceConnectionState"),this._pc.addEventListener("iceconnectionstatechange",()=>{switch(this._pc.iceConnectionState){case"checking":{this.emit("@connectionstatechange","connecting");break}case"connected":case"completed":{this.emit("@connectionstatechange","connected");break}case"failed":{this.emit("@connectionstatechange","failed");break}case"disconnected":{this.emit("@connectionstatechange","disconnected");break}case"closed":{this.emit("@connectionstatechange","closed");break}}}))}async updateIceServers(e){this.assertNotClosed(),c.debug("updateIceServers()");const t=this._pc.getConfiguration();t.iceServers=e,this._pc.setConfiguration(t)}async restartIce(e){if(this.assertNotClosed(),c.debug("restartIce()"),this._remoteSdp.updateIceParameters(e),!!this._transportReady)if(this._direction==="send"){const t=await this._pc.createOffer({iceRestart:!0});c.debug("restartIce() | calling pc.setLocalDescription() [offer:%o]",t),await this._pc.setLocalDescription(t);const i={type:"answer",sdp:this._remoteSdp.getSdp()};c.debug("restartIce() | calling pc.setRemoteDescription() [answer:%o]",i),await this._pc.setRemoteDescription(i)}else{const t={type:"offer",sdp:this._remoteSdp.getSdp()};c.debug("restartIce() | calling pc.setRemoteDescription() [offer:%o]",t),await this._pc.setRemoteDescription(t);const i=await this._pc.createAnswer();c.debug("restartIce() | calling pc.setLocalDescription() [answer:%o]",i),await this._pc.setLocalDescription(i)}}async getTransportStats(){return this.assertNotClosed(),this._pc.getStats()}async send({track:e,encodings:t,codecOptions:i,codec:r,onRtpSender:n}){if(this.assertNotClosed(),this.assertSendDirection(),c.debug("send() [kind:%s, track.id:%s]",e.kind,e.id),t&&t.length>1){let E=1;for(const I of t){const L=I.scalabilityMode?(0,h.parse)(I.scalabilityMode).temporalLayers:3;L>E&&(E=L)}t.forEach((I,L)=>{I.rid=`r${L}`,I.scalabilityMode=`L1T${E}`})}const o=R.clone(this._sendingRtpParametersByKind[e.kind]);o.codecs=u.reduceCodecs(o.codecs,r);const p=R.clone(this._sendingRemoteRtpParametersByKind[e.kind]);p.codecs=u.reduceCodecs(p.codecs,r);const l=this._remoteSdp.getNextMediaSectionIdx(),w=this._pc.addTransceiver(e,{direction:"sendonly",streams:[this._sendStream],sendEncodings:t});n&&n(w.sender);const d=await this._pc.createOffer();let P=S.parse(d.sdp);P.extmapAllowMixed&&this._remoteSdp.setSessionExtmapAllowMixed(),this._transportReady||await this.setupTransport({localDtlsRole:this._forcedLocalDtlsRole??"client",localSdpObject:P}),c.debug("send() | calling pc.setLocalDescription() [offer:%o]",d),await this._pc.setLocalDescription(d);const k=w.mid;o.mid=k,P=S.parse(this._pc.localDescription.sdp);const x=P.media[l.idx];if(o.rtcp.cname=T.getCname({offerMediaObject:x}),!t)o.encodings=v.getRtpEncodings({offerMediaObject:x});else if(t.length===1){const E=v.getRtpEncodings({offerMediaObject:x});Object.assign(E[0],t[0]),o.encodings=E}else o.encodings=t;this._remoteSdp.send({offerMediaObject:x,reuseMid:l.reuseMid,offerRtpParameters:o,answerRtpParameters:p,codecOptions:i});const C={type:"answer",sdp:this._remoteSdp.getSdp()};return c.debug("send() | calling pc.setRemoteDescription() [answer:%o]",C),await this._pc.setRemoteDescription(C),this._mapMidTransceiver.set(k,w),{localId:k,rtpParameters:o,rtpSender:w.sender}}async stopSending(e){if(this.assertSendDirection(),c.debug("stopSending() [localId:%s]",e),this._closed)return;const t=this._mapMidTransceiver.get(e);if(!t)throw new Error("associated RTCRtpTransceiver not found");if(t.sender.replaceTrack(null),this._pc.removeTrack(t.sender),this._remoteSdp.closeMediaSection(t.mid))try{t.stop()}catch{}const r=await this._pc.createOffer();c.debug("stopSending() | calling pc.setLocalDescription() [offer:%o]",r),await this._pc.setLocalDescription(r);const n={type:"answer",sdp:this._remoteSdp.getSdp()};c.debug("stopSending() | calling pc.setRemoteDescription() [answer:%o]",n),await this._pc.setRemoteDescription(n),this._mapMidTransceiver.delete(e)}async pauseSending(e){this.assertNotClosed(),this.assertSendDirection(),c.debug("pauseSending() [localId:%s]",e);const t=this._mapMidTransceiver.get(e);if(!t)throw new Error("associated RTCRtpTransceiver not found");t.direction="inactive",this._remoteSdp.pauseMediaSection(e);const i=await this._pc.createOffer();c.debug("pauseSending() | calling pc.setLocalDescription() [offer:%o]",i),await this._pc.setLocalDescription(i);const r={type:"answer",sdp:this._remoteSdp.getSdp()};c.debug("pauseSending() | calling pc.setRemoteDescription() [answer:%o]",r),await this._pc.setRemoteDescription(r)}async resumeSending(e){this.assertNotClosed(),this.assertSendDirection(),c.debug("resumeSending() [localId:%s]",e);const t=this._mapMidTransceiver.get(e);if(this._remoteSdp.resumeSendingMediaSection(e),!t)throw new Error("associated RTCRtpTransceiver not found");t.direction="sendonly";const i=await this._pc.createOffer();c.debug("resumeSending() | calling pc.setLocalDescription() [offer:%o]",i),await this._pc.setLocalDescription(i);const r={type:"answer",sdp:this._remoteSdp.getSdp()};c.debug("resumeSending() | calling pc.setRemoteDescription() [answer:%o]",r),await this._pc.setRemoteDescription(r)}async replaceTrack(e,t){this.assertNotClosed(),this.assertSendDirection(),t?c.debug("replaceTrack() [localId:%s, track.id:%s]",e,t.id):c.debug("replaceTrack() [localId:%s, no track]",e);const i=this._mapMidTransceiver.get(e);if(!i)throw new Error("associated RTCRtpTransceiver not found");await i.sender.replaceTrack(t)}async setMaxSpatialLayer(e,t){this.assertNotClosed(),this.assertSendDirection(),c.debug("setMaxSpatialLayer() [localId:%s, spatialLayer:%s]",e,t);const i=this._mapMidTransceiver.get(e);if(!i)throw new Error("associated RTCRtpTransceiver not found");const r=i.sender.getParameters();r.encodings.forEach((p,l)=>{l<=t?p.active=!0:p.active=!1}),await i.sender.setParameters(r),this._remoteSdp.muxMediaSectionSimulcast(e,r.encodings);const n=await this._pc.createOffer();c.debug("setMaxSpatialLayer() | calling pc.setLocalDescription() [offer:%o]",n),await this._pc.setLocalDescription(n);const o={type:"answer",sdp:this._remoteSdp.getSdp()};c.debug("setMaxSpatialLayer() | calling pc.setRemoteDescription() [answer:%o]",o),await this._pc.setRemoteDescription(o)}async setRtpEncodingParameters(e,t){this.assertNotClosed(),this.assertSendDirection(),c.debug("setRtpEncodingParameters() [localId:%s, params:%o]",e,t);const i=this._mapMidTransceiver.get(e);if(!i)throw new Error("associated RTCRtpTransceiver not found");const r=i.sender.getParameters();r.encodings.forEach((p,l)=>{r.encodings[l]={...p,...t}}),await i.sender.setParameters(r),this._remoteSdp.muxMediaSectionSimulcast(e,r.encodings);const n=await this._pc.createOffer();c.debug("setRtpEncodingParameters() | calling pc.setLocalDescription() [offer:%o]",n),await this._pc.setLocalDescription(n);const o={type:"answer",sdp:this._remoteSdp.getSdp()};c.debug("setRtpEncodingParameters() | calling pc.setRemoteDescription() [answer:%o]",o),await this._pc.setRemoteDescription(o)}async getSenderStats(e){this.assertNotClosed(),this.assertSendDirection();const t=this._mapMidTransceiver.get(e);if(!t)throw new Error("associated RTCRtpTransceiver not found");return t.sender.getStats()}async sendDataChannel({ordered:e,maxPacketLifeTime:t,maxRetransmits:i,label:r,protocol:n}){this.assertNotClosed(),this.assertSendDirection();const o={negotiated:!0,id:this._nextSendSctpStreamId,ordered:e,maxPacketLifeTime:t,maxRetransmits:i,protocol:n};c.debug("sendDataChannel() [options:%o]",o);const p=this._pc.createDataChannel(r,o);if(this._nextSendSctpStreamId=++this._nextSendSctpStreamId%m.MIS,!this._hasDataChannelMediaSection){const w=await this._pc.createOffer(),d=S.parse(w.sdp),P=d.media.find(x=>x.type==="application");this._transportReady||await this.setupTransport({localDtlsRole:this._forcedLocalDtlsRole??"client",localSdpObject:d}),c.debug("sendDataChannel() | calling pc.setLocalDescription() [offer:%o]",w),await this._pc.setLocalDescription(w),this._remoteSdp.sendSctpAssociation({offerMediaObject:P});const k={type:"answer",sdp:this._remoteSdp.getSdp()};c.debug("sendDataChannel() | calling pc.setRemoteDescription() [answer:%o]",k),await this._pc.setRemoteDescription(k),this._hasDataChannelMediaSection=!0}const l={streamId:o.id,ordered:o.ordered,maxPacketLifeTime:o.maxPacketLifeTime,maxRetransmits:o.maxRetransmits};return{dataChannel:p,sctpStreamParameters:l}}async receive(e){this.assertNotClosed(),this.assertRecvDirection();const t=[],i=new Map;for(const p of e){const{trackId:l,kind:w,rtpParameters:d,streamId:P}=p;c.debug("receive() [trackId:%s, kind:%s]",l,w);const k=d.mid??String(this._mapMidTransceiver.size);i.set(l,k),this._remoteSdp.receive({mid:k,kind:w,offerRtpParameters:d,streamId:P??d.rtcp.cname,trackId:l})}const r={type:"offer",sdp:this._remoteSdp.getSdp()};c.debug("receive() | calling pc.setRemoteDescription() [offer:%o]",r),await this._pc.setRemoteDescription(r);for(const p of e){const{trackId:l,onRtpReceiver:w}=p;if(w){const d=i.get(l),P=this._pc.getTransceivers().find(k=>k.mid===d);if(!P)throw new Error("transceiver not found");w(P.receiver)}}let n=await this._pc.createAnswer();const o=S.parse(n.sdp);for(const p of e){const{trackId:l,rtpParameters:w}=p,d=i.get(l),P=o.media.find(k=>String(k.mid)===d);T.applyCodecParameters({offerRtpParameters:w,answerMediaObject:P})}n={type:"answer",sdp:S.write(o)},this._transportReady||await this.setupTransport({localDtlsRole:this._forcedLocalDtlsRole??"client",localSdpObject:o}),c.debug("receive() | calling pc.setLocalDescription() [answer:%o]",n),await this._pc.setLocalDescription(n);for(const p of e){const{trackId:l}=p,w=i.get(l),d=this._pc.getTransceivers().find(P=>P.mid===w);if(d)this._mapMidTransceiver.set(w,d),t.push({localId:w,track:d.receiver.track,rtpReceiver:d.receiver});else throw new Error("new RTCRtpTransceiver not found")}return t}async stopReceiving(e){if(this.assertRecvDirection(),this._closed)return;for(const r of e){c.debug("stopReceiving() [localId:%s]",r);const n=this._mapMidTransceiver.get(r);if(!n)throw new Error("associated RTCRtpTransceiver not found");this._remoteSdp.closeMediaSection(n.mid)}const t={type:"offer",sdp:this._remoteSdp.getSdp()};c.debug("stopReceiving() | calling pc.setRemoteDescription() [offer:%o]",t),await this._pc.setRemoteDescription(t);const i=await this._pc.createAnswer();c.debug("stopReceiving() | calling pc.setLocalDescription() [answer:%o]",i),await this._pc.setLocalDescription(i);for(const r of e)this._mapMidTransceiver.delete(r)}async pauseReceiving(e){this.assertNotClosed(),this.assertRecvDirection();for(const r of e){c.debug("pauseReceiving() [localId:%s]",r);const n=this._mapMidTransceiver.get(r);if(!n)throw new Error("associated RTCRtpTransceiver not found");n.direction="inactive",this._remoteSdp.pauseMediaSection(r)}const t={type:"offer",sdp:this._remoteSdp.getSdp()};c.debug("pauseReceiving() | calling pc.setRemoteDescription() [offer:%o]",t),await this._pc.setRemoteDescription(t);const i=await this._pc.createAnswer();c.debug("pauseReceiving() | calling pc.setLocalDescription() [answer:%o]",i),await this._pc.setLocalDescription(i)}async resumeReceiving(e){this.assertNotClosed(),this.assertRecvDirection();for(const r of e){c.debug("resumeReceiving() [localId:%s]",r);const n=this._mapMidTransceiver.get(r);if(!n)throw new Error("associated RTCRtpTransceiver not found");n.direction="recvonly",this._remoteSdp.resumeReceivingMediaSection(r)}const t={type:"offer",sdp:this._remoteSdp.getSdp()};c.debug("resumeReceiving() | calling pc.setRemoteDescription() [offer:%o]",t),await this._pc.setRemoteDescription(t);const i=await this._pc.createAnswer();c.debug("resumeReceiving() | calling pc.setLocalDescription() [answer:%o]",i),await this._pc.setLocalDescription(i)}async getReceiverStats(e){this.assertNotClosed(),this.assertRecvDirection();const t=this._mapMidTransceiver.get(e);if(!t)throw new Error("associated RTCRtpTransceiver not found");return t.receiver.getStats()}async receiveDataChannel({sctpStreamParameters:e,label:t,protocol:i}){this.assertNotClosed(),this.assertRecvDirection();const{streamId:r,ordered:n,maxPacketLifeTime:o,maxRetransmits:p}=e,l={negotiated:!0,id:r,ordered:n,maxPacketLifeTime:o,maxRetransmits:p,protocol:i};c.debug("receiveDataChannel() [options:%o]",l);const w=this._pc.createDataChannel(t,l);if(!this._hasDataChannelMediaSection){this._remoteSdp.receiveSctpAssociation();const d={type:"offer",sdp:this._remoteSdp.getSdp()};c.debug("receiveDataChannel() | calling pc.setRemoteDescription() [offer:%o]",d),await this._pc.setRemoteDescription(d);const P=await this._pc.createAnswer();if(!this._transportReady){const k=S.parse(P.sdp);await this.setupTransport({localDtlsRole:this._forcedLocalDtlsRole??"client",localSdpObject:k})}c.debug("receiveDataChannel() | calling pc.setRemoteDescription() [answer:%o]",P),await this._pc.setLocalDescription(P),this._hasDataChannelMediaSection=!0}return{dataChannel:w}}async setupTransport({localDtlsRole:e,localSdpObject:t}){t||(t=S.parse(this._pc.localDescription.sdp));const i=T.extractDtlsParameters({sdpObject:t});i.role=e,this._remoteSdp.updateDtlsRole(e==="client"?"server":"client"),await new Promise((r,n)=>{this.safeEmit("@connect",{dtlsParameters:i},r,n)}),this._transportReady=!0}assertNotClosed(){if(this._closed)throw new g.InvalidStateError("method called in a closed handler")}assertSendDirection(){if(this._direction!=="send")throw new Error('method can just be called for handlers with "send" direction')}assertRecvDirection(){if(this._direction!=="recv")throw new Error('method can just be called for handlers with "recv" direction')}};return it.Chrome111=a,it}var ct={},Ls;function gn(){if(Ls)return ct;Ls=1,Object.defineProperty(ct,"__esModule",{value:!0}),ct.Chrome74=void 0;const S=te(),D=G(),R=Q(),u=X(),T=oe(),v=xe(),_=tr(),g=Y(),y=re(),b=ce(),h=Se(),c=new D.Logger("Chrome74"),f="Chrome74",m={OS:1024,MIS:1024};let a=class ki extends y.HandlerInterface{_closed=!1;_direction;_remoteSdp;_sendingRtpParametersByKind;_sendingRemoteRtpParametersByKind;_forcedLocalDtlsRole;_pc;_mapMidTransceiver=new Map;_sendStream=new MediaStream;_hasDataChannelMediaSection=!1;_nextSendSctpStreamId=0;_transportReady=!1;static createFactory(){return()=>new ki}constructor(){super()}get name(){return f}close(){if(c.debug("close()"),!this._closed){if(this._closed=!0,this._pc)try{this._pc.close()}catch{}this.emit("@close")}}async getNativeRtpCapabilities(){c.debug("getNativeRtpCapabilities()");const e=new RTCPeerConnection({iceServers:[],iceTransportPolicy:"all",bundlePolicy:"max-bundle",rtcpMuxPolicy:"require",sdpSemantics:"unified-plan"});try{e.addTransceiver("audio"),e.addTransceiver("video");const t=await e.createOffer();try{e.close()}catch{}const i=S.parse(t.sdp),r=T.extractRtpCapabilities({sdpObject:i});return _.addNackSupportForOpus(r),r}catch(t){try{e.close()}catch{}throw t}}async getNativeSctpCapabilities(){return c.debug("getNativeSctpCapabilities()"),{numStreams:m}}run({direction:e,iceParameters:t,iceCandidates:i,dtlsParameters:r,sctpParameters:n,iceServers:o,iceTransportPolicy:p,additionalSettings:l,proprietaryConstraints:w,extendedRtpCapabilities:d}){c.debug("run()"),this._direction=e,this._remoteSdp=new b.RemoteSdp({iceParameters:t,iceCandidates:i,dtlsParameters:r,sctpParameters:n}),this._sendingRtpParametersByKind={audio:u.getSendingRtpParameters("audio",d),video:u.getSendingRtpParameters("video",d)},this._sendingRemoteRtpParametersByKind={audio:u.getSendingRemoteRtpParameters("audio",d),video:u.getSendingRemoteRtpParameters("video",d)},r.role&&r.role!=="auto"&&(this._forcedLocalDtlsRole=r.role==="server"?"client":"server"),this._pc=new RTCPeerConnection({iceServers:o??[],iceTransportPolicy:p??"all",bundlePolicy:"max-bundle",rtcpMuxPolicy:"require",sdpSemantics:"unified-plan",...l},w),this._pc.addEventListener("icegatheringstatechange",()=>{this.emit("@icegatheringstatechange",this._pc.iceGatheringState)}),this._pc.addEventListener("icecandidateerror",P=>{this.emit("@icecandidateerror",P)}),this._pc.connectionState?this._pc.addEventListener("connectionstatechange",()=>{this.emit("@connectionstatechange",this._pc.connectionState)}):(c.warn("run() | pc.connectionState not supported, using pc.iceConnectionState"),this._pc.addEventListener("iceconnectionstatechange",()=>{switch(this._pc.iceConnectionState){case"checking":{this.emit("@connectionstatechange","connecting");break}case"connected":case"completed":{this.emit("@connectionstatechange","connected");break}case"failed":{this.emit("@connectionstatechange","failed");break}case"disconnected":{this.emit("@connectionstatechange","disconnected");break}case"closed":{this.emit("@connectionstatechange","closed");break}}}))}async updateIceServers(e){this.assertNotClosed(),c.debug("updateIceServers()");const t=this._pc.getConfiguration();t.iceServers=e,this._pc.setConfiguration(t)}async restartIce(e){if(this.assertNotClosed(),c.debug("restartIce()"),this._remoteSdp.updateIceParameters(e),!!this._transportReady)if(this._direction==="send"){const t=await this._pc.createOffer({iceRestart:!0});c.debug("restartIce() | calling pc.setLocalDescription() [offer:%o]",t),await this._pc.setLocalDescription(t);const i={type:"answer",sdp:this._remoteSdp.getSdp()};c.debug("restartIce() | calling pc.setRemoteDescription() [answer:%o]",i),await this._pc.setRemoteDescription(i)}else{const t={type:"offer",sdp:this._remoteSdp.getSdp()};c.debug("restartIce() | calling pc.setRemoteDescription() [offer:%o]",t),await this._pc.setRemoteDescription(t);const i=await this._pc.createAnswer();c.debug("restartIce() | calling pc.setLocalDescription() [answer:%o]",i),await this._pc.setLocalDescription(i)}}async getTransportStats(){return this.assertNotClosed(),this._pc.getStats()}async send({track:e,encodings:t,codecOptions:i,codec:r}){this.assertNotClosed(),this.assertSendDirection(),c.debug("send() [kind:%s, track.id:%s]",e.kind,e.id),t&&t.length>1&&t.forEach((I,L)=>{I.rid=`r${L}`});const n=R.clone(this._sendingRtpParametersByKind[e.kind]);n.codecs=u.reduceCodecs(n.codecs,r);const o=R.clone(this._sendingRemoteRtpParametersByKind[e.kind]);o.codecs=u.reduceCodecs(o.codecs,r);const p=this._remoteSdp.getNextMediaSectionIdx(),l=this._pc.addTransceiver(e,{direction:"sendonly",streams:[this._sendStream],sendEncodings:t});let w=await this._pc.createOffer(),d=S.parse(w.sdp);d.extmapAllowMixed&&this._remoteSdp.setSessionExtmapAllowMixed();let P;this._transportReady||await this.setupTransport({localDtlsRole:this._forcedLocalDtlsRole??"client",localSdpObject:d});let k=!1;const x=(0,h.parse)((t??[{}])[0].scalabilityMode);t&&t.length===1&&x.spatialLayers>1&&n.codecs[0].mimeType.toLowerCase()==="video/vp9"&&(c.debug("send() | enabling legacy simulcast for VP9 SVC"),k=!0,d=S.parse(w.sdp),P=d.media[p.idx],v.addLegacySimulcast({offerMediaObject:P,numStreams:x.spatialLayers}),w={type:"offer",sdp:S.write(d)}),c.debug("send() | calling pc.setLocalDescription() [offer:%o]",w),await this._pc.setLocalDescription(w);const C=l.mid;if(n.mid=C,d=S.parse(this._pc.localDescription.sdp),P=d.media[p.idx],n.rtcp.cname=T.getCname({offerMediaObject:P}),!t)n.encodings=v.getRtpEncodings({offerMediaObject:P});else if(t.length===1){let I=v.getRtpEncodings({offerMediaObject:P});Object.assign(I[0],t[0]),k&&(I=[I[0]]),n.encodings=I}else n.encodings=t;if(n.encodings.length>1&&(n.codecs[0].mimeType.toLowerCase()==="video/vp8"||n.codecs[0].mimeType.toLowerCase()==="video/h264"))for(const I of n.encodings)I.scalabilityMode?I.scalabilityMode=`L1T${x.temporalLayers}`:I.scalabilityMode="L1T3";this._remoteSdp.send({offerMediaObject:P,reuseMid:p.reuseMid,offerRtpParameters:n,answerRtpParameters:o,codecOptions:i});const E={type:"answer",sdp:this._remoteSdp.getSdp()};return c.debug("send() | calling pc.setRemoteDescription() [answer:%o]",E),await this._pc.setRemoteDescription(E),this._mapMidTransceiver.set(C,l),{localId:C,rtpParameters:n,rtpSender:l.sender}}async stopSending(e){if(this.assertSendDirection(),c.debug("stopSending() [localId:%s]",e),this._closed)return;const t=this._mapMidTransceiver.get(e);if(!t)throw new Error("associated RTCRtpTransceiver not found");if(t.sender.replaceTrack(null),this._pc.removeTrack(t.sender),this._remoteSdp.closeMediaSection(t.mid))try{t.stop()}catch{}const r=await this._pc.createOffer();c.debug("stopSending() | calling pc.setLocalDescription() [offer:%o]",r),await this._pc.setLocalDescription(r);const n={type:"answer",sdp:this._remoteSdp.getSdp()};c.debug("stopSending() | calling pc.setRemoteDescription() [answer:%o]",n),await this._pc.setRemoteDescription(n),this._mapMidTransceiver.delete(e)}async pauseSending(e){this.assertNotClosed(),this.assertSendDirection(),c.debug("pauseSending() [localId:%s]",e);const t=this._mapMidTransceiver.get(e);if(!t)throw new Error("associated RTCRtpTransceiver not found");t.direction="inactive",this._remoteSdp.pauseMediaSection(e);const i=await this._pc.createOffer();c.debug("pauseSending() | calling pc.setLocalDescription() [offer:%o]",i),await this._pc.setLocalDescription(i);const r={type:"answer",sdp:this._remoteSdp.getSdp()};c.debug("pauseSending() | calling pc.setRemoteDescription() [answer:%o]",r),await this._pc.setRemoteDescription(r)}async resumeSending(e){this.assertNotClosed(),this.assertSendDirection(),c.debug("resumeSending() [localId:%s]",e);const t=this._mapMidTransceiver.get(e);if(this._remoteSdp.resumeSendingMediaSection(e),!t)throw new Error("associated RTCRtpTransceiver not found");t.direction="sendonly";const i=await this._pc.createOffer();c.debug("resumeSending() | calling pc.setLocalDescription() [offer:%o]",i),await this._pc.setLocalDescription(i);const r={type:"answer",sdp:this._remoteSdp.getSdp()};c.debug("resumeSending() | calling pc.setRemoteDescription() [answer:%o]",r),await this._pc.setRemoteDescription(r)}async replaceTrack(e,t){this.assertNotClosed(),this.assertSendDirection(),t?c.debug("replaceTrack() [localId:%s, track.id:%s]",e,t.id):c.debug("replaceTrack() [localId:%s, no track]",e);const i=this._mapMidTransceiver.get(e);if(!i)throw new Error("associated RTCRtpTransceiver not found");await i.sender.replaceTrack(t)}async setMaxSpatialLayer(e,t){this.assertNotClosed(),this.assertSendDirection(),c.debug("setMaxSpatialLayer() [localId:%s, spatialLayer:%s]",e,t);const i=this._mapMidTransceiver.get(e);if(!i)throw new Error("associated RTCRtpTransceiver not found");const r=i.sender.getParameters();r.encodings.forEach((p,l)=>{l<=t?p.active=!0:p.active=!1}),await i.sender.setParameters(r),this._remoteSdp.muxMediaSectionSimulcast(e,r.encodings);const n=await this._pc.createOffer();c.debug("setMaxSpatialLayer() | calling pc.setLocalDescription() [offer:%o]",n),await this._pc.setLocalDescription(n);const o={type:"answer",sdp:this._remoteSdp.getSdp()};c.debug("setMaxSpatialLayer() | calling pc.setRemoteDescription() [answer:%o]",o),await this._pc.setRemoteDescription(o)}async setRtpEncodingParameters(e,t){this.assertNotClosed(),this.assertSendDirection(),c.debug("setRtpEncodingParameters() [localId:%s, params:%o]",e,t);const i=this._mapMidTransceiver.get(e);if(!i)throw new Error("associated RTCRtpTransceiver not found");const r=i.sender.getParameters();r.encodings.forEach((p,l)=>{r.encodings[l]={...p,...t}}),await i.sender.setParameters(r),this._remoteSdp.muxMediaSectionSimulcast(e,r.encodings);const n=await this._pc.createOffer();c.debug("setRtpEncodingParameters() | calling pc.setLocalDescription() [offer:%o]",n),await this._pc.setLocalDescription(n);const o={type:"answer",sdp:this._remoteSdp.getSdp()};c.debug("setRtpEncodingParameters() | calling pc.setRemoteDescription() [answer:%o]",o),await this._pc.setRemoteDescription(o)}async getSenderStats(e){this.assertNotClosed(),this.assertSendDirection();const t=this._mapMidTransceiver.get(e);if(!t)throw new Error("associated RTCRtpTransceiver not found");return t.sender.getStats()}async sendDataChannel({ordered:e,maxPacketLifeTime:t,maxRetransmits:i,label:r,protocol:n}){this.assertNotClosed(),this.assertSendDirection();const o={negotiated:!0,id:this._nextSendSctpStreamId,ordered:e,maxPacketLifeTime:t,maxRetransmits:i,protocol:n};c.debug("sendDataChannel() [options:%o]",o);const p=this._pc.createDataChannel(r,o);if(this._nextSendSctpStreamId=++this._nextSendSctpStreamId%m.MIS,!this._hasDataChannelMediaSection){const w=await this._pc.createOffer(),d=S.parse(w.sdp),P=d.media.find(x=>x.type==="application");this._transportReady||await this.setupTransport({localDtlsRole:this._forcedLocalDtlsRole??"client",localSdpObject:d}),c.debug("sendDataChannel() | calling pc.setLocalDescription() [offer:%o]",w),await this._pc.setLocalDescription(w),this._remoteSdp.sendSctpAssociation({offerMediaObject:P});const k={type:"answer",sdp:this._remoteSdp.getSdp()};c.debug("sendDataChannel() | calling pc.setRemoteDescription() [answer:%o]",k),await this._pc.setRemoteDescription(k),this._hasDataChannelMediaSection=!0}const l={streamId:o.id,ordered:o.ordered,maxPacketLifeTime:o.maxPacketLifeTime,maxRetransmits:o.maxRetransmits};return{dataChannel:p,sctpStreamParameters:l}}async receive(e){this.assertNotClosed(),this.assertRecvDirection();const t=[],i=new Map;for(const p of e){const{trackId:l,kind:w,rtpParameters:d,streamId:P}=p;c.debug("receive() [trackId:%s, kind:%s]",l,w);const k=d.mid??String(this._mapMidTransceiver.size);i.set(l,k),this._remoteSdp.receive({mid:k,kind:w,offerRtpParameters:d,streamId:P??d.rtcp.cname,trackId:l})}const r={type:"offer",sdp:this._remoteSdp.getSdp()};c.debug("receive() | calling pc.setRemoteDescription() [offer:%o]",r),await this._pc.setRemoteDescription(r);let n=await this._pc.createAnswer();const o=S.parse(n.sdp);for(const p of e){const{trackId:l,rtpParameters:w}=p,d=i.get(l),P=o.media.find(k=>String(k.mid)===d);T.applyCodecParameters({offerRtpParameters:w,answerMediaObject:P})}n={type:"answer",sdp:S.write(o)},this._transportReady||await this.setupTransport({localDtlsRole:this._forcedLocalDtlsRole??"client",localSdpObject:o}),c.debug("receive() | calling pc.setLocalDescription() [answer:%o]",n),await this._pc.setLocalDescription(n);for(const p of e){const{trackId:l}=p,w=i.get(l),d=this._pc.getTransceivers().find(P=>P.mid===w);if(d)this._mapMidTransceiver.set(w,d),t.push({localId:w,track:d.receiver.track,rtpReceiver:d.receiver});else throw new Error("new RTCRtpTransceiver not found")}return t}async stopReceiving(e){if(this.assertRecvDirection(),this._closed)return;for(const r of e){c.debug("stopReceiving() [localId:%s]",r);const n=this._mapMidTransceiver.get(r);if(!n)throw new Error("associated RTCRtpTransceiver not found");this._remoteSdp.closeMediaSection(n.mid)}const t={type:"offer",sdp:this._remoteSdp.getSdp()};c.debug("stopReceiving() | calling pc.setRemoteDescription() [offer:%o]",t),await this._pc.setRemoteDescription(t);const i=await this._pc.createAnswer();c.debug("stopReceiving() | calling pc.setLocalDescription() [answer:%o]",i),await this._pc.setLocalDescription(i);for(const r of e)this._mapMidTransceiver.delete(r)}async pauseReceiving(e){this.assertNotClosed(),this.assertRecvDirection();for(const r of e){c.debug("pauseReceiving() [localId:%s]",r);const n=this._mapMidTransceiver.get(r);if(!n)throw new Error("associated RTCRtpTransceiver not found");n.direction="inactive",this._remoteSdp.pauseMediaSection(r)}const t={type:"offer",sdp:this._remoteSdp.getSdp()};c.debug("pauseReceiving() | calling pc.setRemoteDescription() [offer:%o]",t),await this._pc.setRemoteDescription(t);const i=await this._pc.createAnswer();c.debug("pauseReceiving() | calling pc.setLocalDescription() [answer:%o]",i),await this._pc.setLocalDescription(i)}async resumeReceiving(e){this.assertNotClosed(),this.assertRecvDirection();for(const r of e){c.debug("resumeReceiving() [localId:%s]",r);const n=this._mapMidTransceiver.get(r);if(!n)throw new Error("associated RTCRtpTransceiver not found");n.direction="recvonly",this._remoteSdp.resumeReceivingMediaSection(r)}const t={type:"offer",sdp:this._remoteSdp.getSdp()};c.debug("resumeReceiving() | calling pc.setRemoteDescription() [offer:%o]",t),await this._pc.setRemoteDescription(t);const i=await this._pc.createAnswer();c.debug("resumeReceiving() | calling pc.setLocalDescription() [answer:%o]",i),await this._pc.setLocalDescription(i)}async getReceiverStats(e){this.assertNotClosed(),this.assertRecvDirection();const t=this._mapMidTransceiver.get(e);if(!t)throw new Error("associated RTCRtpTransceiver not found");return t.receiver.getStats()}async receiveDataChannel({sctpStreamParameters:e,label:t,protocol:i}){this.assertNotClosed(),this.assertRecvDirection();const{streamId:r,ordered:n,maxPacketLifeTime:o,maxRetransmits:p}=e,l={negotiated:!0,id:r,ordered:n,maxPacketLifeTime:o,maxRetransmits:p,protocol:i};c.debug("receiveDataChannel() [options:%o]",l);const w=this._pc.createDataChannel(t,l);if(!this._hasDataChannelMediaSection){this._remoteSdp.receiveSctpAssociation();const d={type:"offer",sdp:this._remoteSdp.getSdp()};c.debug("receiveDataChannel() | calling pc.setRemoteDescription() [offer:%o]",d),await this._pc.setRemoteDescription(d);const P=await this._pc.createAnswer();if(!this._transportReady){const k=S.parse(P.sdp);await this.setupTransport({localDtlsRole:this._forcedLocalDtlsRole??"client",localSdpObject:k})}c.debug("receiveDataChannel() | calling pc.setRemoteDescription() [answer:%o]",P),await this._pc.setLocalDescription(P),this._hasDataChannelMediaSection=!0}return{dataChannel:w}}async setupTransport({localDtlsRole:e,localSdpObject:t}){t||(t=S.parse(this._pc.localDescription.sdp));const i=T.extractDtlsParameters({sdpObject:t});i.role=e,this._remoteSdp.updateDtlsRole(e==="client"?"server":"client"),await new Promise((r,n)=>{this.safeEmit("@connect",{dtlsParameters:i},r,n)}),this._transportReady=!0}assertNotClosed(){if(this._closed)throw new g.InvalidStateError("method called in a closed handler")}assertSendDirection(){if(this._direction!=="send")throw new Error('method can just be called for handlers with "send" direction')}assertRecvDirection(){if(this._direction!=="recv")throw new Error('method can just be called for handlers with "recv" direction')}};return ct.Chrome74=a,ct}var dt={},Is;function _n(){if(Is)return dt;Is=1,Object.defineProperty(dt,"__esModule",{value:!0}),dt.Chrome70=void 0;const S=te(),D=G(),R=Q(),u=X(),T=oe(),v=xe(),_=re(),g=ce(),y=Se(),b=new D.Logger("Chrome70"),h="Chrome70",c={OS:1024,MIS:1024};let f=class Ei extends _.HandlerInterface{_direction;_remoteSdp;_sendingRtpParametersByKind;_sendingRemoteRtpParametersByKind;_forcedLocalDtlsRole;_pc;_mapMidTransceiver=new Map;_sendStream=new MediaStream;_hasDataChannelMediaSection=!1;_nextSendSctpStreamId=0;_transportReady=!1;static createFactory(){return()=>new Ei}constructor(){super()}get name(){return h}close(){if(b.debug("close()"),this._pc)try{this._pc.close()}catch{}this.emit("@close")}async getNativeRtpCapabilities(){b.debug("getNativeRtpCapabilities()");const a=new RTCPeerConnection({iceServers:[],iceTransportPolicy:"all",bundlePolicy:"max-bundle",rtcpMuxPolicy:"require",sdpSemantics:"unified-plan"});try{a.addTransceiver("audio"),a.addTransceiver("video");const s=await a.createOffer();try{a.close()}catch{}const e=S.parse(s.sdp);return T.extractRtpCapabilities({sdpObject:e})}catch(s){try{a.close()}catch{}throw s}}async getNativeSctpCapabilities(){return b.debug("getNativeSctpCapabilities()"),{numStreams:c}}run({direction:a,iceParameters:s,iceCandidates:e,dtlsParameters:t,sctpParameters:i,iceServers:r,iceTransportPolicy:n,additionalSettings:o,proprietaryConstraints:p,extendedRtpCapabilities:l}){b.debug("run()"),this._direction=a,this._remoteSdp=new g.RemoteSdp({iceParameters:s,iceCandidates:e,dtlsParameters:t,sctpParameters:i}),this._sendingRtpParametersByKind={audio:u.getSendingRtpParameters("audio",l),video:u.getSendingRtpParameters("video",l)},this._sendingRemoteRtpParametersByKind={audio:u.getSendingRemoteRtpParameters("audio",l),video:u.getSendingRemoteRtpParameters("video",l)},t.role&&t.role!=="auto"&&(this._forcedLocalDtlsRole=t.role==="server"?"client":"server"),this._pc=new RTCPeerConnection({iceServers:r??[],iceTransportPolicy:n??"all",bundlePolicy:"max-bundle",rtcpMuxPolicy:"require",sdpSemantics:"unified-plan",...o},p),this._pc.addEventListener("icegatheringstatechange",()=>{this.emit("@icegatheringstatechange",this._pc.iceGatheringState)}),this._pc.addEventListener("icecandidateerror",w=>{this.emit("@icecandidateerror",w)}),this._pc.connectionState?this._pc.addEventListener("connectionstatechange",()=>{this.emit("@connectionstatechange",this._pc.connectionState)}):this._pc.addEventListener("iceconnectionstatechange",()=>{switch(b.warn("run() | pc.connectionState not supported, using pc.iceConnectionState"),this._pc.iceConnectionState){case"checking":{this.emit("@connectionstatechange","connecting");break}case"connected":case"completed":{this.emit("@connectionstatechange","connected");break}case"failed":{this.emit("@connectionstatechange","failed");break}case"disconnected":{this.emit("@connectionstatechange","disconnected");break}case"closed":{this.emit("@connectionstatechange","closed");break}}})}async updateIceServers(a){b.debug("updateIceServers()");const s=this._pc.getConfiguration();s.iceServers=a,this._pc.setConfiguration(s)}async restartIce(a){if(b.debug("restartIce()"),this._remoteSdp.updateIceParameters(a),!!this._transportReady)if(this._direction==="send"){const s=await this._pc.createOffer({iceRestart:!0});b.debug("restartIce() | calling pc.setLocalDescription() [offer:%o]",s),await this._pc.setLocalDescription(s);const e={type:"answer",sdp:this._remoteSdp.getSdp()};b.debug("restartIce() | calling pc.setRemoteDescription() [answer:%o]",e),await this._pc.setRemoteDescription(e)}else{const s={type:"offer",sdp:this._remoteSdp.getSdp()};b.debug("restartIce() | calling pc.setRemoteDescription() [offer:%o]",s),await this._pc.setRemoteDescription(s);const e=await this._pc.createAnswer();b.debug("restartIce() | calling pc.setLocalDescription() [answer:%o]",e),await this._pc.setLocalDescription(e)}}async getTransportStats(){return this._pc.getStats()}async send({track:a,encodings:s,codecOptions:e,codec:t}){this.assertSendDirection(),b.debug("send() [kind:%s, track.id:%s]",a.kind,a.id);const i=R.clone(this._sendingRtpParametersByKind[a.kind]);i.codecs=u.reduceCodecs(i.codecs,t);const r=R.clone(this._sendingRemoteRtpParametersByKind[a.kind]);r.codecs=u.reduceCodecs(r.codecs,t);const n=this._remoteSdp.getNextMediaSectionIdx(),o=this._pc.addTransceiver(a,{direction:"sendonly",streams:[this._sendStream]});let p=await this._pc.createOffer(),l=S.parse(p.sdp);l.extmapAllowMixed&&this._remoteSdp.setSessionExtmapAllowMixed();let w;this._transportReady||await this.setupTransport({localDtlsRole:this._forcedLocalDtlsRole??"client",localSdpObject:l}),s&&s.length>1&&(b.debug("send() | enabling legacy simulcast"),l=S.parse(p.sdp),w=l.media[n.idx],v.addLegacySimulcast({offerMediaObject:w,numStreams:s.length}),p={type:"offer",sdp:S.write(l)});let d=!1;const P=(0,y.parse)((s??[{}])[0].scalabilityMode);if(s&&s.length===1&&P.spatialLayers>1&&i.codecs[0].mimeType.toLowerCase()==="video/vp9"&&(b.debug("send() | enabling legacy simulcast for VP9 SVC"),d=!0,l=S.parse(p.sdp),w=l.media[n.idx],v.addLegacySimulcast({offerMediaObject:w,numStreams:P.spatialLayers}),p={type:"offer",sdp:S.write(l)}),b.debug("send() | calling pc.setLocalDescription() [offer:%o]",p),await this._pc.setLocalDescription(p),s){b.debug("send() | applying given encodings");const C=o.sender.getParameters();for(let E=0;E<(C.encodings??[]).length;++E){const I=C.encodings[E],L=s[E];if(!L)break;C.encodings[E]=Object.assign(I,L)}await o.sender.setParameters(C)}const k=o.mid;if(i.mid=k,l=S.parse(this._pc.localDescription.sdp),w=l.media[n.idx],i.rtcp.cname=T.getCname({offerMediaObject:w}),i.encodings=v.getRtpEncodings({offerMediaObject:w}),s)for(let C=0;C<i.encodings.length;++C)s[C]&&Object.assign(i.encodings[C],s[C]);if(d&&(i.encodings=[i.encodings[0]]),i.encodings.length>1&&(i.codecs[0].mimeType.toLowerCase()==="video/vp8"||i.codecs[0].mimeType.toLowerCase()==="video/h264"))for(const C of i.encodings)C.scalabilityMode="L1T3";this._remoteSdp.send({offerMediaObject:w,reuseMid:n.reuseMid,offerRtpParameters:i,answerRtpParameters:r,codecOptions:e});const x={type:"answer",sdp:this._remoteSdp.getSdp()};return b.debug("send() | calling pc.setRemoteDescription() [answer:%o]",x),await this._pc.setRemoteDescription(x),this._mapMidTransceiver.set(k,o),{localId:k,rtpParameters:i,rtpSender:o.sender}}async stopSending(a){this.assertSendDirection(),b.debug("stopSending() [localId:%s]",a);const s=this._mapMidTransceiver.get(a);if(!s)throw new Error("associated RTCRtpTransceiver not found");if(s.sender.replaceTrack(null),this._pc.removeTrack(s.sender),this._remoteSdp.closeMediaSection(s.mid))try{s.stop()}catch{}const t=await this._pc.createOffer();b.debug("stopSending() | calling pc.setLocalDescription() [offer:%o]",t),await this._pc.setLocalDescription(t);const i={type:"answer",sdp:this._remoteSdp.getSdp()};b.debug("stopSending() | calling pc.setRemoteDescription() [answer:%o]",i),await this._pc.setRemoteDescription(i),this._mapMidTransceiver.delete(a)}async pauseSending(a){}async resumeSending(a){}async replaceTrack(a,s){this.assertSendDirection(),s?b.debug("replaceTrack() [localId:%s, track.id:%s]",a,s.id):b.debug("replaceTrack() [localId:%s, no track]",a);const e=this._mapMidTransceiver.get(a);if(!e)throw new Error("associated RTCRtpTransceiver not found");await e.sender.replaceTrack(s)}async setMaxSpatialLayer(a,s){this.assertSendDirection(),b.debug("setMaxSpatialLayer() [localId:%s, spatialLayer:%s]",a,s);const e=this._mapMidTransceiver.get(a);if(!e)throw new Error("associated RTCRtpTransceiver not found");const t=e.sender.getParameters();t.encodings.forEach((n,o)=>{o<=s?n.active=!0:n.active=!1}),await e.sender.setParameters(t),this._remoteSdp.muxMediaSectionSimulcast(a,t.encodings);const i=await this._pc.createOffer();b.debug("setMaxSpatialLayer() | calling pc.setLocalDescription() [offer:%o]",i),await this._pc.setLocalDescription(i);const r={type:"answer",sdp:this._remoteSdp.getSdp()};b.debug("setMaxSpatialLayer() | calling pc.setRemoteDescription() [answer:%o]",r),await this._pc.setRemoteDescription(r)}async setRtpEncodingParameters(a,s){this.assertSendDirection(),b.debug("setRtpEncodingParameters() [localId:%s, params:%o]",a,s);const e=this._mapMidTransceiver.get(a);if(!e)throw new Error("associated RTCRtpTransceiver not found");const t=e.sender.getParameters();t.encodings.forEach((n,o)=>{t.encodings[o]={...n,...s}}),await e.sender.setParameters(t),this._remoteSdp.muxMediaSectionSimulcast(a,t.encodings);const i=await this._pc.createOffer();b.debug("setRtpEncodingParameters() | calling pc.setLocalDescription() [offer:%o]",i),await this._pc.setLocalDescription(i);const r={type:"answer",sdp:this._remoteSdp.getSdp()};b.debug("setRtpEncodingParameters() | calling pc.setRemoteDescription() [answer:%o]",r),await this._pc.setRemoteDescription(r)}async getSenderStats(a){this.assertSendDirection();const s=this._mapMidTransceiver.get(a);if(!s)throw new Error("associated RTCRtpTransceiver not found");return s.sender.getStats()}async sendDataChannel({ordered:a,maxPacketLifeTime:s,maxRetransmits:e,label:t,protocol:i}){this.assertSendDirection();const r={negotiated:!0,id:this._nextSendSctpStreamId,ordered:a,maxPacketLifeTime:s,maxRetransmitTime:s,maxRetransmits:e,protocol:i};b.debug("sendDataChannel() [options:%o]",r);const n=this._pc.createDataChannel(t,r);if(this._nextSendSctpStreamId=++this._nextSendSctpStreamId%c.MIS,!this._hasDataChannelMediaSection){const p=await this._pc.createOffer(),l=S.parse(p.sdp),w=l.media.find(P=>P.type==="application");this._transportReady||await this.setupTransport({localDtlsRole:this._forcedLocalDtlsRole??"client",localSdpObject:l}),b.debug("sendDataChannel() | calling pc.setLocalDescription() [offer:%o]",p),await this._pc.setLocalDescription(p),this._remoteSdp.sendSctpAssociation({offerMediaObject:w});const d={type:"answer",sdp:this._remoteSdp.getSdp()};b.debug("sendDataChannel() | calling pc.setRemoteDescription() [answer:%o]",d),await this._pc.setRemoteDescription(d),this._hasDataChannelMediaSection=!0}const o={streamId:r.id,ordered:r.ordered,maxPacketLifeTime:r.maxPacketLifeTime,maxRetransmits:r.maxRetransmits};return{dataChannel:n,sctpStreamParameters:o}}async receive(a){this.assertRecvDirection();const s=[],e=new Map;for(const n of a){const{trackId:o,kind:p,rtpParameters:l,streamId:w}=n;b.debug("receive() [trackId:%s, kind:%s]",o,p);const d=l.mid??String(this._mapMidTransceiver.size);e.set(o,d),this._remoteSdp.receive({mid:d,kind:p,offerRtpParameters:l,streamId:w??l.rtcp.cname,trackId:o})}const t={type:"offer",sdp:this._remoteSdp.getSdp()};b.debug("receive() | calling pc.setRemoteDescription() [offer:%o]",t),await this._pc.setRemoteDescription(t);let i=await this._pc.createAnswer();const r=S.parse(i.sdp);for(const n of a){const{trackId:o,rtpParameters:p}=n,l=e.get(o),w=r.media.find(d=>String(d.mid)===l);T.applyCodecParameters({offerRtpParameters:p,answerMediaObject:w})}i={type:"answer",sdp:S.write(r)},this._transportReady||await this.setupTransport({localDtlsRole:this._forcedLocalDtlsRole??"client",localSdpObject:r}),b.debug("receive() | calling pc.setLocalDescription() [answer:%o]",i),await this._pc.setLocalDescription(i);for(const n of a){const{trackId:o}=n,p=e.get(o),l=this._pc.getTransceivers().find(w=>w.mid===p);if(!l)throw new Error("new RTCRtpTransceiver not found");this._mapMidTransceiver.set(p,l),s.push({localId:p,track:l.receiver.track,rtpReceiver:l.receiver})}return s}async stopReceiving(a){this.assertRecvDirection();for(const t of a){b.debug("stopReceiving() [localId:%s]",t);const i=this._mapMidTransceiver.get(t);if(!i)throw new Error("associated RTCRtpTransceiver not found");this._remoteSdp.closeMediaSection(i.mid)}const s={type:"offer",sdp:this._remoteSdp.getSdp()};b.debug("stopReceiving() | calling pc.setRemoteDescription() [offer:%o]",s),await this._pc.setRemoteDescription(s);const e=await this._pc.createAnswer();b.debug("stopReceiving() | calling pc.setLocalDescription() [answer:%o]",e),await this._pc.setLocalDescription(e);for(const t of a)this._mapMidTransceiver.delete(t)}async pauseReceiving(a){}async resumeReceiving(a){}async getReceiverStats(a){this.assertRecvDirection();const s=this._mapMidTransceiver.get(a);if(!s)throw new Error("associated RTCRtpTransceiver not found");return s.receiver.getStats()}async receiveDataChannel({sctpStreamParameters:a,label:s,protocol:e}){this.assertRecvDirection();const{streamId:t,ordered:i,maxPacketLifeTime:r,maxRetransmits:n}=a,o={negotiated:!0,id:t,ordered:i,maxPacketLifeTime:r,maxRetransmitTime:r,maxRetransmits:n,protocol:e};b.debug("receiveDataChannel() [options:%o]",o);const p=this._pc.createDataChannel(s,o);if(!this._hasDataChannelMediaSection){this._remoteSdp.receiveSctpAssociation();const l={type:"offer",sdp:this._remoteSdp.getSdp()};b.debug("receiveDataChannel() | calling pc.setRemoteDescription() [offer:%o]",l),await this._pc.setRemoteDescription(l);const w=await this._pc.createAnswer();if(!this._transportReady){const d=S.parse(w.sdp);await this.setupTransport({localDtlsRole:this._forcedLocalDtlsRole??"client",localSdpObject:d})}b.debug("receiveDataChannel() | calling pc.setRemoteDescription() [answer:%o]",w),await this._pc.setLocalDescription(w),this._hasDataChannelMediaSection=!0}return{dataChannel:p}}async setupTransport({localDtlsRole:a,localSdpObject:s}){s||(s=S.parse(this._pc.localDescription.sdp));const e=T.extractDtlsParameters({sdpObject:s});e.role=a,this._remoteSdp.updateDtlsRole(a==="client"?"server":"client"),await new Promise((t,i)=>{this.safeEmit("@connect",{dtlsParameters:e},t,i)}),this._transportReady=!0}assertSendDirection(){if(this._direction!=="send")throw new Error('method can just be called for handlers with "send" direction')}assertRecvDirection(){if(this._direction!=="recv")throw new Error('method can just be called for handlers with "recv" direction')}};return dt.Chrome70=f,dt}var pt={},lt={},Ms;function rr(){if(Ms)return lt;Ms=1,Object.defineProperty(lt,"__esModule",{value:!0}),lt.getRtpEncodings=S,lt.addLegacySimulcast=D;function S({offerMediaObject:R,track:u}){const T=new Set;for(const g of R.ssrcs??[]){if(g.attribute!=="msid")continue;if(g.value.split(" ")[1]===u.id){const b=g.id;T.add(b)}}if(T.size===0)throw new Error(`a=ssrc line with msid information not found [track.id:${u.id}]`);const v=new Map;for(const g of R.ssrcGroups??[]){if(g.semantics!=="FID")continue;let[y,b]=g.ssrcs.split(/\s+/);y=Number(y),b=Number(b),T.has(y)&&(T.delete(y),T.delete(b),v.set(y,b))}for(const g of T)v.set(g,null);const _=[];for(const[g,y]of v){const b={ssrc:g};y&&(b.rtx={ssrc:y}),_.push(b)}return _}function D({offerMediaObject:R,track:u,numStreams:T}){if(T<=1)throw new TypeError("numStreams must be greater than 1");let v,_,g;if(!(R.ssrcs??[]).find(m=>m.attribute!=="msid"?!1:m.value.split(" ")[1]===u.id?(v=m.id,g=m.value.split(" ")[0],!0):!1))throw new Error(`a=ssrc line with msid information not found [track.id:${u.id}]`);(R.ssrcGroups??[]).some(m=>{if(m.semantics!=="FID")return!1;const a=m.ssrcs.split(/\s+/);return Number(a[0])===v?(_=Number(a[1]),!0):!1});const b=R.ssrcs.find(m=>m.attribute==="cname"&&m.id===v);if(!b)throw new Error(`a=ssrc line with cname information not found [track.id:${u.id}]`);const h=b.value,c=[],f=[];for(let m=0;m<T;++m)c.push(v+m),_&&f.push(_+m);R.ssrcGroups=R.ssrcGroups??[],R.ssrcs=R.ssrcs??[],R.ssrcGroups.push({semantics:"SIM",ssrcs:c.join(" ")});for(const m of c)R.ssrcs.push({id:m,attribute:"cname",value:h}),R.ssrcs.push({id:m,attribute:"msid",value:`${g} ${u.id}`});for(let m=0;m<f.length;++m){const a=c[m],s=f[m];R.ssrcs.push({id:s,attribute:"cname",value:h}),R.ssrcs.push({id:s,attribute:"msid",value:`${g} ${u.id}`}),R.ssrcGroups.push({semantics:"FID",ssrcs:`${a} ${s}`})}}return lt}var Os;function wn(){if(Os)return pt;Os=1,Object.defineProperty(pt,"__esModule",{value:!0}),pt.Chrome67=void 0;const S=te(),D=G(),R=Q(),u=X(),T=oe(),v=rr(),_=re(),g=ce(),y=new D.Logger("Chrome67"),b="Chrome67",h={OS:1024,MIS:1024};let c=class xi extends _.HandlerInterface{_direction;_remoteSdp;_sendingRtpParametersByKind;_sendingRemoteRtpParametersByKind;_forcedLocalDtlsRole;_pc;_sendStream=new MediaStream;_mapSendLocalIdRtpSender=new Map;_nextSendLocalId=0;_mapRecvLocalIdInfo=new Map;_hasDataChannelMediaSection=!1;_nextSendSctpStreamId=0;_transportReady=!1;static createFactory(){return()=>new xi}constructor(){super()}get name(){return b}close(){if(y.debug("close()"),this._pc)try{this._pc.close()}catch{}this.emit("@close")}async getNativeRtpCapabilities(){y.debug("getNativeRtpCapabilities()");const m=new RTCPeerConnection({iceServers:[],iceTransportPolicy:"all",bundlePolicy:"max-bundle",rtcpMuxPolicy:"require",sdpSemantics:"plan-b"});try{const a=await m.createOffer({offerToReceiveAudio:!0,offerToReceiveVideo:!0});try{m.close()}catch{}const s=S.parse(a.sdp);return T.extractRtpCapabilities({sdpObject:s})}catch(a){try{m.close()}catch{}throw a}}async getNativeSctpCapabilities(){return y.debug("getNativeSctpCapabilities()"),{numStreams:h}}run({direction:m,iceParameters:a,iceCandidates:s,dtlsParameters:e,sctpParameters:t,iceServers:i,iceTransportPolicy:r,additionalSettings:n,proprietaryConstraints:o,extendedRtpCapabilities:p}){y.debug("run()"),this._direction=m,this._remoteSdp=new g.RemoteSdp({iceParameters:a,iceCandidates:s,dtlsParameters:e,sctpParameters:t,planB:!0}),this._sendingRtpParametersByKind={audio:u.getSendingRtpParameters("audio",p),video:u.getSendingRtpParameters("video",p)},this._sendingRemoteRtpParametersByKind={audio:u.getSendingRemoteRtpParameters("audio",p),video:u.getSendingRemoteRtpParameters("video",p)},e.role&&e.role!=="auto"&&(this._forcedLocalDtlsRole=e.role==="server"?"client":"server"),this._pc=new RTCPeerConnection({iceServers:i??[],iceTransportPolicy:r??"all",bundlePolicy:"max-bundle",rtcpMuxPolicy:"require",sdpSemantics:"plan-b",...n},o),this._pc.addEventListener("icegatheringstatechange",()=>{this.emit("@icegatheringstatechange",this._pc.iceGatheringState)}),this._pc.addEventListener("icecandidateerror",l=>{this.emit("@icecandidateerror",l)}),this._pc.connectionState?this._pc.addEventListener("connectionstatechange",()=>{this.emit("@connectionstatechange",this._pc.connectionState)}):this._pc.addEventListener("iceconnectionstatechange",()=>{switch(y.warn("run() | pc.connectionState not supported, using pc.iceConnectionState"),this._pc.iceConnectionState){case"checking":{this.emit("@connectionstatechange","connecting");break}case"connected":case"completed":{this.emit("@connectionstatechange","connected");break}case"failed":{this.emit("@connectionstatechange","failed");break}case"disconnected":{this.emit("@connectionstatechange","disconnected");break}case"closed":{this.emit("@connectionstatechange","closed");break}}})}async updateIceServers(m){y.debug("updateIceServers()");const a=this._pc.getConfiguration();a.iceServers=m,this._pc.setConfiguration(a)}async restartIce(m){if(y.debug("restartIce()"),this._remoteSdp.updateIceParameters(m),!!this._transportReady)if(this._direction==="send"){const a=await this._pc.createOffer({iceRestart:!0});y.debug("restartIce() | calling pc.setLocalDescription() [offer:%o]",a),await this._pc.setLocalDescription(a);const s={type:"answer",sdp:this._remoteSdp.getSdp()};y.debug("restartIce() | calling pc.setRemoteDescription() [answer:%o]",s),await this._pc.setRemoteDescription(s)}else{const a={type:"offer",sdp:this._remoteSdp.getSdp()};y.debug("restartIce() | calling pc.setRemoteDescription() [offer:%o]",a),await this._pc.setRemoteDescription(a);const s=await this._pc.createAnswer();y.debug("restartIce() | calling pc.setLocalDescription() [answer:%o]",s),await this._pc.setLocalDescription(s)}}async getTransportStats(){return this._pc.getStats()}async send({track:m,encodings:a,codecOptions:s,codec:e}){this.assertSendDirection(),y.debug("send() [kind:%s, track.id:%s]",m.kind,m.id),e&&y.warn("send() | codec selection is not available in %s handler",this.name),this._sendStream.addTrack(m),this._pc.addTrack(m,this._sendStream);let t=await this._pc.createOffer(),i=S.parse(t.sdp);i.extmapAllowMixed&&this._remoteSdp.setSessionExtmapAllowMixed();let r;const n=R.clone(this._sendingRtpParametersByKind[m.kind]);n.codecs=u.reduceCodecs(n.codecs);const o=R.clone(this._sendingRemoteRtpParametersByKind[m.kind]);if(o.codecs=u.reduceCodecs(o.codecs),this._transportReady||await this.setupTransport({localDtlsRole:this._forcedLocalDtlsRole??"client",localSdpObject:i}),m.kind==="video"&&a&&a.length>1&&(y.debug("send() | enabling simulcast"),i=S.parse(t.sdp),r=i.media.find(d=>d.type==="video"),v.addLegacySimulcast({offerMediaObject:r,track:m,numStreams:a.length}),t={type:"offer",sdp:S.write(i)}),y.debug("send() | calling pc.setLocalDescription() [offer:%o]",t),await this._pc.setLocalDescription(t),i=S.parse(this._pc.localDescription.sdp),r=i.media.find(d=>d.type===m.kind),n.rtcp.cname=T.getCname({offerMediaObject:r}),n.encodings=v.getRtpEncodings({offerMediaObject:r,track:m}),a)for(let d=0;d<n.encodings.length;++d)a[d]&&Object.assign(n.encodings[d],a[d]);if(n.encodings.length>1&&n.codecs[0].mimeType.toLowerCase()==="video/vp8")for(const d of n.encodings)d.scalabilityMode="L1T3";this._remoteSdp.send({offerMediaObject:r,offerRtpParameters:n,answerRtpParameters:o,codecOptions:s});const p={type:"answer",sdp:this._remoteSdp.getSdp()};y.debug("send() | calling pc.setRemoteDescription() [answer:%o]",p),await this._pc.setRemoteDescription(p);const l=String(this._nextSendLocalId);this._nextSendLocalId++;const w=this._pc.getSenders().find(d=>d.track===m);return this._mapSendLocalIdRtpSender.set(l,w),{localId:l,rtpParameters:n,rtpSender:w}}async stopSending(m){this.assertSendDirection(),y.debug("stopSending() [localId:%s]",m);const a=this._mapSendLocalIdRtpSender.get(m);if(!a)throw new Error("associated RTCRtpSender not found");this._pc.removeTrack(a),a.track&&this._sendStream.removeTrack(a.track),this._mapSendLocalIdRtpSender.delete(m);const s=await this._pc.createOffer();y.debug("stopSending() | calling pc.setLocalDescription() [offer:%o]",s);try{await this._pc.setLocalDescription(s)}catch(t){if(this._sendStream.getTracks().length===0){y.warn("stopSending() | ignoring expected error due no sending tracks: %s",t.toString());return}throw t}if(this._pc.signalingState==="stable")return;const e={type:"answer",sdp:this._remoteSdp.getSdp()};y.debug("stopSending() | calling pc.setRemoteDescription() [answer:%o]",e),await this._pc.setRemoteDescription(e)}async pauseSending(m){}async resumeSending(m){}async replaceTrack(m,a){this.assertSendDirection(),a?y.debug("replaceTrack() [localId:%s, track.id:%s]",m,a.id):y.debug("replaceTrack() [localId:%s, no track]",m);const s=this._mapSendLocalIdRtpSender.get(m);if(!s)throw new Error("associated RTCRtpSender not found");const e=s.track;await s.replaceTrack(a),e&&this._sendStream.removeTrack(e),a&&this._sendStream.addTrack(a)}async setMaxSpatialLayer(m,a){this.assertSendDirection(),y.debug("setMaxSpatialLayer() [localId:%s, spatialLayer:%s]",m,a);const s=this._mapSendLocalIdRtpSender.get(m);if(!s)throw new Error("associated RTCRtpSender not found");const e=s.getParameters();e.encodings.forEach((t,i)=>{i<=a?t.active=!0:t.active=!1}),await s.setParameters(e)}async setRtpEncodingParameters(m,a){this.assertSendDirection(),y.debug("setRtpEncodingParameters() [localId:%s, params:%o]",m,a);const s=this._mapSendLocalIdRtpSender.get(m);if(!s)throw new Error("associated RTCRtpSender not found");const e=s.getParameters();e.encodings.forEach((t,i)=>{e.encodings[i]={...t,...a}}),await s.setParameters(e)}async getSenderStats(m){this.assertSendDirection();const a=this._mapSendLocalIdRtpSender.get(m);if(!a)throw new Error("associated RTCRtpSender not found");return a.getStats()}async sendDataChannel({ordered:m,maxPacketLifeTime:a,maxRetransmits:s,label:e,protocol:t}){this.assertSendDirection();const i={negotiated:!0,id:this._nextSendSctpStreamId,ordered:m,maxPacketLifeTime:a,maxRetransmitTime:a,maxRetransmits:s,protocol:t};y.debug("sendDataChannel() [options:%o]",i);const r=this._pc.createDataChannel(e,i);if(this._nextSendSctpStreamId=++this._nextSendSctpStreamId%h.MIS,!this._hasDataChannelMediaSection){const o=await this._pc.createOffer(),p=S.parse(o.sdp),l=p.media.find(d=>d.type==="application");this._transportReady||await this.setupTransport({localDtlsRole:this._forcedLocalDtlsRole??"client",localSdpObject:p}),y.debug("sendDataChannel() | calling pc.setLocalDescription() [offer:%o]",o),await this._pc.setLocalDescription(o),this._remoteSdp.sendSctpAssociation({offerMediaObject:l});const w={type:"answer",sdp:this._remoteSdp.getSdp()};y.debug("sendDataChannel() | calling pc.setRemoteDescription() [answer:%o]",w),await this._pc.setRemoteDescription(w),this._hasDataChannelMediaSection=!0}const n={streamId:i.id,ordered:i.ordered,maxPacketLifeTime:i.maxPacketLifeTime,maxRetransmits:i.maxRetransmits};return{dataChannel:r,sctpStreamParameters:n}}async receive(m){this.assertRecvDirection();const a=[];for(const i of m){const{trackId:r,kind:n,rtpParameters:o,streamId:p}=i;y.debug("receive() [trackId:%s, kind:%s]",r,n);const l=n;this._remoteSdp.receive({mid:l,kind:n,offerRtpParameters:o,streamId:p??o.rtcp.cname,trackId:r})}const s={type:"offer",sdp:this._remoteSdp.getSdp()};y.debug("receive() | calling pc.setRemoteDescription() [offer:%o]",s),await this._pc.setRemoteDescription(s);let e=await this._pc.createAnswer();const t=S.parse(e.sdp);for(const i of m){const{kind:r,rtpParameters:n}=i,o=r,p=t.media.find(l=>String(l.mid)===o);T.applyCodecParameters({offerRtpParameters:n,answerMediaObject:p})}e={type:"answer",sdp:S.write(t)},this._transportReady||await this.setupTransport({localDtlsRole:this._forcedLocalDtlsRole??"client",localSdpObject:t}),y.debug("receive() | calling pc.setLocalDescription() [answer:%o]",e),await this._pc.setLocalDescription(e);for(const i of m){const{kind:r,trackId:n,rtpParameters:o}=i,p=n,l=r,w=this._pc.getReceivers().find(d=>d.track&&d.track.id===p);if(!w)throw new Error("new RTCRtpReceiver not");this._mapRecvLocalIdInfo.set(p,{mid:l,rtpParameters:o,rtpReceiver:w}),a.push({localId:p,track:w.track,rtpReceiver:w})}return a}async stopReceiving(m){this.assertRecvDirection();for(const e of m){y.debug("stopReceiving() [localId:%s]",e);const{mid:t,rtpParameters:i}=this._mapRecvLocalIdInfo.get(e)??{};this._mapRecvLocalIdInfo.delete(e),this._remoteSdp.planBStopReceiving({mid:t,offerRtpParameters:i})}const a={type:"offer",sdp:this._remoteSdp.getSdp()};y.debug("stopReceiving() | calling pc.setRemoteDescription() [offer:%o]",a),await this._pc.setRemoteDescription(a);const s=await this._pc.createAnswer();y.debug("stopReceiving() | calling pc.setLocalDescription() [answer:%o]",s),await this._pc.setLocalDescription(s)}async pauseReceiving(m){}async resumeReceiving(m){}async getReceiverStats(m){this.assertRecvDirection();const{rtpReceiver:a}=this._mapRecvLocalIdInfo.get(m)??{};if(!a)throw new Error("associated RTCRtpReceiver not found");return a.getStats()}async receiveDataChannel({sctpStreamParameters:m,label:a,protocol:s}){this.assertRecvDirection();const{streamId:e,ordered:t,maxPacketLifeTime:i,maxRetransmits:r}=m,n={negotiated:!0,id:e,ordered:t,maxPacketLifeTime:i,maxRetransmitTime:i,maxRetransmits:r,protocol:s};y.debug("receiveDataChannel() [options:%o]",n);const o=this._pc.createDataChannel(a,n);if(!this._hasDataChannelMediaSection){this._remoteSdp.receiveSctpAssociation({oldDataChannelSpec:!0});const p={type:"offer",sdp:this._remoteSdp.getSdp()};y.debug("receiveDataChannel() | calling pc.setRemoteDescription() [offer:%o]",p),await this._pc.setRemoteDescription(p);const l=await this._pc.createAnswer();if(!this._transportReady){const w=S.parse(l.sdp);await this.setupTransport({localDtlsRole:this._forcedLocalDtlsRole??"client",localSdpObject:w})}y.debug("receiveDataChannel() | calling pc.setRemoteDescription() [answer:%o]",l),await this._pc.setLocalDescription(l),this._hasDataChannelMediaSection=!0}return{dataChannel:o}}async setupTransport({localDtlsRole:m,localSdpObject:a}){a||(a=S.parse(this._pc.localDescription.sdp));const s=T.extractDtlsParameters({sdpObject:a});s.role=m,this._remoteSdp.updateDtlsRole(m==="client"?"server":"client"),await new Promise((e,t)=>{this.safeEmit("@connect",{dtlsParameters:s},e,t)}),this._transportReady=!0}assertSendDirection(){if(this._direction!=="send")throw new Error('method can just be called for handlers with "send" direction')}assertRecvDirection(){if(this._direction!=="recv")throw new Error('method can just be called for handlers with "recv" direction')}};return pt.Chrome67=c,pt}var ut={},js;function vn(){if(js)return ut;js=1,Object.defineProperty(ut,"__esModule",{value:!0}),ut.Chrome55=void 0;const S=te(),D=G(),R=Y(),u=Q(),T=X(),v=oe(),_=rr(),g=re(),y=ce(),b=new D.Logger("Chrome55"),h="Chrome55",c={OS:1024,MIS:1024};let f=class Li extends g.HandlerInterface{_direction;_remoteSdp;_sendingRtpParametersByKind;_sendingRemoteRtpParametersByKind;_forcedLocalDtlsRole;_pc;_sendStream=new MediaStream;_mapSendLocalIdTrack=new Map;_nextSendLocalId=0;_mapRecvLocalIdInfo=new Map;_hasDataChannelMediaSection=!1;_nextSendSctpStreamId=0;_transportReady=!1;static createFactory(){return()=>new Li}constructor(){super()}get name(){return h}close(){if(b.debug("close()"),this._pc)try{this._pc.close()}catch{}this.emit("@close")}async getNativeRtpCapabilities(){b.debug("getNativeRtpCapabilities()");const a=new RTCPeerConnection({iceServers:[],iceTransportPolicy:"all",bundlePolicy:"max-bundle",rtcpMuxPolicy:"require",sdpSemantics:"plan-b"});try{const s=await a.createOffer({offerToReceiveAudio:!0,offerToReceiveVideo:!0});try{a.close()}catch{}const e=S.parse(s.sdp);return v.extractRtpCapabilities({sdpObject:e})}catch(s){try{a.close()}catch{}throw s}}async getNativeSctpCapabilities(){return b.debug("getNativeSctpCapabilities()"),{numStreams:c}}run({direction:a,iceParameters:s,iceCandidates:e,dtlsParameters:t,sctpParameters:i,iceServers:r,iceTransportPolicy:n,additionalSettings:o,proprietaryConstraints:p,extendedRtpCapabilities:l}){b.debug("run()"),this._direction=a,this._remoteSdp=new y.RemoteSdp({iceParameters:s,iceCandidates:e,dtlsParameters:t,sctpParameters:i,planB:!0}),this._sendingRtpParametersByKind={audio:T.getSendingRtpParameters("audio",l),video:T.getSendingRtpParameters("video",l)},this._sendingRemoteRtpParametersByKind={audio:T.getSendingRemoteRtpParameters("audio",l),video:T.getSendingRemoteRtpParameters("video",l)},t.role&&t.role!=="auto"&&(this._forcedLocalDtlsRole=t.role==="server"?"client":"server"),this._pc=new RTCPeerConnection({iceServers:r??[],iceTransportPolicy:n??"all",bundlePolicy:"max-bundle",rtcpMuxPolicy:"require",sdpSemantics:"plan-b",...o},p),this._pc.addEventListener("icegatheringstatechange",()=>{this.emit("@icegatheringstatechange",this._pc.iceGatheringState)}),this._pc.addEventListener("icecandidateerror",w=>{this.emit("@icecandidateerror",w)}),this._pc.connectionState?this._pc.addEventListener("connectionstatechange",()=>{this.emit("@connectionstatechange",this._pc.connectionState)}):this._pc.addEventListener("iceconnectionstatechange",()=>{switch(b.warn("run() | pc.connectionState not supported, using pc.iceConnectionState"),this._pc.iceConnectionState){case"checking":{this.emit("@connectionstatechange","connecting");break}case"connected":case"completed":{this.emit("@connectionstatechange","connected");break}case"failed":{this.emit("@connectionstatechange","failed");break}case"disconnected":{this.emit("@connectionstatechange","disconnected");break}case"closed":{this.emit("@connectionstatechange","closed");break}}})}async updateIceServers(a){b.debug("updateIceServers()");const s=this._pc.getConfiguration();s.iceServers=a,this._pc.setConfiguration(s)}async restartIce(a){if(b.debug("restartIce()"),this._remoteSdp.updateIceParameters(a),!!this._transportReady)if(this._direction==="send"){const s=await this._pc.createOffer({iceRestart:!0});b.debug("restartIce() | calling pc.setLocalDescription() [offer:%o]",s),await this._pc.setLocalDescription(s);const e={type:"answer",sdp:this._remoteSdp.getSdp()};b.debug("restartIce() | calling pc.setRemoteDescription() [answer:%o]",e),await this._pc.setRemoteDescription(e)}else{const s={type:"offer",sdp:this._remoteSdp.getSdp()};b.debug("restartIce() | calling pc.setRemoteDescription() [offer:%o]",s),await this._pc.setRemoteDescription(s);const e=await this._pc.createAnswer();b.debug("restartIce() | calling pc.setLocalDescription() [answer:%o]",e),await this._pc.setLocalDescription(e)}}async getTransportStats(){return this._pc.getStats()}async send({track:a,encodings:s,codecOptions:e,codec:t}){this.assertSendDirection(),b.debug("send() [kind:%s, track.id:%s]",a.kind,a.id),t&&b.warn("send() | codec selection is not available in %s handler",this.name),this._sendStream.addTrack(a),this._pc.addStream(this._sendStream);let i=await this._pc.createOffer(),r=S.parse(i.sdp);r.extmapAllowMixed&&this._remoteSdp.setSessionExtmapAllowMixed();let n;const o=u.clone(this._sendingRtpParametersByKind[a.kind]);o.codecs=T.reduceCodecs(o.codecs);const p=u.clone(this._sendingRemoteRtpParametersByKind[a.kind]);if(p.codecs=T.reduceCodecs(p.codecs),this._transportReady||await this.setupTransport({localDtlsRole:this._forcedLocalDtlsRole??"client",localSdpObject:r}),a.kind==="video"&&s&&s.length>1&&(b.debug("send() | enabling simulcast"),r=S.parse(i.sdp),n=r.media.find(d=>d.type==="video"),_.addLegacySimulcast({offerMediaObject:n,track:a,numStreams:s.length}),i={type:"offer",sdp:S.write(r)}),b.debug("send() | calling pc.setLocalDescription() [offer:%o]",i),await this._pc.setLocalDescription(i),r=S.parse(this._pc.localDescription.sdp),n=r.media.find(d=>d.type===a.kind),o.rtcp.cname=v.getCname({offerMediaObject:n}),o.encodings=_.getRtpEncodings({offerMediaObject:n,track:a}),s)for(let d=0;d<o.encodings.length;++d)s[d]&&Object.assign(o.encodings[d],s[d]);if(o.encodings.length>1&&o.codecs[0].mimeType.toLowerCase()==="video/vp8")for(const d of o.encodings)d.scalabilityMode="L1T3";this._remoteSdp.send({offerMediaObject:n,offerRtpParameters:o,answerRtpParameters:p,codecOptions:e});const l={type:"answer",sdp:this._remoteSdp.getSdp()};b.debug("send() | calling pc.setRemoteDescription() [answer:%o]",l),await this._pc.setRemoteDescription(l);const w=String(this._nextSendLocalId);return this._nextSendLocalId++,this._mapSendLocalIdTrack.set(w,a),{localId:w,rtpParameters:o}}async stopSending(a){this.assertSendDirection(),b.debug("stopSending() [localId:%s]",a);const s=this._mapSendLocalIdTrack.get(a);if(!s)throw new Error("track not found");this._mapSendLocalIdTrack.delete(a),this._sendStream.removeTrack(s),this._pc.addStream(this._sendStream);const e=await this._pc.createOffer();b.debug("stopSending() | calling pc.setLocalDescription() [offer:%o]",e);try{await this._pc.setLocalDescription(e)}catch(i){if(this._sendStream.getTracks().length===0){b.warn("stopSending() | ignoring expected error due no sending tracks: %s",i.toString());return}throw i}if(this._pc.signalingState==="stable")return;const t={type:"answer",sdp:this._remoteSdp.getSdp()};b.debug("stopSending() | calling pc.setRemoteDescription() [answer:%o]",t),await this._pc.setRemoteDescription(t)}async pauseSending(a){}async resumeSending(a){}async replaceTrack(a,s){throw new R.UnsupportedError("not implemented")}async setMaxSpatialLayer(a,s){throw new R.UnsupportedError(" not implemented")}async setRtpEncodingParameters(a,s){throw new R.UnsupportedError("not supported")}async getSenderStats(a){throw new R.UnsupportedError("not implemented")}async sendDataChannel({ordered:a,maxPacketLifeTime:s,maxRetransmits:e,label:t,protocol:i}){this.assertSendDirection();const r={negotiated:!0,id:this._nextSendSctpStreamId,ordered:a,maxPacketLifeTime:s,maxRetransmitTime:s,maxRetransmits:e,protocol:i};b.debug("sendDataChannel() [options:%o]",r);const n=this._pc.createDataChannel(t,r);if(this._nextSendSctpStreamId=++this._nextSendSctpStreamId%c.MIS,!this._hasDataChannelMediaSection){const p=await this._pc.createOffer(),l=S.parse(p.sdp),w=l.media.find(P=>P.type==="application");this._transportReady||await this.setupTransport({localDtlsRole:this._forcedLocalDtlsRole??"client",localSdpObject:l}),b.debug("sendDataChannel() | calling pc.setLocalDescription() [offer:%o]",p),await this._pc.setLocalDescription(p),this._remoteSdp.sendSctpAssociation({offerMediaObject:w});const d={type:"answer",sdp:this._remoteSdp.getSdp()};b.debug("sendDataChannel() | calling pc.setRemoteDescription() [answer:%o]",d),await this._pc.setRemoteDescription(d),this._hasDataChannelMediaSection=!0}const o={streamId:r.id,ordered:r.ordered,maxPacketLifeTime:r.maxPacketLifeTime,maxRetransmits:r.maxRetransmits};return{dataChannel:n,sctpStreamParameters:o}}async receive(a){this.assertRecvDirection();const s=[];for(const r of a){const{trackId:n,kind:o,rtpParameters:p,streamId:l}=r;b.debug("receive() [trackId:%s, kind:%s]",n,o);const w=o;this._remoteSdp.receive({mid:w,kind:o,offerRtpParameters:p,streamId:l??p.rtcp.cname,trackId:n})}const e={type:"offer",sdp:this._remoteSdp.getSdp()};b.debug("receive() | calling pc.setRemoteDescription() [offer:%o]",e),await this._pc.setRemoteDescription(e);let t=await this._pc.createAnswer();const i=S.parse(t.sdp);for(const r of a){const{kind:n,rtpParameters:o}=r,p=n,l=i.media.find(w=>String(w.mid)===p);v.applyCodecParameters({offerRtpParameters:o,answerMediaObject:l})}t={type:"answer",sdp:S.write(i)},this._transportReady||await this.setupTransport({localDtlsRole:this._forcedLocalDtlsRole??"client",localSdpObject:i}),b.debug("receive() | calling pc.setLocalDescription() [answer:%o]",t),await this._pc.setLocalDescription(t);for(const r of a){const{kind:n,trackId:o,rtpParameters:p}=r,l=n,w=o,d=r.streamId??p.rtcp.cname,k=this._pc.getRemoteStreams().find(x=>x.id===d).getTrackById(w);if(!k)throw new Error("remote track not found");this._mapRecvLocalIdInfo.set(w,{mid:l,rtpParameters:p}),s.push({localId:w,track:k})}return s}async stopReceiving(a){this.assertRecvDirection();for(const t of a){b.debug("stopReceiving() [localId:%s]",t);const{mid:i,rtpParameters:r}=this._mapRecvLocalIdInfo.get(t)??{};this._mapRecvLocalIdInfo.delete(t),this._remoteSdp.planBStopReceiving({mid:i,offerRtpParameters:r})}const s={type:"offer",sdp:this._remoteSdp.getSdp()};b.debug("stopReceiving() | calling pc.setRemoteDescription() [offer:%o]",s),await this._pc.setRemoteDescription(s);const e=await this._pc.createAnswer();b.debug("stopReceiving() | calling pc.setLocalDescription() [answer:%o]",e),await this._pc.setLocalDescription(e)}async pauseReceiving(a){}async resumeReceiving(a){}async getReceiverStats(a){throw new R.UnsupportedError("not implemented")}async receiveDataChannel({sctpStreamParameters:a,label:s,protocol:e}){this.assertRecvDirection();const{streamId:t,ordered:i,maxPacketLifeTime:r,maxRetransmits:n}=a,o={negotiated:!0,id:t,ordered:i,maxPacketLifeTime:r,maxRetransmitTime:r,maxRetransmits:n,protocol:e};b.debug("receiveDataChannel() [options:%o]",o);const p=this._pc.createDataChannel(s,o);if(!this._hasDataChannelMediaSection){this._remoteSdp.receiveSctpAssociation({oldDataChannelSpec:!0});const l={type:"offer",sdp:this._remoteSdp.getSdp()};b.debug("receiveDataChannel() | calling pc.setRemoteDescription() [offer:%o]",l),await this._pc.setRemoteDescription(l);const w=await this._pc.createAnswer();if(!this._transportReady){const d=S.parse(w.sdp);await this.setupTransport({localDtlsRole:this._forcedLocalDtlsRole??"client",localSdpObject:d})}b.debug("receiveDataChannel() | calling pc.setRemoteDescription() [answer:%o]",w),await this._pc.setLocalDescription(w),this._hasDataChannelMediaSection=!0}return{dataChannel:p}}async setupTransport({localDtlsRole:a,localSdpObject:s}){s||(s=S.parse(this._pc.localDescription.sdp));const e=v.extractDtlsParameters({sdpObject:s});e.role=a,this._remoteSdp.updateDtlsRole(a==="client"?"server":"client"),await new Promise((t,i)=>{this.safeEmit("@connect",{dtlsParameters:e},t,i)}),this._transportReady=!0}assertSendDirection(){if(this._direction!=="send")throw new Error('method can just be called for handlers with "send" direction')}assertRecvDirection(){if(this._direction!=="recv")throw new Error('method can just be called for handlers with "recv" direction')}};return ut.Chrome55=f,ut}var ht={},As;function Sn(){if(As)return ht;As=1,Object.defineProperty(ht,"__esModule",{value:!0}),ht.Firefox120=void 0;const S=te(),D=G(),R=Y(),u=Q(),T=X(),v=oe(),_=xe(),g=re(),y=ce(),b=Se(),h=new D.Logger("Firefox120"),c="Firefox120",f={OS:16,MIS:2048};let m=class Ii extends g.HandlerInterface{_closed=!1;_direction;_remoteSdp;_sendingRtpParametersByKind;_sendingRemoteRtpParametersByKind;_pc;_mapMidTransceiver=new Map;_sendStream=new MediaStream;_hasDataChannelMediaSection=!1;_nextSendSctpStreamId=0;_transportReady=!1;static createFactory(){return()=>new Ii}constructor(){super()}get name(){return c}close(){if(h.debug("close()"),!this._closed){if(this._closed=!0,this._pc)try{this._pc.close()}catch{}this.emit("@close")}}async getNativeRtpCapabilities(){h.debug("getNativeRtpCapabilities()");const s=new RTCPeerConnection({iceServers:[],iceTransportPolicy:"all",bundlePolicy:"max-bundle",rtcpMuxPolicy:"require"}),e=document.createElement("canvas");e.getContext("2d");const i=e.captureStream().getVideoTracks()[0];try{s.addTransceiver("audio",{direction:"sendrecv"}),s.addTransceiver(i,{direction:"sendrecv",sendEncodings:[{rid:"r0",maxBitrate:1e5},{rid:"r1",maxBitrate:5e5}]});const r=await s.createOffer();try{e.remove()}catch{}try{i.stop()}catch{}try{s.close()}catch{}const n=S.parse(r.sdp);return v.extractRtpCapabilities({sdpObject:n})}catch(r){try{e.remove()}catch{}try{i.stop()}catch{}try{s.close()}catch{}throw r}}async getNativeSctpCapabilities(){return h.debug("getNativeSctpCapabilities()"),{numStreams:f}}run({direction:s,iceParameters:e,iceCandidates:t,dtlsParameters:i,sctpParameters:r,iceServers:n,iceTransportPolicy:o,additionalSettings:p,proprietaryConstraints:l,extendedRtpCapabilities:w}){this.assertNotClosed(),h.debug("run()"),this._direction=s,this._remoteSdp=new y.RemoteSdp({iceParameters:e,iceCandidates:t,dtlsParameters:i,sctpParameters:r}),this._sendingRtpParametersByKind={audio:T.getSendingRtpParameters("audio",w),video:T.getSendingRtpParameters("video",w)},this._sendingRemoteRtpParametersByKind={audio:T.getSendingRemoteRtpParameters("audio",w),video:T.getSendingRemoteRtpParameters("video",w)},this._pc=new RTCPeerConnection({iceServers:n??[],iceTransportPolicy:o??"all",bundlePolicy:"max-bundle",rtcpMuxPolicy:"require",...p},l),this._pc.addEventListener("icegatheringstatechange",()=>{this.emit("@icegatheringstatechange",this._pc.iceGatheringState)}),this._pc.addEventListener("icecandidateerror",d=>{this.emit("@icecandidateerror",d)}),this._pc.connectionState?this._pc.addEventListener("connectionstatechange",()=>{this.emit("@connectionstatechange",this._pc.connectionState)}):this._pc.addEventListener("iceconnectionstatechange",()=>{switch(h.warn("run() | pc.connectionState not supported, using pc.iceConnectionState"),this._pc.iceConnectionState){case"checking":{this.emit("@connectionstatechange","connecting");break}case"connected":case"completed":{this.emit("@connectionstatechange","connected");break}case"failed":{this.emit("@connectionstatechange","failed");break}case"disconnected":{this.emit("@connectionstatechange","disconnected");break}case"closed":{this.emit("@connectionstatechange","closed");break}}})}async updateIceServers(s){throw this.assertNotClosed(),new R.UnsupportedError("not supported")}async restartIce(s){if(this.assertNotClosed(),h.debug("restartIce()"),this._remoteSdp.updateIceParameters(s),!!this._transportReady)if(this._direction==="send"){const e=await this._pc.createOffer({iceRestart:!0});h.debug("restartIce() | calling pc.setLocalDescription() [offer:%o]",e),await this._pc.setLocalDescription(e);const t={type:"answer",sdp:this._remoteSdp.getSdp()};h.debug("restartIce() | calling pc.setRemoteDescription() [answer:%o]",t),await this._pc.setRemoteDescription(t)}else{const e={type:"offer",sdp:this._remoteSdp.getSdp()};h.debug("restartIce() | calling pc.setRemoteDescription() [offer:%o]",e),await this._pc.setRemoteDescription(e);const t=await this._pc.createAnswer();h.debug("restartIce() | calling pc.setLocalDescription() [answer:%o]",t),await this._pc.setLocalDescription(t)}}async getTransportStats(){return this.assertNotClosed(),this._pc.getStats()}async send({track:s,encodings:e,codecOptions:t,codec:i,onRtpSender:r}){this.assertNotClosed(),this.assertSendDirection(),h.debug("send() [kind:%s, track.id:%s]",s.kind,s.id),e&&e.length>1&&e.forEach((C,E)=>{C.rid=`r${E}`});const n=u.clone(this._sendingRtpParametersByKind[s.kind]);n.codecs=T.reduceCodecs(n.codecs,i);const o=u.clone(this._sendingRemoteRtpParametersByKind[s.kind]);o.codecs=T.reduceCodecs(o.codecs,i);const p=this._pc.addTransceiver(s,{direction:"sendonly",streams:[this._sendStream],sendEncodings:e});r&&r(p.sender);const l=await this._pc.createOffer();let w=S.parse(l.sdp);w.extmapAllowMixed&&this._remoteSdp.setSessionExtmapAllowMixed(),this._transportReady||await this.setupTransport({localDtlsRole:"client",localSdpObject:w});const d=(0,b.parse)((e??[{}])[0].scalabilityMode);h.debug("send() | calling pc.setLocalDescription() [offer:%o]",l),await this._pc.setLocalDescription(l);const P=p.mid;n.mid=P,w=S.parse(this._pc.localDescription.sdp);const k=w.media[w.media.length-1];if(n.rtcp.cname=v.getCname({offerMediaObject:k}),!e)n.encodings=_.getRtpEncodings({offerMediaObject:k});else if(e.length===1){const C=_.getRtpEncodings({offerMediaObject:k});Object.assign(C[0],e[0]),n.encodings=C}else n.encodings=e;if(n.encodings.length>1&&(n.codecs[0].mimeType.toLowerCase()==="video/vp8"||n.codecs[0].mimeType.toLowerCase()==="video/h264"))for(const C of n.encodings)C.scalabilityMode?C.scalabilityMode=`L1T${d.temporalLayers}`:C.scalabilityMode="L1T3";this._remoteSdp.send({offerMediaObject:k,offerRtpParameters:n,answerRtpParameters:o,codecOptions:t});const x={type:"answer",sdp:this._remoteSdp.getSdp()};return h.debug("send() | calling pc.setRemoteDescription() [answer:%o]",x),await this._pc.setRemoteDescription(x),this._mapMidTransceiver.set(P,p),{localId:P,rtpParameters:n,rtpSender:p.sender}}async stopSending(s){if(this.assertSendDirection(),h.debug("stopSending() [localId:%s]",s),this._closed)return;const e=this._mapMidTransceiver.get(s);if(!e)throw new Error("associated transceiver not found");e.sender.replaceTrack(null),this._pc.removeTrack(e.sender),this._remoteSdp.disableMediaSection(e.mid);const t=await this._pc.createOffer();h.debug("stopSending() | calling pc.setLocalDescription() [offer:%o]",t),await this._pc.setLocalDescription(t);const i={type:"answer",sdp:this._remoteSdp.getSdp()};h.debug("stopSending() | calling pc.setRemoteDescription() [answer:%o]",i),await this._pc.setRemoteDescription(i),this._mapMidTransceiver.delete(s)}async pauseSending(s){this.assertNotClosed(),this.assertSendDirection(),h.debug("pauseSending() [localId:%s]",s);const e=this._mapMidTransceiver.get(s);if(!e)throw new Error("associated RTCRtpTransceiver not found");e.direction="inactive",this._remoteSdp.pauseMediaSection(s);const t=await this._pc.createOffer();h.debug("pauseSending() | calling pc.setLocalDescription() [offer:%o]",t),await this._pc.setLocalDescription(t);const i={type:"answer",sdp:this._remoteSdp.getSdp()};h.debug("pauseSending() | calling pc.setRemoteDescription() [answer:%o]",i),await this._pc.setRemoteDescription(i)}async resumeSending(s){this.assertNotClosed(),this.assertSendDirection(),h.debug("resumeSending() [localId:%s]",s);const e=this._mapMidTransceiver.get(s);if(!e)throw new Error("associated RTCRtpTransceiver not found");e.direction="sendonly",this._remoteSdp.resumeSendingMediaSection(s);const t=await this._pc.createOffer();h.debug("resumeSending() | calling pc.setLocalDescription() [offer:%o]",t),await this._pc.setLocalDescription(t);const i={type:"answer",sdp:this._remoteSdp.getSdp()};h.debug("resumeSending() | calling pc.setRemoteDescription() [answer:%o]",i),await this._pc.setRemoteDescription(i)}async replaceTrack(s,e){this.assertNotClosed(),this.assertSendDirection(),e?h.debug("replaceTrack() [localId:%s, track.id:%s]",s,e.id):h.debug("replaceTrack() [localId:%s, no track]",s);const t=this._mapMidTransceiver.get(s);if(!t)throw new Error("associated RTCRtpTransceiver not found");await t.sender.replaceTrack(e)}async setMaxSpatialLayer(s,e){this.assertNotClosed(),this.assertSendDirection(),h.debug("setMaxSpatialLayer() [localId:%s, spatialLayer:%s]",s,e);const t=this._mapMidTransceiver.get(s);if(!t)throw new Error("associated transceiver not found");const i=t.sender.getParameters();i.encodings.forEach((o,p)=>{p<=e?o.active=!0:o.active=!1}),await t.sender.setParameters(i),this._remoteSdp.muxMediaSectionSimulcast(s,i.encodings);const r=await this._pc.createOffer();h.debug("setMaxSpatialLayer() | calling pc.setLocalDescription() [offer:%o]",r),await this._pc.setLocalDescription(r);const n={type:"answer",sdp:this._remoteSdp.getSdp()};h.debug("setMaxSpatialLayer() | calling pc.setRemoteDescription() [answer:%o]",n),await this._pc.setRemoteDescription(n)}async setRtpEncodingParameters(s,e){this.assertNotClosed(),this.assertSendDirection(),h.debug("setRtpEncodingParameters() [localId:%s, params:%o]",s,e);const t=this._mapMidTransceiver.get(s);if(!t)throw new Error("associated RTCRtpTransceiver not found");const i=t.sender.getParameters();i.encodings.forEach((o,p)=>{i.encodings[p]={...o,...e}}),await t.sender.setParameters(i),this._remoteSdp.muxMediaSectionSimulcast(s,i.encodings);const r=await this._pc.createOffer();h.debug("setRtpEncodingParameters() | calling pc.setLocalDescription() [offer:%o]",r),await this._pc.setLocalDescription(r);const n={type:"answer",sdp:this._remoteSdp.getSdp()};h.debug("setRtpEncodingParameters() | calling pc.setRemoteDescription() [answer:%o]",n),await this._pc.setRemoteDescription(n)}async getSenderStats(s){this.assertNotClosed(),this.assertSendDirection();const e=this._mapMidTransceiver.get(s);if(!e)throw new Error("associated RTCRtpTransceiver not found");return e.sender.getStats()}async sendDataChannel({ordered:s,maxPacketLifeTime:e,maxRetransmits:t,label:i,protocol:r}){this.assertNotClosed(),this.assertSendDirection();const n={negotiated:!0,id:this._nextSendSctpStreamId,ordered:s,maxPacketLifeTime:e,maxRetransmits:t,protocol:r};h.debug("sendDataChannel() [options:%o]",n);const o=this._pc.createDataChannel(i,n);if(this._nextSendSctpStreamId=++this._nextSendSctpStreamId%f.MIS,!this._hasDataChannelMediaSection){const l=await this._pc.createOffer(),w=S.parse(l.sdp),d=w.media.find(k=>k.type==="application");this._transportReady||await this.setupTransport({localDtlsRole:"client",localSdpObject:w}),h.debug("sendDataChannel() | calling pc.setLocalDescription() [offer:%o]",l),await this._pc.setLocalDescription(l),this._remoteSdp.sendSctpAssociation({offerMediaObject:d});const P={type:"answer",sdp:this._remoteSdp.getSdp()};h.debug("sendDataChannel() | calling pc.setRemoteDescription() [answer:%o]",P),await this._pc.setRemoteDescription(P),this._hasDataChannelMediaSection=!0}const p={streamId:n.id,ordered:n.ordered,maxPacketLifeTime:n.maxPacketLifeTime,maxRetransmits:n.maxRetransmits};return{dataChannel:o,sctpStreamParameters:p}}async receive(s){this.assertNotClosed(),this.assertRecvDirection();const e=[],t=new Map;for(const o of s){const{trackId:p,kind:l,rtpParameters:w,streamId:d}=o;h.debug("receive() [trackId:%s, kind:%s]",p,l);const P=w.mid??String(this._mapMidTransceiver.size);t.set(p,P),this._remoteSdp.receive({mid:P,kind:l,offerRtpParameters:w,streamId:d??w.rtcp.cname,trackId:p})}const i={type:"offer",sdp:this._remoteSdp.getSdp()};h.debug("receive() | calling pc.setRemoteDescription() [offer:%o]",i),await this._pc.setRemoteDescription(i);for(const o of s){const{trackId:p,onRtpReceiver:l}=o;if(l){const w=t.get(p),d=this._pc.getTransceivers().find(P=>P.mid===w);if(!d)throw new Error("transceiver not found");l(d.receiver)}}let r=await this._pc.createAnswer();const n=S.parse(r.sdp);for(const o of s){const{trackId:p,rtpParameters:l}=o,w=t.get(p),d=n.media.find(P=>String(P.mid)===w);v.applyCodecParameters({offerRtpParameters:l,answerMediaObject:d}),r={type:"answer",sdp:S.write(n)}}this._transportReady||await this.setupTransport({localDtlsRole:"client",localSdpObject:n}),h.debug("receive() | calling pc.setLocalDescription() [answer:%o]",r),await this._pc.setLocalDescription(r);for(const o of s){const{trackId:p}=o,l=t.get(p),w=this._pc.getTransceivers().find(d=>d.mid===l);if(!w)throw new Error("new RTCRtpTransceiver not found");this._mapMidTransceiver.set(l,w),e.push({localId:l,track:w.receiver.track,rtpReceiver:w.receiver})}return e}async stopReceiving(s){if(this.assertRecvDirection(),this._closed)return;for(const i of s){h.debug("stopReceiving() [localId:%s]",i);const r=this._mapMidTransceiver.get(i);if(!r)throw new Error("associated RTCRtpTransceiver not found");this._remoteSdp.closeMediaSection(r.mid)}const e={type:"offer",sdp:this._remoteSdp.getSdp()};h.debug("stopReceiving() | calling pc.setRemoteDescription() [offer:%o]",e),await this._pc.setRemoteDescription(e);const t=await this._pc.createAnswer();h.debug("stopReceiving() | calling pc.setLocalDescription() [answer:%o]",t),await this._pc.setLocalDescription(t);for(const i of s)this._mapMidTransceiver.delete(i)}async pauseReceiving(s){this.assertNotClosed(),this.assertRecvDirection();for(const i of s){h.debug("pauseReceiving() [localId:%s]",i);const r=this._mapMidTransceiver.get(i);if(!r)throw new Error("associated RTCRtpTransceiver not found");r.direction="inactive",this._remoteSdp.pauseMediaSection(i)}const e={type:"offer",sdp:this._remoteSdp.getSdp()};h.debug("pauseReceiving() | calling pc.setRemoteDescription() [offer:%o]",e),await this._pc.setRemoteDescription(e);const t=await this._pc.createAnswer();h.debug("pauseReceiving() | calling pc.setLocalDescription() [answer:%o]",t),await this._pc.setLocalDescription(t)}async resumeReceiving(s){this.assertNotClosed(),this.assertRecvDirection();for(const i of s){h.debug("resumeReceiving() [localId:%s]",i);const r=this._mapMidTransceiver.get(i);if(!r)throw new Error("associated RTCRtpTransceiver not found");r.direction="recvonly",this._remoteSdp.resumeReceivingMediaSection(i)}const e={type:"offer",sdp:this._remoteSdp.getSdp()};h.debug("resumeReceiving() | calling pc.setRemoteDescription() [offer:%o]",e),await this._pc.setRemoteDescription(e);const t=await this._pc.createAnswer();h.debug("resumeReceiving() | calling pc.setLocalDescription() [answer:%o]",t),await this._pc.setLocalDescription(t)}async getReceiverStats(s){this.assertRecvDirection();const e=this._mapMidTransceiver.get(s);if(!e)throw new Error("associated RTCRtpTransceiver not found");return e.receiver.getStats()}async receiveDataChannel({sctpStreamParameters:s,label:e,protocol:t}){this.assertNotClosed(),this.assertRecvDirection();const{streamId:i,ordered:r,maxPacketLifeTime:n,maxRetransmits:o}=s,p={negotiated:!0,id:i,ordered:r,maxPacketLifeTime:n,maxRetransmits:o,protocol:t};h.debug("receiveDataChannel() [options:%o]",p);const l=this._pc.createDataChannel(e,p);if(!this._hasDataChannelMediaSection){this._remoteSdp.receiveSctpAssociation();const w={type:"offer",sdp:this._remoteSdp.getSdp()};h.debug("receiveDataChannel() | calling pc.setRemoteDescription() [offer:%o]",w),await this._pc.setRemoteDescription(w);const d=await this._pc.createAnswer();if(!this._transportReady){const P=S.parse(d.sdp);await this.setupTransport({localDtlsRole:"client",localSdpObject:P})}h.debug("receiveDataChannel() | calling pc.setRemoteDescription() [answer:%o]",d),await this._pc.setLocalDescription(d),this._hasDataChannelMediaSection=!0}return{dataChannel:l}}async setupTransport({localDtlsRole:s,localSdpObject:e}){e||(e=S.parse(this._pc.localDescription.sdp));const t=v.extractDtlsParameters({sdpObject:e});t.role=s,this._remoteSdp.updateDtlsRole(s==="client"?"server":"client"),await new Promise((i,r)=>{this.safeEmit("@connect",{dtlsParameters:t},i,r)}),this._transportReady=!0}assertNotClosed(){if(this._closed)throw new R.InvalidStateError("method called in a closed handler")}assertSendDirection(){if(this._direction!=="send")throw new Error('method can just be called for handlers with "send" direction')}assertRecvDirection(){if(this._direction!=="recv")throw new Error('method can just be called for handlers with "recv" direction')}};return ht.Firefox120=m,ht}var ft={},Ns;function bn(){if(Ns)return ft;Ns=1,Object.defineProperty(ft,"__esModule",{value:!0}),ft.Firefox60=void 0;const S=te(),D=G(),R=Y(),u=Q(),T=X(),v=oe(),_=xe(),g=re(),y=ce(),b=Se(),h=new D.Logger("Firefox60"),c="Firefox60",f={OS:16,MIS:2048};let m=class Mi extends g.HandlerInterface{_closed=!1;_direction;_remoteSdp;_sendingRtpParametersByKind;_sendingRemoteRtpParametersByKind;_pc;_mapMidTransceiver=new Map;_sendStream=new MediaStream;_hasDataChannelMediaSection=!1;_nextSendSctpStreamId=0;_transportReady=!1;static createFactory(){return()=>new Mi}constructor(){super()}get name(){return c}close(){if(h.debug("close()"),!this._closed){if(this._closed=!0,this._pc)try{this._pc.close()}catch{}this.emit("@close")}}async getNativeRtpCapabilities(){h.debug("getNativeRtpCapabilities()");const s=new RTCPeerConnection({iceServers:[],iceTransportPolicy:"all",bundlePolicy:"max-bundle",rtcpMuxPolicy:"require"}),e=document.createElement("canvas");e.getContext("2d");const i=e.captureStream().getVideoTracks()[0];try{s.addTransceiver("audio",{direction:"sendrecv"});const r=s.addTransceiver(i,{direction:"sendrecv"}),n=r.sender.getParameters(),o=[{rid:"r0",maxBitrate:1e5},{rid:"r1",maxBitrate:5e5}];n.encodings=o,await r.sender.setParameters(n);const p=await s.createOffer();try{e.remove()}catch{}try{i.stop()}catch{}try{s.close()}catch{}const l=S.parse(p.sdp);return v.extractRtpCapabilities({sdpObject:l})}catch(r){try{e.remove()}catch{}try{i.stop()}catch{}try{s.close()}catch{}throw r}}async getNativeSctpCapabilities(){return h.debug("getNativeSctpCapabilities()"),{numStreams:f}}run({direction:s,iceParameters:e,iceCandidates:t,dtlsParameters:i,sctpParameters:r,iceServers:n,iceTransportPolicy:o,additionalSettings:p,proprietaryConstraints:l,extendedRtpCapabilities:w}){this.assertNotClosed(),h.debug("run()"),this._direction=s,this._remoteSdp=new y.RemoteSdp({iceParameters:e,iceCandidates:t,dtlsParameters:i,sctpParameters:r}),this._sendingRtpParametersByKind={audio:T.getSendingRtpParameters("audio",w),video:T.getSendingRtpParameters("video",w)},this._sendingRemoteRtpParametersByKind={audio:T.getSendingRemoteRtpParameters("audio",w),video:T.getSendingRemoteRtpParameters("video",w)},this._pc=new RTCPeerConnection({iceServers:n??[],iceTransportPolicy:o??"all",bundlePolicy:"max-bundle",rtcpMuxPolicy:"require",...p},l),this._pc.addEventListener("icegatheringstatechange",()=>{this.emit("@icegatheringstatechange",this._pc.iceGatheringState)}),this._pc.addEventListener("icecandidateerror",d=>{this.emit("@icecandidateerror",d)}),this._pc.connectionState?this._pc.addEventListener("connectionstatechange",()=>{this.emit("@connectionstatechange",this._pc.connectionState)}):this._pc.addEventListener("iceconnectionstatechange",()=>{switch(h.warn("run() | pc.connectionState not supported, using pc.iceConnectionState"),this._pc.iceConnectionState){case"checking":{this.emit("@connectionstatechange","connecting");break}case"connected":case"completed":{this.emit("@connectionstatechange","connected");break}case"failed":{this.emit("@connectionstatechange","failed");break}case"disconnected":{this.emit("@connectionstatechange","disconnected");break}case"closed":{this.emit("@connectionstatechange","closed");break}}})}async updateIceServers(s){throw this.assertNotClosed(),new R.UnsupportedError("not supported")}async restartIce(s){if(this.assertNotClosed(),h.debug("restartIce()"),this._remoteSdp.updateIceParameters(s),!!this._transportReady)if(this._direction==="send"){const e=await this._pc.createOffer({iceRestart:!0});h.debug("restartIce() | calling pc.setLocalDescription() [offer:%o]",e),await this._pc.setLocalDescription(e);const t={type:"answer",sdp:this._remoteSdp.getSdp()};h.debug("restartIce() | calling pc.setRemoteDescription() [answer:%o]",t),await this._pc.setRemoteDescription(t)}else{const e={type:"offer",sdp:this._remoteSdp.getSdp()};h.debug("restartIce() | calling pc.setRemoteDescription() [offer:%o]",e),await this._pc.setRemoteDescription(e);const t=await this._pc.createAnswer();h.debug("restartIce() | calling pc.setLocalDescription() [answer:%o]",t),await this._pc.setLocalDescription(t)}}async getTransportStats(){return this.assertNotClosed(),this._pc.getStats()}async send({track:s,encodings:e,codecOptions:t,codec:i}){this.assertNotClosed(),this.assertSendDirection(),h.debug("send() [kind:%s, track.id:%s]",s.kind,s.id),e&&(e=u.clone(e),e.forEach((x,C)=>{x.rid=`r${C}`}),e.reverse());const r=u.clone(this._sendingRtpParametersByKind[s.kind]);r.codecs=T.reduceCodecs(r.codecs,i);const n=u.clone(this._sendingRemoteRtpParametersByKind[s.kind]);n.codecs=T.reduceCodecs(n.codecs,i);const o=this._pc.addTransceiver(s,{direction:"sendonly",streams:[this._sendStream]});if(e){const x=o.sender.getParameters();x.encodings=e,await o.sender.setParameters(x)}const p=await this._pc.createOffer();let l=S.parse(p.sdp);l.extmapAllowMixed&&this._remoteSdp.setSessionExtmapAllowMixed(),this._transportReady||await this.setupTransport({localDtlsRole:"client",localSdpObject:l});const w=(0,b.parse)((e??[{}])[0].scalabilityMode);h.debug("send() | calling pc.setLocalDescription() [offer:%o]",p),await this._pc.setLocalDescription(p);const d=o.mid;r.mid=d,l=S.parse(this._pc.localDescription.sdp);const P=l.media[l.media.length-1];if(r.rtcp.cname=v.getCname({offerMediaObject:P}),!e)r.encodings=_.getRtpEncodings({offerMediaObject:P});else if(e.length===1){const x=_.getRtpEncodings({offerMediaObject:P});Object.assign(x[0],e[0]),r.encodings=x}else r.encodings=e.reverse();if(r.encodings.length>1&&(r.codecs[0].mimeType.toLowerCase()==="video/vp8"||r.codecs[0].mimeType.toLowerCase()==="video/h264"))for(const x of r.encodings)x.scalabilityMode?x.scalabilityMode=`L1T${w.temporalLayers}`:x.scalabilityMode="L1T3";this._remoteSdp.send({offerMediaObject:P,offerRtpParameters:r,answerRtpParameters:n,codecOptions:t});const k={type:"answer",sdp:this._remoteSdp.getSdp()};return h.debug("send() | calling pc.setRemoteDescription() [answer:%o]",k),await this._pc.setRemoteDescription(k),this._mapMidTransceiver.set(d,o),{localId:d,rtpParameters:r,rtpSender:o.sender}}async stopSending(s){if(this.assertSendDirection(),h.debug("stopSending() [localId:%s]",s),this._closed)return;const e=this._mapMidTransceiver.get(s);if(!e)throw new Error("associated transceiver not found");e.sender.replaceTrack(null),this._pc.removeTrack(e.sender),this._remoteSdp.disableMediaSection(e.mid);const t=await this._pc.createOffer();h.debug("stopSending() | calling pc.setLocalDescription() [offer:%o]",t),await this._pc.setLocalDescription(t);const i={type:"answer",sdp:this._remoteSdp.getSdp()};h.debug("stopSending() | calling pc.setRemoteDescription() [answer:%o]",i),await this._pc.setRemoteDescription(i),this._mapMidTransceiver.delete(s)}async pauseSending(s){this.assertNotClosed(),this.assertSendDirection(),h.debug("pauseSending() [localId:%s]",s);const e=this._mapMidTransceiver.get(s);if(!e)throw new Error("associated RTCRtpTransceiver not found");e.direction="inactive",this._remoteSdp.pauseMediaSection(s);const t=await this._pc.createOffer();h.debug("pauseSending() | calling pc.setLocalDescription() [offer:%o]",t),await this._pc.setLocalDescription(t);const i={type:"answer",sdp:this._remoteSdp.getSdp()};h.debug("pauseSending() | calling pc.setRemoteDescription() [answer:%o]",i),await this._pc.setRemoteDescription(i)}async resumeSending(s){this.assertNotClosed(),this.assertSendDirection(),h.debug("resumeSending() [localId:%s]",s);const e=this._mapMidTransceiver.get(s);if(!e)throw new Error("associated RTCRtpTransceiver not found");e.direction="sendonly",this._remoteSdp.resumeSendingMediaSection(s);const t=await this._pc.createOffer();h.debug("resumeSending() | calling pc.setLocalDescription() [offer:%o]",t),await this._pc.setLocalDescription(t);const i={type:"answer",sdp:this._remoteSdp.getSdp()};h.debug("resumeSending() | calling pc.setRemoteDescription() [answer:%o]",i),await this._pc.setRemoteDescription(i)}async replaceTrack(s,e){this.assertNotClosed(),this.assertSendDirection(),e?h.debug("replaceTrack() [localId:%s, track.id:%s]",s,e.id):h.debug("replaceTrack() [localId:%s, no track]",s);const t=this._mapMidTransceiver.get(s);if(!t)throw new Error("associated RTCRtpTransceiver not found");await t.sender.replaceTrack(e)}async setMaxSpatialLayer(s,e){this.assertNotClosed(),this.assertSendDirection(),h.debug("setMaxSpatialLayer() [localId:%s, spatialLayer:%s]",s,e);const t=this._mapMidTransceiver.get(s);if(!t)throw new Error("associated transceiver not found");const i=t.sender.getParameters();e=i.encodings.length-1-e,i.encodings.forEach((o,p)=>{p>=e?o.active=!0:o.active=!1}),await t.sender.setParameters(i),this._remoteSdp.muxMediaSectionSimulcast(s,i.encodings);const r=await this._pc.createOffer();h.debug("setMaxSpatialLayer() | calling pc.setLocalDescription() [offer:%o]",r),await this._pc.setLocalDescription(r);const n={type:"answer",sdp:this._remoteSdp.getSdp()};h.debug("setMaxSpatialLayer() | calling pc.setRemoteDescription() [answer:%o]",n),await this._pc.setRemoteDescription(n)}async setRtpEncodingParameters(s,e){this.assertNotClosed(),this.assertSendDirection(),h.debug("setRtpEncodingParameters() [localId:%s, params:%o]",s,e);const t=this._mapMidTransceiver.get(s);if(!t)throw new Error("associated RTCRtpTransceiver not found");const i=t.sender.getParameters();i.encodings.forEach((o,p)=>{i.encodings[p]={...o,...e}}),await t.sender.setParameters(i),this._remoteSdp.muxMediaSectionSimulcast(s,i.encodings);const r=await this._pc.createOffer();h.debug("setRtpEncodingParameters() | calling pc.setLocalDescription() [offer:%o]",r),await this._pc.setLocalDescription(r);const n={type:"answer",sdp:this._remoteSdp.getSdp()};h.debug("setRtpEncodingParameters() | calling pc.setRemoteDescription() [answer:%o]",n),await this._pc.setRemoteDescription(n)}async getSenderStats(s){this.assertNotClosed(),this.assertSendDirection();const e=this._mapMidTransceiver.get(s);if(!e)throw new Error("associated RTCRtpTransceiver not found");return e.sender.getStats()}async sendDataChannel({ordered:s,maxPacketLifeTime:e,maxRetransmits:t,label:i,protocol:r}){this.assertNotClosed(),this.assertSendDirection();const n={negotiated:!0,id:this._nextSendSctpStreamId,ordered:s,maxPacketLifeTime:e,maxRetransmits:t,protocol:r};h.debug("sendDataChannel() [options:%o]",n);const o=this._pc.createDataChannel(i,n);if(this._nextSendSctpStreamId=++this._nextSendSctpStreamId%f.MIS,!this._hasDataChannelMediaSection){const l=await this._pc.createOffer(),w=S.parse(l.sdp),d=w.media.find(k=>k.type==="application");this._transportReady||await this.setupTransport({localDtlsRole:"client",localSdpObject:w}),h.debug("sendDataChannel() | calling pc.setLocalDescription() [offer:%o]",l),await this._pc.setLocalDescription(l),this._remoteSdp.sendSctpAssociation({offerMediaObject:d});const P={type:"answer",sdp:this._remoteSdp.getSdp()};h.debug("sendDataChannel() | calling pc.setRemoteDescription() [answer:%o]",P),await this._pc.setRemoteDescription(P),this._hasDataChannelMediaSection=!0}const p={streamId:n.id,ordered:n.ordered,maxPacketLifeTime:n.maxPacketLifeTime,maxRetransmits:n.maxRetransmits};return{dataChannel:o,sctpStreamParameters:p}}async receive(s){this.assertNotClosed(),this.assertRecvDirection();const e=[],t=new Map;for(const o of s){const{trackId:p,kind:l,rtpParameters:w,streamId:d}=o;h.debug("receive() [trackId:%s, kind:%s]",p,l);const P=w.mid??String(this._mapMidTransceiver.size);t.set(p,P),this._remoteSdp.receive({mid:P,kind:l,offerRtpParameters:w,streamId:d??w.rtcp.cname,trackId:p})}const i={type:"offer",sdp:this._remoteSdp.getSdp()};h.debug("receive() | calling pc.setRemoteDescription() [offer:%o]",i),await this._pc.setRemoteDescription(i);let r=await this._pc.createAnswer();const n=S.parse(r.sdp);for(const o of s){const{trackId:p,rtpParameters:l}=o,w=t.get(p),d=n.media.find(P=>String(P.mid)===w);v.applyCodecParameters({offerRtpParameters:l,answerMediaObject:d}),r={type:"answer",sdp:S.write(n)}}this._transportReady||await this.setupTransport({localDtlsRole:"client",localSdpObject:n}),h.debug("receive() | calling pc.setLocalDescription() [answer:%o]",r),await this._pc.setLocalDescription(r);for(const o of s){const{trackId:p}=o,l=t.get(p),w=this._pc.getTransceivers().find(d=>d.mid===l);if(!w)throw new Error("new RTCRtpTransceiver not found");this._mapMidTransceiver.set(l,w),e.push({localId:l,track:w.receiver.track,rtpReceiver:w.receiver})}return e}async stopReceiving(s){if(this.assertRecvDirection(),this._closed)return;for(const i of s){h.debug("stopReceiving() [localId:%s]",i);const r=this._mapMidTransceiver.get(i);if(!r)throw new Error("associated RTCRtpTransceiver not found");this._remoteSdp.closeMediaSection(r.mid)}const e={type:"offer",sdp:this._remoteSdp.getSdp()};h.debug("stopReceiving() | calling pc.setRemoteDescription() [offer:%o]",e),await this._pc.setRemoteDescription(e);const t=await this._pc.createAnswer();h.debug("stopReceiving() | calling pc.setLocalDescription() [answer:%o]",t),await this._pc.setLocalDescription(t);for(const i of s)this._mapMidTransceiver.delete(i)}async pauseReceiving(s){this.assertNotClosed(),this.assertRecvDirection();for(const i of s){h.debug("pauseReceiving() [localId:%s]",i);const r=this._mapMidTransceiver.get(i);if(!r)throw new Error("associated RTCRtpTransceiver not found");r.direction="inactive",this._remoteSdp.pauseMediaSection(i)}const e={type:"offer",sdp:this._remoteSdp.getSdp()};h.debug("pauseReceiving() | calling pc.setRemoteDescription() [offer:%o]",e),await this._pc.setRemoteDescription(e);const t=await this._pc.createAnswer();h.debug("pauseReceiving() | calling pc.setLocalDescription() [answer:%o]",t),await this._pc.setLocalDescription(t)}async resumeReceiving(s){this.assertNotClosed(),this.assertRecvDirection();for(const i of s){h.debug("resumeReceiving() [localId:%s]",i);const r=this._mapMidTransceiver.get(i);if(!r)throw new Error("associated RTCRtpTransceiver not found");r.direction="recvonly",this._remoteSdp.resumeReceivingMediaSection(i)}const e={type:"offer",sdp:this._remoteSdp.getSdp()};h.debug("resumeReceiving() | calling pc.setRemoteDescription() [offer:%o]",e),await this._pc.setRemoteDescription(e);const t=await this._pc.createAnswer();h.debug("resumeReceiving() | calling pc.setLocalDescription() [answer:%o]",t),await this._pc.setLocalDescription(t)}async getReceiverStats(s){this.assertRecvDirection();const e=this._mapMidTransceiver.get(s);if(!e)throw new Error("associated RTCRtpTransceiver not found");return e.receiver.getStats()}async receiveDataChannel({sctpStreamParameters:s,label:e,protocol:t}){this.assertNotClosed(),this.assertRecvDirection();const{streamId:i,ordered:r,maxPacketLifeTime:n,maxRetransmits:o}=s,p={negotiated:!0,id:i,ordered:r,maxPacketLifeTime:n,maxRetransmits:o,protocol:t};h.debug("receiveDataChannel() [options:%o]",p);const l=this._pc.createDataChannel(e,p);if(!this._hasDataChannelMediaSection){this._remoteSdp.receiveSctpAssociation();const w={type:"offer",sdp:this._remoteSdp.getSdp()};h.debug("receiveDataChannel() | calling pc.setRemoteDescription() [offer:%o]",w),await this._pc.setRemoteDescription(w);const d=await this._pc.createAnswer();if(!this._transportReady){const P=S.parse(d.sdp);await this.setupTransport({localDtlsRole:"client",localSdpObject:P})}h.debug("receiveDataChannel() | calling pc.setRemoteDescription() [answer:%o]",d),await this._pc.setLocalDescription(d),this._hasDataChannelMediaSection=!0}return{dataChannel:l}}async setupTransport({localDtlsRole:s,localSdpObject:e}){e||(e=S.parse(this._pc.localDescription.sdp));const t=v.extractDtlsParameters({sdpObject:e});t.role=s,this._remoteSdp.updateDtlsRole(s==="client"?"server":"client"),await new Promise((i,r)=>{this.safeEmit("@connect",{dtlsParameters:t},i,r)}),this._transportReady=!0}assertNotClosed(){if(this._closed)throw new R.InvalidStateError("method called in a closed handler")}assertSendDirection(){if(this._direction!=="send")throw new Error('method can just be called for handlers with "send" direction')}assertRecvDirection(){if(this._direction!=="recv")throw new Error('method can just be called for handlers with "recv" direction')}};return ft.Firefox60=m,ft}var mt={},Fs;function yn(){if(Fs)return mt;Fs=1,Object.defineProperty(mt,"__esModule",{value:!0}),mt.Safari12=void 0;const S=te(),D=G(),R=Q(),u=X(),T=oe(),v=xe(),_=tr(),g=Y(),y=re(),b=ce(),h=Se(),c=new D.Logger("Safari12"),f="Safari12",m={OS:1024,MIS:1024};let a=class Oi extends y.HandlerInterface{_closed=!1;_direction;_remoteSdp;_sendingRtpParametersByKind;_sendingRemoteRtpParametersByKind;_forcedLocalDtlsRole;_pc;_mapMidTransceiver=new Map;_sendStream=new MediaStream;_hasDataChannelMediaSection=!1;_nextSendSctpStreamId=0;_transportReady=!1;static createFactory(){return()=>new Oi}constructor(){super()}get name(){return f}close(){if(c.debug("close()"),!this._closed){if(this._closed=!0,this._pc)try{this._pc.close()}catch{}this.emit("@close")}}async getNativeRtpCapabilities(){c.debug("getNativeRtpCapabilities()");const e=new RTCPeerConnection({iceServers:[],iceTransportPolicy:"all",bundlePolicy:"max-bundle",rtcpMuxPolicy:"require"});try{e.addTransceiver("audio"),e.addTransceiver("video");const t=await e.createOffer();try{e.close()}catch{}const i=S.parse(t.sdp),r=T.extractRtpCapabilities({sdpObject:i});return _.addNackSupportForOpus(r),r}catch(t){try{e.close()}catch{}throw t}}async getNativeSctpCapabilities(){return c.debug("getNativeSctpCapabilities()"),{numStreams:m}}run({direction:e,iceParameters:t,iceCandidates:i,dtlsParameters:r,sctpParameters:n,iceServers:o,iceTransportPolicy:p,additionalSettings:l,proprietaryConstraints:w,extendedRtpCapabilities:d}){this.assertNotClosed(),c.debug("run()"),this._direction=e,this._remoteSdp=new b.RemoteSdp({iceParameters:t,iceCandidates:i,dtlsParameters:r,sctpParameters:n}),this._sendingRtpParametersByKind={audio:u.getSendingRtpParameters("audio",d),video:u.getSendingRtpParameters("video",d)},this._sendingRemoteRtpParametersByKind={audio:u.getSendingRemoteRtpParameters("audio",d),video:u.getSendingRemoteRtpParameters("video",d)},r.role&&r.role!=="auto"&&(this._forcedLocalDtlsRole=r.role==="server"?"client":"server"),this._pc=new RTCPeerConnection({iceServers:o??[],iceTransportPolicy:p??"all",bundlePolicy:"max-bundle",rtcpMuxPolicy:"require",...l},w),this._pc.addEventListener("icegatheringstatechange",()=>{this.emit("@icegatheringstatechange",this._pc.iceGatheringState)}),this._pc.addEventListener("icecandidateerror",P=>{this.emit("@icecandidateerror",P)}),this._pc.connectionState?this._pc.addEventListener("connectionstatechange",()=>{this.emit("@connectionstatechange",this._pc.connectionState)}):this._pc.addEventListener("iceconnectionstatechange",()=>{switch(c.warn("run() | pc.connectionState not supported, using pc.iceConnectionState"),this._pc.iceConnectionState){case"checking":{this.emit("@connectionstatechange","connecting");break}case"connected":case"completed":{this.emit("@connectionstatechange","connected");break}case"failed":{this.emit("@connectionstatechange","failed");break}case"disconnected":{this.emit("@connectionstatechange","disconnected");break}case"closed":{this.emit("@connectionstatechange","closed");break}}})}async updateIceServers(e){this.assertNotClosed(),c.debug("updateIceServers()");const t=this._pc.getConfiguration();t.iceServers=e,this._pc.setConfiguration(t)}async restartIce(e){if(this.assertNotClosed(),c.debug("restartIce()"),this._remoteSdp.updateIceParameters(e),!!this._transportReady)if(this._direction==="send"){const t=await this._pc.createOffer({iceRestart:!0});c.debug("restartIce() | calling pc.setLocalDescription() [offer:%o]",t),await this._pc.setLocalDescription(t);const i={type:"answer",sdp:this._remoteSdp.getSdp()};c.debug("restartIce() | calling pc.setRemoteDescription() [answer:%o]",i),await this._pc.setRemoteDescription(i)}else{const t={type:"offer",sdp:this._remoteSdp.getSdp()};c.debug("restartIce() | calling pc.setRemoteDescription() [offer:%o]",t),await this._pc.setRemoteDescription(t);const i=await this._pc.createAnswer();c.debug("restartIce() | calling pc.setLocalDescription() [answer:%o]",i),await this._pc.setLocalDescription(i)}}async getTransportStats(){return this.assertNotClosed(),this._pc.getStats()}async send({track:e,encodings:t,codecOptions:i,codec:r,onRtpSender:n}){this.assertNotClosed(),this.assertSendDirection(),c.debug("send() [kind:%s, track.id:%s]",e.kind,e.id);const o=R.clone(this._sendingRtpParametersByKind[e.kind]);o.codecs=u.reduceCodecs(o.codecs,r);const p=R.clone(this._sendingRemoteRtpParametersByKind[e.kind]);p.codecs=u.reduceCodecs(p.codecs,r);const l=this._remoteSdp.getNextMediaSectionIdx(),w=this._pc.addTransceiver(e,{direction:"sendonly",streams:[this._sendStream]});n&&n(w.sender);let d=await this._pc.createOffer(),P=S.parse(d.sdp);P.extmapAllowMixed&&this._remoteSdp.setSessionExtmapAllowMixed();let k;this._transportReady||await this.setupTransport({localDtlsRole:this._forcedLocalDtlsRole??"client",localSdpObject:P});const x=(0,h.parse)((t??[{}])[0].scalabilityMode);t&&t.length>1&&(c.debug("send() | enabling legacy simulcast"),P=S.parse(d.sdp),k=P.media[l.idx],v.addLegacySimulcast({offerMediaObject:k,numStreams:t.length}),d={type:"offer",sdp:S.write(P)}),c.debug("send() | calling pc.setLocalDescription() [offer:%o]",d),await this._pc.setLocalDescription(d);const C=w.mid;if(o.mid=C,P=S.parse(this._pc.localDescription.sdp),k=P.media[l.idx],o.rtcp.cname=T.getCname({offerMediaObject:k}),o.encodings=v.getRtpEncodings({offerMediaObject:k}),t)for(let I=0;I<o.encodings.length;++I)t[I]&&Object.assign(o.encodings[I],t[I]);if(o.encodings.length>1&&(o.codecs[0].mimeType.toLowerCase()==="video/vp8"||o.codecs[0].mimeType.toLowerCase()==="video/h264"))for(const I of o.encodings)I.scalabilityMode?I.scalabilityMode=`L1T${x.temporalLayers}`:I.scalabilityMode="L1T3";this._remoteSdp.send({offerMediaObject:k,reuseMid:l.reuseMid,offerRtpParameters:o,answerRtpParameters:p,codecOptions:i});const E={type:"answer",sdp:this._remoteSdp.getSdp()};return c.debug("send() | calling pc.setRemoteDescription() [answer:%o]",E),await this._pc.setRemoteDescription(E),this._mapMidTransceiver.set(C,w),{localId:C,rtpParameters:o,rtpSender:w.sender}}async stopSending(e){if(this.assertSendDirection(),this._closed)return;c.debug("stopSending() [localId:%s]",e);const t=this._mapMidTransceiver.get(e);if(!t)throw new Error("associated RTCRtpTransceiver not found");if(t.sender.replaceTrack(null),this._pc.removeTrack(t.sender),this._remoteSdp.closeMediaSection(t.mid))try{t.stop()}catch{}const r=await this._pc.createOffer();c.debug("stopSending() | calling pc.setLocalDescription() [offer:%o]",r),await this._pc.setLocalDescription(r);const n={type:"answer",sdp:this._remoteSdp.getSdp()};c.debug("stopSending() | calling pc.setRemoteDescription() [answer:%o]",n),await this._pc.setRemoteDescription(n),this._mapMidTransceiver.delete(e)}async pauseSending(e){this.assertNotClosed(),this.assertSendDirection(),c.debug("pauseSending() [localId:%s]",e);const t=this._mapMidTransceiver.get(e);if(!t)throw new Error("associated RTCRtpTransceiver not found");t.direction="inactive",this._remoteSdp.pauseMediaSection(e);const i=await this._pc.createOffer();c.debug("pauseSending() | calling pc.setLocalDescription() [offer:%o]",i),await this._pc.setLocalDescription(i);const r={type:"answer",sdp:this._remoteSdp.getSdp()};c.debug("pauseSending() | calling pc.setRemoteDescription() [answer:%o]",r),await this._pc.setRemoteDescription(r)}async resumeSending(e){this.assertNotClosed(),this.assertSendDirection(),c.debug("resumeSending() [localId:%s]",e);const t=this._mapMidTransceiver.get(e);if(!t)throw new Error("associated RTCRtpTransceiver not found");t.direction="sendonly",this._remoteSdp.resumeSendingMediaSection(e);const i=await this._pc.createOffer();c.debug("resumeSending() | calling pc.setLocalDescription() [offer:%o]",i),await this._pc.setLocalDescription(i);const r={type:"answer",sdp:this._remoteSdp.getSdp()};c.debug("resumeSending() | calling pc.setRemoteDescription() [answer:%o]",r),await this._pc.setRemoteDescription(r)}async replaceTrack(e,t){this.assertNotClosed(),this.assertSendDirection(),t?c.debug("replaceTrack() [localId:%s, track.id:%s]",e,t.id):c.debug("replaceTrack() [localId:%s, no track]",e);const i=this._mapMidTransceiver.get(e);if(!i)throw new Error("associated RTCRtpTransceiver not found");await i.sender.replaceTrack(t)}async setMaxSpatialLayer(e,t){this.assertNotClosed(),this.assertSendDirection(),c.debug("setMaxSpatialLayer() [localId:%s, spatialLayer:%s]",e,t);const i=this._mapMidTransceiver.get(e);if(!i)throw new Error("associated RTCRtpTransceiver not found");const r=i.sender.getParameters();r.encodings.forEach((p,l)=>{l<=t?p.active=!0:p.active=!1}),await i.sender.setParameters(r),this._remoteSdp.muxMediaSectionSimulcast(e,r.encodings);const n=await this._pc.createOffer();c.debug("setMaxSpatialLayer() | calling pc.setLocalDescription() [offer:%o]",n),await this._pc.setLocalDescription(n);const o={type:"answer",sdp:this._remoteSdp.getSdp()};c.debug("setMaxSpatialLayer() | calling pc.setRemoteDescription() [answer:%o]",o),await this._pc.setRemoteDescription(o)}async setRtpEncodingParameters(e,t){this.assertNotClosed(),this.assertSendDirection(),c.debug("setRtpEncodingParameters() [localId:%s, params:%o]",e,t);const i=this._mapMidTransceiver.get(e);if(!i)throw new Error("associated RTCRtpTransceiver not found");const r=i.sender.getParameters();r.encodings.forEach((p,l)=>{r.encodings[l]={...p,...t}}),await i.sender.setParameters(r),this._remoteSdp.muxMediaSectionSimulcast(e,r.encodings);const n=await this._pc.createOffer();c.debug("setRtpEncodingParameters() | calling pc.setLocalDescription() [offer:%o]",n),await this._pc.setLocalDescription(n);const o={type:"answer",sdp:this._remoteSdp.getSdp()};c.debug("setRtpEncodingParameters() | calling pc.setRemoteDescription() [answer:%o]",o),await this._pc.setRemoteDescription(o)}async getSenderStats(e){this.assertNotClosed(),this.assertSendDirection();const t=this._mapMidTransceiver.get(e);if(!t)throw new Error("associated RTCRtpTransceiver not found");return t.sender.getStats()}async sendDataChannel({ordered:e,maxPacketLifeTime:t,maxRetransmits:i,label:r,protocol:n}){this.assertNotClosed(),this.assertSendDirection();const o={negotiated:!0,id:this._nextSendSctpStreamId,ordered:e,maxPacketLifeTime:t,maxRetransmits:i,protocol:n};c.debug("sendDataChannel() [options:%o]",o);const p=this._pc.createDataChannel(r,o);if(this._nextSendSctpStreamId=++this._nextSendSctpStreamId%m.MIS,!this._hasDataChannelMediaSection){const w=await this._pc.createOffer(),d=S.parse(w.sdp),P=d.media.find(x=>x.type==="application");this._transportReady||await this.setupTransport({localDtlsRole:this._forcedLocalDtlsRole??"client",localSdpObject:d}),c.debug("sendDataChannel() | calling pc.setLocalDescription() [offer:%o]",w),await this._pc.setLocalDescription(w),this._remoteSdp.sendSctpAssociation({offerMediaObject:P});const k={type:"answer",sdp:this._remoteSdp.getSdp()};c.debug("sendDataChannel() | calling pc.setRemoteDescription() [answer:%o]",k),await this._pc.setRemoteDescription(k),this._hasDataChannelMediaSection=!0}const l={streamId:o.id,ordered:o.ordered,maxPacketLifeTime:o.maxPacketLifeTime,maxRetransmits:o.maxRetransmits};return{dataChannel:p,sctpStreamParameters:l}}async receive(e){this.assertNotClosed(),this.assertRecvDirection();const t=[],i=new Map;for(const p of e){const{trackId:l,kind:w,rtpParameters:d,streamId:P}=p;c.debug("receive() [trackId:%s, kind:%s]",l,w);const k=d.mid??String(this._mapMidTransceiver.size);i.set(l,k),this._remoteSdp.receive({mid:k,kind:w,offerRtpParameters:d,streamId:P??d.rtcp.cname,trackId:l})}const r={type:"offer",sdp:this._remoteSdp.getSdp()};c.debug("receive() | calling pc.setRemoteDescription() [offer:%o]",r),await this._pc.setRemoteDescription(r);for(const p of e){const{trackId:l,onRtpReceiver:w}=p;if(w){const d=i.get(l),P=this._pc.getTransceivers().find(k=>k.mid===d);if(!P)throw new Error("transceiver not found");w(P.receiver)}}let n=await this._pc.createAnswer();const o=S.parse(n.sdp);for(const p of e){const{trackId:l,rtpParameters:w}=p,d=i.get(l),P=o.media.find(k=>String(k.mid)===d);T.applyCodecParameters({offerRtpParameters:w,answerMediaObject:P})}n={type:"answer",sdp:S.write(o)},this._transportReady||await this.setupTransport({localDtlsRole:this._forcedLocalDtlsRole??"client",localSdpObject:o}),c.debug("receive() | calling pc.setLocalDescription() [answer:%o]",n),await this._pc.setLocalDescription(n);for(const p of e){const{trackId:l}=p,w=i.get(l),d=this._pc.getTransceivers().find(P=>P.mid===w);if(!d)throw new Error("new RTCRtpTransceiver not found");this._mapMidTransceiver.set(w,d),t.push({localId:w,track:d.receiver.track,rtpReceiver:d.receiver})}return t}async stopReceiving(e){if(this.assertRecvDirection(),this._closed)return;for(const r of e){c.debug("stopReceiving() [localId:%s]",r);const n=this._mapMidTransceiver.get(r);if(!n)throw new Error("associated RTCRtpTransceiver not found");this._remoteSdp.closeMediaSection(n.mid)}const t={type:"offer",sdp:this._remoteSdp.getSdp()};c.debug("stopReceiving() | calling pc.setRemoteDescription() [offer:%o]",t),await this._pc.setRemoteDescription(t);const i=await this._pc.createAnswer();c.debug("stopReceiving() | calling pc.setLocalDescription() [answer:%o]",i),await this._pc.setLocalDescription(i);for(const r of e)this._mapMidTransceiver.delete(r)}async pauseReceiving(e){this.assertNotClosed(),this.assertRecvDirection();for(const r of e){c.debug("pauseReceiving() [localId:%s]",r);const n=this._mapMidTransceiver.get(r);if(!n)throw new Error("associated RTCRtpTransceiver not found");n.direction="inactive",this._remoteSdp.pauseMediaSection(r)}const t={type:"offer",sdp:this._remoteSdp.getSdp()};c.debug("pauseReceiving() | calling pc.setRemoteDescription() [offer:%o]",t),await this._pc.setRemoteDescription(t);const i=await this._pc.createAnswer();c.debug("pauseReceiving() | calling pc.setLocalDescription() [answer:%o]",i),await this._pc.setLocalDescription(i)}async resumeReceiving(e){this.assertNotClosed(),this.assertRecvDirection();for(const r of e){c.debug("resumeReceiving() [localId:%s]",r);const n=this._mapMidTransceiver.get(r);if(!n)throw new Error("associated RTCRtpTransceiver not found");n.direction="recvonly",this._remoteSdp.resumeReceivingMediaSection(r)}const t={type:"offer",sdp:this._remoteSdp.getSdp()};c.debug("resumeReceiving() | calling pc.setRemoteDescription() [offer:%o]",t),await this._pc.setRemoteDescription(t);const i=await this._pc.createAnswer();c.debug("resumeReceiving() | calling pc.setLocalDescription() [answer:%o]",i),await this._pc.setLocalDescription(i)}async getReceiverStats(e){this.assertNotClosed(),this.assertRecvDirection();const t=this._mapMidTransceiver.get(e);if(!t)throw new Error("associated RTCRtpTransceiver not found");return t.receiver.getStats()}async receiveDataChannel({sctpStreamParameters:e,label:t,protocol:i}){this.assertNotClosed(),this.assertRecvDirection();const{streamId:r,ordered:n,maxPacketLifeTime:o,maxRetransmits:p}=e,l={negotiated:!0,id:r,ordered:n,maxPacketLifeTime:o,maxRetransmits:p,protocol:i};c.debug("receiveDataChannel() [options:%o]",l);const w=this._pc.createDataChannel(t,l);if(!this._hasDataChannelMediaSection){this._remoteSdp.receiveSctpAssociation();const d={type:"offer",sdp:this._remoteSdp.getSdp()};c.debug("receiveDataChannel() | calling pc.setRemoteDescription() [offer:%o]",d),await this._pc.setRemoteDescription(d);const P=await this._pc.createAnswer();if(!this._transportReady){const k=S.parse(P.sdp);await this.setupTransport({localDtlsRole:this._forcedLocalDtlsRole??"client",localSdpObject:k})}c.debug("receiveDataChannel() | calling pc.setRemoteDescription() [answer:%o]",P),await this._pc.setLocalDescription(P),this._hasDataChannelMediaSection=!0}return{dataChannel:w}}async setupTransport({localDtlsRole:e,localSdpObject:t}){t||(t=S.parse(this._pc.localDescription.sdp));const i=T.extractDtlsParameters({sdpObject:t});i.role=e,this._remoteSdp.updateDtlsRole(e==="client"?"server":"client"),await new Promise((r,n)=>{this.safeEmit("@connect",{dtlsParameters:i},r,n)}),this._transportReady=!0}assertNotClosed(){if(this._closed)throw new g.InvalidStateError("method called in a closed handler")}assertSendDirection(){if(this._direction!=="send")throw new Error('method can just be called for handlers with "send" direction')}assertRecvDirection(){if(this._direction!=="recv")throw new Error('method can just be called for handlers with "recv" direction')}};return mt.Safari12=a,mt}var gt={},Us;function Rn(){if(Us)return gt;Us=1,Object.defineProperty(gt,"__esModule",{value:!0}),gt.Safari11=void 0;const S=te(),D=G(),R=Q(),u=X(),T=oe(),v=rr(),_=re(),g=ce(),y=new D.Logger("Safari11"),b="Safari11",h={OS:1024,MIS:1024};let c=class ji extends _.HandlerInterface{_direction;_remoteSdp;_sendingRtpParametersByKind;_sendingRemoteRtpParametersByKind;_forcedLocalDtlsRole;_pc;_sendStream=new MediaStream;_mapSendLocalIdRtpSender=new Map;_nextSendLocalId=0;_mapRecvLocalIdInfo=new Map;_hasDataChannelMediaSection=!1;_nextSendSctpStreamId=0;_transportReady=!1;static createFactory(){return()=>new ji}constructor(){super()}get name(){return b}close(){if(y.debug("close()"),this._pc)try{this._pc.close()}catch{}this.emit("@close")}async getNativeRtpCapabilities(){y.debug("getNativeRtpCapabilities()");const m=new RTCPeerConnection({iceServers:[],iceTransportPolicy:"all",bundlePolicy:"max-bundle",rtcpMuxPolicy:"require",sdpSemantics:"plan-b"});try{const a=await m.createOffer({offerToReceiveAudio:!0,offerToReceiveVideo:!0});try{m.close()}catch{}const s=S.parse(a.sdp);return T.extractRtpCapabilities({sdpObject:s})}catch(a){try{m.close()}catch{}throw a}}async getNativeSctpCapabilities(){return y.debug("getNativeSctpCapabilities()"),{numStreams:h}}run({direction:m,iceParameters:a,iceCandidates:s,dtlsParameters:e,sctpParameters:t,iceServers:i,iceTransportPolicy:r,additionalSettings:n,proprietaryConstraints:o,extendedRtpCapabilities:p}){y.debug("run()"),this._direction=m,this._remoteSdp=new g.RemoteSdp({iceParameters:a,iceCandidates:s,dtlsParameters:e,sctpParameters:t,planB:!0}),this._sendingRtpParametersByKind={audio:u.getSendingRtpParameters("audio",p),video:u.getSendingRtpParameters("video",p)},this._sendingRemoteRtpParametersByKind={audio:u.getSendingRemoteRtpParameters("audio",p),video:u.getSendingRemoteRtpParameters("video",p)},e.role&&e.role!=="auto"&&(this._forcedLocalDtlsRole=e.role==="server"?"client":"server"),this._pc=new RTCPeerConnection({iceServers:i??[],iceTransportPolicy:r??"all",bundlePolicy:"max-bundle",rtcpMuxPolicy:"require",...n},o),this._pc.addEventListener("icegatheringstatechange",()=>{this.emit("@icegatheringstatechange",this._pc.iceGatheringState)}),this._pc.addEventListener("icecandidateerror",l=>{this.emit("@icecandidateerror",l)}),this._pc.connectionState?this._pc.addEventListener("connectionstatechange",()=>{this.emit("@connectionstatechange",this._pc.connectionState)}):this._pc.addEventListener("iceconnectionstatechange",()=>{switch(y.warn("run() | pc.connectionState not supported, using pc.iceConnectionState"),this._pc.iceConnectionState){case"checking":{this.emit("@connectionstatechange","connecting");break}case"connected":case"completed":{this.emit("@connectionstatechange","connected");break}case"failed":{this.emit("@connectionstatechange","failed");break}case"disconnected":{this.emit("@connectionstatechange","disconnected");break}case"closed":{this.emit("@connectionstatechange","closed");break}}})}async updateIceServers(m){y.debug("updateIceServers()");const a=this._pc.getConfiguration();a.iceServers=m,this._pc.setConfiguration(a)}async restartIce(m){if(y.debug("restartIce()"),this._remoteSdp.updateIceParameters(m),!!this._transportReady)if(this._direction==="send"){const a=await this._pc.createOffer({iceRestart:!0});y.debug("restartIce() | calling pc.setLocalDescription() [offer:%o]",a),await this._pc.setLocalDescription(a);const s={type:"answer",sdp:this._remoteSdp.getSdp()};y.debug("restartIce() | calling pc.setRemoteDescription() [answer:%o]",s),await this._pc.setRemoteDescription(s)}else{const a={type:"offer",sdp:this._remoteSdp.getSdp()};y.debug("restartIce() | calling pc.setRemoteDescription() [offer:%o]",a),await this._pc.setRemoteDescription(a);const s=await this._pc.createAnswer();y.debug("restartIce() | calling pc.setLocalDescription() [answer:%o]",s),await this._pc.setLocalDescription(s)}}async getTransportStats(){return this._pc.getStats()}async send({track:m,encodings:a,codecOptions:s,codec:e}){this.assertSendDirection(),y.debug("send() [kind:%s, track.id:%s]",m.kind,m.id),e&&y.warn("send() | codec selection is not available in %s handler",this.name),this._sendStream.addTrack(m),this._pc.addTrack(m,this._sendStream);let t=await this._pc.createOffer(),i=S.parse(t.sdp);i.extmapAllowMixed&&this._remoteSdp.setSessionExtmapAllowMixed();let r;const n=R.clone(this._sendingRtpParametersByKind[m.kind]);n.codecs=u.reduceCodecs(n.codecs);const o=R.clone(this._sendingRemoteRtpParametersByKind[m.kind]);if(o.codecs=u.reduceCodecs(o.codecs),this._transportReady||await this.setupTransport({localDtlsRole:this._forcedLocalDtlsRole??"client",localSdpObject:i}),m.kind==="video"&&a&&a.length>1&&(y.debug("send() | enabling simulcast"),i=S.parse(t.sdp),r=i.media.find(d=>d.type==="video"),v.addLegacySimulcast({offerMediaObject:r,track:m,numStreams:a.length}),t={type:"offer",sdp:S.write(i)}),y.debug("send() | calling pc.setLocalDescription() [offer:%o]",t),await this._pc.setLocalDescription(t),i=S.parse(this._pc.localDescription.sdp),r=i.media.find(d=>d.type===m.kind),n.rtcp.cname=T.getCname({offerMediaObject:r}),n.encodings=v.getRtpEncodings({offerMediaObject:r,track:m}),a)for(let d=0;d<n.encodings.length;++d)a[d]&&Object.assign(n.encodings[d],a[d]);if(n.encodings.length>1&&n.codecs[0].mimeType.toLowerCase()==="video/vp8")for(const d of n.encodings)d.scalabilityMode="L1T3";this._remoteSdp.send({offerMediaObject:r,offerRtpParameters:n,answerRtpParameters:o,codecOptions:s});const p={type:"answer",sdp:this._remoteSdp.getSdp()};y.debug("send() | calling pc.setRemoteDescription() [answer:%o]",p),await this._pc.setRemoteDescription(p);const l=String(this._nextSendLocalId);this._nextSendLocalId++;const w=this._pc.getSenders().find(d=>d.track===m);return this._mapSendLocalIdRtpSender.set(l,w),{localId:l,rtpParameters:n,rtpSender:w}}async stopSending(m){this.assertSendDirection();const a=this._mapSendLocalIdRtpSender.get(m);if(!a)throw new Error("associated RTCRtpSender not found");a.track&&this._sendStream.removeTrack(a.track),this._mapSendLocalIdRtpSender.delete(m);const s=await this._pc.createOffer();y.debug("stopSending() | calling pc.setLocalDescription() [offer:%o]",s);try{await this._pc.setLocalDescription(s)}catch(t){if(this._sendStream.getTracks().length===0){y.warn("stopSending() | ignoring expected error due no sending tracks: %s",t.toString());return}throw t}if(this._pc.signalingState==="stable")return;const e={type:"answer",sdp:this._remoteSdp.getSdp()};y.debug("stopSending() | calling pc.setRemoteDescription() [answer:%o]",e),await this._pc.setRemoteDescription(e)}async pauseSending(m){}async resumeSending(m){}async replaceTrack(m,a){this.assertSendDirection(),a?y.debug("replaceTrack() [localId:%s, track.id:%s]",m,a.id):y.debug("replaceTrack() [localId:%s, no track]",m);const s=this._mapSendLocalIdRtpSender.get(m);if(!s)throw new Error("associated RTCRtpSender not found");const e=s.track;await s.replaceTrack(a),e&&this._sendStream.removeTrack(e),a&&this._sendStream.addTrack(a)}async setMaxSpatialLayer(m,a){this.assertSendDirection(),y.debug("setMaxSpatialLayer() [localId:%s, spatialLayer:%s]",m,a);const s=this._mapSendLocalIdRtpSender.get(m);if(!s)throw new Error("associated RTCRtpSender not found");const e=s.getParameters();e.encodings.forEach((t,i)=>{i<=a?t.active=!0:t.active=!1}),await s.setParameters(e)}async setRtpEncodingParameters(m,a){this.assertSendDirection(),y.debug("setRtpEncodingParameters() [localId:%s, params:%o]",m,a);const s=this._mapSendLocalIdRtpSender.get(m);if(!s)throw new Error("associated RTCRtpSender not found");const e=s.getParameters();e.encodings.forEach((t,i)=>{e.encodings[i]={...t,...a}}),await s.setParameters(e)}async getSenderStats(m){this.assertSendDirection();const a=this._mapSendLocalIdRtpSender.get(m);if(!a)throw new Error("associated RTCRtpSender not found");return a.getStats()}async sendDataChannel({ordered:m,maxPacketLifeTime:a,maxRetransmits:s,label:e,protocol:t}){this.assertSendDirection();const i={negotiated:!0,id:this._nextSendSctpStreamId,ordered:m,maxPacketLifeTime:a,maxRetransmits:s,protocol:t};y.debug("sendDataChannel() [options:%o]",i);const r=this._pc.createDataChannel(e,i);if(this._nextSendSctpStreamId=++this._nextSendSctpStreamId%h.MIS,!this._hasDataChannelMediaSection){const o=await this._pc.createOffer(),p=S.parse(o.sdp),l=p.media.find(d=>d.type==="application");this._transportReady||await this.setupTransport({localDtlsRole:this._forcedLocalDtlsRole??"client",localSdpObject:p}),y.debug("sendDataChannel() | calling pc.setLocalDescription() [offer:%o]",o),await this._pc.setLocalDescription(o),this._remoteSdp.sendSctpAssociation({offerMediaObject:l});const w={type:"answer",sdp:this._remoteSdp.getSdp()};y.debug("sendDataChannel() | calling pc.setRemoteDescription() [answer:%o]",w),await this._pc.setRemoteDescription(w),this._hasDataChannelMediaSection=!0}const n={streamId:i.id,ordered:i.ordered,maxPacketLifeTime:i.maxPacketLifeTime,maxRetransmits:i.maxRetransmits};return{dataChannel:r,sctpStreamParameters:n}}async receive(m){this.assertRecvDirection();const a=[];for(const i of m){const{trackId:r,kind:n,rtpParameters:o,streamId:p}=i;y.debug("receive() [trackId:%s, kind:%s]",r,n);const l=n;this._remoteSdp.receive({mid:l,kind:n,offerRtpParameters:o,streamId:p??o.rtcp.cname,trackId:r})}const s={type:"offer",sdp:this._remoteSdp.getSdp()};y.debug("receive() | calling pc.setRemoteDescription() [offer:%o]",s),await this._pc.setRemoteDescription(s);let e=await this._pc.createAnswer();const t=S.parse(e.sdp);for(const i of m){const{kind:r,rtpParameters:n}=i,o=r,p=t.media.find(l=>String(l.mid)===o);T.applyCodecParameters({offerRtpParameters:n,answerMediaObject:p})}e={type:"answer",sdp:S.write(t)},this._transportReady||await this.setupTransport({localDtlsRole:this._forcedLocalDtlsRole??"client",localSdpObject:t}),y.debug("receive() | calling pc.setLocalDescription() [answer:%o]",e),await this._pc.setLocalDescription(e);for(const i of m){const{kind:r,trackId:n,rtpParameters:o}=i,p=r,l=n,w=this._pc.getReceivers().find(d=>d.track&&d.track.id===l);if(!w)throw new Error("new RTCRtpReceiver not");this._mapRecvLocalIdInfo.set(l,{mid:p,rtpParameters:o,rtpReceiver:w}),a.push({localId:l,track:w.track,rtpReceiver:w})}return a}async stopReceiving(m){this.assertRecvDirection();for(const e of m){y.debug("stopReceiving() [localId:%s]",e);const{mid:t,rtpParameters:i}=this._mapRecvLocalIdInfo.get(e)??{};this._mapRecvLocalIdInfo.delete(e),this._remoteSdp.planBStopReceiving({mid:t,offerRtpParameters:i})}const a={type:"offer",sdp:this._remoteSdp.getSdp()};y.debug("stopReceiving() | calling pc.setRemoteDescription() [offer:%o]",a),await this._pc.setRemoteDescription(a);const s=await this._pc.createAnswer();y.debug("stopReceiving() | calling pc.setLocalDescription() [answer:%o]",s),await this._pc.setLocalDescription(s)}async getReceiverStats(m){this.assertRecvDirection();const{rtpReceiver:a}=this._mapRecvLocalIdInfo.get(m)??{};if(!a)throw new Error("associated RTCRtpReceiver not found");return a.getStats()}async pauseReceiving(m){}async resumeReceiving(m){}async receiveDataChannel({sctpStreamParameters:m,label:a,protocol:s}){this.assertRecvDirection();const{streamId:e,ordered:t,maxPacketLifeTime:i,maxRetransmits:r}=m,n={negotiated:!0,id:e,ordered:t,maxPacketLifeTime:i,maxRetransmits:r,protocol:s};y.debug("receiveDataChannel() [options:%o]",n);const o=this._pc.createDataChannel(a,n);if(!this._hasDataChannelMediaSection){this._remoteSdp.receiveSctpAssociation({oldDataChannelSpec:!0});const p={type:"offer",sdp:this._remoteSdp.getSdp()};y.debug("receiveDataChannel() | calling pc.setRemoteDescription() [offer:%o]",p),await this._pc.setRemoteDescription(p);const l=await this._pc.createAnswer();if(!this._transportReady){const w=S.parse(l.sdp);await this.setupTransport({localDtlsRole:this._forcedLocalDtlsRole??"client",localSdpObject:w})}y.debug("receiveDataChannel() | calling pc.setRemoteDescription() [answer:%o]",l),await this._pc.setLocalDescription(l),this._hasDataChannelMediaSection=!0}return{dataChannel:o}}async setupTransport({localDtlsRole:m,localSdpObject:a}){a||(a=S.parse(this._pc.localDescription.sdp));const s=T.extractDtlsParameters({sdpObject:a});s.role=m,this._remoteSdp.updateDtlsRole(m==="client"?"server":"client"),await new Promise((e,t)=>{this.safeEmit("@connect",{dtlsParameters:s},e,t)}),this._transportReady=!0}assertSendDirection(){if(this._direction!=="send")throw new Error('method can just be called for handlers with "send" direction')}assertRecvDirection(){if(this._direction!=="recv")throw new Error('method can just be called for handlers with "recv" direction')}};return gt.Safari11=c,gt}var _t={},wt={},qs;function Cn(){if(qs)return wt;qs=1,Object.defineProperty(wt,"__esModule",{value:!0}),wt.getCapabilities=D,wt.mangleRtpParameters=R;const S=Q();function D(){const u=RTCRtpReceiver.getCapabilities(),T=S.clone(u);for(const v of T.codecs??[]){if(v.channels=v.numChannels,delete v.numChannels,v.mimeType=v.mimeType??`${v.kind}/${v.name}`,v.parameters){const _=v.parameters;_.apt&&(_.apt=Number(_.apt)),_["packetization-mode"]&&(_["packetization-mode"]=Number(_["packetization-mode"]))}for(const _ of v.rtcpFeedback??[])_.parameter||(_.parameter="")}return T}function R(u){const T=S.clone(u);T.mid&&(T.muxId=T.mid,delete T.mid);for(const v of T.codecs)v.channels&&(v.numChannels=v.channels,delete v.channels),v.mimeType&&!v.name&&(v.name=v.mimeType.split("/")[1]),delete v.mimeType;return T}return wt}var $s;function Tn(){if($s)return _t;$s=1,Object.defineProperty(_t,"__esModule",{value:!0}),_t.Edge11=void 0;const S=G(),D=Y(),R=Q(),u=X(),T=Cn(),v=re(),_=new S.Logger("Edge11"),g="Edge11";let y=class Ai extends v.HandlerInterface{_sendingRtpParametersByKind;_remoteIceParameters;_remoteIceCandidates;_remoteDtlsParameters;_iceGatherer;_iceTransport;_dtlsTransport;_rtpSenders=new Map;_rtpReceivers=new Map;_nextSendLocalId=0;_cname;_transportReady=!1;static createFactory(){return()=>new Ai}constructor(){super()}get name(){return g}close(){_.debug("close()");try{this._iceGatherer.close()}catch{}try{this._iceTransport.stop()}catch{}try{this._dtlsTransport.stop()}catch{}for(const h of this._rtpSenders.values())try{h.stop()}catch{}for(const h of this._rtpReceivers.values())try{h.stop()}catch{}this.emit("@close")}async getNativeRtpCapabilities(){return _.debug("getNativeRtpCapabilities()"),T.getCapabilities()}async getNativeSctpCapabilities(){return _.debug("getNativeSctpCapabilities()"),{numStreams:{OS:0,MIS:0}}}run({direction:h,iceParameters:c,iceCandidates:f,dtlsParameters:m,sctpParameters:a,iceServers:s,iceTransportPolicy:e,additionalSettings:t,proprietaryConstraints:i,extendedRtpCapabilities:r}){_.debug("run()"),this._sendingRtpParametersByKind={audio:u.getSendingRtpParameters("audio",r),video:u.getSendingRtpParameters("video",r)},this._remoteIceParameters=c,this._remoteIceCandidates=f,this._remoteDtlsParameters=m,this._cname=`CNAME-${R.generateRandomNumber()}`,this.setIceGatherer({iceServers:s,iceTransportPolicy:e}),this.setIceTransport(),this.setDtlsTransport()}async updateIceServers(h){throw new D.UnsupportedError("not supported")}async restartIce(h){if(_.debug("restartIce()"),this._remoteIceParameters=h,!!this._transportReady){_.debug("restartIce() | calling iceTransport.start()"),this._iceTransport.start(this._iceGatherer,h,"controlling");for(const c of this._remoteIceCandidates)this._iceTransport.addRemoteCandidate(c);this._iceTransport.addRemoteCandidate({})}}async getTransportStats(){return this._iceTransport.getStats()}async send({track:h,encodings:c,codecOptions:f,codec:m}){_.debug("send() [kind:%s, track.id:%s]",h.kind,h.id),this._transportReady||await this.setupTransport({localDtlsRole:"server"}),_.debug("send() | calling new RTCRtpSender()");const a=new RTCRtpSender(h,this._dtlsTransport),s=R.clone(this._sendingRtpParametersByKind[h.kind]);s.codecs=u.reduceCodecs(s.codecs,m);const e=s.codecs.some(r=>/.+\/rtx$/i.test(r.mimeType));c||(c=[{}]);for(const r of c)r.ssrc=R.generateRandomNumber(),e&&(r.rtx={ssrc:R.generateRandomNumber()});s.encodings=c,s.rtcp={cname:this._cname,reducedSize:!0,mux:!0};const t=T.mangleRtpParameters(s);_.debug("send() | calling rtpSender.send() [params:%o]",t),await a.send(t);const i=String(this._nextSendLocalId);return this._nextSendLocalId++,this._rtpSenders.set(i,a),{localId:i,rtpParameters:s,rtpSender:a}}async stopSending(h){_.debug("stopSending() [localId:%s]",h);const c=this._rtpSenders.get(h);if(!c)throw new Error("RTCRtpSender not found");this._rtpSenders.delete(h);try{_.debug("stopSending() | calling rtpSender.stop()"),c.stop()}catch(f){throw _.warn("stopSending() | rtpSender.stop() failed:%o",f),f}}async pauseSending(h){}async resumeSending(h){}async replaceTrack(h,c){c?_.debug("replaceTrack() [localId:%s, track.id:%s]",h,c.id):_.debug("replaceTrack() [localId:%s, no track]",h);const f=this._rtpSenders.get(h);if(!f)throw new Error("RTCRtpSender not found");f.setTrack(c)}async setMaxSpatialLayer(h,c){_.debug("setMaxSpatialLayer() [localId:%s, spatialLayer:%s]",h,c);const f=this._rtpSenders.get(h);if(!f)throw new Error("RTCRtpSender not found");const m=f.getParameters();m.encodings.forEach((a,s)=>{s<=c?a.active=!0:a.active=!1}),await f.setParameters(m)}async setRtpEncodingParameters(h,c){_.debug("setRtpEncodingParameters() [localId:%s, params:%o]",h,c);const f=this._rtpSenders.get(h);if(!f)throw new Error("RTCRtpSender not found");const m=f.getParameters();m.encodings.forEach((a,s)=>{m.encodings[s]={...a,...c}}),await f.setParameters(m)}async getSenderStats(h){const c=this._rtpSenders.get(h);if(!c)throw new Error("RTCRtpSender not found");return c.getStats()}async sendDataChannel(h){throw new D.UnsupportedError("not implemented")}async receive(h){const c=[];for(const f of h){const{trackId:m,kind:a}=f;_.debug("receive() [trackId:%s, kind:%s]",m,a)}this._transportReady||await this.setupTransport({localDtlsRole:"server"});for(const f of h){const{trackId:m,kind:a,rtpParameters:s}=f;_.debug("receive() | calling new RTCRtpReceiver()");const e=new RTCRtpReceiver(this._dtlsTransport,a);e.addEventListener("error",r=>{_.error('rtpReceiver "error" event [event:%o]',r)});const t=T.mangleRtpParameters(s);_.debug("receive() | calling rtpReceiver.receive() [params:%o]",t),await e.receive(t);const i=m;this._rtpReceivers.set(i,e),c.push({localId:i,track:e.track,rtpReceiver:e})}return c}async stopReceiving(h){for(const c of h){_.debug("stopReceiving() [localId:%s]",c);const f=this._rtpReceivers.get(c);if(!f)throw new Error("RTCRtpReceiver not found");this._rtpReceivers.delete(c);try{_.debug("stopReceiving() | calling rtpReceiver.stop()"),f.stop()}catch(m){_.warn("stopReceiving() | rtpReceiver.stop() failed:%o",m)}}}async pauseReceiving(h){}async resumeReceiving(h){}async getReceiverStats(h){const c=this._rtpReceivers.get(h);if(!c)throw new Error("RTCRtpReceiver not found");return c.getStats()}async receiveDataChannel(h){throw new D.UnsupportedError("not implemented")}setIceGatherer({iceServers:h,iceTransportPolicy:c}){const f=new RTCIceGatherer({iceServers:h??[],gatherPolicy:c??"all"});f.addEventListener("error",m=>{_.error('iceGatherer "error" event [event:%o]',m)});try{f.gather()}catch(m){_.debug("setIceGatherer() | iceGatherer.gather() failed: %s",m.toString())}this._iceGatherer=f}setIceTransport(){const h=new RTCIceTransport(this._iceGatherer);h.addEventListener("statechange",()=>{switch(h.state){case"checking":{this.emit("@connectionstatechange","connecting");break}case"connected":case"completed":{this.emit("@connectionstatechange","connected");break}case"failed":{this.emit("@connectionstatechange","failed");break}case"disconnected":{this.emit("@connectionstatechange","disconnected");break}case"closed":{this.emit("@connectionstatechange","closed");break}}}),h.addEventListener("icestatechange",()=>{switch(h.state){case"checking":{this.emit("@connectionstatechange","connecting");break}case"connected":case"completed":{this.emit("@connectionstatechange","connected");break}case"failed":{this.emit("@connectionstatechange","failed");break}case"disconnected":{this.emit("@connectionstatechange","disconnected");break}case"closed":{this.emit("@connectionstatechange","closed");break}}}),h.addEventListener("candidatepairchange",c=>{_.debug('iceTransport "candidatepairchange" event [pair:%o]',c.pair)}),this._iceTransport=h}setDtlsTransport(){const h=new RTCDtlsTransport(this._iceTransport);h.addEventListener("statechange",()=>{_.debug('dtlsTransport "statechange" event [state:%s]',h.state)}),h.addEventListener("dtlsstatechange",()=>{_.debug('dtlsTransport "dtlsstatechange" event [state:%s]',h.state),h.state==="closed"&&this.emit("@connectionstatechange","closed")}),h.addEventListener("error",c=>{_.error('dtlsTransport "error" event [event:%o]',c)}),this._dtlsTransport=h}async setupTransport({localDtlsRole:h}){_.debug("setupTransport()");const c=this._dtlsTransport.getLocalParameters();c.role=h,await new Promise((f,m)=>{this.safeEmit("@connect",{dtlsParameters:c},f,m)}),this._iceTransport.start(this._iceGatherer,this._remoteIceParameters,"controlling");for(const f of this._remoteIceCandidates)this._iceTransport.addRemoteCandidate(f);this._iceTransport.addRemoteCandidate({}),this._remoteDtlsParameters.fingerprints=this._remoteDtlsParameters.fingerprints.filter(f=>f.algorithm==="sha-256"||f.algorithm==="sha-384"||f.algorithm==="sha-512"),this._dtlsTransport.start(this._remoteDtlsParameters),this._transportReady=!0}};return _t.Edge11=y,_t}var vt={},Bs;function Dn(){if(Bs)return vt;Bs=1,Object.defineProperty(vt,"__esModule",{value:!0}),vt.ReactNativeUnifiedPlan=void 0;const S=te(),D=G(),R=Q(),u=X(),T=oe(),v=xe(),_=tr(),g=Y(),y=re(),b=ce(),h=Se(),c=new D.Logger("ReactNativeUnifiedPlan"),f="ReactNativeUnifiedPlan",m={OS:1024,MIS:1024};let a=class Ni extends y.HandlerInterface{_closed=!1;_direction;_remoteSdp;_sendingRtpParametersByKind;_sendingRemoteRtpParametersByKind;_forcedLocalDtlsRole;_pc;_mapMidTransceiver=new Map;_sendStream=new MediaStream;_hasDataChannelMediaSection=!1;_nextSendSctpStreamId=0;_transportReady=!1;static createFactory(){return()=>new Ni}constructor(){super()}get name(){return f}close(){if(c.debug("close()"),!this._closed){if(this._closed=!0,this._sendStream.release(!1),this._pc)try{this._pc.close()}catch{}this.emit("@close")}}async getNativeRtpCapabilities(){c.debug("getNativeRtpCapabilities()");const e=new RTCPeerConnection({iceServers:[],iceTransportPolicy:"all",bundlePolicy:"max-bundle",rtcpMuxPolicy:"require",sdpSemantics:"unified-plan"});try{e.addTransceiver("audio"),e.addTransceiver("video");const t=await e.createOffer();try{e.close()}catch{}const i=S.parse(t.sdp),r=T.extractRtpCapabilities({sdpObject:i});return _.addNackSupportForOpus(r),r}catch(t){try{e.close()}catch{}throw t}}async getNativeSctpCapabilities(){return c.debug("getNativeSctpCapabilities()"),{numStreams:m}}run({direction:e,iceParameters:t,iceCandidates:i,dtlsParameters:r,sctpParameters:n,iceServers:o,iceTransportPolicy:p,additionalSettings:l,proprietaryConstraints:w,extendedRtpCapabilities:d}){this.assertNotClosed(),c.debug("run()"),this._direction=e,this._remoteSdp=new b.RemoteSdp({iceParameters:t,iceCandidates:i,dtlsParameters:r,sctpParameters:n}),this._sendingRtpParametersByKind={audio:u.getSendingRtpParameters("audio",d),video:u.getSendingRtpParameters("video",d)},this._sendingRemoteRtpParametersByKind={audio:u.getSendingRemoteRtpParameters("audio",d),video:u.getSendingRemoteRtpParameters("video",d)},r.role&&r.role!=="auto"&&(this._forcedLocalDtlsRole=r.role==="server"?"client":"server"),this._pc=new RTCPeerConnection({iceServers:o??[],iceTransportPolicy:p??"all",bundlePolicy:"max-bundle",rtcpMuxPolicy:"require",sdpSemantics:"unified-plan",...l},w),this._pc.addEventListener("icegatheringstatechange",()=>{this.emit("@icegatheringstatechange",this._pc.iceGatheringState)}),this._pc.addEventListener("icecandidateerror",P=>{this.emit("@icecandidateerror",P)}),this._pc.connectionState?this._pc.addEventListener("connectionstatechange",()=>{this.emit("@connectionstatechange",this._pc.connectionState)}):this._pc.addEventListener("iceconnectionstatechange",()=>{switch(c.warn("run() | pc.connectionState not supported, using pc.iceConnectionState"),this._pc.iceConnectionState){case"checking":{this.emit("@connectionstatechange","connecting");break}case"connected":case"completed":{this.emit("@connectionstatechange","connected");break}case"failed":{this.emit("@connectionstatechange","failed");break}case"disconnected":{this.emit("@connectionstatechange","disconnected");break}case"closed":{this.emit("@connectionstatechange","closed");break}}})}async updateIceServers(e){this.assertNotClosed(),c.debug("updateIceServers()");const t=this._pc.getConfiguration();t.iceServers=e,this._pc.setConfiguration(t)}async restartIce(e){if(this.assertNotClosed(),c.debug("restartIce()"),this._remoteSdp.updateIceParameters(e),!!this._transportReady)if(this._direction==="send"){const t=await this._pc.createOffer({iceRestart:!0});c.debug("restartIce() | calling pc.setLocalDescription() [offer:%o]",t),await this._pc.setLocalDescription(t);const i={type:"answer",sdp:this._remoteSdp.getSdp()};c.debug("restartIce() | calling pc.setRemoteDescription() [answer:%o]",i),await this._pc.setRemoteDescription(i)}else{const t={type:"offer",sdp:this._remoteSdp.getSdp()};c.debug("restartIce() | calling pc.setRemoteDescription() [offer:%o]",t),await this._pc.setRemoteDescription(t);const i=await this._pc.createAnswer();c.debug("restartIce() | calling pc.setLocalDescription() [answer:%o]",i),await this._pc.setLocalDescription(i)}}async getTransportStats(){return this.assertNotClosed(),this._pc.getStats()}async send({track:e,encodings:t,codecOptions:i,codec:r,onRtpSender:n}){this.assertNotClosed(),this.assertSendDirection(),c.debug("send() [kind:%s, track.id:%s]",e.kind,e.id),t&&t.length>1&&t.forEach((L,O)=>{L.rid=`r${O}`});const o=R.clone(this._sendingRtpParametersByKind[e.kind]);o.codecs=u.reduceCodecs(o.codecs,r);const p=R.clone(this._sendingRemoteRtpParametersByKind[e.kind]);p.codecs=u.reduceCodecs(p.codecs,r);const l=this._remoteSdp.getNextMediaSectionIdx(),w=this._pc.addTransceiver(e,{direction:"sendonly",streams:[this._sendStream],sendEncodings:t});n&&n(w.sender);let d=await this._pc.createOffer(),P=S.parse(d.sdp);P.extmapAllowMixed&&this._remoteSdp.setSessionExtmapAllowMixed();let k;this._transportReady||await this.setupTransport({localDtlsRole:this._forcedLocalDtlsRole??"client",localSdpObject:P});let x=!1;const C=(0,h.parse)((t??[{}])[0].scalabilityMode);t&&t.length===1&&C.spatialLayers>1&&o.codecs[0].mimeType.toLowerCase()==="video/vp9"&&(c.debug("send() | enabling legacy simulcast for VP9 SVC"),x=!0,P=S.parse(d.sdp),k=P.media[l.idx],v.addLegacySimulcast({offerMediaObject:k,numStreams:C.spatialLayers}),d={type:"offer",sdp:S.write(P)}),c.debug("send() | calling pc.setLocalDescription() [offer:%o]",d),await this._pc.setLocalDescription(d);let E=w.mid??void 0;if(E||c.warn("send() | missing transceiver.mid (bug in react-native-webrtc, using a workaround"),o.mid=E,P=S.parse(this._pc.localDescription.sdp),k=P.media[l.idx],o.rtcp.cname=T.getCname({offerMediaObject:k}),!t)o.encodings=v.getRtpEncodings({offerMediaObject:k});else if(t.length===1){let L=v.getRtpEncodings({offerMediaObject:k});Object.assign(L[0],t[0]),x&&(L=[L[0]]),o.encodings=L}else o.encodings=t;if(o.encodings.length>1&&(o.codecs[0].mimeType.toLowerCase()==="video/vp8"||o.codecs[0].mimeType.toLowerCase()==="video/h264"))for(const L of o.encodings)L.scalabilityMode?L.scalabilityMode=`L1T${C.temporalLayers}`:L.scalabilityMode="L1T3";this._remoteSdp.send({offerMediaObject:k,reuseMid:l.reuseMid,offerRtpParameters:o,answerRtpParameters:p,codecOptions:i});const I={type:"answer",sdp:this._remoteSdp.getSdp()};return c.debug("send() | calling pc.setRemoteDescription() [answer:%o]",I),await this._pc.setRemoteDescription(I),E||(E=w.mid,o.mid=E),this._mapMidTransceiver.set(E,w),{localId:E,rtpParameters:o,rtpSender:w.sender}}async stopSending(e){if(this.assertSendDirection(),this._closed)return;c.debug("stopSending() [localId:%s]",e);const t=this._mapMidTransceiver.get(e);if(!t)throw new Error("associated RTCRtpTransceiver not found");if(t.sender.replaceTrack(null),this._pc.removeTrack(t.sender),this._remoteSdp.closeMediaSection(t.mid))try{t.stop()}catch{}const r=await this._pc.createOffer();c.debug("stopSending() | calling pc.setLocalDescription() [offer:%o]",r),await this._pc.setLocalDescription(r);const n={type:"answer",sdp:this._remoteSdp.getSdp()};c.debug("stopSending() | calling pc.setRemoteDescription() [answer:%o]",n),await this._pc.setRemoteDescription(n),this._mapMidTransceiver.delete(e)}async pauseSending(e){this.assertNotClosed(),this.assertSendDirection(),c.debug("pauseSending() [localId:%s]",e);const t=this._mapMidTransceiver.get(e);if(!t)throw new Error("associated RTCRtpTransceiver not found");t.direction="inactive",this._remoteSdp.pauseMediaSection(e);const i=await this._pc.createOffer();c.debug("pauseSending() | calling pc.setLocalDescription() [offer:%o]",i),await this._pc.setLocalDescription(i);const r={type:"answer",sdp:this._remoteSdp.getSdp()};c.debug("pauseSending() | calling pc.setRemoteDescription() [answer:%o]",r),await this._pc.setRemoteDescription(r)}async resumeSending(e){this.assertNotClosed(),this.assertSendDirection(),c.debug("resumeSending() [localId:%s]",e);const t=this._mapMidTransceiver.get(e);if(this._remoteSdp.resumeSendingMediaSection(e),!t)throw new Error("associated RTCRtpTransceiver not found");t.direction="sendonly";const i=await this._pc.createOffer();c.debug("resumeSending() | calling pc.setLocalDescription() [offer:%o]",i),await this._pc.setLocalDescription(i);const r={type:"answer",sdp:this._remoteSdp.getSdp()};c.debug("resumeSending() | calling pc.setRemoteDescription() [answer:%o]",r),await this._pc.setRemoteDescription(r)}async replaceTrack(e,t){this.assertNotClosed(),this.assertSendDirection(),t?c.debug("replaceTrack() [localId:%s, track.id:%s]",e,t.id):c.debug("replaceTrack() [localId:%s, no track]",e);const i=this._mapMidTransceiver.get(e);if(!i)throw new Error("associated RTCRtpTransceiver not found");await i.sender.replaceTrack(t)}async setMaxSpatialLayer(e,t){this.assertNotClosed(),this.assertSendDirection(),c.debug("setMaxSpatialLayer() [localId:%s, spatialLayer:%s]",e,t);const i=this._mapMidTransceiver.get(e);if(!i)throw new Error("associated RTCRtpTransceiver not found");const r=i.sender.getParameters();r.encodings.forEach((p,l)=>{l<=t?p.active=!0:p.active=!1}),await i.sender.setParameters(r),this._remoteSdp.muxMediaSectionSimulcast(e,r.encodings);const n=await this._pc.createOffer();c.debug("setMaxSpatialLayer() | calling pc.setLocalDescription() [offer:%o]",n),await this._pc.setLocalDescription(n);const o={type:"answer",sdp:this._remoteSdp.getSdp()};c.debug("setMaxSpatialLayer() | calling pc.setRemoteDescription() [answer:%o]",o),await this._pc.setRemoteDescription(o)}async setRtpEncodingParameters(e,t){this.assertNotClosed(),this.assertSendDirection(),c.debug("setRtpEncodingParameters() [localId:%s, params:%o]",e,t);const i=this._mapMidTransceiver.get(e);if(!i)throw new Error("associated RTCRtpTransceiver not found");const r=i.sender.getParameters();r.encodings.forEach((p,l)=>{r.encodings[l]={...p,...t}}),await i.sender.setParameters(r),this._remoteSdp.muxMediaSectionSimulcast(e,r.encodings);const n=await this._pc.createOffer();c.debug("setRtpEncodingParameters() | calling pc.setLocalDescription() [offer:%o]",n),await this._pc.setLocalDescription(n);const o={type:"answer",sdp:this._remoteSdp.getSdp()};c.debug("setRtpEncodingParameters() | calling pc.setRemoteDescription() [answer:%o]",o),await this._pc.setRemoteDescription(o)}async getSenderStats(e){this.assertNotClosed(),this.assertSendDirection();const t=this._mapMidTransceiver.get(e);if(!t)throw new Error("associated RTCRtpTransceiver not found");return t.sender.getStats()}async sendDataChannel({ordered:e,maxPacketLifeTime:t,maxRetransmits:i,label:r,protocol:n}){this.assertNotClosed(),this.assertSendDirection();const o={negotiated:!0,id:this._nextSendSctpStreamId,ordered:e,maxPacketLifeTime:t,maxRetransmits:i,protocol:n};c.debug("sendDataChannel() [options:%o]",o);const p=this._pc.createDataChannel(r,o);if(this._nextSendSctpStreamId=++this._nextSendSctpStreamId%m.MIS,!this._hasDataChannelMediaSection){const w=await this._pc.createOffer(),d=S.parse(w.sdp),P=d.media.find(x=>x.type==="application");this._transportReady||await this.setupTransport({localDtlsRole:this._forcedLocalDtlsRole??"client",localSdpObject:d}),c.debug("sendDataChannel() | calling pc.setLocalDescription() [offer:%o]",w),await this._pc.setLocalDescription(w),this._remoteSdp.sendSctpAssociation({offerMediaObject:P});const k={type:"answer",sdp:this._remoteSdp.getSdp()};c.debug("sendDataChannel() | calling pc.setRemoteDescription() [answer:%o]",k),await this._pc.setRemoteDescription(k),this._hasDataChannelMediaSection=!0}const l={streamId:o.id,ordered:o.ordered,maxPacketLifeTime:o.maxPacketLifeTime,maxRetransmits:o.maxRetransmits};return{dataChannel:p,sctpStreamParameters:l}}async receive(e){this.assertNotClosed(),this.assertRecvDirection();const t=[],i=new Map;for(const p of e){const{trackId:l,kind:w,rtpParameters:d,streamId:P}=p;c.debug("receive() [trackId:%s, kind:%s]",l,w);const k=d.mid??String(this._mapMidTransceiver.size);i.set(l,k),this._remoteSdp.receive({mid:k,kind:w,offerRtpParameters:d,streamId:P??d.rtcp.cname,trackId:l})}const r={type:"offer",sdp:this._remoteSdp.getSdp()};c.debug("receive() | calling pc.setRemoteDescription() [offer:%o]",r),await this._pc.setRemoteDescription(r);for(const p of e){const{trackId:l,onRtpReceiver:w}=p;if(w){const d=i.get(l),P=this._pc.getTransceivers().find(k=>k.mid===d);if(!P)throw new Error("transceiver not found");w(P.receiver)}}let n=await this._pc.createAnswer();const o=S.parse(n.sdp);for(const p of e){const{trackId:l,rtpParameters:w}=p,d=i.get(l),P=o.media.find(k=>String(k.mid)===d);T.applyCodecParameters({offerRtpParameters:w,answerMediaObject:P})}n={type:"answer",sdp:S.write(o)},this._transportReady||await this.setupTransport({localDtlsRole:this._forcedLocalDtlsRole??"client",localSdpObject:o}),c.debug("receive() | calling pc.setLocalDescription() [answer:%o]",n),await this._pc.setLocalDescription(n);for(const p of e){const{trackId:l}=p,w=i.get(l),d=this._pc.getTransceivers().find(P=>P.mid===w);if(d)this._mapMidTransceiver.set(w,d),t.push({localId:w,track:d.receiver.track,rtpReceiver:d.receiver});else throw new Error("new RTCRtpTransceiver not found")}return t}async stopReceiving(e){if(this.assertRecvDirection(),this._closed)return;for(const r of e){c.debug("stopReceiving() [localId:%s]",r);const n=this._mapMidTransceiver.get(r);if(!n)throw new Error("associated RTCRtpTransceiver not found");this._remoteSdp.closeMediaSection(n.mid)}const t={type:"offer",sdp:this._remoteSdp.getSdp()};c.debug("stopReceiving() | calling pc.setRemoteDescription() [offer:%o]",t),await this._pc.setRemoteDescription(t);const i=await this._pc.createAnswer();c.debug("stopReceiving() | calling pc.setLocalDescription() [answer:%o]",i),await this._pc.setLocalDescription(i);for(const r of e)this._mapMidTransceiver.delete(r)}async pauseReceiving(e){this.assertNotClosed(),this.assertRecvDirection();for(const r of e){c.debug("pauseReceiving() [localId:%s]",r);const n=this._mapMidTransceiver.get(r);if(!n)throw new Error("associated RTCRtpTransceiver not found");n.direction="inactive",this._remoteSdp.pauseMediaSection(r)}const t={type:"offer",sdp:this._remoteSdp.getSdp()};c.debug("pauseReceiving() | calling pc.setRemoteDescription() [offer:%o]",t),await this._pc.setRemoteDescription(t);const i=await this._pc.createAnswer();c.debug("pauseReceiving() | calling pc.setLocalDescription() [answer:%o]",i),await this._pc.setLocalDescription(i)}async resumeReceiving(e){this.assertNotClosed(),this.assertRecvDirection();for(const r of e){c.debug("resumeReceiving() [localId:%s]",r);const n=this._mapMidTransceiver.get(r);if(!n)throw new Error("associated RTCRtpTransceiver not found");n.direction="recvonly",this._remoteSdp.resumeReceivingMediaSection(r)}const t={type:"offer",sdp:this._remoteSdp.getSdp()};c.debug("resumeReceiving() | calling pc.setRemoteDescription() [offer:%o]",t),await this._pc.setRemoteDescription(t);const i=await this._pc.createAnswer();c.debug("resumeReceiving() | calling pc.setLocalDescription() [answer:%o]",i),await this._pc.setLocalDescription(i)}async getReceiverStats(e){this.assertNotClosed(),this.assertRecvDirection();const t=this._mapMidTransceiver.get(e);if(!t)throw new Error("associated RTCRtpTransceiver not found");return t.receiver.getStats()}async receiveDataChannel({sctpStreamParameters:e,label:t,protocol:i}){this.assertNotClosed(),this.assertRecvDirection();const{streamId:r,ordered:n,maxPacketLifeTime:o,maxRetransmits:p}=e,l={negotiated:!0,id:r,ordered:n,maxPacketLifeTime:o,maxRetransmits:p,protocol:i};c.debug("receiveDataChannel() [options:%o]",l);const w=this._pc.createDataChannel(t,l);if(!this._hasDataChannelMediaSection){this._remoteSdp.receiveSctpAssociation();const d={type:"offer",sdp:this._remoteSdp.getSdp()};c.debug("receiveDataChannel() | calling pc.setRemoteDescription() [offer:%o]",d),await this._pc.setRemoteDescription(d);const P=await this._pc.createAnswer();if(!this._transportReady){const k=S.parse(P.sdp);await this.setupTransport({localDtlsRole:this._forcedLocalDtlsRole??"client",localSdpObject:k})}c.debug("receiveDataChannel() | calling pc.setRemoteDescription() [answer:%o]",P),await this._pc.setLocalDescription(P),this._hasDataChannelMediaSection=!0}return{dataChannel:w}}async setupTransport({localDtlsRole:e,localSdpObject:t}){t||(t=S.parse(this._pc.localDescription.sdp));const i=T.extractDtlsParameters({sdpObject:t});i.role=e,this._remoteSdp.updateDtlsRole(e==="client"?"server":"client"),await new Promise((r,n)=>{this.safeEmit("@connect",{dtlsParameters:i},r,n)}),this._transportReady=!0}assertNotClosed(){if(this._closed)throw new g.InvalidStateError("method called in a closed handler")}assertSendDirection(){if(this._direction!=="send")throw new Error('method can just be called for handlers with "send" direction')}assertRecvDirection(){if(this._direction!=="recv")throw new Error('method can just be called for handlers with "recv" direction')}};return vt.ReactNativeUnifiedPlan=a,vt}var St={},zs;function Pn(){if(zs)return St;zs=1,Object.defineProperty(St,"__esModule",{value:!0}),St.ReactNative=void 0;const S=te(),D=G(),R=Y(),u=Q(),T=X(),v=oe(),_=rr(),g=re(),y=ce(),b=new D.Logger("ReactNative"),h="ReactNative",c={OS:1024,MIS:1024};let f=class Fi extends g.HandlerInterface{_direction;_remoteSdp;_sendingRtpParametersByKind;_sendingRemoteRtpParametersByKind;_forcedLocalDtlsRole;_pc;_sendStream=new MediaStream;_mapSendLocalIdTrack=new Map;_nextSendLocalId=0;_mapRecvLocalIdInfo=new Map;_hasDataChannelMediaSection=!1;_nextSendSctpStreamId=0;_transportReady=!1;static createFactory(){return()=>new Fi}constructor(){super()}get name(){return h}close(){if(b.debug("close()"),this._sendStream.release(!1),this._pc)try{this._pc.close()}catch{}this.emit("@close")}async getNativeRtpCapabilities(){b.debug("getNativeRtpCapabilities()");const a=new RTCPeerConnection({iceServers:[],iceTransportPolicy:"all",bundlePolicy:"max-bundle",rtcpMuxPolicy:"require",sdpSemantics:"plan-b"});try{const s=await a.createOffer({offerToReceiveAudio:!0,offerToReceiveVideo:!0});try{a.close()}catch{}const e=S.parse(s.sdp);return v.extractRtpCapabilities({sdpObject:e})}catch(s){try{a.close()}catch{}throw s}}async getNativeSctpCapabilities(){return b.debug("getNativeSctpCapabilities()"),{numStreams:c}}run({direction:a,iceParameters:s,iceCandidates:e,dtlsParameters:t,sctpParameters:i,iceServers:r,iceTransportPolicy:n,additionalSettings:o,proprietaryConstraints:p,extendedRtpCapabilities:l}){b.debug("run()"),this._direction=a,this._remoteSdp=new y.RemoteSdp({iceParameters:s,iceCandidates:e,dtlsParameters:t,sctpParameters:i,planB:!0}),this._sendingRtpParametersByKind={audio:T.getSendingRtpParameters("audio",l),video:T.getSendingRtpParameters("video",l)},this._sendingRemoteRtpParametersByKind={audio:T.getSendingRemoteRtpParameters("audio",l),video:T.getSendingRemoteRtpParameters("video",l)},t.role&&t.role!=="auto"&&(this._forcedLocalDtlsRole=t.role==="server"?"client":"server"),this._pc=new RTCPeerConnection({iceServers:r??[],iceTransportPolicy:n??"all",bundlePolicy:"max-bundle",rtcpMuxPolicy:"require",sdpSemantics:"plan-b",...o},p),this._pc.addEventListener("icegatheringstatechange",()=>{this.emit("@icegatheringstatechange",this._pc.iceGatheringState)}),this._pc.addEventListener("icecandidateerror",w=>{this.emit("@icecandidateerror",w)}),this._pc.connectionState?this._pc.addEventListener("connectionstatechange",()=>{this.emit("@connectionstatechange",this._pc.connectionState)}):this._pc.addEventListener("iceconnectionstatechange",()=>{switch(b.warn("run() | pc.connectionState not supported, using pc.iceConnectionState"),this._pc.iceConnectionState){case"checking":{this.emit("@connectionstatechange","connecting");break}case"connected":case"completed":{this.emit("@connectionstatechange","connected");break}case"failed":{this.emit("@connectionstatechange","failed");break}case"disconnected":{this.emit("@connectionstatechange","disconnected");break}case"closed":{this.emit("@connectionstatechange","closed");break}}})}async updateIceServers(a){b.debug("updateIceServers()");const s=this._pc.getConfiguration();s.iceServers=a,this._pc.setConfiguration(s)}async restartIce(a){if(b.debug("restartIce()"),this._remoteSdp.updateIceParameters(a),!!this._transportReady)if(this._direction==="send"){const s=await this._pc.createOffer({iceRestart:!0});b.debug("restartIce() | calling pc.setLocalDescription() [offer:%o]",s),await this._pc.setLocalDescription(s);const e={type:"answer",sdp:this._remoteSdp.getSdp()};b.debug("restartIce() | calling pc.setRemoteDescription() [answer:%o]",e),await this._pc.setRemoteDescription(e)}else{const s={type:"offer",sdp:this._remoteSdp.getSdp()};b.debug("restartIce() | calling pc.setRemoteDescription() [offer:%o]",s),await this._pc.setRemoteDescription(s);const e=await this._pc.createAnswer();b.debug("restartIce() | calling pc.setLocalDescription() [answer:%o]",e),await this._pc.setLocalDescription(e)}}async getTransportStats(){return this._pc.getStats()}async send({track:a,encodings:s,codecOptions:e,codec:t}){this.assertSendDirection(),b.debug("send() [kind:%s, track.id:%s]",a.kind,a.id),t&&b.warn("send() | codec selection is not available in %s handler",this.name),this._sendStream.addTrack(a),this._pc.addStream(this._sendStream);let i=await this._pc.createOffer(),r=S.parse(i.sdp);r.extmapAllowMixed&&this._remoteSdp.setSessionExtmapAllowMixed();let n;const o=u.clone(this._sendingRtpParametersByKind[a.kind]);o.codecs=T.reduceCodecs(o.codecs);const p=u.clone(this._sendingRemoteRtpParametersByKind[a.kind]);if(p.codecs=T.reduceCodecs(p.codecs),this._transportReady||await this.setupTransport({localDtlsRole:this._forcedLocalDtlsRole??"client",localSdpObject:r}),a.kind==="video"&&s&&s.length>1&&(b.debug("send() | enabling simulcast"),r=S.parse(i.sdp),n=r.media.find(d=>d.type==="video"),_.addLegacySimulcast({offerMediaObject:n,track:a,numStreams:s.length}),i={type:"offer",sdp:S.write(r)}),b.debug("send() | calling pc.setLocalDescription() [offer:%o]",i),await this._pc.setLocalDescription(i),r=S.parse(this._pc.localDescription.sdp),n=r.media.find(d=>d.type===a.kind),o.rtcp.cname=v.getCname({offerMediaObject:n}),o.encodings=_.getRtpEncodings({offerMediaObject:n,track:a}),s)for(let d=0;d<o.encodings.length;++d)s[d]&&Object.assign(o.encodings[d],s[d]);if(o.encodings.length>1&&(o.codecs[0].mimeType.toLowerCase()==="video/vp8"||o.codecs[0].mimeType.toLowerCase()==="video/h264"))for(const d of o.encodings)d.scalabilityMode="L1T3";this._remoteSdp.send({offerMediaObject:n,offerRtpParameters:o,answerRtpParameters:p,codecOptions:e});const l={type:"answer",sdp:this._remoteSdp.getSdp()};b.debug("send() | calling pc.setRemoteDescription() [answer:%o]",l),await this._pc.setRemoteDescription(l);const w=String(this._nextSendLocalId);return this._nextSendLocalId++,this._mapSendLocalIdTrack.set(w,a),{localId:w,rtpParameters:o}}async stopSending(a){this.assertSendDirection(),b.debug("stopSending() [localId:%s]",a);const s=this._mapSendLocalIdTrack.get(a);if(!s)throw new Error("track not found");this._mapSendLocalIdTrack.delete(a),this._sendStream.removeTrack(s),this._pc.addStream(this._sendStream);const e=await this._pc.createOffer();b.debug("stopSending() | calling pc.setLocalDescription() [offer:%o]",e);try{await this._pc.setLocalDescription(e)}catch(i){if(this._sendStream.getTracks().length===0){b.warn("stopSending() | ignoring expected error due no sending tracks: %s",i.toString());return}throw i}if(this._pc.signalingState==="stable")return;const t={type:"answer",sdp:this._remoteSdp.getSdp()};b.debug("stopSending() | calling pc.setRemoteDescription() [answer:%o]",t),await this._pc.setRemoteDescription(t)}async pauseSending(a){}async resumeSending(a){}async replaceTrack(a,s){throw new R.UnsupportedError("not implemented")}async setMaxSpatialLayer(a,s){throw new R.UnsupportedError("not implemented")}async setRtpEncodingParameters(a,s){throw new R.UnsupportedError("not implemented")}async getSenderStats(a){throw new R.UnsupportedError("not implemented")}async sendDataChannel({ordered:a,maxPacketLifeTime:s,maxRetransmits:e,label:t,protocol:i}){this.assertSendDirection();const r={negotiated:!0,id:this._nextSendSctpStreamId,ordered:a,maxPacketLifeTime:s,maxRetransmitTime:s,maxRetransmits:e,protocol:i};b.debug("sendDataChannel() [options:%o]",r);const n=this._pc.createDataChannel(t,r);if(this._nextSendSctpStreamId=++this._nextSendSctpStreamId%c.MIS,!this._hasDataChannelMediaSection){const p=await this._pc.createOffer(),l=S.parse(p.sdp),w=l.media.find(P=>P.type==="application");this._transportReady||await this.setupTransport({localDtlsRole:this._forcedLocalDtlsRole??"client",localSdpObject:l}),b.debug("sendDataChannel() | calling pc.setLocalDescription() [offer:%o]",p),await this._pc.setLocalDescription(p),this._remoteSdp.sendSctpAssociation({offerMediaObject:w});const d={type:"answer",sdp:this._remoteSdp.getSdp()};b.debug("sendDataChannel() | calling pc.setRemoteDescription() [answer:%o]",d),await this._pc.setRemoteDescription(d),this._hasDataChannelMediaSection=!0}const o={streamId:r.id,ordered:r.ordered,maxPacketLifeTime:r.maxPacketLifeTime,maxRetransmits:r.maxRetransmits};return{dataChannel:n,sctpStreamParameters:o}}async receive(a){this.assertRecvDirection();const s=[],e=new Map;for(const n of a){const{trackId:o,kind:p,rtpParameters:l}=n;b.debug("receive() [trackId:%s, kind:%s]",o,p);const w=p;let d=n.streamId??l.rtcp.cname;b.debug("receive() | forcing a random remote streamId to avoid well known bug in react-native-webrtc"),d+=`-hack-${u.generateRandomNumber()}`,e.set(o,d),this._remoteSdp.receive({mid:w,kind:p,offerRtpParameters:l,streamId:d,trackId:o})}const t={type:"offer",sdp:this._remoteSdp.getSdp()};b.debug("receive() | calling pc.setRemoteDescription() [offer:%o]",t),await this._pc.setRemoteDescription(t);let i=await this._pc.createAnswer();const r=S.parse(i.sdp);for(const n of a){const{kind:o,rtpParameters:p}=n,l=o,w=r.media.find(d=>String(d.mid)===l);v.applyCodecParameters({offerRtpParameters:p,answerMediaObject:w})}i={type:"answer",sdp:S.write(r)},this._transportReady||await this.setupTransport({localDtlsRole:this._forcedLocalDtlsRole??"client",localSdpObject:r}),b.debug("receive() | calling pc.setLocalDescription() [answer:%o]",i),await this._pc.setLocalDescription(i);for(const n of a){const{kind:o,trackId:p,rtpParameters:l}=n,w=p,d=o,P=e.get(p),x=this._pc.getRemoteStreams().find(C=>C.id===P).getTrackById(w);if(!x)throw new Error("remote track not found");this._mapRecvLocalIdInfo.set(w,{mid:d,rtpParameters:l}),s.push({localId:w,track:x})}return s}async stopReceiving(a){this.assertRecvDirection();for(const t of a){b.debug("stopReceiving() [localId:%s]",t);const{mid:i,rtpParameters:r}=this._mapRecvLocalIdInfo.get(t)??{};this._mapRecvLocalIdInfo.delete(t),this._remoteSdp.planBStopReceiving({mid:i,offerRtpParameters:r})}const s={type:"offer",sdp:this._remoteSdp.getSdp()};b.debug("stopReceiving() | calling pc.setRemoteDescription() [offer:%o]",s),await this._pc.setRemoteDescription(s);const e=await this._pc.createAnswer();b.debug("stopReceiving() | calling pc.setLocalDescription() [answer:%o]",e),await this._pc.setLocalDescription(e)}async pauseReceiving(a){}async resumeReceiving(a){}async getReceiverStats(a){throw new R.UnsupportedError("not implemented")}async receiveDataChannel({sctpStreamParameters:a,label:s,protocol:e}){this.assertRecvDirection();const{streamId:t,ordered:i,maxPacketLifeTime:r,maxRetransmits:n}=a,o={negotiated:!0,id:t,ordered:i,maxPacketLifeTime:r,maxRetransmitTime:r,maxRetransmits:n,protocol:e};b.debug("receiveDataChannel() [options:%o]",o);const p=this._pc.createDataChannel(s,o);if(!this._hasDataChannelMediaSection){this._remoteSdp.receiveSctpAssociation({oldDataChannelSpec:!0});const l={type:"offer",sdp:this._remoteSdp.getSdp()};b.debug("receiveDataChannel() | calling pc.setRemoteDescription() [offer:%o]",l),await this._pc.setRemoteDescription(l);const w=await this._pc.createAnswer();if(!this._transportReady){const d=S.parse(w.sdp);await this.setupTransport({localDtlsRole:this._forcedLocalDtlsRole??"client",localSdpObject:d})}b.debug("receiveDataChannel() | calling pc.setRemoteDescription() [answer:%o]",w),await this._pc.setLocalDescription(w),this._hasDataChannelMediaSection=!0}return{dataChannel:p}}async setupTransport({localDtlsRole:a,localSdpObject:s}){s||(s=S.parse(this._pc.localDescription.sdp));const e=v.extractDtlsParameters({sdpObject:s});e.role=a,this._remoteSdp.updateDtlsRole(a==="client"?"server":"client"),await new Promise((t,i)=>{this.safeEmit("@connect",{dtlsParameters:e},t,i)}),this._transportReady=!0}assertSendDirection(){if(this._direction!=="send")throw new Error('method can just be called for handlers with "send" direction')}assertRecvDirection(){if(this._direction!=="recv")throw new Error('method can just be called for handlers with "recv" direction')}};return St.ReactNative=f,St}var Hs;function qi(){if(Hs)return Te;Hs=1,Object.defineProperty(Te,"__esModule",{value:!0}),Te.Device=void 0,Te.detectDeviceAsync=n,Te.detectDevice=o;const S=nn(),D=G(),R=ve(),u=Y(),T=Q(),v=X(),_=Di(),g=mn(),y=gn(),b=_n(),h=wn(),c=vn(),f=Sn(),m=bn(),a=yn(),s=Rn(),e=Tn(),t=Dn(),i=Pn(),r=new D.Logger("Device");async function n(w){r.debug("detectDeviceAsync() [userAgent:%s]",w),!w&&typeof navigator=="object"&&(w=navigator.userAgent);const d=await(0,S.UAParser)(w).withFeatureCheck();return l(d)}function o(w){r.debug("detectDevice() [userAgent:%s]",w),!w&&typeof navigator=="object"&&(w=navigator.userAgent);const d=(0,S.UAParser)(w);return l(d)}let p=class Ui{_handlerFactory;_handlerName;_loaded=!1;_extendedRtpCapabilities;_recvRtpCapabilities;_canProduceByKind;_sctpCapabilities;_observer=new R.EnhancedEventEmitter;static async factory({handlerName:d,handlerFactory:P}={}){if(r.debug("factory()"),d&&P)throw new TypeError("just one of handlerName or handlerInterface can be given");if(!d&&!P&&(d=await n(),!d))throw new u.UnsupportedError("device not supported");return new Ui({handlerName:d,handlerFactory:P})}constructor({handlerName:d,handlerFactory:P}={}){if(r.debug("constructor()"),d&&P)throw new TypeError("just one of handlerName or handlerInterface can be given");if(P)this._handlerFactory=P;else{if(d)r.debug("constructor() | handler given: %s",d);else if(d=o(),d)r.debug("constructor() | detected handler: %s",d);else throw new u.UnsupportedError("device not supported");switch(d){case"Chrome111":{this._handlerFactory=g.Chrome111.createFactory();break}case"Chrome74":{this._handlerFactory=y.Chrome74.createFactory();break}case"Chrome70":{this._handlerFactory=b.Chrome70.createFactory();break}case"Chrome67":{this._handlerFactory=h.Chrome67.createFactory();break}case"Chrome55":{this._handlerFactory=c.Chrome55.createFactory();break}case"Firefox120":{this._handlerFactory=f.Firefox120.createFactory();break}case"Firefox60":{this._handlerFactory=m.Firefox60.createFactory();break}case"Safari12":{this._handlerFactory=a.Safari12.createFactory();break}case"Safari11":{this._handlerFactory=s.Safari11.createFactory();break}case"Edge11":{this._handlerFactory=e.Edge11.createFactory();break}case"ReactNativeUnifiedPlan":{this._handlerFactory=t.ReactNativeUnifiedPlan.createFactory();break}case"ReactNative":{this._handlerFactory=i.ReactNative.createFactory();break}default:throw new TypeError(`unknown handlerName "${d}"`)}}const k=this._handlerFactory();this._handlerName=k.name,k.close(),this._extendedRtpCapabilities=void 0,this._recvRtpCapabilities=void 0,this._canProduceByKind={audio:!1,video:!1},this._sctpCapabilities=void 0}get handlerName(){return this._handlerName}get loaded(){return this._loaded}get rtpCapabilities(){if(!this._loaded)throw new u.InvalidStateError("not loaded");return this._recvRtpCapabilities}get sctpCapabilities(){if(!this._loaded)throw new u.InvalidStateError("not loaded");return this._sctpCapabilities}get observer(){return this._observer}async load({routerRtpCapabilities:d,preferLocalCodecsOrder:P=!1}){r.debug("load() [routerRtpCapabilities:%o]",d);let k;try{if(this._loaded)throw new u.InvalidStateError("already loaded");const x=T.clone(d);v.validateRtpCapabilities(x),k=this._handlerFactory();const C=await k.getNativeRtpCapabilities();r.debug("load() | got native RTP capabilities:%o",C);const E=T.clone(C);v.validateRtpCapabilities(E),this._extendedRtpCapabilities=v.getExtendedRtpCapabilities(E,x,P),r.debug("load() | got extended RTP capabilities:%o",this._extendedRtpCapabilities),this._canProduceByKind.audio=v.canSend("audio",this._extendedRtpCapabilities),this._canProduceByKind.video=v.canSend("video",this._extendedRtpCapabilities),this._recvRtpCapabilities=v.getRecvRtpCapabilities(this._extendedRtpCapabilities),v.validateRtpCapabilities(this._recvRtpCapabilities),r.debug("load() | got receiving RTP capabilities:%o",this._recvRtpCapabilities),this._sctpCapabilities=await k.getNativeSctpCapabilities(),r.debug("load() | got native SCTP capabilities:%o",this._sctpCapabilities),v.validateSctpCapabilities(this._sctpCapabilities),r.debug("load() succeeded"),this._loaded=!0,k.close()}catch(x){throw k&&k.close(),x}}canProduce(d){if(this._loaded){if(d!=="audio"&&d!=="video")throw new TypeError(`invalid kind "${d}"`)}else throw new u.InvalidStateError("not loaded");return this._canProduceByKind[d]}createSendTransport({id:d,iceParameters:P,iceCandidates:k,dtlsParameters:x,sctpParameters:C,iceServers:E,iceTransportPolicy:I,additionalSettings:L,proprietaryConstraints:O,appData:F}){return r.debug("createSendTransport()"),this.createTransport({direction:"send",id:d,iceParameters:P,iceCandidates:k,dtlsParameters:x,sctpParameters:C,iceServers:E,iceTransportPolicy:I,additionalSettings:L,proprietaryConstraints:O,appData:F})}createRecvTransport({id:d,iceParameters:P,iceCandidates:k,dtlsParameters:x,sctpParameters:C,iceServers:E,iceTransportPolicy:I,additionalSettings:L,proprietaryConstraints:O,appData:F}){return r.debug("createRecvTransport()"),this.createTransport({direction:"recv",id:d,iceParameters:P,iceCandidates:k,dtlsParameters:x,sctpParameters:C,iceServers:E,iceTransportPolicy:I,additionalSettings:L,proprietaryConstraints:O,appData:F})}createTransport({direction:d,id:P,iceParameters:k,iceCandidates:x,dtlsParameters:C,sctpParameters:E,iceServers:I,iceTransportPolicy:L,additionalSettings:O,proprietaryConstraints:F,appData:$}){if(this._loaded){if(typeof P!="string")throw new TypeError("missing id");if(typeof k!="object")throw new TypeError("missing iceParameters");if(Array.isArray(x)){if(typeof C!="object")throw new TypeError("missing dtlsParameters");if(E&&typeof E!="object")throw new TypeError("wrong sctpParameters");if($&&typeof $!="object")throw new TypeError("if given, appData must be an object")}else throw new TypeError("missing iceCandidates")}else throw new u.InvalidStateError("not loaded");const H=new _.Transport({direction:d,id:P,iceParameters:k,iceCandidates:x,dtlsParameters:C,sctpParameters:E,iceServers:I,iceTransportPolicy:L,additionalSettings:O,proprietaryConstraints:F,appData:$,handlerFactory:this._handlerFactory,extendedRtpCapabilities:this._extendedRtpCapabilities,canProduceByKind:this._canProduceByKind});return this._observer.safeEmit("newtransport",H),H}};Te.Device=p;function l(w){if(typeof navigator=="object"&&navigator.product==="ReactNative"){if(r.debug("detectDeviceImpl() | React-Native detected"),typeof RTCPeerConnection>"u"){r.warn("detectDeviceImpl() | unsupported react-native-webrtc without RTCPeerConnection, forgot to call registerGlobals()?");return}return typeof RTCRtpTransceiver<"u"?(r.debug("detectDeviceImpl() | ReactNative UnifiedPlan handler chosen"),"ReactNativeUnifiedPlan"):(r.debug("detectDeviceImpl() | ReactNative PlanB handler chosen"),"ReactNative")}else{r.debug("detectDeviceImpl() | browser detected [userAgent:%s, parsed:%o]",w.ua,w);const d=w.browser,P=d.name?.toLowerCase(),k=parseInt(d.major??"0"),C=w.engine.name?.toLowerCase(),E=w.os,I=E.name?.toLowerCase(),L=parseFloat(E.version??"0"),F=w.device.model?.toLowerCase(),$=I==="ios"||F==="ipad",H=P&&["chrome","chromium","mobile chrome","chrome webview","chrome headless"].includes(P),J=P&&["firefox","mobile firefox","mobile focus"].includes(P),ye=P&&["safari","mobile safari"].includes(P),me=P&&["edge"].includes(P);if((H||me)&&!$&&k>=111)return"Chrome111";if(H&&!$&&k>=74||me&&!$&&k>=88)return"Chrome74";if(H&&!$&&k>=70)return"Chrome70";if(H&&!$&&k>=67)return"Chrome67";if(H&&!$&&k>=55)return"Chrome55";if(J&&!$&&k>=120)return"Firefox120";if(J&&!$&&k>=60)return"Firefox60";if(J&&$&&L>=14.3)return"Safari12";if(ye&&k>=12&&typeof RTCRtpTransceiver<"u"&&RTCRtpTransceiver.prototype.hasOwnProperty("currentDirection"))return"Safari12";if(ye&&k>=11)return"Safari11";if(me&&!$&&k>=11&&k<=18)return"Edge11";if(C==="webkit"&&$&&typeof RTCRtpTransceiver<"u"&&RTCRtpTransceiver.prototype.hasOwnProperty("currentDirection"))return"Safari12";if(C==="blink"){const ie=w.ua.match(/(?:(?:Chrome|Chromium))[ /](\w+)/i);if(ie){const Le=Number(ie[1]);return Le>=111?"Chrome111":Le>=74?"Chrome74":Le>=70?"Chrome70":Le>=67?"Chrome67":"Chrome55"}else return"Chrome111"}else{r.warn("detectDeviceImpl() | browser not supported [name:%s, version:%s]",P,k);return}}}return Te}var Pr={},Vs;function kn(){return Vs||(Vs=1,Object.defineProperty(Pr,"__esModule",{value:!0})),Pr}var kr={},Ks;function En(){return Ks||(Ks=1,Object.defineProperty(kr,"__esModule",{value:!0})),kr}var Gs;function xn(){return Gs||(Gs=1,function(S){var D=Ce&&Ce.__createBinding||(Object.create?function(u,T,v,_){_===void 0&&(_=v);var g=Object.getOwnPropertyDescriptor(T,v);(!g||("get"in g?!T.__esModule:g.writable||g.configurable))&&(g={enumerable:!0,get:function(){return T[v]}}),Object.defineProperty(u,_,g)}:function(u,T,v,_){_===void 0&&(_=v),u[_]=T[v]}),R=Ce&&Ce.__exportStar||function(u,T){for(var v in u)v!=="default"&&!Object.prototype.hasOwnProperty.call(T,v)&&D(T,u,v)};Object.defineProperty(S,"__esModule",{value:!0}),R(qi(),S),R(Di(),S),R(yi(),S),R(Ri(),S),R(Ci(),S),R(Ti(),S),R(kn(),S),R(En(),S),R(re(),S),R(Y(),S)}(Ce)),Ce}var bt={},yt={},Er={},Ft={},Qs;function Ln(){return Qs||(Qs=1,Object.defineProperty(Ft,"__esModule",{value:!0}),Ft.default="ffffffff-ffff-ffff-ffff-ffffffffffff"),Ft}var Ut={},Ws;function In(){return Ws||(Ws=1,Object.defineProperty(Ut,"__esModule",{value:!0}),Ut.default="00000000-0000-0000-0000-000000000000"),Ut}var qt={},$t={},Bt={},Ys;function Mn(){return Ys||(Ys=1,Object.defineProperty(Bt,"__esModule",{value:!0}),Bt.default=/^(?:[0-9a-f]{8}-[0-9a-f]{4}-[1-8][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}|00000000-0000-0000-0000-000000000000|ffffffff-ffff-ffff-ffff-ffffffffffff)$/i),Bt}var Xs;function sr(){if(Xs)return $t;Xs=1,Object.defineProperty($t,"__esModule",{value:!0});const S=Mn();function D(R){return typeof R=="string"&&S.default.test(R)}return $t.default=D,$t}var Js;function ir(){if(Js)return qt;Js=1,Object.defineProperty(qt,"__esModule",{value:!0});const S=sr();function D(R){if(!(0,S.default)(R))throw TypeError("Invalid UUID");let u;return Uint8Array.of((u=parseInt(R.slice(0,8),16))>>>24,u>>>16&255,u>>>8&255,u&255,(u=parseInt(R.slice(9,13),16))>>>8,u&255,(u=parseInt(R.slice(14,18),16))>>>8,u&255,(u=parseInt(R.slice(19,23),16))>>>8,u&255,(u=parseInt(R.slice(24,36),16))/1099511627776&255,u/4294967296&255,u>>>24&255,u>>>16&255,u>>>8&255,u&255)}return qt.default=D,qt}var Fe={},Zs;function be(){if(Zs)return Fe;Zs=1,Object.defineProperty(Fe,"__esModule",{value:!0}),Fe.unsafeStringify=void 0;const S=sr(),D=[];for(let T=0;T<256;++T)D.push((T+256).toString(16).slice(1));function R(T,v=0){return(D[T[v+0]]+D[T[v+1]]+D[T[v+2]]+D[T[v+3]]+"-"+D[T[v+4]]+D[T[v+5]]+"-"+D[T[v+6]]+D[T[v+7]]+"-"+D[T[v+8]]+D[T[v+9]]+"-"+D[T[v+10]]+D[T[v+11]]+D[T[v+12]]+D[T[v+13]]+D[T[v+14]]+D[T[v+15]]).toLowerCase()}Fe.unsafeStringify=R;function u(T,v=0){const _=R(T,v);if(!(0,S.default)(_))throw TypeError("Stringified UUID is invalid");return _}return Fe.default=u,Fe}var Ue={},zt={},ei;function Mr(){if(ei)return zt;ei=1,Object.defineProperty(zt,"__esModule",{value:!0});let S;const D=new Uint8Array(16);function R(){if(!S){if(typeof crypto>"u"||!crypto.getRandomValues)throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");S=crypto.getRandomValues.bind(crypto)}return S(D)}return zt.default=R,zt}var ti;function $i(){if(ti)return Ue;ti=1,Object.defineProperty(Ue,"__esModule",{value:!0}),Ue.updateV1State=void 0;const S=Mr(),D=be(),R={};function u(_,g,y){let b;const h=_?._v6??!1;if(_){const c=Object.keys(_);c.length===1&&c[0]==="_v6"&&(_=void 0)}if(_)b=v(_.random??_.rng?.()??(0,S.default)(),_.msecs,_.nsecs,_.clockseq,_.node,g,y);else{const c=Date.now(),f=(0,S.default)();T(R,c,f),b=v(f,R.msecs,R.nsecs,h?void 0:R.clockseq,h?void 0:R.node,g,y)}return g??(0,D.unsafeStringify)(b)}function T(_,g,y){return _.msecs??=-1/0,_.nsecs??=0,g===_.msecs?(_.nsecs++,_.nsecs>=1e4&&(_.node=void 0,_.nsecs=0)):g>_.msecs?_.nsecs=0:g<_.msecs&&(_.node=void 0),_.node||(_.node=y.slice(10,16),_.node[0]|=1,_.clockseq=(y[8]<<8|y[9])&16383),_.msecs=g,_}Ue.updateV1State=T;function v(_,g,y,b,h,c,f=0){if(_.length<16)throw new Error("Random bytes length must be >= 16");if(!c)c=new Uint8Array(16),f=0;else if(f<0||f+16>c.length)throw new RangeError(`UUID byte range ${f}:${f+15} is out of buffer bounds`);g??=Date.now(),y??=0,b??=(_[8]<<8|_[9])&16383,h??=_.slice(10,16),g+=122192928e5;const m=((g&268435455)*1e4+y)%4294967296;c[f++]=m>>>24&255,c[f++]=m>>>16&255,c[f++]=m>>>8&255,c[f++]=m&255;const a=g/4294967296*1e4&268435455;c[f++]=a>>>8&255,c[f++]=a&255,c[f++]=a>>>24&15|16,c[f++]=a>>>16&255,c[f++]=b>>>8|128,c[f++]=b&255;for(let s=0;s<6;++s)c[f++]=h[s];return c}return Ue.default=u,Ue}var Ht={},ri;function Bi(){if(ri)return Ht;ri=1,Object.defineProperty(Ht,"__esModule",{value:!0});const S=ir(),D=be();function R(T){const v=typeof T=="string"?(0,S.default)(T):T,_=u(v);return typeof T=="string"?(0,D.unsafeStringify)(_):_}Ht.default=R;function u(T){return Uint8Array.of((T[6]&15)<<4|T[7]>>4&15,(T[7]&15)<<4|(T[4]&240)>>4,(T[4]&15)<<4|(T[5]&240)>>4,(T[5]&15)<<4|(T[0]&240)>>4,(T[0]&15)<<4|(T[1]&240)>>4,(T[1]&15)<<4|(T[2]&240)>>4,96|T[2]&15,T[3],T[8],T[9],T[10],T[11],T[12],T[13],T[14],T[15])}return Ht}var xr={},Vt={},si;function On(){if(si)return Vt;si=1,Object.defineProperty(Vt,"__esModule",{value:!0});function S(f){const m=T(f),a=u(m,f.length*8);return D(a)}function D(f){const m=new Uint8Array(f.length*4);for(let a=0;a<f.length*4;a++)m[a]=f[a>>2]>>>a%4*8&255;return m}function R(f){return(f+64>>>9<<4)+14+1}function u(f,m){const a=new Uint32Array(R(m)).fill(0);a.set(f),a[m>>5]|=128<<m%32,a[a.length-1]=m,f=a;let s=1732584193,e=-271733879,t=-1732584194,i=271733878;for(let r=0;r<f.length;r+=16){const n=s,o=e,p=t,l=i;s=y(s,e,t,i,f[r],7,-680876936),i=y(i,s,e,t,f[r+1],12,-389564586),t=y(t,i,s,e,f[r+2],17,606105819),e=y(e,t,i,s,f[r+3],22,-1044525330),s=y(s,e,t,i,f[r+4],7,-176418897),i=y(i,s,e,t,f[r+5],12,1200080426),t=y(t,i,s,e,f[r+6],17,-1473231341),e=y(e,t,i,s,f[r+7],22,-45705983),s=y(s,e,t,i,f[r+8],7,1770035416),i=y(i,s,e,t,f[r+9],12,-1958414417),t=y(t,i,s,e,f[r+10],17,-42063),e=y(e,t,i,s,f[r+11],22,-1990404162),s=y(s,e,t,i,f[r+12],7,1804603682),i=y(i,s,e,t,f[r+13],12,-40341101),t=y(t,i,s,e,f[r+14],17,-1502002290),e=y(e,t,i,s,f[r+15],22,1236535329),s=b(s,e,t,i,f[r+1],5,-165796510),i=b(i,s,e,t,f[r+6],9,-1069501632),t=b(t,i,s,e,f[r+11],14,643717713),e=b(e,t,i,s,f[r],20,-373897302),s=b(s,e,t,i,f[r+5],5,-701558691),i=b(i,s,e,t,f[r+10],9,38016083),t=b(t,i,s,e,f[r+15],14,-660478335),e=b(e,t,i,s,f[r+4],20,-405537848),s=b(s,e,t,i,f[r+9],5,568446438),i=b(i,s,e,t,f[r+14],9,-1019803690),t=b(t,i,s,e,f[r+3],14,-187363961),e=b(e,t,i,s,f[r+8],20,1163531501),s=b(s,e,t,i,f[r+13],5,-1444681467),i=b(i,s,e,t,f[r+2],9,-51403784),t=b(t,i,s,e,f[r+7],14,1735328473),e=b(e,t,i,s,f[r+12],20,-1926607734),s=h(s,e,t,i,f[r+5],4,-378558),i=h(i,s,e,t,f[r+8],11,-2022574463),t=h(t,i,s,e,f[r+11],16,1839030562),e=h(e,t,i,s,f[r+14],23,-35309556),s=h(s,e,t,i,f[r+1],4,-1530992060),i=h(i,s,e,t,f[r+4],11,1272893353),t=h(t,i,s,e,f[r+7],16,-155497632),e=h(e,t,i,s,f[r+10],23,-1094730640),s=h(s,e,t,i,f[r+13],4,681279174),i=h(i,s,e,t,f[r],11,-358537222),t=h(t,i,s,e,f[r+3],16,-722521979),e=h(e,t,i,s,f[r+6],23,76029189),s=h(s,e,t,i,f[r+9],4,-640364487),i=h(i,s,e,t,f[r+12],11,-421815835),t=h(t,i,s,e,f[r+15],16,530742520),e=h(e,t,i,s,f[r+2],23,-995338651),s=c(s,e,t,i,f[r],6,-198630844),i=c(i,s,e,t,f[r+7],10,1126891415),t=c(t,i,s,e,f[r+14],15,-1416354905),e=c(e,t,i,s,f[r+5],21,-57434055),s=c(s,e,t,i,f[r+12],6,1700485571),i=c(i,s,e,t,f[r+3],10,-1894986606),t=c(t,i,s,e,f[r+10],15,-1051523),e=c(e,t,i,s,f[r+1],21,-2054922799),s=c(s,e,t,i,f[r+8],6,1873313359),i=c(i,s,e,t,f[r+15],10,-30611744),t=c(t,i,s,e,f[r+6],15,-1560198380),e=c(e,t,i,s,f[r+13],21,1309151649),s=c(s,e,t,i,f[r+4],6,-145523070),i=c(i,s,e,t,f[r+11],10,-1120210379),t=c(t,i,s,e,f[r+2],15,718787259),e=c(e,t,i,s,f[r+9],21,-343485551),s=v(s,n),e=v(e,o),t=v(t,p),i=v(i,l)}return Uint32Array.of(s,e,t,i)}function T(f){if(f.length===0)return new Uint32Array;const m=new Uint32Array(R(f.length*8)).fill(0);for(let a=0;a<f.length;a++)m[a>>2]|=(f[a]&255)<<a%4*8;return m}function v(f,m){const a=(f&65535)+(m&65535);return(f>>16)+(m>>16)+(a>>16)<<16|a&65535}function _(f,m){return f<<m|f>>>32-m}function g(f,m,a,s,e,t){return v(_(v(v(m,f),v(s,t)),e),a)}function y(f,m,a,s,e,t,i){return g(m&a|~m&s,f,m,e,t,i)}function b(f,m,a,s,e,t,i){return g(m&s|a&~s,f,m,e,t,i)}function h(f,m,a,s,e,t,i){return g(m^a^s,f,m,e,t,i)}function c(f,m,a,s,e,t,i){return g(a^(m|~s),f,m,e,t,i)}return Vt.default=S,Vt}var pe={},ii;function Zt(){if(ii)return pe;ii=1,Object.defineProperty(pe,"__esModule",{value:!0}),pe.URL=pe.DNS=pe.stringToBytes=void 0;const S=ir(),D=be();function R(T){T=unescape(encodeURIComponent(T));const v=new Uint8Array(T.length);for(let _=0;_<T.length;++_)v[_]=T.charCodeAt(_);return v}pe.stringToBytes=R,pe.DNS="6ba7b810-9dad-11d1-80b4-00c04fd430c8",pe.URL="6ba7b811-9dad-11d1-80b4-00c04fd430c8";function u(T,v,_,g,y,b){const h=typeof _=="string"?R(_):_,c=typeof g=="string"?(0,S.default)(g):g;if(typeof g=="string"&&(g=(0,S.default)(g)),g?.length!==16)throw TypeError("Namespace must be array-like (16 iterable integer values, 0-255)");let f=new Uint8Array(16+h.length);if(f.set(c),f.set(h,c.length),f=v(f),f[6]=f[6]&15|T,f[8]=f[8]&63|128,y){b=b||0;for(let m=0;m<16;++m)y[b+m]=f[m];return y}return(0,D.unsafeStringify)(f)}return pe.default=u,pe}var ni;function jn(){return ni||(ni=1,function(S){Object.defineProperty(S,"__esModule",{value:!0}),S.URL=S.DNS=void 0;const D=On(),R=Zt();var u=Zt();Object.defineProperty(S,"DNS",{enumerable:!0,get:function(){return u.DNS}}),Object.defineProperty(S,"URL",{enumerable:!0,get:function(){return u.URL}});function T(v,_,g,y){return(0,R.default)(48,D.default,v,_,g,y)}T.DNS=R.DNS,T.URL=R.URL,S.default=T}(xr)),xr}var Kt={},Gt={},ai;function An(){if(ai)return Gt;ai=1,Object.defineProperty(Gt,"__esModule",{value:!0});const S=typeof crypto<"u"&&crypto.randomUUID&&crypto.randomUUID.bind(crypto);return Gt.default={randomUUID:S},Gt}var oi;function Nn(){if(oi)return Kt;oi=1,Object.defineProperty(Kt,"__esModule",{value:!0});const S=An(),D=Mr(),R=be();function u(T,v,_){if(S.default.randomUUID&&!v&&!T)return S.default.randomUUID();T=T||{};const g=T.random??T.rng?.()??(0,D.default)();if(g.length<16)throw new Error("Random bytes length must be >= 16");if(g[6]=g[6]&15|64,g[8]=g[8]&63|128,v){if(_=_||0,_<0||_+16>v.length)throw new RangeError(`UUID byte range ${_}:${_+15} is out of buffer bounds`);for(let y=0;y<16;++y)v[_+y]=g[y];return v}return(0,R.unsafeStringify)(g)}return Kt.default=u,Kt}var Lr={},Qt={},ci;function Fn(){if(ci)return Qt;ci=1,Object.defineProperty(Qt,"__esModule",{value:!0});function S(u,T,v,_){switch(u){case 0:return T&v^~T&_;case 1:return T^v^_;case 2:return T&v^T&_^v&_;case 3:return T^v^_}}function D(u,T){return u<<T|u>>>32-T}function R(u){const T=[1518500249,1859775393,2400959708,3395469782],v=[1732584193,4023233417,2562383102,271733878,3285377520],_=new Uint8Array(u.length+1);_.set(u),_[u.length]=128,u=_;const g=u.length/4+2,y=Math.ceil(g/16),b=new Array(y);for(let h=0;h<y;++h){const c=new Uint32Array(16);for(let f=0;f<16;++f)c[f]=u[h*64+f*4]<<24|u[h*64+f*4+1]<<16|u[h*64+f*4+2]<<8|u[h*64+f*4+3];b[h]=c}b[y-1][14]=(u.length-1)*8/Math.pow(2,32),b[y-1][14]=Math.floor(b[y-1][14]),b[y-1][15]=(u.length-1)*8&4294967295;for(let h=0;h<y;++h){const c=new Uint32Array(80);for(let t=0;t<16;++t)c[t]=b[h][t];for(let t=16;t<80;++t)c[t]=D(c[t-3]^c[t-8]^c[t-14]^c[t-16],1);let f=v[0],m=v[1],a=v[2],s=v[3],e=v[4];for(let t=0;t<80;++t){const i=Math.floor(t/20),r=D(f,5)+S(i,m,a,s)+e+T[i]+c[t]>>>0;e=s,s=a,a=D(m,30)>>>0,m=f,f=r}v[0]=v[0]+f>>>0,v[1]=v[1]+m>>>0,v[2]=v[2]+a>>>0,v[3]=v[3]+s>>>0,v[4]=v[4]+e>>>0}return Uint8Array.of(v[0]>>24,v[0]>>16,v[0]>>8,v[0],v[1]>>24,v[1]>>16,v[1]>>8,v[1],v[2]>>24,v[2]>>16,v[2]>>8,v[2],v[3]>>24,v[3]>>16,v[3]>>8,v[3],v[4]>>24,v[4]>>16,v[4]>>8,v[4])}return Qt.default=R,Qt}var di;function Un(){return di||(di=1,function(S){Object.defineProperty(S,"__esModule",{value:!0}),S.URL=S.DNS=void 0;const D=Fn(),R=Zt();var u=Zt();Object.defineProperty(S,"DNS",{enumerable:!0,get:function(){return u.DNS}}),Object.defineProperty(S,"URL",{enumerable:!0,get:function(){return u.URL}});function T(v,_,g,y){return(0,R.default)(80,D.default,v,_,g,y)}T.DNS=R.DNS,T.URL=R.URL,S.default=T}(Lr)),Lr}var Wt={},pi;function qn(){if(pi)return Wt;pi=1,Object.defineProperty(Wt,"__esModule",{value:!0});const S=be(),D=$i(),R=Bi();function u(T,v,_){T??={},_??=0;let g=(0,D.default)({...T,_v6:!0},new Uint8Array(16));if(g=(0,R.default)(g),v){for(let y=0;y<16;y++)v[_+y]=g[y];return v}return(0,S.unsafeStringify)(g)}return Wt.default=u,Wt}var Yt={},li;function $n(){if(li)return Yt;li=1,Object.defineProperty(Yt,"__esModule",{value:!0});const S=ir(),D=be();function R(T){const v=typeof T=="string"?(0,S.default)(T):T,_=u(v);return typeof T=="string"?(0,D.unsafeStringify)(_):_}Yt.default=R;function u(T){return Uint8Array.of((T[3]&15)<<4|T[4]>>4&15,(T[4]&15)<<4|(T[5]&240)>>4,(T[5]&15)<<4|T[6]&15,T[7],(T[1]&15)<<4|(T[2]&240)>>4,(T[2]&15)<<4|(T[3]&240)>>4,16|(T[0]&240)>>4,(T[0]&15)<<4|(T[1]&240)>>4,T[8],T[9],T[10],T[11],T[12],T[13],T[14],T[15])}return Yt}var qe={},ui;function Bn(){if(ui)return qe;ui=1,Object.defineProperty(qe,"__esModule",{value:!0}),qe.updateV7State=void 0;const S=Mr(),D=be(),R={};function u(_,g,y){let b;if(_)b=v(_.random??_.rng?.()??(0,S.default)(),_.msecs,_.seq,g,y);else{const h=Date.now(),c=(0,S.default)();T(R,h,c),b=v(c,R.msecs,R.seq,g,y)}return g??(0,D.unsafeStringify)(b)}function T(_,g,y){return _.msecs??=-1/0,_.seq??=0,g>_.msecs?(_.seq=y[6]<<23|y[7]<<16|y[8]<<8|y[9],_.msecs=g):(_.seq=_.seq+1|0,_.seq===0&&_.msecs++),_}qe.updateV7State=T;function v(_,g,y,b,h=0){if(_.length<16)throw new Error("Random bytes length must be >= 16");if(!b)b=new Uint8Array(16),h=0;else if(h<0||h+16>b.length)throw new RangeError(`UUID byte range ${h}:${h+15} is out of buffer bounds`);return g??=Date.now(),y??=_[6]*127<<24|_[7]<<16|_[8]<<8|_[9],b[h++]=g/1099511627776&255,b[h++]=g/4294967296&255,b[h++]=g/16777216&255,b[h++]=g/65536&255,b[h++]=g/256&255,b[h++]=g&255,b[h++]=112|y>>>28&15,b[h++]=y>>>20&255,b[h++]=128|y>>>14&63,b[h++]=y>>>6&255,b[h++]=y<<2&255|_[10]&3,b[h++]=_[11],b[h++]=_[12],b[h++]=_[13],b[h++]=_[14],b[h++]=_[15],b}return qe.default=u,qe}var Xt={},hi;function zn(){if(hi)return Xt;hi=1,Object.defineProperty(Xt,"__esModule",{value:!0});const S=sr();function D(R){if(!(0,S.default)(R))throw TypeError("Invalid UUID");return parseInt(R.slice(14,15),16)}return Xt.default=D,Xt}var fi;function Hn(){return fi||(fi=1,function(S){Object.defineProperty(S,"__esModule",{value:!0}),S.version=S.validate=S.v7=S.v6ToV1=S.v6=S.v5=S.v4=S.v3=S.v1ToV6=S.v1=S.stringify=S.parse=S.NIL=S.MAX=void 0;var D=Ln();Object.defineProperty(S,"MAX",{enumerable:!0,get:function(){return D.default}});var R=In();Object.defineProperty(S,"NIL",{enumerable:!0,get:function(){return R.default}});var u=ir();Object.defineProperty(S,"parse",{enumerable:!0,get:function(){return u.default}});var T=be();Object.defineProperty(S,"stringify",{enumerable:!0,get:function(){return T.default}});var v=$i();Object.defineProperty(S,"v1",{enumerable:!0,get:function(){return v.default}});var _=Bi();Object.defineProperty(S,"v1ToV6",{enumerable:!0,get:function(){return _.default}});var g=jn();Object.defineProperty(S,"v3",{enumerable:!0,get:function(){return g.default}});var y=Nn();Object.defineProperty(S,"v4",{enumerable:!0,get:function(){return y.default}});var b=Un();Object.defineProperty(S,"v5",{enumerable:!0,get:function(){return b.default}});var h=qn();Object.defineProperty(S,"v6",{enumerable:!0,get:function(){return h.default}});var c=$n();Object.defineProperty(S,"v6ToV1",{enumerable:!0,get:function(){return c.default}});var f=Bn();Object.defineProperty(S,"v7",{enumerable:!0,get:function(){return f.default}});var m=sr();Object.defineProperty(S,"validate",{enumerable:!0,get:function(){return m.default}});var a=zn();Object.defineProperty(S,"version",{enumerable:!0,get:function(){return a.default}})}(Er)),Er}var Rt={},mi;function Vn(){if(mi)return Rt;mi=1,Object.defineProperty(Rt,"__esModule",{value:!0}),Rt.FakeEventTarget=void 0;let S=class{listeners={};addEventListener(R,u,T={}){u&&(this.listeners[R]??=[],this.listeners[R].push({callback:u,once:T.once===!0}))}removeEventListener(R,u){this.listeners[R]&&(this.listeners[R]=this.listeners[R].filter(T=>T.callback!==u))}dispatchEvent(R){if(!R||typeof R.type!="string")throw new Error("invalid event object");const u=this.listeners[R.type];if(!u)return!0;for(const T of[...u]){try{T.callback.call(this,R)}catch(v){setTimeout(()=>{throw v},0)}T.once&&this.removeEventListener(R.type,T.callback)}return!R.defaultPrevented}};return Rt.FakeEventTarget=S,Rt}var Jt={},gi;function Kn(){if(gi)return Jt;gi=1,Object.defineProperty(Jt,"__esModule",{value:!0}),Jt.clone=S;function S(D){if(D!==void 0)return Number.isNaN(D)?NaN:typeof structuredClone=="function"?structuredClone(D):JSON.parse(JSON.stringify(D))}return Jt}var _i;function Gn(){if(_i)return yt;_i=1,Object.defineProperty(yt,"__esModule",{value:!0}),yt.FakeMediaStreamTrack=void 0;const S=Hn(),D=Vn(),R=Kn();class u extends D.FakeEventTarget{#m;#l;#u;#e;#r;#t;#s;#h;#i;#f;#n;#a=null;#o=null;#c=null;#d=null;#p=null;constructor({kind:v,id:_,label:g,contentHint:y,enabled:b,muted:h,readyState:c,capabilities:f,constraints:m,settings:a,data:s}){super(),this.#m=_??(0,S.v4)(),this.#l=v,this.#u=g??"",this.#s=y??"",this.#r=b??!0,this.#t=h??!1,this.#e=c??"live",this.#h=f??{},this.#i=m??{},this.#f=a??{},this.#n=s??{}}get id(){return this.#m}get kind(){return this.#l}get label(){return this.#u}get contentHint(){return this.#s}set contentHint(v){this.#s=v}get enabled(){return this.#r}set enabled(v){const _=this.#r!==v;this.#r=v,_&&this.dispatchEvent(new Event("enabledchange"))}get muted(){return this.#t}get readyState(){return this.#e}get data(){return this.#n}set data(v){this.#n=v}get onmute(){return this.#a}set onmute(v){this.#a&&this.removeEventListener("mute",this.#a),this.#a=v,v&&this.addEventListener("mute",v)}get onunmute(){return this.#o}set onunmute(v){this.#o&&this.removeEventListener("unmute",this.#o),this.#o=v,v&&this.addEventListener("unmute",v)}get onended(){return this.#c}set onended(v){this.#c&&this.removeEventListener("ended",this.#c),this.#c=v,v&&this.addEventListener("ended",v)}get onenabledchange(){return this.#d}set onenabledchange(v){this.#d&&this.removeEventListener("enabledchange",this.#d),this.#d=v,v&&this.addEventListener("enabledchange",v)}get onstopped(){return this.#p}set onstopped(v){this.#p&&this.removeEventListener("stopped",this.#p),this.#p=v,v&&this.addEventListener("stopped",v)}addEventListener(v,_,g){super.addEventListener(v,_,g)}removeEventListener(v,_){super.removeEventListener(v,_)}stop(){this.#e!=="ended"&&(this.#e="ended",this.dispatchEvent(new Event("stopped")))}clone({id:v,data:_}={}){return new u({id:v??(0,S.v4)(),kind:this.#l,label:this.#u,contentHint:this.#s,enabled:this.#r,muted:this.#t,readyState:this.#e,capabilities:(0,R.clone)(this.#h),constraints:(0,R.clone)(this.#i),settings:(0,R.clone)(this.#f),data:_??(0,R.clone)(this.#n)})}getCapabilities(){return this.#h}getConstraints(){return this.#i}async applyConstraints(v={}){return this.#i=v,Promise.resolve()}getSettings(){return this.#f}remoteStop(){this.#e!=="ended"&&(this.#e="ended",this.dispatchEvent(new Event("stopped")),this.dispatchEvent(new Event("ended")))}remoteMute(){this.#t||(this.#t=!0,this.dispatchEvent(new Event("mute")))}remoteUnmute(){this.#t&&(this.#t=!1,this.dispatchEvent(new Event("unmute")))}}return yt.FakeMediaStreamTrack=u,yt}var wi;function Qn(){if(wi)return bt;wi=1,Object.defineProperty(bt,"__esModule",{value:!0}),bt.FakeHandler=void 0;const S=Gn(),D=ve(),R=G(),u=Q(),T=X(),v=Y(),_=re(),g=new R.Logger("FakeHandler"),y="FakeHandler";class b extends D.EnhancedEventEmitter{id;ordered;maxPacketLifeTime;maxRetransmits;label;protocol;constructor({id:f,ordered:m,maxPacketLifeTime:a,maxRetransmits:s,label:e,protocol:t}){super(),this.id=f,this.ordered=m,this.maxPacketLifeTime=a,this.maxRetransmits=s,this.label=e,this.protocol=t}close(){this.safeEmit("close"),this.emit("@close")}send(f){this.safeEmit("message",f)}addEventListener(f,m){this.on(f,m)}}let h=class zi extends _.HandlerInterface{_closed=!1;fakeParameters;_rtpParametersByKind;_cname=`CNAME-${u.generateRandomNumber()}`;_transportReady=!1;_nextLocalId=1;_tracks=new Map;_nextSctpStreamId=0;static createFactory(f){return()=>new zi(f)}constructor(f){super(),this.fakeParameters=f}get name(){return y}close(){g.debug("close()"),!this._closed&&(this._closed=!0)}setIceGatheringState(f){this.emit("@icegatheringstatechange",f)}setConnectionState(f){this.emit("@connectionstatechange",f)}async getNativeRtpCapabilities(){return g.debug("getNativeRtpCapabilities()"),this.fakeParameters.generateNativeRtpCapabilities()}async getNativeSctpCapabilities(){return g.debug("getNativeSctpCapabilities()"),this.fakeParameters.generateNativeSctpCapabilities()}run({direction:f,iceParameters:m,iceCandidates:a,dtlsParameters:s,sctpParameters:e,iceServers:t,iceTransportPolicy:i,proprietaryConstraints:r,extendedRtpCapabilities:n}){this.assertNotClosed(),g.debug("run()"),this._rtpParametersByKind={audio:T.getSendingRtpParameters("audio",n),video:T.getSendingRtpParameters("video",n)}}async updateIceServers(f){this.assertNotClosed(),g.debug("updateIceServers()")}async restartIce(f){this.assertNotClosed(),g.debug("restartIce()")}async getTransportStats(){return this.assertNotClosed(),new Map}async send({track:f,encodings:m,codecOptions:a,codec:s}){this.assertNotClosed(),g.debug("send() [kind:%s, track.id:%s]",f.kind,f.id),this._transportReady||await this.setupTransport({localDtlsRole:"server"});const e=u.clone(this._rtpParametersByKind[f.kind]),t=e.codecs.some(r=>/.+\/rtx$/i.test(r.mimeType));e.mid=`mid-${u.generateRandomNumber()}`,m||(m=[{}]);for(const r of m)r.ssrc=u.generateRandomNumber(),t&&(r.rtx={ssrc:u.generateRandomNumber()});e.encodings=m,e.rtcp={cname:this._cname,reducedSize:!0,mux:!0};const i=this._nextLocalId++;return this._tracks.set(i,f),{localId:String(i),rtpParameters:e}}async stopSending(f){if(g.debug("stopSending() [localId:%s]",f),!this._closed){if(!this._tracks.has(Number(f)))throw new Error("local track not found");this._tracks.delete(Number(f))}}async pauseSending(f){this.assertNotClosed()}async resumeSending(f){this.assertNotClosed()}async replaceTrack(f,m){this.assertNotClosed(),m?g.debug("replaceTrack() [localId:%s, track.id:%s]",f,m.id):g.debug("replaceTrack() [localId:%s, no track]",f),this._tracks.delete(Number(f)),this._tracks.set(Number(f),m)}async setMaxSpatialLayer(f,m){this.assertNotClosed(),g.debug("setMaxSpatialLayer() [localId:%s, spatialLayer:%s]",f,m)}async setRtpEncodingParameters(f,m){this.assertNotClosed(),g.debug("setRtpEncodingParameters() [localId:%s, params:%o]",f,m)}async getSenderStats(f){return this.assertNotClosed(),new Map}async sendDataChannel({ordered:f,maxPacketLifeTime:m,maxRetransmits:a,label:s,protocol:e}){this.assertNotClosed(),this._transportReady||await this.setupTransport({localDtlsRole:"server"}),g.debug("sendDataChannel()");const t=new b({id:this._nextSctpStreamId++,ordered:f,maxPacketLifeTime:m,maxRetransmits:a,label:s,protocol:e}),i={streamId:this._nextSctpStreamId,ordered:f,maxPacketLifeTime:m,maxRetransmits:a};return{dataChannel:t,sctpStreamParameters:i}}async receive(f){this.assertNotClosed();const m=[];for(const a of f){const{trackId:s,kind:e}=a;this._transportReady||await this.setupTransport({localDtlsRole:"client"}),g.debug("receive() [trackId:%s, kind:%s]",s,e);const t=this._nextLocalId++,i=new S.FakeMediaStreamTrack({kind:e});this._tracks.set(t,i),m.push({localId:String(t),track:i})}return m}async stopReceiving(f){if(!this._closed)for(const m of f)g.debug("stopReceiving() [localId:%s]",m),this._tracks.delete(Number(m))}async pauseReceiving(f){this.assertNotClosed()}async resumeReceiving(f){this.assertNotClosed()}async getReceiverStats(f){return this.assertNotClosed(),new Map}async receiveDataChannel({sctpStreamParameters:f,label:m,protocol:a}){return this.assertNotClosed(),this._transportReady||await this.setupTransport({localDtlsRole:"client"}),g.debug("receiveDataChannel()"),{dataChannel:new b({id:f.streamId,ordered:f.ordered,maxPacketLifeTime:f.maxPacketLifeTime,maxRetransmits:f.maxRetransmits,label:m,protocol:a})}}async setupTransport({localDtlsRole:f,localSdpObject:m}){const a=u.clone(this.fakeParameters.generateLocalDtlsParameters());f&&(a.role=f),this.emit("@connectionstatechange","connecting"),await new Promise((s,e)=>this.emit("@connect",{dtlsParameters:a},s,e)),this._transportReady=!0}assertNotClosed(){if(this._closed)throw new v.InvalidStateError("method called in a closed handler")}};return bt.FakeHandler=h,bt}var se={},vi;function Wn(){if(vi)return se;vi=1,Object.defineProperty(se,"__esModule",{value:!0}),se.generateRouterRtpCapabilities=R,se.generateNativeRtpCapabilities=u,se.generateNativeSctpCapabilities=T,se.generateLocalDtlsParameters=v,se.generateTransportRemoteParameters=_,se.generateProducerRemoteParameters=g,se.generateConsumerRemoteParameters=y,se.generateDataProducerRemoteParameters=b,se.generateDataConsumerRemoteParameters=h;const S=Q();function D(){return String(S.generateRandomNumber())}function R(){return S.deepFreeze({codecs:[{mimeType:"audio/opus",kind:"audio",preferredPayloadType:100,clockRate:48e3,channels:2,rtcpFeedback:[{type:"transport-cc"}],parameters:{useinbandfec:1,foo:"bar"}},{mimeType:"video/VP8",kind:"video",preferredPayloadType:101,clockRate:9e4,rtcpFeedback:[{type:"nack"},{type:"nack",parameter:"pli"},{type:"ccm",parameter:"fir"},{type:"goog-remb"},{type:"transport-cc"}],parameters:{"x-google-start-bitrate":1500}},{mimeType:"video/rtx",kind:"video",preferredPayloadType:102,clockRate:9e4,rtcpFeedback:[],parameters:{apt:101}},{mimeType:"video/H264",kind:"video",preferredPayloadType:103,clockRate:9e4,rtcpFeedback:[{type:"nack"},{type:"nack",parameter:"pli"},{type:"ccm",parameter:"fir"},{type:"goog-remb"},{type:"transport-cc"}],parameters:{"level-asymmetry-allowed":1,"packetization-mode":1,"profile-level-id":"42e01f"}},{mimeType:"video/rtx",kind:"video",preferredPayloadType:104,clockRate:9e4,rtcpFeedback:[],parameters:{apt:103}},{mimeType:"video/VP9",kind:"video",preferredPayloadType:105,clockRate:9e4,rtcpFeedback:[{type:"nack"},{type:"nack",parameter:"pli"},{type:"ccm",parameter:"fir"},{type:"goog-remb"},{type:"transport-cc"}],parameters:{"profile-id":0,"x-google-start-bitrate":1500}},{mimeType:"video/rtx",kind:"video",preferredPayloadType:106,clockRate:9e4,rtcpFeedback:[],parameters:{apt:105}}],headerExtensions:[{kind:"audio",uri:"urn:ietf:params:rtp-hdrext:sdes:mid",preferredId:1,preferredEncrypt:!1,direction:"sendrecv"},{kind:"video",uri:"urn:ietf:params:rtp-hdrext:sdes:mid",preferredId:1,preferredEncrypt:!1,direction:"sendrecv"},{kind:"video",uri:"urn:ietf:params:rtp-hdrext:sdes:rtp-stream-id",preferredId:2,preferredEncrypt:!1,direction:"recvonly"},{kind:"video",uri:"urn:ietf:params:rtp-hdrext:sdes:repaired-rtp-stream-id",preferredId:3,preferredEncrypt:!1,direction:"recvonly"},{kind:"audio",uri:"http://www.webrtc.org/experiments/rtp-hdrext/abs-send-time",preferredId:4,preferredEncrypt:!1,direction:"sendrecv"},{kind:"video",uri:"http://www.webrtc.org/experiments/rtp-hdrext/abs-send-time",preferredId:4,preferredEncrypt:!1,direction:"sendrecv"},{kind:"audio",uri:"http://www.ietf.org/id/draft-holmer-rmcat-transport-wide-cc-extensions-01",preferredId:5,preferredEncrypt:!1,direction:"recvonly"},{kind:"video",uri:"http://www.ietf.org/id/draft-holmer-rmcat-transport-wide-cc-extensions-01",preferredId:5,preferredEncrypt:!1,direction:"sendrecv"},{kind:"audio",uri:"urn:ietf:params:rtp-hdrext:ssrc-audio-level",preferredId:10,preferredEncrypt:!1,direction:"sendrecv"},{kind:"video",uri:"urn:3gpp:video-orientation",preferredId:11,preferredEncrypt:!1,direction:"sendrecv"},{kind:"video",uri:"urn:ietf:params:rtp-hdrext:toffset",preferredId:12,preferredEncrypt:!1,direction:"sendrecv"}]})}function u(){return S.deepFreeze({codecs:[{mimeType:"audio/opus",kind:"audio",preferredPayloadType:111,clockRate:48e3,channels:2,rtcpFeedback:[{type:"transport-cc"}],parameters:{minptime:10,useinbandfec:1}},{mimeType:"audio/ISAC",kind:"audio",preferredPayloadType:103,clockRate:16e3,channels:1,rtcpFeedback:[{type:"transport-cc"}],parameters:{}},{mimeType:"audio/CN",kind:"audio",preferredPayloadType:106,clockRate:32e3,channels:1,rtcpFeedback:[{type:"transport-cc"}],parameters:{}},{mimeType:"video/VP8",kind:"video",preferredPayloadType:96,clockRate:9e4,rtcpFeedback:[{type:"goog-remb"},{type:"transport-cc"},{type:"ccm",parameter:"fir"},{type:"nack"},{type:"nack",parameter:"pli"}],parameters:{baz:"1234abcd"}},{mimeType:"video/rtx",kind:"video",preferredPayloadType:97,clockRate:9e4,rtcpFeedback:[],parameters:{apt:96}},{mimeType:"video/VP9",kind:"video",preferredPayloadType:98,clockRate:9e4,rtcpFeedback:[{type:"goog-remb"},{type:"transport-cc"},{type:"ccm",parameter:"fir"},{type:"nack"},{type:"nack",parameter:"pli"}],parameters:{"profile-id":0}},{mimeType:"video/rtx",kind:"video",preferredPayloadType:99,clockRate:9e4,rtcpFeedback:[],parameters:{apt:98}}],headerExtensions:[{kind:"audio",uri:"urn:ietf:params:rtp-hdrext:sdes:mid",preferredId:1},{kind:"video",uri:"urn:ietf:params:rtp-hdrext:sdes:mid",preferredId:1},{kind:"video",uri:"urn:ietf:params:rtp-hdrext:toffset",preferredId:2},{kind:"video",uri:"http://www.webrtc.org/experiments/rtp-hdrext/abs-send-time",preferredId:3},{kind:"video",uri:"urn:3gpp:video-orientation",preferredId:4},{kind:"video",uri:"http://www.ietf.org/id/draft-holmer-rmcat-transport-wide-cc-extensions-01",preferredId:5},{kind:"video",uri:"http://www.webrtc.org/experiments/rtp-hdrext/playout-delay",preferredId:6},{kind:"video",uri:"http://www.webrtc.org/experiments/rtp-hdrext/video-content-type",preferredId:7},{kind:"video",uri:"http://www.webrtc.org/experiments/rtp-hdrext/video-timing",preferredId:8},{kind:"audio",uri:"urn:ietf:params:rtp-hdrext:ssrc-audio-level",preferredId:10}]})}function T(){return S.deepFreeze({numStreams:{OS:2048,MIS:2048}})}function v(){return S.deepFreeze({fingerprints:[{algorithm:"sha-256",value:"82:5A:68:3D:36:C3:0A:DE:AF:E7:32:43:D2:88:83:57:AC:2D:65:E5:80:C4:B6:FB:AF:1A:A0:21:9F:6D:0C:AD"}],role:"auto"})}function _(){return{id:D(),iceParameters:S.deepFreeze({iceLite:!0,password:"yku5ej8nvfaor28lvtrabcx0wkrpkztz",usernameFragment:"h3hk1iz6qqlnqlne"}),iceCandidates:S.deepFreeze([{foundation:"udpcandidate",address:"9.9.9.9",ip:"9.9.9.9",port:40533,priority:1078862079,protocol:"udp",type:"host",tcpType:"passive"},{foundation:"udpcandidate",address:"9.9.9.9",ip:"9:9:9:9:9:9",port:41333,priority:1078862089,protocol:"udp",type:"host",tcpType:"passive"}]),dtlsParameters:S.deepFreeze({fingerprints:[{algorithm:"sha-256",value:"A9:F4:E0:D2:74:D3:0F:D9:CA:A5:2F:9F:7F:47:FA:F0:C4:72:DD:73:49:D0:3B:14:90:20:51:30:1B:90:8E:71"},{algorithm:"sha-384",value:"03:D9:0B:87:13:98:F6:6D:BC:FC:92:2E:39:D4:E1:97:32:61:30:56:84:70:81:6E:D1:82:97:EA:D9:C1:21:0F:6B:C5:E7:7F:E1:97:0C:17:97:6E:CF:B3:EF:2E:74:B0"},{algorithm:"sha-512",value:"84:27:A4:28:A4:73:AF:43:02:2A:44:68:FF:2F:29:5C:3B:11:9A:60:F4:A8:F0:F5:AC:A0:E3:49:3E:B1:34:53:A9:85:CE:51:9B:ED:87:5E:B8:F4:8E:3D:FA:20:51:B8:96:EE:DA:56:DC:2F:5C:62:79:15:23:E0:21:82:2B:2C"}],role:"auto"}),sctpParameters:S.deepFreeze({port:5e3,OS:2048,MIS:2048,maxMessageSize:2e6})}}function g(){return S.deepFreeze({id:D()})}function y({id:c,codecMimeType:f}={}){switch(f){case"audio/opus":return{id:c??D(),producerId:D(),kind:"audio",rtpParameters:S.deepFreeze({codecs:[{mimeType:"audio/opus",payloadType:100,clockRate:48e3,channels:2,rtcpFeedback:[{type:"transport-cc"}],parameters:{useinbandfec:1,foo:"bar"}}],encodings:[{ssrc:46687003}],headerExtensions:[{uri:"urn:ietf:params:rtp-hdrext:sdes:mid",id:1},{uri:"http://www.ietf.org/id/draft-holmer-rmcat-transport-wide-cc-extensions-01",id:5},{uri:"urn:ietf:params:rtp-hdrext:ssrc-audio-level",id:10}],rtcp:{cname:"wB4Ql4lrsxYLjzuN",reducedSize:!0,mux:!0}})};case"audio/ISAC":return{id:c??D(),producerId:D(),kind:"audio",rtpParameters:S.deepFreeze({codecs:[{mimeType:"audio/ISAC",payloadType:111,clockRate:16e3,channels:1,rtcpFeedback:[{type:"transport-cc"}],parameters:{}}],encodings:[{ssrc:46687004}],headerExtensions:[{uri:"urn:ietf:params:rtp-hdrext:sdes:mid",id:1},{uri:"http://www.ietf.org/id/draft-holmer-rmcat-transport-wide-cc-extensions-01",id:5}],rtcp:{cname:"wB4Ql4lrsxYLjzuN",reducedSize:!0,mux:!0}})};case"video/VP8":return{id:c??D(),producerId:D(),kind:"video",rtpParameters:S.deepFreeze({codecs:[{mimeType:"video/VP8",payloadType:101,clockRate:9e4,rtcpFeedback:[{type:"nack"},{type:"nack",parameter:"pli"},{type:"ccm",parameter:"fir"},{type:"goog-remb"},{type:"transport-cc"}],parameters:{"x-google-start-bitrate":1500}},{mimeType:"video/rtx",payloadType:102,clockRate:9e4,rtcpFeedback:[],parameters:{apt:101}}],encodings:[{ssrc:99991111,rtx:{ssrc:99991112}}],headerExtensions:[{uri:"urn:ietf:params:rtp-hdrext:sdes:mid",id:1},{uri:"http://www.webrtc.org/experiments/rtp-hdrext/abs-send-time",id:4},{uri:"http://www.ietf.org/id/draft-holmer-rmcat-transport-wide-cc-extensions-01",id:5},{uri:"urn:3gpp:video-orientation",id:11},{uri:"urn:ietf:params:rtp-hdrext:toffset",id:12}],rtcp:{cname:"wB4Ql4lrsxYLjzuN",reducedSize:!0,mux:!0}})};case"video/H264":return{id:c??D(),producerId:D(),kind:"video",rtpParameters:S.deepFreeze({codecs:[{mimeType:"video/H264",payloadType:103,clockRate:9e4,rtcpFeedback:[{type:"nack"},{type:"nack",parameter:"pli"},{type:"ccm",parameter:"fir"},{type:"goog-remb"},{type:"transport-cc"}],parameters:{"level-asymmetry-allowed":1,"packetization-mode":1,"profile-level-id":"42e01f"}},{mimeType:"video/rtx",payloadType:104,clockRate:9e4,rtcpFeedback:[],parameters:{apt:103}}],encodings:[{ssrc:99991113,rtx:{ssrc:99991114}}],headerExtensions:[{uri:"urn:ietf:params:rtp-hdrext:sdes:mid",id:1},{uri:"http://www.webrtc.org/experiments/rtp-hdrext/abs-send-time",id:4},{uri:"http://www.ietf.org/id/draft-holmer-rmcat-transport-wide-cc-extensions-01",id:5},{uri:"urn:3gpp:video-orientation",id:11},{uri:"urn:ietf:params:rtp-hdrext:toffset",id:12}],rtcp:{cname:"wB4Ql4lrsxYLjzuN",reducedSize:!0,mux:!0}})};default:throw new TypeError(`unknown codecMimeType '${f}'`)}}function b(){return S.deepFreeze({id:D()})}function h({id:c}={}){return{id:c??D(),dataProducerId:D(),sctpStreamParameters:S.deepFreeze({streamId:666,maxPacketLifeTime:5e3,maxRetransmits:void 0})}}return se}var Si;function oa(){return Si||(Si=1,function(S){Object.defineProperty(S,"__esModule",{value:!0}),S.debug=S.testFakeParameters=S.FakeHandler=S.ortc=S.parseScalabilityMode=S.detectDeviceAsync=S.detectDevice=S.Device=S.version=S.types=void 0;const D=er();S.debug=D.default,S.types=xn(),S.version="3.12.5";var R=qi();Object.defineProperty(S,"Device",{enumerable:!0,get:function(){return R.Device}}),Object.defineProperty(S,"detectDevice",{enumerable:!0,get:function(){return R.detectDevice}}),Object.defineProperty(S,"detectDeviceAsync",{enumerable:!0,get:function(){return R.detectDeviceAsync}});var u=Se();Object.defineProperty(S,"parseScalabilityMode",{enumerable:!0,get:function(){return u.parse}}),S.ortc=X();var T=Qn();Object.defineProperty(S,"FakeHandler",{enumerable:!0,get:function(){return T.FakeHandler}}),S.testFakeParameters=Wn()}(Sr)),Sr}export{oa as r};
